(window.webpackJsonp=window.webpackJsonp||[]).push([[4],[,,,,,,,,function(t,e,i){i=[i,e,i(9),i(248)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e)}.apply(e,i);void 0!==e&&(t.exports=e)},,,function(t,e,i){i=[i,e,i(9),i(249),i(250),i(251),i(252),i(253),i(254),i(255)],e=function(t,e,i,n,o,s,r,a,c,l){Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e),i.__exportStar(l,e)}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,i){i=[i,e,i(9),i(290),i(106),i(291),i(292),i(107),i(293),i(294),i(295),i(296),i(297),i(74),i(108),i(298),i(299)],e=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v){Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e),i.__exportStar(l,e),i.__exportStar(u,e),i.__exportStar(p,e),i.__exportStar(d,e),i.__exportStar(h,e),i.__exportStar(f,e),i.__exportStar(m,e),i.__exportStar(v,e)}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,i){i=[i,e,i(9),i(118),i(301),i(302),i(122),i(121),i(303),i(77),i(119),i(120),i(304)],e=function(t,e,i,n,o,s,r,a,c,l,u,p,d){Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e),i.__exportStar(l,e),i.__exportStar(u,e),i.__exportStar(p,e),i.__exportStar(d,e)}.apply(e,i);void 0!==e&&(t.exports=e)},,,,,,,,,function(t,e,s){var i=[s,e,s(1),s(412)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$scope","$timeout","$log","$element","ProfileService"],o.prototype.$onInit=function(){var e=this,t=this.$element[0].querySelectorAll("img")[0];this.elaborateAvatarData(),void 0!==t&&(t.onerror=function(){var t=e.avatar+"";e.$log.warn("Error loading avatar ("+e.avatarEntity.email+"): "+t),e.getImg(),e.$scope.$applyAsync()}),this.$scope.$watch(function(){return e.avatarEntity},function(){e.elaborateAvatarData()},!0)},o.prototype.$onChanges=function(t){t.avatarEntity&&this.getImg()},o.prototype.elaborateAvatarData=function(){this.hasPicture=void 0!==this.avatarEntity.picture,this.altText=this.getAltText(),this.getImg()},o.prototype.getImg=function(){void 0!==this.avatarEntity.picture?this.avatar=this.avatarEntity.picture:this.avatar=this.ProfileService.getInitial(this.avatarEntity.fullName,this.avatarEntity.email)},o.prototype.getAltText=function(){return this.ProfileService.getInitial(this.avatarEntity.fullName,this.avatarEntity.email)};var n=o;function o(t,e,i,n,o){this.$scope=t,this.$timeout=e,this.$log=i,this.$element=n,this.ProfileService=o,this.disabled=!1}e.AvatarModule=i.module("components.avatar",[]).component("avatar",{bindings:{avatarEntity:"<",avatarSize:"@",disabled:"<?"},controller:n,templateUrl:s(413),transclude:!0})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9),i(308),i(164),i(163),i(162),i(160),i(161),i(78),i(309),i(310),i(311),i(319),i(320)],e=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f){Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e),i.__exportStar(l,e),i.__exportStar(u,e),i.__exportStar(p,e),i.__exportStar(d,e),i.__exportStar(h,e),i.__exportStar(f,e)}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,s){var i=[s,e,s(1),s(415)],e=function(t,e,i){var n;function o(t,e,i){this.$mdDialog=t,this.config=i,this.hideSubmitButton=!1,this.config.cancelText=void 0===i.cancelText?"MAIN.CANCEL":i.cancelText,void 0!==i.hideSubmit&&(this.hideSubmitButton=i.hideSubmit),this.explanation=!1===this.config.translate?i.explanation:e.instant(i.explanation,i.explanationParams),this.title=!1===this.config.translate?i.title:e.instant(i.title,i.titleParams)}Object.defineProperty(e,"__esModule",{value:!0}),(n=e.WarningDialogTypes||(e.WarningDialogTypes={})).info="info",n.warning="warning",n.error="error",o.$inject=["$mdDialog","$translate","config"],o.prototype.cancel=function(){this.$mdDialog.cancel()},o.prototype.submit=function(){this.$mdDialog.hide()},o.factory=function(t){return{controller:o,locals:{config:t},templateUrl:s(416)}},e.WarningDialog=o,e.WarningDialogModule=i.module("common.warningDialog",[])}.apply(e,i);void 0!==e&&(t.exports=e)},,,,,function(t,e,i){i=[i,e,i(9),i(1),i(105),i(109),i(111),i(112),i(113),i(75),i(114),i(115),i(116),i(117),i(123),i(125),i(126),i(127),i(128),i(43),i(129),i(130),i(131),i(132),i(133),i(134),i(135),i(136),i(137),i(138),i(139),i(140),i(142),i(143),i(144),i(145),i(146),i(147),i(148),i(149),i(150),i(151),i(152),i(153),i(154),i(156),i(157),i(158),i(159),i(167),i(168),i(169),i(170),i(171),i(172),i(105),i(109),i(111),i(112),i(113),i(75),i(114),i(115),i(116),i(117),i(123),i(125),i(126),i(127),i(128),i(43),i(129),i(130),i(132),i(131),i(133),i(134),i(135),i(136),i(137),i(138),i(139),i(140),i(142),i(143),i(144),i(145),i(146),i(147),i(148),i(149),i(150),i(151),i(152),i(153),i(154),i(156),i(157),i(158),i(159),i(167),i(168),i(169),i(170),i(171),i(172)],e=function(P,t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v,g,S,$,y,b,w,E,C,T,A,I,R,O,D,x,M,_,L,N,k,F,U,V,j,q,B,z,G,H,W,K,Y,Q,Z,X,J,tt,et,it,nt,ot,st,rt,at,ct,lt,ut,pt,dt,ht,ft,mt,vt,gt,St,$t,yt,bt,wt,Et,Ct,Tt,At,It,Rt,Ot,Dt,xt,Mt,_t,Lt,Nt,Pt,kt,Ft,Ut,Vt,jt,qt,Bt,zt,Gt,Ht,Wt,Kt,Yt,Qt,Zt){Object.defineProperty(t,"__esModule",{value:!0}),e.__exportStar(et,t),e.__exportStar(it,t),e.__exportStar(nt,t),e.__exportStar(ot,t),e.__exportStar(st,t),e.__exportStar(rt,t),e.__exportStar(at,t),e.__exportStar(ct,t),e.__exportStar(lt,t),e.__exportStar(ut,t),e.__exportStar(pt,t),e.__exportStar(dt,t),e.__exportStar(ht,t),e.__exportStar(ft,t),e.__exportStar(mt,t),e.__exportStar(vt,t),e.__exportStar(gt,t),e.__exportStar(St,t),e.__exportStar($t,t),e.__exportStar(yt,t),e.__exportStar(bt,t),e.__exportStar(wt,t),e.__exportStar(Et,t),e.__exportStar(Ct,t),e.__exportStar(Tt,t),e.__exportStar(At,t),e.__exportStar(It,t),e.__exportStar(Rt,t),e.__exportStar(Ot,t),e.__exportStar(Dt,t),e.__exportStar(xt,t),e.__exportStar(Mt,t),e.__exportStar(_t,t),e.__exportStar(Lt,t),e.__exportStar(Nt,t),e.__exportStar(Pt,t),e.__exportStar(kt,t),e.__exportStar(Ft,t),e.__exportStar(Ut,t),e.__exportStar(Vt,t),e.__exportStar(jt,t),e.__exportStar(qt,t),e.__exportStar(Bt,t),e.__exportStar(zt,t),e.__exportStar(Gt,t),e.__exportStar(Ht,t),e.__exportStar(Wt,t),e.__exportStar(Kt,t),e.__exportStar(Yt,t),e.__exportStar(Qt,t),e.__exportStar(Zt,t),t.ZivverServicesModule=i.module("zivver.services",[]).service("AccessRightGrantService",n.AccessRightGrantService).service("AccountsService",o.AccountsService).service("ActiveSessionsService",s.ActiveSessionsService).service("AliasService",r.AliasService).service("AuditLogService",a.AuditLogService).service("AuthSessionService",c.AuthSessionService).service("AvailabilityService",l.AvailabilityService).service("BusinessRulesService",u.BusinessRulesService).service("CommunicationLogService",p.CommunicationLogService).service("ContactsService",d.ContactsService).service("ConversationStartersService",h.ConversationStartersService).service("ConversationsService",f.ConversationsService).service("DelegateAccountService",m.DelegateAccountService).service("DeviceService",v.DeviceService).service("DraftsRecipientsService",g.DraftsRecipientsService).service("DraftsService",S.DraftsService).service("DraftsValidationService",$.DraftsValidationService).service("FilesOutService",y.FilesOutService).service("FTPService",b.FTPService).service("GeoService",E.GeoService).service("FunctionsService",w.FunctionsService).service("InvitesService",C.InvitesService).service("KeysService",T.KeysService).service("LabelService",A.LabelService).service("LinkifyService",I.LinkifyService).service("LoggerService",R.LoggerService).service("LoginService",O.LoginService).service("MediaService",D.MediaService).service("MessengerService",x.MessengerService).service("MultifactorService",M.MultifactorService).service("NotificationService",_.NotificationService).service("OrganizationService",L.OrganizationService).service("OrganizationUnitService",N.OrganizationUnitService).service("PasswordService",k.PasswordService).service("PrintService",F.PrintService).service("ProfileService",U.ProfileService).service("RecoveryKeyService",V.RecoveryKeyService).service("ReplyService",j.ReplyService).service("SanitizeService",q.SanitizeService).service("ScrollService",B.ScrollService).service("SettingsService",z.SettingsService).service("ShareTokenService",G.ShareTokenService).service("SignatureService",H.SignatureService).service("SignupService",W.SignupService).service("SpecialsService",K.SpecialsService).service("StorageService",Y.StorageService).service("SurveyService",Z.SurveyService).service("SubscriptionService",Q.SubscriptionService).service("ThemeService",X.ThemeService).service("WebSocketService",J.WebSocketService).service("WizardService",tt.WizardService).config(R.decorateLogService).run(["DeviceService",function(t){t.isDesktop()}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,u){var i=[u,e,u(1),u(54),u(11),u(37),u(395)],e=function(t,e,i,n,o,s){Object.defineProperty(e,"__esModule",{value:!0}),a.$inject=["$rootScope","$log","AppSwitcherService"],a.prototype.$onInit=function(){var e=this;this.current=this.AppSwitcherService.getContext(),this.AppSwitcherService.getContexts().then(function(t){e.checkCurrentContext(t,e.current),e.contexts=t}),this.$rootScope.$on(o.AuthEvents.scopesChanged,function(){e.AppSwitcherService.getContexts().then(function(t){e.checkCurrentContext(t,e.current),e.contexts=t})})},a.prototype.activateContext=function(t){t.specialId!==this.current.specialId&&this.AppSwitcherService.switchContext(t,"conversations.label",{label:"inbox"})},a.prototype.toggleDropdown=function(){this.open=!this.open},a.prototype.checkCurrentContext=function(t,e){var i=t.map(function(t){return t.theme}),n=t.map(function(t){return t.specialId}),o=this.AppSwitcherService.getDefaultContext();void 0!==e.specialId&&-1===n.indexOf(e.specialId)?(this.$log.warn("Appswitcher resumed with special not active (anymore)",{contexts:t,current:e}),this.AppSwitcherService.switchContext(o,"conversations.label",{})):void 0!==e.theme&&void 0===e.specialId&&(-1===(n=i.indexOf(e.theme))?(this.$log.warn("Appswitcher theme is not defined (anymore)",{contexts:t,current:e}),this.AppSwitcherService.switchContext(o,"conversations.label",{})):(i=t[n],this.$log.debug("Switching to context for theme",{context:i}),this.AppSwitcherService.switchContext(i,"conversations.label",{})))};var r=a;function a(t,e,i){this.$rootScope=t,this.$log=e,this.AppSwitcherService=i,this.contexts=[],this.open=!1}e.AppSwitcher=r,l.$inject=["$window","$q","$state","SpecialsService","StorageService","AuthSessionService"],l.prototype.getContext=function(){return this.context},l.prototype.getDefaultContext=function(){return i.extend({},this.defaultContext)},l.prototype.getContexts=function(){var e=this;return void 0===this.contextsPromise&&(!1===this.AuthSessionService.hasScope(o.Scopes.SPECIALSUSER)?this.contextsPromise=this.$q.resolve([this.defaultContext]):this.contextsPromise=this.SpecialsService.listSpecials().then(function(t){var i=[];return t.filter(function(t){return"active"===t.status}).forEach(function(t){var e=s.importSpecialTheme(t.theme);i.push({specialId:t.id,name:t.name,icon:e.iconSvg,theme:t.theme})}),e.contexts=[e.defaultContext].concat(i),e.contexts})),this.contextsPromise},l.prototype.switchContext=function(t,e,i){void 0===t.specialId?(this.StorageService.removeItem("LOCAL","application.context"),this.StorageService.removeItem("SESSION","application.theme")):(this.StorageService.setItem("LOCAL","application.context",t),this.StorageService.setItem("SESSION","application.theme",t.theme)),n.locationReload(e,i,this.$window,this.$state,this.StorageService)},l.prototype.switchToSpecialId=function(e,i,n){var o=this;return this.getContexts().then(function(t){t=t.filter(function(t){return t.specialId===e});return 0!==t.length&&(o.switchContext(t[0],i,n),!0)})},l.prototype.restoreContext=function(){var t,e=this.StorageService.getItem("LOCAL","application.context")||this.getDefaultContext();return void 0!==(null==e?void 0:e.theme)&&(t=s.importSpecialTheme(e.theme),e.icon=t.iconSvg),e},l.prototype.setContextStylesheet=function(t){void 0!==t.theme&&s.loadTheme(t.theme)};var c=l;function l(t,e,i,n,o,s){this.$window=t,this.$q=e,this.$state=i,this.SpecialsService=n,this.StorageService=o,this.AuthSessionService=s,this.contexts=[],this.defaultContext={name:"Zivver",icon:u(396)},this.context=this.restoreContext(),this.setContextStylesheet(this.context)}e.AppSwitcherService=c,e.AppSwitcherModule=i.module("components.AppSwitcher",[]).service("AppSwitcherService",c).component("appSwitcher",{controller:r,template:u(397)}).run(["$transitions","$mdDialog","$translate","AppSwitcherService",function(t,r,a,c){t.onBefore({},function(t){var e=t.to(),i=t.params(),n=c.getContext(),o=e.name,s=!1;void 0!==n.specialId&&(-1<o.indexOf("settings.")&&(s=!0),-1<o.indexOf("organization.")&&(s=!0),s=-1<o.indexOf("contacts.")||s)&&(t.abort(),r.show(r.confirm().textContent(a.instant("app-switcher.CONFIRM.SWITCH",{theme:n.name})).ok(a.instant("MAIN.OK")).cancel(a.instant("MAIN.CANCEL"))).then(function(){c.switchContext(c.getDefaultContext(),e.name,i)}))})}])}.apply(e,i);void 0!==e&&(t.exports=e)},,,,function(t,e,s){e=function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i={telede:s(312),teleecg:s(313)};function n(t){var e=(new Date).toISOString().split("T").shift().replace(/-/g,""),i=document.createElement("link");i.rel="stylesheet",i.media="screen",i.href=t+"?"+e,document.body.appendChild(i)}function o(t){return void 0!==i[t]}e.loadTheme=function(t){if(!1!==o(t)){document.body.classList.add("theme-"+t),n(i[t]),n("/assets/v2/themes/"+t+"/material.css");try{window.sessionStorage.setItem("application.theme",JSON.stringify(t))}catch(t){}}},e.unloadTheme=function(){for(var t=document.body.classList,e=0,i=t.value.split(" ");e<i.length;e++){var n=i[e];0===n.indexOf("theme-")&&t.remove(n)}window.sessionStorage.removeItem("application.theme")},e.validTheme=o,e.importSpecialTheme=function(t){switch(t){case"telede":return s(314);case"teleecg":return s(317);default:throw new Error("Unexpected theme: "+t)}}}.apply(e,[s,e]);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9),i(242),i(243),i(244)],e=function(t,e,i,n,o,s){Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e)}.apply(e,i);void 0!==e&&(t.exports=e)},,,,function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.COLOR_ROCKET_BLUE="#0b74e7",e.COLOR_MIDNIGHT_BLUE="#003668",e.COLOR_SEA_BLUE="#00a9e0",e.COLOR_SKY_BLUE="#e6f7fc",e.COLOR_MINT_GREEN="#cef5ee",e.COLOR_CLOVER_GREEN="#00ba9b",e.COLOR_APRICOT_ORANGE="#ffeedb",e.COLOR_CARROT_ORANGE="#fb743d",e.COLOR_COTTON_PINK="#ffe6e9",e.COLOR_LAVA_RED="#e81b42",e.COLOR_WHITE="#ffffff",e.COLOR_INK_BLACK="#1f1f1f",e.COLOR_ASH_GREY="#fafafa",e.COLOR_FOG_GREY="#eeeeee",e.COLOR_SILVER_GREY="#e0e0e0",e.COLOR_ELEPHANT_GREY="#9e9e9e",e.COLOR_SLATE_GREY="#757575",e.COLOR_LAVANDER_PURPLE="#ecdef9",e.COLOR_INDIGO_PURPLE="#9013fe",e.COLOR_TANGERINE_YELLOW="#ffcc00",e.COLOR_LIGHT_YELLOW="#fff5cc",e.COLOR_RICK_GOLD="#ddaa44",e.COLOR_LIGHT_GOLD="#f7ebd4",e.COLOR_HOT_MAGENDA="#ff00cc",e.COLOR_LIGHT_MAGENDA="#ffccf5"}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(9),i(15),i(8)],e=function(t,e,o,s,r){function i(t,e,i,n,o){this.$rootScope=t,this.$http=e,this.$q=i,this.$window=n,this.DraftsValidationService=o}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$rootScope","$http","$q","$window","DraftsValidationService"],i.prototype.list=function(t,e){return this.$http.get("/api/drafts",{params:{offset:t,limit:e,creator:"webapp"}}).then(function(t){return t.data}).then(function(t){return{items:t.items.map(function(t){return new s.Draft(t)}),pagination:t.pagination}})},i.prototype.get=function(t){return this.$http.get("/api/drafts/"+t).then(function(t){return t.data}).then(function(t){return new s.Draft(t)})},i.prototype.save=function(t,e){t.isModified=!1;e=this.getDraftRequestEntity(t,e);return void 0===t.id?this.$http.post("/api/drafts",e).then(function(t){return t.data}).then(function(t){return new s.Draft(t)}):this.$http.put("/api/drafts/"+t.id,e).then(function(t){return t.data}).then(function(t){return new s.Draft(t)})},i.prototype.remove=function(t){var e=this,i=[this.$http.delete("/api/drafts/"+t.id)];return t.files.forEach(function(t){i.push(e.$http.delete("/api/files_out/"+t.id))}),this.$q.all(i).then(function(){return!0})},i.prototype.send=function(e){var i=this,t={draft:this.getDraftRequestEntity(e)};return this.$http.post("/api/drafts/finalize",t).then(function(t){return t.data}).then(function(t){return new s.FinalizeResult(t)}).then(function(t){return null==e.id?i.$q.reject():(i.$http.delete("/api/drafts/"+e.id),t)})},i.prototype.validate=function(i){var n=this,t={draft:this.getDraftRequestEntity(i)};return this.$http.put("/api/drafts/validation",t).then(function(t){t.status===r.HTTP_ACCEPTED&&0===(null==(e=t.data.violations)?void 0:e.length)&&(t.data.violations=i.validation.inputViolations,t.data.validDraft=i.validation.validDraft);var e=new s.ValidationStatus(t.data,n.DraftsValidationService.getDismissedViolationsIds(i.id));return e.validationCompleted=t.status===r.HTTP_OK,e=e.addClientViolations(i.validation.clientViolations),n.$rootScope.$broadcast(a.ValidationsUpdated,{validation:e}),e})},i.prototype.setAccessRightGrant=function(t){void 0===t?delete this.grantToken:this.grantToken=t},i.prototype.getDraftRequestEntity=function(t,e){var i,n=t.toRequestEntity();if(t.isReply()||t.isForward()){if(void 0===this.grantToken)throw Error("accessRightGrant is undefined");void 0!==t.quote&&(i={conversationId:t.quote.conversationInfo.id,messageIds:t.quote.messages.filter(function(t){return!1===t.revoked}).map(function(t){return t.id})}),0!==(i=void 0!==e?e:i).messageIds.length&&(n.quote=o.__assign(o.__assign({},i),{downloadGrant:this.grantToken.token}))}return n},e.DraftsService=i,n.ValidationsUpdated="DraftEvents.ValidationsUpdated";var a=n;function n(){}e.DraftEvents=a}.apply(e,i);void 0!==e&&(t.exports=e)},,,,,,,function(t,e,s){var i=[s,e,s(1),s(458)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$rootScope","$scope","$timeout","$element","$mdSidenav"],o.prototype.$onInit=function(){var e=this;this.locationChangeStartListener=this.$rootScope.$on("$locationChangeStart",function(t){t.preventDefault(),e.$mdSidenav("sidepane").close()}),this.$scope.$applyAsync(function(){e.$mdSidenav("sidepane").open(),e.$mdSidenav("sidepane").onClose(function(){void 0!==e.onClose&&e.$timeout(function(){return e.onClose()},250)})})},o.prototype.$onDestroy=function(){this.locationChangeStartListener()},o.prototype.closePane=function(){this.$mdSidenav("sidepane").close()};var n=o;function o(t,e,i,n,o){this.$rootScope=t,this.$scope=e,this.$timeout=i,this.$element=n,this.$mdSidenav=o,document.body.appendChild(this.$element[0])}e.SidepaneModule=i.module("components.sidePane",[]).component("sidepane",{controller:n,bindings:{onClose:"&"},transclude:{title:"paneTitle",content:"paneContent"},template:s(459)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(102)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var s=window.snowPlow,n=(e.trackPageView=function(t){s("trackPageView",t,r())},e.trackError=function(t,e,i,n,o){s("trackError",t,e,i,n,o,r())},e.setUserId=function(t){s("setUserId",t)},e.setCustomUrl=function(t,e){e=(e=void 0===e||e)?i.anonymizeUrl(new URL(t)):t;s("setCustomUrl",e),s("setReferrerUrl",e)},{});function r(){return Object.keys(n).map(function(t){return n[t]})}function o(t,e){n[t]=e}function a(t){delete n[t]}e.setUserContext=o,e.deleteUserContext=a,e.clearUserContext=function(){s("setUserId",null),Object.keys(n).forEach(function(t){return delete n[t]})},e.setDelegationContext=function(t,e){o("delegation",{schema:"iglu:com.zivver/delegation_context/jsonschema/1-0-0",data:{delegated_from_account_uuid:t,delegated_to_account_uuid:e}})},e.setConversationContext=function(t,e){o("conversation",{schema:"iglu:com.zivver/conversation_context/jsonschema/1-0-1",data:{conversation_uuid:t,bcc_of_conversation_uuid:e=void 0===e?null:e}})},e.deleteConversationContext=function(){a("conversation")}}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.encodeEmailForURI=function(t){return encodeURI(t).replace(/#/g,"%23").replace(/\$/g,"%24").replace(/&/g,"%26").replace(/\+/g,"%2B").replace(/\//g,"%2F").replace(/\\/g,"%5C").replace(/=/g,"%3D").replace(/\?/g,"%3F").replace(/\^/g,"%5E").replace(/~/g,"%7E")}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(9)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.removeEmptyProps=function(t){var e=i.__assign({},t);return Object.keys(t).forEach(function(t){""!==e[t]&&null!=e[t]||delete e[t]}),e}}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.locationReload=function(t,e,i,n,o){i.location.href=n.href(t,e=void 0===e?{}:e,{absolute:!0})}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,p){var i=[p,e,p(1),p(181),p(27),p(81),p(24),p(423)],e=function(t,e,i,n,o,s,r){Object.defineProperty(e,"__esModule",{value:!0}),c.$inject=["$rootScope","$log","$mdDialog","$translate","$state","ContactsService","ConversationsService","MessengerService","ProfileService","DeviceService"],c.prototype.$onInit=function(){this.expandable=!1===this.profile.isGuest(),this.collapsedList="READ"===this.listTitle||"BCC"===this.listTitle||"UNREAD"===this.listTitle||"BOUNCES"===this.listTitle,this.isQuotedInfo=this.isQuotedInfo||!1,this.collapsible=this.collapsible||!1,this.isConversationInfo="CONVERSATION"===this.infoType},c.prototype.$onChanges=function(t){void 0!==t.participants&&this.setParticipantsRemoved(),void 0!==this.participants&&this.orderByVerificationProblem()},c.prototype.openContact=function(t){this.profile.isGuest()||this.profile.email===t.email||this.$state.go("contacts.view",{email:[t.email]})},c.prototype.isVerified=function(t){return!!this.hasAccessRights(t)&&"generatedCode"!==t.accessRight.accessRightType},c.prototype.setParticipantsRemoved=function(){var i,n=this;void 0!==this.conversationParticipants&&(i=this.conversationParticipants.map(function(t){return t.email}),this.participants.forEach(function(t,e){n.isQuotedInfo?i.indexOf(t.participant.email)<0&&(n.participants[e].removed=!0):i.indexOf(t.email)<0&&(n.participants[e].removed=!0)}))},c.prototype.orderByVerificationProblem=function(){var i=this;this.participants.sort(function(t,e){if(i.hasAccessRights(t)&&i.hasAccessRights(e))return Number(e.accessRight.verificationProblem)-Number(t.accessRight.verificationProblem)})},c.prototype.hasAccessRights=function(t){return void 0!==t.accessRight},c.prototype.isDisabled=function(t){return t.email===this.profile.email||!1===t.active||!0===t.removed},c.prototype.toggleCard=function(t){!0===this.expandable&&(t.collapsed=!t.collapsed)},c.prototype.editVerificationMethod=function(e){var i=this,t=new s.RecipientDialog,n=e;t.resolve.recipient=function(){return i.ContactsService.get(n.email).then(function(t){return t.toRecipient()})},t.locals.verificationProblem=n.accessRight.verificationProblem,t.locals.editParticipant=!0,this.$mdDialog.show(t).then(function(t){t=t.accessRightSetup;i.ConversationsService.updateVerification(i.conversationId,e.uuid,{accessRightSetup:t}).then(function(t){return e.accessRight=t})})},c.prototype.removeParticipant=function(e){var i=this,t=o.WarningDialog.factory({title:"participants-list.REMOVE.DIALOG.TITLE",explanation:"participants-list.REMOVE.DIALOG.EXPLANATION",explanationParams:{email:e},submitText:"participants-list.REMOVE.DIALOG.CONFIRM",type:o.WarningDialogTypes.error});this.$mdDialog.show(t).then(function(){i.ConversationsService.removeParticipant(i.conversationId,e).then(function(){i.participants=i.participants.filter(function(t){return t.email!==e}),i.$rootScope.$broadcast(l.Updated,i.participants),i.MessengerService.toast("participants-list.REMOVE.SUCCESS")}).catch(function(t){i.$log.warn("Participant "+e+" could not be removed from conversation "+i.conversationId,{error:t}),i.MessengerService.toast("participants-list.REMOVE.FAILED")})})},c.prototype.toggleCollapsedList=function(){this.collapsedList=!this.collapsedList},c.prototype.determineIcon=function(t){var e;if(this.isVerified(t))switch(t.accessRight.accessRightType){case"email":e="email";break;case"password":e="keyboard";break;case"sms":e="sms";break;case"zivver":e="lock"}else e="lock_outline";return e},c.prototype.getAccessRightType=function(t){var e,i="participants-list.LABELS";switch(t.accessRight.accessRightType){case"email":e=this.$translate.instant(i+".EMAIL");break;case"generatedCode":case"password":e=this.$translate.instant(i+".ACCESS-CODE");break;case"sms":e=this.$translate.instant(i+".SMS");break;case"zivver":e=this.$translate.instant(i+".ZIVVER")}return e},c.prototype.getAccessType=function(t){return"email"===t.accessRight.accessRightType||"zivver"===t.accessRight.accessRightType?t.email:t.accessRight.challengeInformation},c.prototype.showVerificationInput=function(t){return this.isConversationInfo&&("password"===t.accessRight.accessRightType&&void 0!==t.accessRight.challengeInformation||"password"!==t.accessRight.accessRightType)},c.prototype.canEditVerificationMethod=function(t){return"zivver"!==t.accessRight.accessRightType};var a=c;function c(t,e,i,n,o,s,r,a,c,l){this.$rootScope=t,this.$log=e,this.$mdDialog=i,this.$translate=n,this.$state=o,this.ContactsService=s,this.ConversationsService=r,this.MessengerService=a,this.ProfileService=c,this.DeviceService=l,this.bccIcon=p(424)}e.ParticipantsList=a,u.Updated="participants:updated";var l=u;function u(){}e.Events=l,e.ParticipantsListModule=i.module("components.ParticipantsList",[r.AvatarModule.name,n.ParticipantAvatarsModule.name,o.WarningDialogModule.name]).component("participantsList",{bindings:{collapsible:"<",conversationId:"<",conversationParticipants:"<",expandable:"<",infoType:"<",icon:"@",isQuotedInfo:"<",listTitle:"@",profile:"<",participants:"<",svg:"@"},controller:a,templateUrl:p(425)})}.apply(e,i);void 0!==e&&(t.exports=e)},,,,,,,,,,,,,,,,function(t,e,c){var i=[c,e,c(1),c(14),c(263),c(264)],e=function(t,s,e,r){function i(i,n){var o=[];return function(t){var e=n.use();void 0!==s.AvailableLanguages[e]&&void 0===o[t]&&(i.warn("Missing "+e+" translation for id "+t),o[t]=!0)}}function n(e){return function(t){return e.get(s.TRANSLATIONS[t.key]).then(function(t){return t.data})}}function o(t,e,i){var n;e.useCookieStorage(),e.useSanitizeValueStrategy("escaped"),e.useLoader("i18nTranslationsLoader"),e.useMissingTranslationHandler("i18nMissingTranslationsLogger"),n=(navigator.language||navigator.userLanguage).substr(0,2).toLowerCase(),Object.keys(s.AvailableLanguages).indexOf(n),e.registerAvailableLanguageKeys(Object.keys(s.AvailableLanguages),{en_US:"en",en_UK:"en",nl_NL:"nl",nl_BE:"nl"}),e.fallbackLanguage("en"),e.determinePreferredLanguage(),i.firstDayOfWeek=1,i.formatDate=function(t){return null!==(t=void 0===t?null:t)?r(t).format("L"):null},i.parseDate=function(t){t=r(t,"L",!0);return t.isValid()?t.toDate():new Date(NaN)}}function a(t,i,n,o){t.$on("$translateChangeSuccess",function(t,e){i.find("html").attr("lang",e.language),n.defaults.headers.common["Accept-Language"]=e.language,r.locale(e.language),o.months=r.months(),o.shortMonths=r.monthsShort(),o.days=r.weekdays(),o.shortDays=r.weekdaysShort()})}i.$inject=["$log","$translate"],n.$inject=["$http"],o.$inject=["$httpProvider","$translateProvider","$mdDateLocaleProvider"],a.$inject=["$rootScope","$document","$http","$mdDateLocale"],Object.defineProperty(s,"__esModule",{value:!0}),s.AvailableLanguages={en:"English",de:"Deutsch",nl:"Nederlands"},s.EmailTemplateLanguages=["de","en","es","fr","it","nl","pl","pt","sv"],s.TRANSLATIONS={en:c(265),de:c(266),nl:c(267)},s.I18nModule=e.module("common.i18n",["pascalprecht.translate"]).config(o).run(a).factory("i18nMissingTranslationsLogger",i).factory("i18nTranslationsLoader",n)}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,i){i=[i,e,i(1),i(280)],e=function(t,e,c){i.$inject=["$q","PasswordService"],Object.defineProperty(e,"__esModule",{value:!0});var l=72;function i(r,a){return{require:"ngModel",priority:9999,link:function(t,e,i,n){function o(t,e,i){n.$strength={pwarning:null!==(i=void 0===i?null:i)&&""!==i&&i,suggestions:null!==(e=void 0===e?null:e)&&0<e.length&&e,"score-0":0===t,"score-1":1===t,"score-2":2===t,"score-3":3===t,"score-4":4===t},n.$strength.score=t,s.setAttribute("data-score",t)}var s=c.element("<div></div>")[0];s.className="password-strength",s.setAttribute("data-score","0"),e.after(s),e.attr("maxlength",l),e.parent().addClass("password-strength").attr("md-is-error","ctrl.form.password.$dirty"),o(-1),n.$viewChangeListeners.push(function(){void 0===n.$viewValue&&(o(0),n.$setValidity("passwordStrength",!0))}),n.$asyncValidators.passwordStrength=function(t){return n.$isEmpty(t)?(o(0),r.resolve(!0)):((t=a.test(t)).catch(function(t){return o(t.data.score,t.data.suggestions,t.data.warning),r.reject(!1)}),t.then(function(t){return o(t.score,t.suggestions,t.warning),0!=t.minimumScore<=t.score||r.reject(!1)}))}}}}e.PasswordStrengthDirectiveModule=c.module("zivver.PasswordStrengthDirective",[]).directive("passwordStrength",i)}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.active=!0,this.collapsed=!0,this.fullName=null,this.removable=!1,this.removed=!1,void 0!==t&&(this.accessRight=t.accessRight,this.active=void 0===t.active||t.active,this.email=t.email,this.fullName=t.fullName||null,this.picture=t.picture,this.removable=void 0!==t.removable&&t.removable,this.uuid=t.uuid)}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.fullNameOrEmail=function(){return null!==this.fullName?this.fullName:this.email},i.prototype.fullNameAndEmail=function(){return null!==this.fullName?this.fullName+" &lt;"+this.email+"&gt;":this.email},e.Participant=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(1),i(14),i(11)],e=function(t,i,e,o,n){Object.defineProperty(i,"__esModule",{value:!0});var s="auth.session",r="delegate-auth.session",a="auth.newSessionDuration",c=(i.LONG_SESSION_EXPIRATION=2592e3,i.SHORT_SESSION_EXPIRATION=43200,l.$inject=["$cookies","$log","$rootScope","$timeout","$window","StorageService"],l.prototype.setAccessToken=function(t,e){this.accessToken=t,this.accessTokenExpires=o().add(e,"seconds").toDate()},l.prototype.setRefreshToken=function(t,e,i){var n=e?"LOCAL":"SESSION",i=(this.removeStorageEventListener(),(void 0!==i?o().add(i,"seconds"):o().add(this.getSessionDuration(e),"seconds")).toDate()),t=(this.registerStorageEventListener(),this.session={accountId:t.accountId,delegate:!1,expires:i,guest:!1,refreshToken:t.refreshToken,sessionId:t.sessionId,username:t.username},this.StorageService.setItem(n,s,this.session),this.removeOtherRefreshToken(),{});e&&(t.expires=i),this.$cookies.put(s,"1",t)},l.prototype.getSessionDuration=function(t){var e;return void 0===t&&(t=!1),null!=(e=this.StorageService.getAndRemoveItem("SESSION",a))?e:t?i.LONG_SESSION_EXPIRATION:i.SHORT_SESSION_EXPIRATION},l.prototype.removeOtherRefreshToken=function(){var t=this.StorageService.getItem("LOCAL",s);null!==t&&t.username!==this.getUsername()&&this.StorageService.removeItem("LOCAL",s)},l.prototype.forgetMe=function(t){var e;this.$log.info("Removing authentication"),delete this.accessToken,delete this.accessTokenExpires,delete this.session,this.removeStorageEventListener(),void 0!==t?null!==(e=this.StorageService.getItem("LOCAL",s))&&e.username===t&&this.StorageService.removeItem("LOCAL",s):(this.$cookies.remove(s),this.StorageService.removeItem("LOCAL",s)),this.StorageService.removeItem("SESSION",s),this.StorageService.removeItem("SESSION",r)},l.prototype.forgetDelegate=function(){var t=this;delete this.accessToken,delete this.accessTokenExpires,delete this.session,this.ignoreStorageEvent=!0,this.StorageService.removeItem("SESSION",r),this.restoreSession(),this.$timeout(function(){t.ignoreStorageEvent=!1})},l.prototype.isAuthenticated=function(){return void 0!==this.getAccessToken()&&0<this.getScopes().length},l.prototype.getAccessToken=function(){if(void 0!==this.accessToken){if(new Date<this.accessTokenExpires)return this.accessToken;delete this.accessToken,delete this.accessTokenExpires}},l.prototype.getRefreshToken=function(){return this.hasRefreshToken()?this.session.refreshToken:void 0},l.prototype.hasRefreshToken=function(){return void 0!==this.session&&void 0!==this.session.refreshToken},l.prototype.getUsername=function(){var t;return null!=(t=null==(t=this.session)?void 0:t.username)?t:void 0},l.prototype.isUserInLocalStorage=function(t){var e=this.StorageService.getItem("LOCAL",s);return null!==e&&e.username===t},l.prototype.getUsernameFromStorage=function(){var t=this.StorageService.getItem("LOCAL",s)||this.StorageService.getItem("SESSION",s);return null!==t?t.username:""},l.prototype.setScopes=function(t){!1===e.equals(t,this.scopes)&&this.$rootScope.$broadcast(n.AuthEvents.scopesChanged,{scopes:t}),this.scopes=t},l.prototype.getScopes=function(){return this.scopes},l.prototype.hasScope=function(e){return 1===this.getScopes().filter(function(t){return t===e}).length},l.prototype.hasScopes=function(t,e){if(void 0===e&&(e="OR"),0===t.length)throw Error("no scopes to check");for(var i="OR"!==e,n=0,o=t;n<o.length;n++)var s=this.hasScope(o[n]),i="OR"===e?i||s:i&&s;return i},l.prototype.getAccountId=function(){return void 0!==this.session?this.session.accountId:void 0},l.prototype.getMainAccountId=function(){return!1===this.isDelegate()?this.getAccountId():(this.StorageService.getItem("SESSION",s)||this.StorageService.getItem("LOCAL",s)).accountId},l.prototype.getSessionId=function(){var t;return null==(t=this.session)?void 0:t.sessionId},l.prototype.isDelegate=function(){return void 0!==this.session&&this.session.delegate||!1},l.prototype.isGuest=function(){return void 0!==this.session&&this.session.guest||!1},l.prototype.setSessionDurationOverride=function(t){this.$log.debug("Set session duration override: ",{duration:t}),this.StorageService.setItem("SESSION",a,t)},l.prototype.restoreSession=function(){var t=this.StorageService.getItem("SESSION",r)||this.StorageService.getItem("SESSION",s);return null!==t?(this.session=t,!0):void 0===this.$cookies.get(s)?(this.StorageService.removeItem("LOCAL",s),this.StorageService.removeItem("SESSION",s),this.StorageService.removeItem("SESSION",r),!1):null!==(t=this.StorageService.getItem("LOCAL",s))&&(this.session=t,!0)},l.prototype.removeStorageEventListener=function(){void 0!==this.storageEventListener&&(this.$window.removeEventListener("storage",this.storageEventListener),this.storageEventListener=void 0)},l.prototype.registerStorageEventListener=function(){var e=this;this.storageEventListener=function(t){null!==t.key&&t.key!==s||(e.ignoreStorageEvent?(e.$log.debug("auth.session ignoring storage event"),e.ignoreStorageEvent=!1):(e.$log.debug("auth.session changed in other tab"),e.removeStorageEventListener(),e.cleanUpStorage()))},this.$timeout(function(){e.$window.addEventListener("storage",e.storageEventListener)})},l.prototype.cleanUpStorage=function(){var t=this.StorageService.getItem("LOCAL",s),e=this.StorageService.getItem("SESSION",s),i=this.StorageService.getItem("SESSION",r);null!==t&&null!==e&&t.username===e.username?(this.StorageService.removeItem("SESSION",s),this.$window.location.reload()):(null===t&&null===e&&null===i||null===t&&!0===(null==i?void 0:i.delegate)||t.username===this.getUsername()&&(null!==e||null!==i)||t.username!==this.getUsername()&&null===i||t.username!==this.getUsername()&&null!==i&&(null==t?void 0:t.username)!==(null==e?void 0:e.username))&&(i=this.getUsername()===(null==t?void 0:t.username)?null==e?void 0:e.username:this.getUsername(),this.$rootScope.$broadcast(n.AuthEvents.logoutOtherTab,{username:i}),delete this.accessToken,delete this.accessTokenExpires,delete this.session)},l.prototype.setSessionToken=function(t,e,i){var n=this;this.session={accountId:t.accountId,delegate:e,expires:void 0,guest:i,refreshToken:t.refreshToken,sessionId:t.sessionId,username:t.username},this.ignoreStorageEvent=!0,this.StorageService.setItem("SESSION",r,this.session),this.$timeout(function(){n.ignoreStorageEvent=!1})},l);function l(t,e,i,n,o,s){this.$cookies=t,this.$log=e,this.$rootScope=i,this.$timeout=n,this.$window=o,this.StorageService=s,this.scopes=[],this.ignoreStorageEvent=!1,this.restoreSession()&&this.registerStorageEventListener()}i.AuthSessionService=c}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(15)],e=function(t,e,i){function n(t){var e;this.isSelected=!1,void 0!==t&&(this.email=t.email,this.organization=t.organization,this.personal=null!=(e=t.personal)?e:{id:void 0},this.profile=t.profile,this.verifications=null!=(e=t.verifications)?e:[],this.uuid=t.uuid)}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(n.prototype,"fullName",{get:function(){var t=null!=(t=null!=(t=null==(t=this.personal)?void 0:t.fullName)?t:null==(t=this.organization)?void 0:t.fullName)?t:null==(t=this.profile)?void 0:t.fullName;return void 0!==t&&0<t.length?t:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"picture",{get:function(){var t;return null==(t=this.profile)?void 0:t.picture},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"phonenumber",{get:function(){var t;return null==(t=this.personal)?void 0:t.phonenumber},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"language",{get:function(){var t;return null==(t=this.personal)?void 0:t.language},enumerable:!0,configurable:!0}),n.prototype.toRecipient=function(t){void 0===t&&(t="to");var e=new i.Recipient({email:this.email,fullName:this.fullName,phonenumber:this.phonenumber,language:this.language});return e.recipientType=t,e.picture=null==(t=this.profile)?void 0:t.picture,e.verifications=this.verifications,e.accessRightSetup=this.getDefaultAccessRight(),e},n.prototype.getDefaultAccessRight=function(){if(0!==this.verifications.length)return i.AccessRightSetup.fromVerification(this.verifications[0])},e.Contact=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(118)],e=function(t,e,i){function n(t){this.emailIsValid=!0,this.verifications=[],void 0!==t&&(this.email=t.email,this.language=t.language,this.fullName=t.fullName,this.phonenumber=t.phonenumber,t instanceof n?(this.verifications=t.verifications,this.accessRightSetup=t.accessRightSetup,this.picture=t.picture,this.emailIsValid=t.emailIsValid):void 0!==t.accessRightSetup&&0<t.accessRightSetup.length&&(this.accessRightSetup=new i.AccessRightSetup(t.accessRightSetup[0])),this.recipientType=t.recipientType)}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype.toRequestEntity=function(){var t,e,i={email:this.email};return void 0!==this.accessRightSetup&&(e=(t=this.accessRightSetup).id,i.accessRightSetup=[{id:e,accessType:t.accessType,phonenumber:t.phonenumber,password:t.password}]),void 0!==this.fullName&&(i.fullName=this.fullName),void 0!==this.language&&(i.language=this.language),i.recipientType=null!=(e=this.recipientType)?e:"to",i},n.prototype.fullNameOrEmail=function(){return void 0!==this.fullName?this.fullName:this.email},e.Recipient=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(160)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.MessageDefinition=function(t){this.formDefinition=new i.FormDefinition(t.formDefinition),this.id=t.id,this.name=t.name}}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,s){var i=[s,e,s(1),s(384)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","$http","$timeout"],o.prototype.$onInit=function(){this.withApi=void 0===this.withApi||this.withApi,this.withApi&&this.getBackendVersion()},o.prototype.getBackendVersion=function(){var e=this;10<=this.refreshErrors||this.$http.get("/api/version").then(function(t){return t.data}).then(function(t){null!==e.backend&&e.backend!==t.backendVersion&&e.$log.debug("backend updated to "+t.backendVersion),null!==e.backendApi&&e.backendApi!==t.apiVersion&&e.$log.debug("backend api version updated to "+t.apiVersion),e.backend=t.backendVersion,e.backendApi=t.apiVersion,e.refreshErrors=0}).catch(function(t){e.refreshErrors++,400<=t.status&&e.$log.warn("Uncaught error getting version from api",{error:t})}).finally(function(){e.refreshTimeout=e.$timeout(function(){e.getBackendVersion()},9e5+6e3*e.refreshErrors,!1)})};var n=o;function o(t,e,i){this.$log=t,this.$http=e,this.$timeout=i,this.app="2.20.216",this.api="1.58.36",this.backend=null,this.backendApi=null,this.refreshTimeout=null,this.refreshErrors=0}e.Version=n,e.VersionModule=i.module("components.version",[]).component("version",{controller:n,template:s(385),bindings:{withApi:"<"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,l){var i=[l,e,l(9),l(1),l(71),l(15),l(182),l(229),l(24),l(421)],e=function(t,e,h,i,f,n,o,s,r){Object.defineProperty(e,"__esModule",{value:!0}),e.RecipientDialog=function(){this.templateUrl=l(422),this.locals={validation:void 0,violations:void 0,verificationProblem:void 0,editParticipant:!1},this.resolve={recipient:void 0},this.controller=a},c.$inject=["$scope","$log","$mdDialog","$timeout","$translate","$window","ContactsService","recipient","validation","violations","verificationProblem","editParticipant"],c.prototype.initSetupForRecipient=function(){void 0===this.recipient.language&&this.isGuest()&&(this.recipient.language=this.$translate.use()),this.isZivverAccount=1===this.verifications.filter(function(t){return"zivver"===t.verificationType}).length,this.accessRightSetup=this.recipient.accessRightSetup||new n.AccessRightSetup,void 0!==this.accessRightSetup&&this.accessRightSetup.id?this.verificationID=this.accessRightSetup.id:this.hasVerifications()&&(this.verificationID=this.verifications[0].id),this.verificationChanged()},c.prototype.verificationChanged=function(){var t,e,i,n=this;void 0!==this.verificationID&&(t=(e=this.showUserInputs()).phonenumber,e=e.accesscode,this.showPhoneNumberField=t,this.showAccessCodeField=e,i=this.verificationProblem&&this.verificationID===this.recipient.accessRightSetup.id,this.recipient.accessRightSetup)&&"DefaultSms"===this.recipient.accessRightSetup.id&&this.$scope.$applyAsync(function(){var t;null!=(t=n.form.verificationID)&&t.$setValidity("verificationProblem",!i),n.$scope.$watch(function(){return n.accessRightSetup.phonenumber},function(t){null!=t&&""!==t&&null!=(t=n.form.verificationID)&&t.$setValidity("verificationProblem",!0)})})},c.prototype.save=function(){var t;this.form.$invalid?this.$log.debug("form is invalid"):((t=n.AccessRightSetup.fromVerification(this.getSelectedVerificationMethod())).requiresUserInput&&(t.isSms()?t.phonenumber=this.accessRightSetup.phonenumber:t.isPassword()&&(t.password=this.accessRightSetup.password)),this.recipient.accessRightSetup=t,this.$mdDialog.hide({recipient:this.recipient,accessRightSetup:t}))},c.prototype.isGuest=function(){return 0===this.verifications.filter(function(t){return"zivver"===t.verificationType}).length},c.prototype.cancel=function(){this.$mdDialog.cancel()},c.prototype.hasVerifications=function(){return 0<this.verifications.length},c.prototype.showUserInputs=function(){var t,e,i=!1,n=!1;return this.hasVerifications()&&"DefaultZivver"!==this.verificationID&&(t=(e=this.getSelectedVerificationMethod()).verificationType,e=e.requiresUserInput,"sms"===t&&(i=e),"password"===t&&(n=e),!1===e)&&(this.recipient.phonenumber="",this.accessRightSetup.phonenumber="",this.accessRightSetup.password=""),{phonenumber:i,accesscode:n}},c.prototype.getContactInfo=function(t){var n=this;this.ContactsService.get(t).then(function(t){var e=t.toRecipient(n.recipient.recipientType),i={};Object.keys(h.__assign(h.__assign({},e),n.recipient)).map(function(t){i[t]=n.recipient[t]||e[t]}),n.recipient=i,n.verifications=e.verifications,n.initSetupForRecipient()}).finally(function(){return n.loading=!1})},c.prototype.getSelectedVerificationMethod=function(){var e=this;return this.verifications.filter(function(t){return t.id===e.verificationID}).shift()},c.prototype.validEmailChanged=function(){var t=this;null!=this.recipient.email&&""!==this.recipient.email&&this.$timeout(function(){t.recipient.accessRightSetup=void 0,t.getContactInfo(t.recipient.email),t.violations=t.validation.getViolationsForRecipient(t.recipient)},100)},c.prototype.autofocusNumber=function(){return!0===this.showPhoneNumberField&&(void 0===this.form.phonenumber||""===this.form.phonenumber)};var a=c;function c(t,e,i,n,o,s,r,a,c,l,u,p){var d=this;this.$scope=t,this.$log=e,this.$mdDialog=i,this.$timeout=n,this.$translate=o,this.$window=s,this.ContactsService=r,this.recipient=a,this.validation=c,this.violations=l,this.verificationProblem=u,this.editParticipant=p,this.loading=!0,this.emailPattern="^([!#-'*+\\/-9=?A-Z^-~-]+(\\.[!#-'*+\\/-9=?A-Z^-~-]+)*)@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$",this.verifications=[],this.isZivverAccount=!1,this.languages=f.EmailTemplateLanguages.map(function(t){return{code:t,label:d.$translate.instant("MAIN.LANGUAGES."+t.toUpperCase())}}).sort(function(t,e){return t.label.localeCompare(e.label)}),this.title=a.fullNameOrEmail(),this.verifications=h.__spreadArrays(a.verifications),this.getContactInfo(a.email)}e.RecipientDialogModule=i.module("drafts.RecipientDialog",[r.AvatarModule.name,o.DraftViolationItemModule.name,s.InputPhonenumberModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t,e){return null==t||""===t?e:t}Object.defineProperty(e,"__esModule",{value:!0}),e.IfEmptyFilterModule=i.module("zivver.common.filters.ifEmpty",[]).filter("ifEmpty",function(){return n})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,s){var i=[s,e,s(9),s(14),s(438)],e=function(t,e,i,n){function o(t,e,i,n,o,s,r,a){this.$element=t,this.$mdDialog=e,this.$scope=i,this.$timeout=n,this.OrganizationService=o,this.isDraft=s,this.isEnabled=r,this.scheduledExpiration=a,this.amount=null,this.action={revoke:!0,delete:!1},this.unit="d"}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$element","$mdDialog","$scope","$timeout","OrganizationService","isDraft","isEnabled","scheduledExpiration"],o.prototype.$onInit=function(){var t,e=this;void 0===this.scheduledExpiration?this.OrganizationService.getMessageExpirationPolicy().then(function(t){!0===t.automaticScheduledExpiration?e.scheduledExpiration={action:t.defaults.action,expiresIn:t.defaults.duration}:e.scheduledExpiration={action:"revoke",expiresIn:"P0D"}}):(this.scheduledExpiration={action:!1!==this.isEnabled?this.scheduledExpiration.action:"revoke",expiresIn:!1!==this.isEnabled?this.scheduledExpiration.expiresIn:void 0},this.targetToggle(this.scheduledExpiration.action),void 0!==this.scheduledExpiration.expiresIn&&(t=new RegExp("([WDH])+"),this.unit=this.scheduledExpiration.expiresIn.substr(this.scheduledExpiration.expiresIn.search(t),1).toLowerCase(),this.amount=Math.round(n.duration(this.scheduledExpiration.expiresIn).as(this.unit)))),this.originalSettings={action:i.__assign({},this.action),amount:this.amount,isEnabled:this.isEnabled,unit:this.unit,expiresIn:void 0!==this.scheduledExpiration&&void 0!==this.scheduledExpiration.expiresIn?this.scheduledExpiration.expiresIn:"PnullD"},Object.freeze(this.originalSettings),this.$scope.$watchCollection(function(){return[e.amount,e.unit]},function(t){void 0!==t&&void 0!==e.scheduledExpiration&&(e.amount=t[0],e.unit=t[1],e.scheduledDate=n().add(e.amount,e.unit).format("dddd D MMMM YYYY, HH:mm"),e.scheduledExpiration.expiresIn=e.getDuration(),e.scheduledExpiration.expiresAt=n().add(n.duration(e.getDuration())).toISOString())})},o.prototype.getDuration=function(){switch(this.unit){case"w":return"P"+this.amount+"W";case"d":return"P"+this.amount+"D";case"h":return"PT"+this.amount+"H"}},o.prototype.targetToggle=function(t){!1===this.action[t]&&(this.action.revoke=!this.action.revoke,this.action.delete=!this.action.delete,this.scheduledExpiration.action=t)},o.prototype.momentToggle=function(t){!1===t?(this.scheduledExpiration.expiresIn=void 0,this.scheduledExpiration.expiresAt=void 0):(this.scheduledExpiration.expiresIn=this.getDuration(),this.scheduledExpiration.expiresAt=n().add(n.duration(this.getDuration())).toISOString())},o.prototype.trimLength=function(t){var e=document.getElementById("amount");8!==t.keyCode&&(t.keyCode<37||40<t.keyCode)&&((t.keyCode<41||57<t.keyCode)&&(t.keyCode<96||105<t.keyCode)||3<e.value.length)&&t.preventDefault()},o.prototype.disableSave=function(){return!0===this.isOriginalSetting()||this.isEnabled&&void 0!==this.scheduledExpiration&&this.scheduledExpiration.expiresIn&&!this.amount},o.prototype.onEnabledChange=function(){!0===this.isEnabled&&this.$timeout(function(){var t=document.getElementById("amount");null!==t&&t.focus()},120,!0)},o.prototype.close=function(){return this.$mdDialog.cancel()},o.prototype.save=function(){return this.$mdDialog.hide({isEnabled:this.isEnabled,scheduledExpiration:this.isEnabled?this.scheduledExpiration:void 0})},o.prototype.isOriginalSetting=function(){return void 0!==this.scheduledExpiration&&this.unit===this.originalSettings.unit&&this.amount===this.originalSettings.amount&&this.isEnabled===this.originalSettings.isEnabled&&this.action.revoke===this.originalSettings.action.revoke&&this.action.delete===this.originalSettings.action.delete&&this.scheduledExpiration.expiresIn===this.originalSettings.expiresIn},o.factory=function(t){return{controller:o,templateUrl:s(439),locals:t}},e.ExpirationDialog=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/img/shield.a58474.svg"},,,,,,,,,,,,,,,function(t,e,r){var i=[r,e,r(1),r(193),r(616)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$scope","$log","$window","$timeout","FilesOutService","ScrollService"],s.prototype.$onInit=function(){var e=this;this.sections=this.formDefinition.sections,this.numberSteps=this.sections.length,this.openFirstSection(),this.$scope.$watch(function(){return e.currentState},function(t){void 0!==t&&e.changeCurrentState(t)})},s.prototype.goToStep=function(t){var e=this,t=(this.activeStep=t,this.getSectionByIndex(t-1));t.setOpened(!0).setFocusedComponent(t.getFirstComponent()),this.$timeout(function(){var t=e.$window.document.getElementById("special-step-"+e.activeStep);e.ScrollService.scrollIntoView(t,e.mainContentElement,!0)},100,!1)},s.prototype.getCurrentStep=function(){return this.activeStep},s.prototype.scrollToComponent=function(t){t=this.$window.document.getElementById(t);void 0!==t?this.ScrollService.scrollIntoView(t,this.mainContentElement,!0):this.$log.warn("can not find component to scroll to!")},s.prototype.awaitUpload=function(){this.awaitedUploads++,this.getLastSection().setDisabled(!0)},s.prototype.awaitedUploadDone=function(){0<this.awaitedUploads&&this.awaitedUploads--,0===this.awaitedUploads&&this.getLastSection().setDisabled(!1)},s.prototype.onSubmitSpecial=function(){return"initiation"===this.type?this.onSubmit({subject:this.createSubject()}):"response"===this.type?this.onSubmit():void 0},s.prototype.validateComponents=function(t){var n=this,o=[];return void 0!==this.formCtrl&&0<t.length&&t.forEach(function(t){var e,i=n.formCtrl[t];void 0!==i&&(i.$setTouched(),i.$validate(),void 0!==(e=Object.keys(i.$error)))&&0<e.length&&o.push({compKey:t,error:i.$error})}),o},s.prototype.closeAllStepsBelow=function(t){this.activeStep=t;for(var e=this.activeStep;e<this.numberSteps;++e)this.getSectionByIndex(e).setOpened(!1).setCompleted(!1)},s.prototype.validateForm=function(){var t=this.sections.reduce(function(t,e){return t.concat(e.components.filter(function(t){return!1===t.isStatic()}).map(function(t){return t.key}))},[]);return this.validateComponents(t)},s.prototype.jumpToFirstError=function(t){var i,e=this,n=t[0].compKey;this.sections.some(function(t){var e=t.hasComponentByKey(n);if(!0===e)return i=t.getComponentByKey(n),e}),void 0!==i&&0<t.length?(this.scrollToComponent(n),this.$timeout(function(){i.showError=!0,e.$timeout(function(){i.showError=!1},750,!1)},this.ScrollService.scrollDuration)):this.$log.warn("failed to jump to first erroneous component!")},s.prototype.onSectionCompleted=function(){return this.completedSteps++,"initiation"===this.type?this.saveDraft(this.createSubject()):this.saveDraft()},s.prototype.onCancelForm=function(){this.onCancel()},s.prototype.addFile=function(t){this.files.push(t)},s.prototype.removeFile=function(e){void 0!==e.id&&this.FilesOutService.remove(e.id),this.files=this.files.filter(function(t){return t.id!==e.id})},s.prototype.removeAllFiles=function(){var e=this;0!==this.files.length&&this.files.forEach(function(t){e.FilesOutService.remove(t.id)}),this.files=[]},s.prototype.toSaveEntity=function(){var n={messageDefinition:this.messageDefinitionId,data:{}};return this.sections.forEach(function(t){var e,i=t.toSaveEntity();for(e in i)!0===i.hasOwnProperty(e)&&(n.data[e]=i[e])}),n},s.prototype.changeCurrentState=function(t){switch(t){case"pending":this.sections.forEach(function(t){return t.setDisabled(!1)});break;case"submitting":this.sections.forEach(function(t){return t.setDisabled(!0).setOpened(!1)}),this.getLastSection().setOpened(!0);break;case"sent":this.getLastSection().setDisabled(!1)}},s.prototype.openFirstSection=function(){return this.getFirstSection().setOpened(!0)},s.prototype.getSectionByIndex=function(t){if(-1<t&&t<this.sections.length)return this.sections[t];throw new Error("index out of bounds")},s.prototype.getFirstSection=function(){return this.getSectionByIndex(0)},s.prototype.getLastSection=function(){return this.getSectionByIndex(this.sections.length-1)},s.prototype.createSubject=function(){var i=this,n=this.formDefinition.subjectTemplate,o=(" "+n).slice(1);return(n=(n=n.replace(/\$(\w-*)+/g,function(t){t=i.formDefinition.getComponentByKey(t.replace("$",""));return void 0!==t.answer&&void 0!==t.answer.subject?t.answer.subject:""})).replace(/&(\w-*)+/g,function(t){var e=i.formDefinition.getComponentByKey(t.replace("&",""));return void 0!==e.answer&&void 0!==e.answer.value?e.answer.value:(i.$log.warn("SpecialsForm could not create subject for '&-template-var'",{subject:n,subjectCopy:o,match:t,comp:e}),"")})).trim()},s.prototype.saveDraft=function(t){t={draftBody:this.generateBody(),subject:t};return this.onSave(t)},s.prototype.generateBody=function(){return this.body=JSON.stringify(this.toSaveEntity(),null,0),this.body};var o=s;function s(t,e,i,n,o,s){this.$scope=t,this.$log=e,this.$window=i,this.$timeout=n,this.FilesOutService=o,this.ScrollService=s,this.activeStep=1,this.completedSteps=1,this.awaitedUploads=0,this.mainContentElement=this.$window.document.getElementsByClassName("main-content")[0]}e.SpecialsForm=o,e.SpecialsFormModule=i.module("ziv.components.specialsForm",[n.SpecialsSectionModule.name]).component("specialsForm",{controller:o,bindings:{body:"<",currentState:"=",files:"=",formDefinition:"=",messageDefinitionId:"<",onCancel:"&",onSave:"&",onSubmit:"&",submitTranslated:"<",type:"<"},templateUrl:r(617)})}.apply(e,i);void 0!==e&&(t.exports=e)},,,function(t,e,i){i=[i,e,i(38)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=new RegExp(i.TOKEN_REGEX,"g"),o=new RegExp(i.UUID_REGEX,"g"),s=["conversations.label","conversations.view","conversations.reply"],r=["inbox","archive","trash"];function a(t){var i=[];return t.searchParams.forEach(function(t,e){return i.push(e)}),t.origin+t.pathname.replace(o,"{uuid}").replace(n,"{token}")+(0===i.length?"":"?"+i.join("="))}e.anonymizeStateUrl=function(t){var e=t.injector().get("$window"),e=new URL(e.location.href),i=t.to();return-1<s.indexOf(i.name)&&(i=t.params().label,-1===r.indexOf(i))&&(e.pathname=e.pathname.replace(new RegExp("/"+encodeURIComponent(i)+"/"),"/{label}/").replace(new RegExp("/"+encodeURIComponent(i)),"/{label}")),a(e).replace("/%7Blabel%7D","/{label}")},e.anonymizeUrl=a}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,n){var i=[n,e,n(1),n(275)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FooterDonsModule=i.module("components.footerDons",[]).component("footerDons",{controller:function(){this.url="https://www.linkedin.com/in/vvandonselaar/"},template:n(276)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(71),r(284)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$rootScope","$scope","$translate"],s.prototype.$onInit=function(){var i=this;this.availableLanguages=n.AvailableLanguages,this.language=this.$translate.use(),this.$rootScope.$on("$translateChangeSuccess",function(t,e){i.language=e.language}),this.$scope.$watch(function(){return i.language},function(t,e){t!==e&&null!==e&&i.$translate.use(t)}),void 0===this.availableLanguages[this.language]&&(this.language=Object.keys(this.availableLanguages)[0])};var o=s;function s(t,e,i){this.$rootScope=t,this.$scope=e,this.$translate=i,this.availableLanguages={},this.language=null}e.LanguageSelectModule=i.module("components.languageSelect",[n.I18nModule.name]).component("languageSelect",{controller:o,template:r(285)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(13),i(11)],e=function(t,e,o,c){Object.defineProperty(e,"__esModule",{value:!0});var n="arg.";function i(t,e,i,n,o,s,r){var a=this;this.$window=e,this.$q=i,this.$http=n,this.$log=o,this.StorageService=s,this.AuthSessionService=r,t.$on(c.AuthEvents.logoutSuccess,function(){a.clear()})}i.$inject=["$rootScope","$window","$q","$http","$log","StorageService","AuthSessionService"],i.prototype.getGrant=function(i){var n=this;return this.$q(function(e){var t=n.StorageService.getItem(n.getStorageType(),n.prefix(i));return null!==t?(n.$log.debug("Grant "+i+" available from storage."),e(new o.AccessRightGrant(t))):(n.$log.debug("Fetching grant "+i+" from api."),n.$http.get("/api/shares_in/"+i+"/grant").then(function(t){n.$log.debug("Fetched grant "+i+" from api."),e(new o.AccessRightGrant(t.data))}))})},i.prototype.setGrant=function(t,e){this.StorageService.setItem(this.getStorageType(),this.prefix(t),e)},i.prototype.clear=function(){var e=this,i=this.getStorageType();this.StorageService.keys(i).filter(function(t){return t.substring(0,n.length)===n}).forEach(function(t){return e.StorageService.removeItem(i,t)})},i.prototype.prefix=function(t){return n+this.AuthSessionService.getSessionId()+"."+t},i.prototype.getStorageType=function(){return this.AuthSessionService.isGuest()?"SESSION":"LOCAL"},e.AccessRightGrantService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.busy=!1,this.style={},this.id=t.id,this.downloadable=t.downloadable,this.empty=t.empty,this.fileType=t.fileType,this.inline=t.inline,this.name=t.name,this.size=t.size,this.openedBy=t instanceof i?t.openedBy:t.opened_by}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.isImage=function(){return"image"===this.fileType.split("/")[0]},i.prototype.isVideo=function(){return"video"===this.fileType.split("/")[0]},i.prototype.isSvg=function(){return"svg+xml"===this.fileType.split("/")[1]},i.prototype.isArchive=function(){return-1<["zip","tar","gz","rar","7z","dmg","iso"].indexOf(this.name.split(".").pop())},i.prototype.isPdf=function(){return"pdf"===this.fileType.split("/")[1]},i.prototype.setBackgroundImage=function(t,e){this.style.backgroundImage="url("+t+")",this.style.backgroundSize=e?"90px 90px":void 0},i.prototype.getFileTypeIcon=function(){return"ziv:filetype-"+(this.isImage()||this.isSvg()?"image":this.isVideo()?"video":this.isPdf()?"pdf":this.isArchive()?"archive":"file")},e.Attachment=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(9),i(74),i(106),i(108)],e=function(t,e,i,n,o,s){function r(t){this.body=null,this.contentType="text/plain",this.counters={hardBounces:0,opens:0,softBounces:0},this.deleted=!1,this.files=[],this.revoked=!1,this.sender=null,this.inlineImages=[],this.isSelected=!1,this.batchDownload=t.batchDownload||null,this.body=void 0===t.body?null:t.body,this.contentType=t.contentType,this.counters.hardBounces=t.hardBouncedBy,this.counters.opens=t.opened_by,this.counters.softBounces=t.softBouncedBy,this.createdDate=new Date(t.created),this.createdDateString=t.created,this.deleted=t.deleted,this.id=t.id,this.isBcc=t.bcc,this.messageDefinition=t.messageDefinition,this.participant=new n.Participant(i.__assign({},t.participant)),this.quoted=t.quoted,this.revoked=t.revoked,this.scheduledExpiration=t.scheduledExpiration,this.sender=t.sender,this.files=t.files.map(function(t){return new o.Attachment(t)}).sort(function(t,e){return t.name.localeCompare(e.name)}),void 0!==t.quote&&(this.quote=new s.Quote(t.quote)),this.sentByDelegate=t.sentByDelegate}Object.defineProperty(e,"__esModule",{value:!0}),r.fromQuotedConversationMessage=function(t){return new r(i.__assign(i.__assign({},t),{deleted:!1,hardBouncedBy:0,softBouncedBy:0,opened_by:0,quote:void 0}))},e.ConversationMessage=r}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(107)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Quote=function(t){this.messages=[],this.conversationInfo=t.conversation,void 0!==t.messages&&(this.messages=t.messages.map(function(t){return i.ConversationMessage.fromQuotedConversationMessage(t)}))}}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(110)],e=function(t,e,i){function n(t,e,i){this.$q=t,this.$log=e,this.$http=i}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$q","$log","$http"],n.prototype.list=function(){return this.$http.get("/api/accounts").then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.listFunctional=function(){return this.$http.get("/api/accounts/functional").then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.listRekeyables=function(){var i=this;return this.$http.get("/api/accounts/rekey").then(function(t){return t.data}).then(function(t){return t.rekeyableAccounts}).then(function(t){var e=[];return t.forEach(function(t){t=i.$http.get("/api/accounts/"+t).then(function(t){return t.data});e.push(t)}),i.$q.all(e).then(function(t){return t})})},n.prototype.getProfile=function(t){return this.$http.get("/api/profile/"+t).then(function(t){return new i.Profile(t.data)})},n.prototype.getAccount=function(t){return this.$http.get("/api/accounts/"+t).then(function(t){return t.data})},n.prototype.createFunctionalAccount=function(t){return this.$http.post("/api/accounts/functional",t).then(function(){return!0})},n.prototype.createAccount=function(t){return this.$http.post("/api/accounts",t)},n.prototype.updatePassword=function(t,e,i){return this.$http.post("/api/accounts/"+t+"/password",{newPassword:e,mustChange:i}).then(function(){return!0})},n.prototype.convertToRegular=function(t){return this.$http.post("/api/accounts/"+t+"/to_regular",{}).then(function(){return!0})},n.prototype.convertToFunctional=function(t){return this.$http.post("/api/accounts/"+t+"/to_functional",{}).then(function(){return!0})},n.prototype.removeSessions=function(t){return this.$http.delete("/api/accounts/"+t+"/sessions").then(function(){return!0})},n.prototype.rekey=function(){return this.$http.post("/api/accounts/rekey",{}).then(function(){return!0})},n.prototype.updateAccountActive=function(t,e){return this.$http.put("/api/accounts/"+t,{active:e}).then(function(){return!0})},n.prototype.removeAccount=function(t){return this.$http.delete("/api/accounts/"+t).then(function(){return!0})},n.prototype.mergeGuest=function(t,e){return this.$http.post("/api/accounts/"+t+"/merge/guest",{emailAddress:e}).then(function(){return!0})},n.prototype.mergeAccount=function(t,e){return this.$http.post("/api/accounts/"+t+"/merge/account",{accountId:e}).then(function(){return!0})},n.prototype.removeMultifactor=function(t){return this.$http.delete("/api/accounts/"+t+"/multifactor").then(function(){return!0})},e.AccountsService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.nickName=null,this.picture=null,void 0!==t&&(this.absenceDisablesPush=t.absenceDisablesPush,this.absenceMessage=t.absenceMessage,this.accountType=t.accountType,this.email=t.email,this.fullName=t.fullName||null,this.language=t.language,this.nickName=t.nickName||null,this.organizationLogo=t.organizationLogo,this.organizationName=t.organizationName,this.picture=t.picture,this.showRealSender=t.showRealSender||!1,this.showRealSenderDefault=t.showRealSenderDefault||!1,this.timezone=t.timezone||null,this.uuid=t.uuid," "===this.nickName)&&(this.nickName=null)}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.isGuest=function(){return"guest"===this.accountType},i.prototype.isPersonal=function(){return"personal"===this.accountType},i.prototype.isBusiness=function(){return"business"===this.accountType},e.Profile=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http"],i.prototype.list=function(){return this.$http.get("/api/sessions").then(function(t){return t.data}).then(function(t){return t.items})},i.prototype.kill=function(t){return this.$http.delete("/api/sessions/"+t).then(function(){return!0})},e.ActiveSessionsService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(52)],e=function(t,e,i){function n(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$http"],n.prototype.getAccountAliases=function(t){return this.$http.get("/api/accounts/"+t+"/aliases").then(function(t){return t.data})},n.prototype.create=function(t,e){return this.$http.post("/api/accounts/"+t+"/aliases",{emailAddress:e}).then(function(t){return t.data})},n.prototype.patch=function(t,e){e=i.encodeEmailForURI(e);return this.$http.patch("/api/accounts/"+t+"/aliases/"+e,{}).then(function(){return!0})},n.prototype.remove=function(t,e){e=i.encodeEmailForURI(e);return this.$http.delete("/api/accounts/"+t+"/aliases/"+e).then(function(){return!0})},e.AliasService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(53)],e=function(t,e,i){function n(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$http"],n.prototype.getPersonalAuditLogs=function(t){t=i.removeEmptyProps({toDate:t});return this.$http.get("/api/audit_logs/personal",{params:t}).then(function(t){return t.data}).then(function(t){return t.items})},e.AuditLogService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http"],i.prototype.list=function(){return this.$http.get("/api/scheduled_absences").then(function(t){return t.data})},i.prototype.create=function(t){return this.$http.post("/api/scheduled_absences",t).then(function(t){return t.data})},i.prototype.update=function(t,e){return this.$http.put("/api/scheduled_absences/"+t,e).then(function(t){return t.data})},i.prototype.remove=function(t){return this.$http.delete("/api/scheduled_absences/"+t).then(function(){return!0})},e.AvailabilityService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(300)],e=function(t,e,i){function n(t,e,i){this.$log=t,this.$q=e,this.$http=i}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$log","$q","$http"],n.prototype.list=function(){return this.$http.get("/api/business_rules/organization").then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new i.BusinessRule(t)})})},n.prototype.listPersonal=function(){return this.$http.get("/api/business_rules").then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new i.BusinessRule(t)})})},n.prototype.update=function(t,e){return this.$http.put("/api/business_rules/organization/"+t,e).then(function(t){return t.data}).then(function(t){return new i.BusinessRule(t)})},e.BusinessRulesService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http"],i.prototype.getCategories=function(){var e=this;return this.$http.get("/api/audit_logs/communication/categories").then(function(t){return t.data}).then(function(t){return t.categories.sort(e.sortCategories)})},i.prototype.getCommunicationLogs=function(t,e,i){return this.$http.get("/api/audit_logs/communication/"+t,{params:{toDate:e,category:i}}).then(function(t){return t.data}).then(function(t){return t.items})},i.prototype.sortCategories=function(t,e){return t.categoryLabel=void 0===t.categoryLabel?t.category:t.categoryLabel,e.categoryLabel=void 0===e.categoryLabel?e.category:e.categoryLabel,t.categoryLabel.localeCompare(e.categoryLabel)},e.CommunicationLogService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(76),i(53),i(52)],e=function(t,e,a,c,i){function n(t,e,i,n){this.$log=e,this.$q=i,this.$http=n}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$rootScope","$log","$q","$http"],n.prototype.listContacts=function(t){var r=this;return this.$q(function(o){var s=[];!function e(i,n){r.$http.get("/api/contacts"+("all"!==t?"/"+t:""),{params:{offset:i,limit:n}}).then(function(t){return t.data}).then(function(t){(s=s.concat(t.items.map(function(t){return new a.Contact(t)}))).length<t.pagination.total?e(i+n,n):o(s)})}(0,1e3)})},n.prototype.get=function(t){t=i.encodeEmailForURI(t);return this.$http.get("/api/contacts/"+t).then(function(t){return t.data}).then(function(t){return new a.Contact(t)})},n.prototype.addContact=function(t){var e=this;return this.$http.post("/api/contacts/personal",{email:t}).then(function(){return e.get(t)})},n.prototype.removePersonalContact=function(t,e){return this.$http.delete("/api/contacts/personal/"+e).then(function(){return!0})},n.prototype.savePersonalInfo=function(t){var e=this,i=t.personal,n=i.fullName,o=i.language,s=i.phonenumber,r=i.identifier,i=i.accessRightPassword;return(void 0===t.personal.id?this.$http.post("/api/contacts/personal",c.removeEmptyProps({email:t.email,fullName:n,language:o,phonenumber:s,identifier:r,accessRightPassword:i})):this.$http.put("/api/contacts/personal/"+t.personal.id,c.removeEmptyProps({fullName:n,language:o,phonenumber:s,identifier:r,accessRightPassword:i}))).then(function(){return e.get(t.email)})},e.ContactsService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.isValid=!0,this.requiresUserInput=!1,void 0===t?this.accessType="generatedCode":(this.accessType=t.accessType,this.id=t.id,this.password=t.password,this.phonenumber=t.phonenumber,(this.isPassword()&&void 0===this.password||this.isSms()&&void 0===this.phonenumber)&&(this.requiresUserInput=!0))}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.isPassword=function(){return"password"===this.accessType},i.prototype.isSms=function(){return"sms"===this.accessType},i.fromVerification=function(t){var e=new i;return e.id=t.id,e.requiresUserInput=t.requiresUserInput,e.accessType="none"===t.verificationType?"Email"===t.id?"email":"generatedCode":"direct"===t.verificationType?"zivver":t.verificationType,e},e.AccessRightSetup=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(120)],e=function(t,e,n){function o(t,e){var i;void 0===e&&(e=[]),this.validationCompleted=!1,this.validDraft=!0,this.violationsUnresolved=[],this.violationsIgnored=[],this.inputViolations=[],void 0!==t&&(this.inputViolations=null!=(i=t.violations)?i:[],this.validDraft=t.validDraft,void 0!==t.violations)&&0<t.violations.length&&(i=t.violations.filter(function(t){return"trustedRecipients"!==t.violationType}).map(function(t){return new n.Violation(t)}),this.violationsUnresolved=i.filter(function(t){return-1===e.indexOf(t.id)}),this.violationsIgnored=i.filter(function(t){return-1<e.indexOf(t.id)}))}Object.defineProperty(e,"__esModule",{value:!0}),o.clone=function(t){var e=new o;return e.validDraft=t.validDraft,e.validationCompleted=t.validationCompleted,e.violationsIgnored=t.violationsIgnored,e.violationsUnresolved=t.violationsUnresolved,e.inputViolations=t.inputViolations,e},o.prototype.hasViolations=function(){return 0<this.violationsUnresolved.length},o.prototype.getErrors=function(){return this.violationsUnresolved.filter(function(t){return"error"===t.violationLevel})},o.prototype.getWarnings=function(){return this.violationsUnresolved.filter(function(t){return"warning"===t.violationLevel})},o.prototype.getSuggestions=function(){return this.violationsUnresolved.filter(function(t){return"suggestion"===t.violationLevel})},o.prototype.getShowStoppers=function(){return this.violationsUnresolved.filter(function(t){return!0===t.showStopper})},o.prototype.getViolationsForRecipient=function(e){return this.violationsUnresolved.filter(function(t){return-1<t.recipients.indexOf(e.email)})},o.prototype.getViolationsForAttachment=function(e){return this.violationsUnresolved.filter(function(t){return-1<t.files.indexOf(e)})},o.prototype.addClientViolation=function(e){var t=(t=o.clone(this)).removeViolationByBusinessRuleId(e.businessRuleId),i=this.violationsUnresolved.filter(function(t){return t.businessRuleId===e.businessRuleId}).shift(),n=this.violationsIgnored.filter(function(t){return t.businessRuleId===e.businessRuleId}).shift();return(void 0!==i?(e.files=i.files.concat(e.files),e.recipients=i.recipients.concat(e.recipients),t.violationsUnresolved):void 0!==n?(e.files=n.files.concat(e.files),e.recipients=n.recipients.concat(e.recipients),t.violationsIgnored):t.violationsUnresolved).push(e),t},o.prototype.addClientViolations=function(t){var e=this,i=o.clone(this);return t.forEach(function(t){i=e.addClientViolation(t)}),i},o.prototype.removeViolationByBusinessRuleId=function(e){var t=o.clone(this);return t.violationsUnresolved=t.violationsUnresolved.filter(function(t){return t.businessRuleId!==e}),t.violationsIgnored=t.violationsIgnored.filter(function(t){return t.businessRuleId!==e}),t},o.prototype.removeViolationsForEmail=function(e){function t(t){return!(1===t.recipients.length&&-1<t.recipients.indexOf(e))}var i=o.clone(this);return i.violationsUnresolved=i.violationsUnresolved.filter(t),this.violationsIgnored=i.violationsIgnored.filter(t),i},o.prototype.removeViolationsForFile=function(e){function t(t){return!(1===t.files.length&&-1<t.files.indexOf(e))}var i=o.clone(this);return i.violationsUnresolved=i.violationsUnresolved.filter(t),this.violationsIgnored=i.violationsIgnored.filter(t),i},o.prototype.ignoreViolation=function(e){var t=o.clone(this);return t.violationsUnresolved=t.violationsUnresolved.filter(function(t){return t.id!==e.id}),t.violationsIgnored.push(e),t},Object.defineProperty(o.prototype,"clientViolations",{get:function(){return this.violationsUnresolved.filter(function(t){return t.isClientViolation()})},enumerable:!0,configurable:!0}),e.ValidationStatus=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.files=[],this.recipients=[],void 0!==t&&(this.businessRuleId=t.businessRuleId,this.description=t.description,this.files=t.files||[],this.id=t.id.toString(),this.recipients=t.recipients||[],this.showStopper=t.showStopper,this.violationCategory=t.violationCategory,this.violationLevel=t.violationLevel,this.violationType=t.violationType)}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.isClientViolation=function(){return 0===this.businessRuleId.indexOf("client::")},e.Violation=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(9),i(13)],e=function(t,e,i,n){var o;function s(t){var e=o.call(this,t)||this;return void 0!==t&&(e.shareId=t.shareId),e}Object.defineProperty(e,"__esModule",{value:!0}),o=n.Quote,i.__extends(s,o),e.DraftQuote=s}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9)],e=function(t,e,r){function i(t){this.parts=[],void 0!==t&&(this.fileslotId=t.id,this.fileType=t.fileType,this.inline=t.inline||!1,this.name=t.name,this.size=t.size)}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.fileId||this.fileslotId},enumerable:!0,configurable:!0}),i.prototype.calculateParts=function(t,e){for(var i=[],n=0,o=e,s=0;s<t;s++)i.push({part:s+1,start:n,end:o}),(o=(n=o)+e)>this.size&&(o=this.size);this.parts=i.map(function(t){return r.__assign(r.__assign({},t),{loaded:0,total:t.end-t.start})}),this.upload={aborted:!1,progress:0,loaded:0,partsLeft:this.parts.length}},e.DraftAttachment=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(124),i(53)],e=function(t,e,i,n){function o(t){this.$http=t,this.requestConfig={authenticationRequired:!1}}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$http"],o.prototype.getInfo=function(t){return this.$http.get("/api/conversation_starters/"+t,this.requestConfig).then(function(t){return t.data})},o.prototype.initiateConversationGuest=function(t,e){return this.$http.post("/api/conversation_starters/"+t,n.removeEmptyProps(e),this.requestConfig).then(function(t){return t.data})},o.prototype.validateConversationStarterToken=function(t){return this.$http.put("/api/conversation_starters",{token:t},this.requestConfig).then(function(t){return t.data})},o.prototype.getBranding=function(t){return this.$http.get("/api/branding/conversation_starters/"+t,this.requestConfig).then(function(t){return new i.GuestBranding(t.data)}).catch(function(){return new i.GuestBranding})},e.ConversationStartersService=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.GuestBranding=function(t){this.name="zivver",void 0!==t&&(this.accentColor=t.accentColor,this.logoUrl=t.logoUrl,this.name=t.name,this.primaryColor=t.primaryColor,this.wallpaperUrl=t.wallpaperUrl,this.languageColor=t.languageColor)}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(9),i(14),i(11),i(13),i(124)],e=function(t,e,n,o,a,r,i){function s(t,e,i,n,o,s){var r=this;this.$http=t,this.$q=e,this.$rootScope=i,this.$timeout=n,this.AccessRightGrantService=o,this.SpecialsService=s,this.downloadTokens=new Map,this.shares=new Map,i.$on(a.AuthEvents.logoutSuccess,function(){r.downloadTokens=new Map,r.shares=new Map})}Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$http","$q","$rootScope","$timeout","AccessRightGrantService","SpecialsService"],s.prototype.list=function(e,t,i,n,o){var s=this,i={order:e,label:i,limit:n=void 0===n?50:n,start:void 0===t?void 0:t.toISOString(),special:o};return this.$http.get("/api/conversations",{params:i}).then(function(t){return t.data}).then(function(t){return"asc"===e&&(t.items=t.items.reverse()),{items:t.items.map(function(t){return new r.Conversation(t,s.labels)}),pagination:{total:t.pagination.total}}})},s.prototype.get=function(t){var n=this;return this.$http.get("/api/conversations/"+t).then(function(t){return t.data}).then(function(i){return void 0===i.specialId?new r.Conversation(i,n.labels):n.SpecialsService.getConversationFlow(t).then(function(t){var e=new r.Conversation(i,n.labels);return e.flow=t,e})})},s.prototype.getMessage=function(t,e,i){return this.$http.get("/api/conversations/"+t+"/messages/"+e,{params:{token:i}}).then(function(t){return t.data}).then(function(t){return new r.ConversationMessage(t)})},s.prototype.removeConversation=function(t){return this.$http.delete("/api/shares_in/"+t).then(function(){return!0})},s.prototype.getBatch=function(t){var e=this;return this.$http.post("/api/conversations/batch",{ids:t}).then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new r.Conversation(t,e.labels)})})},s.prototype.listMessages=function(t,e,o){return this.$http.get("/api/conversations/"+t+"/messages",{params:{order:"asc",token:e,limit:1e3}}).then(function(t){return t.data}).then(function(t){var e=t.items.reduce(function(t,e){var i,n=e.sender===o;return e.deleted||e.revoked&&0==n?((i=new r.ConversationEvent).originator=e.sender,i.createdDate=new Date(e.created),e.deleted&&n?i.eventType="deleted-own":e.deleted?i.eventType="deleted":e.revoked&&(i.eventType="revoked"),t[1].push(i)):((i=new r.ConversationMessage(e)).isOwn=n,t[0].push(i)),t},[[],[]]),i=e[0],e=e[1];return{items:i,events:n.__spreadArrays(t.events.map(function(t){return new r.ConversationEvent(t)}),e),pagination:t.pagination}})},s.prototype.revokeMessage=function(t,e,i){return this.$http.delete("/api/conversations/"+t+"/messages/"+e+"?action="+i).then(function(){return!0})},s.prototype.unrevokeMessage=function(t,e){return this.$http.post("/api/conversations/"+t+"/messages/"+e+"/un_revoke",{}).then(function(){return!0})},s.prototype.scheduleAccessRemoval=function(t,e,i){return this.$http.put("/api/conversations/"+t+"/messages/"+e+"/scheduled_expiration",i).then(function(){return!0})},s.prototype.unscheduleAccessRemoval=function(t,e){return this.$http.delete("/api/conversations/"+t+"/messages/"+e+"/scheduled_expiration").then(function(){return!0})},s.prototype.deliverMessage=function(t,e,i){return this.$http.post("/api/conversations/"+t+"/messages/"+e+"/deliver/self",{params:{token:i}}).then(function(){return!0})},s.prototype.updateReadMarker=function(t,e){return this.updateConversation(t,{readMarker:e}).then(function(t){return t})},s.prototype.moveConversation=function(t,e){return this.updateConversation(t.id,{archive:"ARCHIVE"===e,trash:"TRASH"===e})},s.prototype.setMessageParticipants=function(e,t){e.participant=t.filter(function(t){return t.email===e.sender})[0]},s.prototype.setConversationLabels=function(t,e){var i=this,n=(e=e.concat([t.systemLabel])).map(function(t){return t.id});return this.updateConversation(t.id,{labels:n}).then(function(){return t.labelIdList=n,t.updateLabelCollection(new r.LabelCollection(e)),i.$rootScope.$broadcast("conversation:updated",t),t})},s.prototype.search=function(t,e){return this.$http.get("/api/conversations/search",{params:{search:t,specialId:e}}).then(function(t){return t.data}).then(function(t){return t.items})},s.prototype.getMessageOpenedBy=function(t,e){return this.$http.get("/api/conversations/"+t+"/messages/"+e+"/opened_by").then(function(t){return t.data})},s.prototype.getShare=function(i){var n=this;return this.shares.has(i)?this.$q.resolve(this.shares.get(i)):this.$http.get("/api/shares_in/"+i).then(function(t){return t.data}).then(function(t){return new r.Share(t)}).then(function(e){return n.AccessRightGrantService.getGrant(e.id).then(function(t){return e.setAccessRightGrant(t),e.isAccessGranted()&&n.AccessRightGrantService.setGrant(e.id,t),n.shares.set(i,e),e})})},s.prototype.triggerAccessRight=function(t){return this.$http.put("/api/shares_in/"+t.id+"/access_rights/"+t.accessRight.id,{}).then(function(){return!0})},s.prototype.notifySender=function(t){return this.$http.post("/api/shares_in/"+t.id+"/access_rights/"+t.accessRight.id+"/inaccessible",{}).then(function(t){return t.data})},s.prototype.validateAccessRight=function(e,t){var i=this,t={response:t,downloadGrant:e.accessRightGrant.token};return this.$http.post("/api/shares_in/"+e.id+"/access_rights/"+e.accessRight.id,t).then(function(t){return t.data}).then(function(t){t=new r.AccessRightGrant(t);return e.setAccessRightGrant(t),i.shares.set(e.id,e),t})},s.prototype.getAttachmentInfo=function(t,e){return this.$http.get("/api/shares_in/"+t+"/files/"+e+"/opened_by").then(function(t){return t.data})},s.prototype.getFileDownloadUrl=function(e,i){return this.getShareDownloadToken(e).then(function(t){return"/api/shares_in/"+e.id+"/files/"+i+"/download/content?download_token="+t})},s.prototype.getFileDownloadAllUrl=function(e,i){return this.getShareDownloadToken(e).then(function(t){return"/api/shares_in/"+e.id+"/messages/"+i+"/files/download/content?download_token="+t})},s.prototype.getMessageDownloadUrl=function(t,e,i,n){return this.getShareDownloadToken(t).then(function(t){return"/api/conversations/"+e+"/messages/"+i+"/download/content?download_token="+t+"&file_type="+n})},s.prototype.addNewParticipants=function(t,e,i){e={items:e.map(function(t){return t.toRequestEntity()}),downloadGrantToken:i};return this.$http.post("/api/conversations/"+t+"/participants/finalize",e).then(function(){return!0})},s.prototype.removeParticipant=function(t,e){return this.$http.post("/api/conversations/"+t+"/participants/remove",{email:e}).then(function(){return!0})},s.prototype.validateNewParticipants=function(t,e,i){e={items:e.map(function(t){return t.toRequestEntity()}),downloadGrantToken:i};return this.$http.put("/api/conversations/"+t+"/participants/validation",e).then(function(t){return t.data})},s.prototype.setLabels=function(t){this.labels=t},s.prototype.getBrandingForShare=function(t){return this.$http.get("/api/branding/accounts/"+t.conversationCreatorAccountUuid).then(function(t){return new i.GuestBranding(t.data)}).catch(function(){return new i.GuestBranding})},s.prototype.updateConversation=function(t,e){return this.$http.patch("/api/conversations/"+t,e).then(function(){return!0}).catch(function(){return!1})},s.prototype.updateVerification=function(t,e,i){return this.$http.patch("/api/conversations/"+t+"/participants/"+e+"/verification",i).then(function(t){return t.data})},s.prototype.getSecurityLevel=function(t){return this.$http.get("/api/domains",{params:{email:t}}).then(function(t){return t.data.securityLevel})},s.prototype.sendCopyToInbox=function(t,e,i){return this.$http.post("/api/conversations/"+t+"/messages/"+e+"/deliver/self",{securityLevel:i}).then(function(){return!0})},s.prototype.getShareDownloadToken=function(i){var n=this;if(this.downloadTokens.has(i.id)){var t=this.downloadTokens.get(i.id),e=t.token,t=t.expires;if(new Date<t)return e;this.downloadTokens.delete(i.id)}t={token:i.accessRightGrant.token},e=this.$http.post("/api/shares_in/"+i.id+"/download",t).then(function(t){return t.data}).then(function(t){var e=o().add(t.tokenExpirySeconds-10,"seconds");return n.downloadTokens.set(i.id,{expires:e.toDate(),token:n.$q.resolve(t.token)}),t.token});return this.downloadTokens.set(i.id,{expires:o().add(10,"seconds").toDate(),token:e}),e},s.prototype.getProofOfDeliveryDownloadToken=function(t,e,i){var n=this,o=t+"-"+e;if(this.downloadTokens.has(o)){var s=this.downloadTokens.get(o),r=s.token,s=s.expires;if(new Date<s)return r;this.downloadTokens.delete(o)}return this.$http.get("/api/conversations/"+t+"/messages/"+e+"/logs/download",{params:{recipient:i}}).then(function(t){var e=t.data.expirationTime;return n.downloadTokens.set(o,{expires:new Date(e),token:n.$q.resolve(t.data.token)}),t.data.token})},s.prototype.getProofOfDeliveryReport=function(e,i,t){return this.getProofOfDeliveryDownloadToken(e,i,t).then(function(t){return"/api/conversations/"+e+"/messages/"+i+"/logs/download/content?download_token="+t})},s.prototype.clearShares=function(){this.shares=new Map},e.ConversationsService=s}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http"],i.prototype.getPrincipalAccounts=function(t){return this.$http.get("/api/accounts/"+t+"/delegates").then(function(t){return t.data}).then(function(t){return t.items})},i.prototype.addPrincipalAccount=function(t,e){return this.$http.post("/api/accounts/"+t+"/delegates",{delegateAccountId:e}).then(function(){return!0})},i.prototype.removePrincipalAccount=function(t,e){return this.$http.delete("/api/accounts/"+t+"/delegates/"+e).then(function(){return!0})},i.prototype.getDelegations=function(){return this.$http.get("/api/delegations").then(function(t){return t.data}).then(function(t){return t.items.sort(function(t,e){t=t.fullName||t.email,e=e.fullName||e.email;return t.localeCompare(e)})})},i.prototype.listDelegateAccounts=function(){return this.$http.get("/api/delegations/delegates").then(function(t){return t.data}).then(function(t){return t.items})},i.prototype.addDelegateAccount=function(t){return this.$http.post("/api/delegations/delegates",{email:t}).then(function(){return!0})},i.prototype.removeDelegateAccount=function(t){return this.$http.delete("/api/delegations/delegates/"+t).then(function(){return!0})},e.DelegateAccountService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(72)],e=function(t,e,s){function r(t,e,i,n){var o=this;this.$rootScope=t,this.$timeout=i,this.$log=n,this.uaParser=new s.UAParser,e.addEventListener("orientationchange",function(){var t=-1<e.screen.orientation.type.indexOf("landscape")?"landscape":"portrait";o.$timeout(function(){o.$rootScope.$broadcast(r.Events.OrientationChanged,t),o.$log.debug("Device orientation changed to ",t)},10,!1)}),e.addEventListener("resize",function(){o.$timeout(function(){o.$rootScope.$broadcast(r.Events.WindowResized),o.$log.debug("Window resized ")},10,!1)})}Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$rootScope","$window","$timeout","$log"],r.prototype.isDesktop=function(){return void 0===this.uaParser.getDevice().type},r.prototype.isMobile=function(){return"mobile"===this.uaParser.getDevice().type},r.prototype.isTablet=function(){return"tablet"===this.uaParser.getDevice().type},r.prototype.getBrowser=function(){return this.uaParser.getBrowser()},r.prototype.getDevice=function(){return this.uaParser.getDevice()},r.prototype.getOS=function(){return this.uaParser.getOS()},r.prototype.isMSBrowser=function(){var t=/edg\b/g.test(window.navigator.userAgent.toLowerCase()),e=this.getBrowser().name;return"IE"===e||"Edge"===e&&!1===t},r.prototype.simulateMouseClick=function(t){this.$timeout(function(){var e;try{e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})}catch(t){(e=document.createEvent("MouseEvent")).initEvent("click",!1,!1,{view:window})}t.dispatchEvent(e)},180,!1)},r.Events={OrientationChanged:"OrientationChanged",WindowResized:"WindowResized"},e.DeviceService=r}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(77),i(38)],e=function(t,e,a,i){Object.defineProperty(e,"__esModule",{value:!0});var n="(([\\w_.+-])+\\s)+";function c(){this.validPatternsList=[c.PATTERN_GMAIL,c.PATTERN_OUTLOOK,c.PATTERN_EMAIL,c.PATTERN_ANYTHING_ELSE]}c.prototype.extractRecipientsUsingRegex=function(t){var e=[];if(null!==t.match(c.PATTERN_SEPARATORS.pattern))for(var i=0,n=t.split(c.PATTERN_SEPARATORS.pattern);i<n.length;i++){var o=n[i];0!==o.length&&""!==o&&" "!==o&&(o=this.getMatchFor(o),e.push(o))}else 0!==t.length&&""!==t&&" "!==t&&e.push(this.getMatchFor(t));return e},c.prototype.getMatchFor=function(t){for(var e={},i=0,n=this.validPatternsList;i<n.length;i++){var o=n[i],s=t.match(o.pattern);if(null!==s&&s.length){var s=s[0],r=s.match(c.PATTERN_NAME.pattern),r=(null!==r&&r.length&&(e.fullName=r.shift().trim()),s.match(c.PATTERN_EMAIL.pattern));if(null!==r&&r.length&&(e.email=r.shift().trim().toLowerCase()),o===c.PATTERN_ANYTHING_ELSE&&(e.email=s),void 0!==e.email&&void 0!==e.fullName)break;if(void 0!==e.email)break}}return new a.Recipient(e)},c.PATTERN_SEPARATORS={name:"separators",pattern:new RegExp("[,;]+","g")},c.PATTERN_NAME={name:"onlyName",pattern:new RegExp(n,"ig")},c.PATTERN_EMAIL={name:"zivverEmail",pattern:new RegExp(i.EMAIL_REGEX,"i")},c.PATTERN_GMAIL={name:"gmail",pattern:new RegExp("("+n+")(<("+i.EMAIL_REGEX+")>)","ig")},c.PATTERN_OUTLOOK={name:"outlook",pattern:new RegExp("("+n+")("+i.EMAIL_REGEX+")","ig")},c.PATTERN_ANYTHING_ELSE={name:"anythingElse",pattern:new RegExp("(([^\\s,;])+\\s?)+","ig")},e.DraftsRecipientsService=c}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(15),i(43)],e=function(t,e,n,o){Object.defineProperty(e,"__esModule",{value:!0});var s="ignoredViolations.";function i(t,e){this.$rootScope=t,this.StorageService=e}i.$inject=["$rootScope","StorageService"],i.prototype.dismissViolation=function(t,e){var i=n.ValidationStatus.clone(e.validation),i=(i=t.isClientViolation()?i.removeViolationByBusinessRuleId(t.businessRuleId):i).ignoreViolation(t);return this.$rootScope.$broadcast(o.DraftEvents.ValidationsUpdated,{validation:i}),this.StorageService.setItem("SESSION",s+e.id,i.violationsIgnored.map(function(t){return t.id})),i},i.prototype.dismissAllViolations=function(t){var e=n.ValidationStatus.clone(t.validation);return e.violationsUnresolved.filter(function(t){return!1===t.showStopper}).forEach(function(t){e=(e=t.isClientViolation()?e.removeViolationByBusinessRuleId(t.businessRuleId):e).ignoreViolation(t)}),this.$rootScope.$broadcast(o.DraftEvents.ValidationsUpdated,{validation:e}),this.StorageService.setItem("SESSION",s+t.id,e.violationsIgnored.map(function(t){return t.id})),e},i.prototype.getDismissedViolationsIds=function(t){return this.StorageService.getItem("SESSION",s+t)||[]},i.prototype.clearDismissedViolations=function(t){return this.StorageService.removeItem("SESSION",s+t)},i.prototype.getIconStatus=function(t,e){var i=t.getErrors(),n=t.getShowStoppers(),o=t.getSuggestions(),s=t.getWarnings();return e?{iconStatus:"unknown",icon:"lock",info:".NOTIFICATIONS.UNKNOWN"}:0<s.length||0<i.length||0<n.length?{iconStatus:"error",icon:"error",info:".NOTIFICATIONS."+(0<i.length?"ERROR":"WARNING")}:0===t.violationsUnresolved.length||0<o.length?{iconStatus:"verified",icon:"lock",info:".NOTIFICATIONS.OK"}:void 0},e.DraftsValidationService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(15)],e=function(t,e,o){function i(t,e,i,n){this.$log=t,this.$q=e,this.$http=i,this.Upload=n,this.maxFileSize=5497558138880}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$log","$q","$http","Upload"],i.prototype.createFileSlot=function(t,e,i,n){return this.$http.post("/api/files_out",{fileType:i,size:e,name:t,inline:n}).then(function(t){return new o.DraftAttachment(t.data)})},i.prototype.initMultipart=function(t){return this.$http.put("/api/files_out/"+t.fileslotId+"/multipart",{}).then(function(t){return t.data})},i.prototype.readMultipart=function(n,o,s){return this.$q(function(t,e){var i=new FileReader;i.readAsArrayBuffer(n.slice(o,s)),i.onloadend=function(){i.readyState===FileReader.DONE?t(i.result):e("Error reading file part from "+o+" to "+s)}})},i.prototype.uploadPart=function(t,i,e){e={method:"put",url:"/api/files_out/"+t.fileslotId+"/multipart/"+i,data:e,headers:{"Content-Type":"application/octet-stream"},timeout:this.$q(function(e){return t.parts=t.parts.map(function(t){return t.part===i&&(t.abort=e),t})}),transformRequest:function(t){return t},uploadEventHandlers:{progress:function(e){t.parts=t.parts.map(function(t){return t.part===i&&(t.loaded=e.loaded),t}),t.upload.loaded=t.parts.reduce(function(t,e){return t+e.loaded},0),t.upload.progress=Math.floor(t.upload.loaded/t.size*100)}}};return this.$http(e).then(function(){t.upload.partsLeft--,t.parts=t.parts.map(function(t){return t.part===i&&(t.abort=function(){}),t})})},i.prototype.finishMultipart=function(t){return this.$http.post("/api/files_out/"+t+"/multipart",{}).then(function(){return!0})},i.prototype.uploadToFileSlot=function(e,t){return e.upload={aborted:!1,partsLeft:0,progress:0,loaded:0},this.Upload.http({url:"/api/files_out/"+e.id+"/content",method:"POST",data:t,headers:{"Content-Type":"application/octet-stream"},timeout:0}).progress(function(t){void 0!==e.upload&&(e.upload.loaded=t.loaded,e.upload.progress=t.loaded/t.total*100)}).then(function(){return e.upload=void 0,e})},i.prototype.remove=function(t){return this.$http.delete("/api/files_out/"+t).then(function(){return!0})},i.prototype.getMaxFileSize=function(){return this.maxFileSize},e.FilesOutService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http"],i.prototype.getFTPStatus=function(){return this.$http.get("/api/authentication/ftp",{}).then(function(t){return t.data})},i.prototype.setFTPStatus=function(t){return this.$http.put("/api/authentication/ftp",{enabled:t}).then(function(t){return t.data})},e.FTPService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http"],i.prototype.list=function(){return this.$http.get("/api/functions").then(function(t){return t.data}).then(function(t){return t.items})},i.prototype.update=function(t,e){return this.$http.post("/api/functions/"+t+"/members",{member:e}).then(function(){})},i.prototype.remove=function(t,e){return this.$http.delete("/api/functions/"+t+"/members/"+e).then(function(){return!0})},e.FunctionsService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(t,e,i){this.$http=t,this.$q=e,this.$log=i}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http","$q","$log"],i.prototype.getCountryCodes=function(){return this.$http.get("/api/geo/phonenumbers",{cache:!0}).then(function(t){return t.data})},i.prototype.getCountries=function(){return this.$http.get("/api/geo/countries").then(function(t){return t.data})},i.prototype.getCountriesInfo=function(){var e=this;return void 0===this.countriesInfo&&(this.countriesInfo=this.$q.all([this.getCountryCodes(),this.getCountries()]).then(function(t){var e=t[0],i=t[1],n=[];return Object.keys(e).forEach(function(t){void 0!==i[t]&&n.push({iso:t,name:i[t],code:e[t].toString()})}),n}).catch(function(t){return e.$log.warn("Error getting codes and names",{error:t}),e.countriesInfo=void 0,[]})),this.countriesInfo},i.prototype.validatePhonenumber=function(t,e){return this.$http.put("/api/geo/phonenumbers/validate",{defaultRegion:e,phoneNumber:t=void 0===t?"":t}).then(function(t){return t.data})},i.prototype.getCurrentCountryIso=function(){return this.$http.get("/api/geo/countries/current_by_ip").then(function(t){return t.data.region})},e.GeoService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(227)],e=function(t,e,i){function n(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$http"],n.prototype.get=function(t){return this.$http.get("/api/accounts/invites/"+t).then(function(t){return t.data}).then(function(t){return new i.Invite(t)})},n.prototype.invite=function(t){return this.$http.post("/api/accounts/invites",t).then(function(t){return t.data}).then(function(t){return new i.Invite(t)})},n.prototype.update=function(t,e){return this.$http.put("/api/accounts/invites/"+t,e).then(function(t){return t.data}).then(function(t){return new i.Invite(t)})},n.prototype.remove=function(t){return this.$http.delete("/api/accounts/invites/"+t).then(function(){return!0})},e.InvitesService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http"],i.prototype.verifyAdoptShareToken=function(t){return this.$http.put("/api/keys/adopt_share_key",{shareToken:t}).then(function(t){return t.data})},i.prototype.adoptShareToken=function(t){return this.$http.post("/api/keys/adopt_share_key",{shareToken:t}).then(function(){return!0})},e.KeysService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(11),i(13)],e=function(t,e,r,n){function i(t,e,i,n,o){var s=this;this.$rootScope=t,this.$log=e,this.$q=i,this.$http=n,this.AppSwitcherService=o,t.$on(r.AuthEvents.logoutSuccess,function(){s.labelCollectionCached=void 0})}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$rootScope","$log","$q","$http","AppSwitcherService"],i.prototype.getLabels=function(t){var e=this;return void 0===t&&(t=!0),void 0!==this.labelCollectionCached&&t?this.$q.resolve(this.labelCollectionCached):(void 0!==this.getPromise&&t||(t=this.AppSwitcherService.getContext().specialId,this.getPromise=this.$http.get("/api/labels",{params:{special:t}}).then(function(t){return t.data}).then(function(t){return e.getPromise=void 0,e.labelCollectionCached=new n.LabelCollection(t.items.map(function(t){return new n.Label(t)})),e.labelCollectionCached})),this.getPromise)},i.prototype.createLabel=function(t,e){var i=this;return this.$http.post("/api/labels",{name:t,color:e}).then(function(t){return t.data}).then(function(t){t=new n.Label(t);return void 0!==i.labelCollectionCached&&(i.labelCollectionCached.add(t),i.broadCastUpdate()),t})},i.prototype.updateLabel=function(t,e,i){var n=this,o={name:e,color:i};return this.$http.put("/api/labels/"+t,o).then(function(){void 0!==n.labelCollectionCached&&(n.labelCollectionCached.update(t,o),n.broadCastUpdate())})},i.prototype.removeLabel=function(t){var e=this;return this.$http.delete("/api/labels/"+t).then(function(){return void 0!==e.labelCollectionCached&&(e.labelCollectionCached.remove(t),e.broadCastUpdate(),e.broadCastDelete(t)),!0})},i.prototype.getLabelsAndBroadcast=function(){var e=this;return this.getLabels(!1).then(function(t){return e.broadCastUpdate(),t})},i.prototype.getColors=function(){return Object.keys(n.LabelColors)},i.prototype.broadCastUpdate=function(){this.$rootScope.$broadcast(n.LabelEvents.Updated,this.labelCollectionCached)},i.prototype.broadCastDelete=function(t){this.$rootScope.$broadcast(n.LabelEvents.Deleted,t)},e.LabelService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(305)],e=function(t,e,i){function n(t){var e=this;this.$q=t,this.resolversMap=new Map,this.worker=new i,this.worker.addEventListener("message",function(t){e.resolversMap.get(t.data.id)(t.data.result),e.resolversMap.delete(t.data.id)})}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$q"],n.prototype.convertStringToLink=function(t,e){var i=this.$q.defer();return this.resolversMap.set(t,i.resolve),this.worker.postMessage({id:t,message:e}),i.promise},e.LinkifyService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9),i(1)],e=function(t,e,i,n){c.$inject=["$provide","$logProvider"],Object.defineProperty(e,"__esModule",{value:!0}),(o=r=e.LogLevel||(e.LogLevel={})).INFO="INFO",o.WARN="WARN",o.ERROR="ERROR";var r,o,s=['ARIA: Attribute "',"mdInput messages show animation called on invalid messages element: "];function a(t,e){var i=this;this.$timeout=t,this.$state=e,this.messageMemory={},this.CHANNEL="WEBAPP",this.resetDefaultContext(),this.messageMemory={},this.$timeout(function(){i.purgeMemory()},6e5,!1)}function c(t,e){function i(o,s){return[r.ERROR,r.WARN,r.INFO].forEach(function(t){var i,e,n;e=o,t=(i=t).toString().toLowerCase(),n=e[t],e[t]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.apply(null,t),function(t,e,i){s.get("LoggerService").logMessage(t,e,i)}.apply(null,[i].concat(t))}}),o}e.debugEnabled(!(i.$inject=["$delegate","$injector"])),t.decorator("$log",i)}a.$inject=["$timeout","$state"],a.prototype.addToDefaultContext=function(t,e){null===e&&n.isDefined(this.defaultContext[t])?delete this.defaultContext[t]:this.defaultContext[t]=e},a.prototype.resetDefaultContext=function(){this.defaultContext={version:"2.20.216"}},a.prototype.logMessage=function(t,e,i){void 0===i&&(i={}),"string"!=typeof(e=n.isArray(e)?e.shift():e)&&(e=void 0!==e.message?e.message:JSON.stringify(e)),void 0!==this.messageMemory[t+"-"+e]||-1<s.indexOf(e)||(this.messageMemory[t+"-"+e]=Date.now(),t={channel:this.CHANNEL,level:t,message:e.substr(0,255),context:this.getContext(i)},fetch("/api/log",{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json","Zivver-User-Agent":"Zivver WebApp/${ENV_VERSION} API/1.58.36"},body:JSON.stringify(t)}).catch(function(t){}))},a.prototype.getContext=function(t){return i.__assign(i.__assign(i.__assign({},t),this.defaultContext),{state:this.$state.current.name})},a.prototype.purgeMemory=function(){var e=this,i=Date.now()-600;Object.keys(this.messageMemory).forEach(function(t){e.messageMemory[t]<i&&delete e.messageMemory[t]}),this.$timeout(function(){e.purgeMemory()},6e5,!1)},e.LoggerService=a,e.decorateLogService=c}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9),i(11)],e=function(t,r,o,a){Object.defineProperty(r,"__esModule",{value:!0});var i=["login","login-extra-factor","login-refresh","login-401","logout"],e=(r.SSO_TARGET_USERNAME_STORAGE_KEY="sso.targetUsername",r.SSO_IDP_URL_STORAGE_KEY="sso.url",n.$inject=["$q","$timeout","$log","$http","$httpParamSerializerJQLike","$state","AuthSessionService","StorageService"],n.prototype.login=function(t,e){var i=this,n=this.AuthSessionService.getSessionDuration(this.rememberMe);return this.loginRequest(a.GrantType.password,{username:t,password:e,zivver_session_duration:n}).then(function(t){return i.processRefreshToken(t,!1,!1,n)}).then(function(t){return i.processAccessToken(t)})},n.prototype.loginMobappSsoRefreshToken=function(t){var e=this;return this.loginRequest(a.GrantType.refresh_token,{refresh_token:t}).then(function(t){return e.processRefreshToken(t)}).then(function(t){return e.processAccessToken(t)})},n.prototype.logout=function(t){return this.logoutRequest(t)},n.prototype.refresh=function(t){var e=this;return(t=void 0===t||t)&&void 0!==this.refreshPromise?this.refreshPromise:(t=this.AuthSessionService.isDelegate()?a.GrantType.delegate:a.GrantType.refresh_token,t=this.loginRequest(t,{refresh_token:this.AuthSessionService.getRefreshToken(),username:this.AuthSessionService.getUsername()}).then(function(t){return e.processRefreshToken(t,e.AuthSessionService.isDelegate(),e.AuthSessionService.isGuest())}).then(function(t){return e.processAccessToken(t)}).finally(function(){e.refreshPromise=void 0}),this.refreshPromise=t)},n.prototype.authCodeLogin=function(t,e){var i=this,n=(this.rememberMe=e,this.AuthSessionService.getSessionDuration(e));return this.loginRequest(a.GrantType.authorization_code,{code:t,zivver_session_duration:n}).then(function(t){return i.processRefreshToken(t,!1,!e,n)}).then(function(t){return i.processAccessToken(t)})},n.prototype.ssoLogin=function(t){var o=this,s=(this.rememberMe=!1,this.AuthSessionService.getSessionDuration());return this.loginRequest(a.GrantType.authorization_code,{code:t,zivver_session_duration:s}).then(function(t){var e,i=null!=(i=o.StorageService.getItem("SESSION",r.SSO_TARGET_USERNAME_STORAGE_KEY))?i:"",n=null!=(n=o.StorageService.getItem("SESSION",r.SSO_IDP_URL_STORAGE_KEY))?n:"";if(""!==i&&t.username!==i)throw(e=new Error("SSO user mismatch")).name="SSO_TARGET_USER_MISMATCH",e.extras={actualUser:t.username,targetUser:i,idpUrl:n},e;return o.processRefreshToken(t,!1,!1,s)}).then(function(t){return o.processAccessToken(t)})},n.prototype.switchAccount=function(t){var e=this,i=this.AuthSessionService.getAccessToken(),n=this.AuthSessionService.getRefreshToken(),o=a.GrantType.delegate;return void 0===n?this.$q.reject("No refresh token available"):(void 0!==i&&!0===this.AuthSessionService.isDelegate()&&this.logoutRequest(i),this.mainUsername===t&&(this.AuthSessionService.forgetDelegate(),o=a.GrantType.refresh_token),this.loginRequest(o,{username:t,refresh_token:n}).then(function(t){return o===a.GrantType.delegate?e.processRefreshToken(t,!0):e.processRefreshToken(t)}).then(function(t){return e.processAccessToken(t)}))},n.prototype.setRememberMe=function(t){this.rememberMe=t},n.prototype.setLoginDestination=function(t,e){void 0===e&&(e={}),-1<i.indexOf(t)||(this.StorageService.setItem("SESSION","login.destination",{stateName:t,stateParams:e}),this.StorageService.setItem("SESSION","login.destination.temp",{stateName:t,stateParams:e}))},n.prototype.getLoginDestination=function(){return this.StorageService.getItem("SESSION","login.destination")||{stateName:"conversations.label",stateParams:{}}},n.prototype.getTempLoginDestination=function(){return this.StorageService.getItem("SESSION","login.destination.temp")||{stateName:"conversations.label",stateParams:{}}},n.prototype.clearLoginDestination=function(){this.StorageService.removeItem("SESSION","login.destination")},n.prototype.getNewWebappDestination=function(){return this.StorageService.getItem("SESSION","login-destination")},n.prototype.setNewWebappDestination=function(t){this.StorageService.setItem("SESSION","login-destination",t)},n.prototype.clearNewWebappLoginDestination=function(){this.StorageService.removeItem("SESSION","login-destination")},n.prototype.check401Response=function(t){var e={reason:t.reason};switch(t.reason){case"ACCOUNT_SUSPENDED":case"NOT_DELEGATED":break;case"CLIENT_IP_NOT_IN_RANGE":e.details={clientIp:t.clientIp,allowedRanges:t.allowedRanges};break;default:return!1}return this.$state.go("login-401",e),!0},n.prototype.handleLoginResult=function(t,e,i){return t.mfaRequired?this.$state.go("login-extra-factor",{},{location:"replace"}):(void 0===e&&(t=this.getLoginDestination(),this.clearLoginDestination(),e=t.stateName,i=t.stateParams),this.$state.go(e,i,{location:"replace"}))},n.prototype.isTrustedDevice=function(){var e=this,t=this.StorageService.getItem("LOCAL",this.getTrustedDeviceStorageKey());return null===t?(this.$log.info("No trusted device token found"),this.$q.resolve(!1)):(this.$log.info("Validating trusted device"),this.$http.put("/api/authentication/trusted-clients",{token:t}).then(function(t){return t.data}).then(function(t){return e.AuthSessionService.setScopes(t.scope.split(" ").map(s)),e.storeTrustedDeviceToken(t.token),e.$log.info("Trusted device validated"),!0},function(t){return e.$log.warn("Trusted device was not valid",{error:t}),e.removeTrustedDeviceToken(),!1}).catch(function(t){return e.$log.warn("Error validating trusted device",{error:t}),!1}))},n.prototype.trustDevice=function(){var e=this;return this.$http.post("/api/authentication/trusted-clients",{}).then(function(t){return t.data}).then(function(t){return e.storeTrustedDeviceToken(t.token)})},n.prototype.createLoginResult=function(t){return{accessToken:t.access_token,accountId:t.accountId,expiresIn:t.expires_in,mfaRequired:t.mfa_required,refreshToken:t.refresh_token,sessionId:t.sessionId,scopes:t.scope.split(" "),username:t.username}},n.prototype.processAccessToken=function(t){return this.AuthSessionService.setAccessToken(t.accessToken,.85*t.expiresIn),this.AuthSessionService.setScopes(t.scopes.map(s)),t},n.prototype.processRefreshToken=function(t,e,i,n){void 0===e&&(e=!1),void 0===i&&(i=!1);var o=this.StorageService.getItem("LOCAL","auth.session");return(null==o?void 0:o.username)===t.username&&this.setRememberMe(!0),e||i?this.AuthSessionService.setSessionToken(t,e,i):this.AuthSessionService.setRefreshToken(t,this.rememberMe,n),this.$timeout(function(){return t},250)},n.prototype.storeTrustedDeviceToken=function(t){this.StorageService.setItem("LOCAL",this.getTrustedDeviceStorageKey(),t)},n.prototype.removeTrustedDeviceToken=function(){this.StorageService.removeItem("LOCAL",this.getTrustedDeviceStorageKey())},n.prototype.getTrustedDeviceStorageKey=function(){return"trusted-client."+this.AuthSessionService.getAccountId()},n.prototype.loginRequest=function(t,e){var i=this,n={authenticationRequired:!1,headers:this.headers};return this.$http.post("/api/authentication/login",this.$httpParamSerializerJQLike(o.__assign(o.__assign({},e),{grant_type:t})),n).then(function(t){return t.data}).then(function(t){return i.createLoginResult(t)})},n.prototype.logoutRequest=function(t){var e={authenticationRequired:!1,headers:this.headers};return this.$http.post("/api/authentication/revoke",this.$httpParamSerializerJQLike({token:t,token_type_hint:"access_token"}),e).then(function(){return!0})},n);function n(t,e,i,n,o,s,r,a){this.$q=t,this.$timeout=e,this.$log=i,this.$http=n,this.$httpParamSerializerJQLike=o,this.$state=s,this.AuthSessionService=r,this.StorageService=a,this.rememberMe=!1,this.headers={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},this.mainUsername=this.AuthSessionService.getUsernameFromStorage()}function s(t){return a.Scopes[t]}r.LoginService=e}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(141)],e=function(t,e,s){function i(t,e,i){this.$log=t,this.$http=e,this.$location=i}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$log","$http","$location"],i.prototype.resize=function(t,e,i,n){var o=this,t={source:this.getAbsoluteUrl(t),resize:{width:e,height:i},fitIn:n};return this.$http.post("/api/media/image_resize",t).then(function(t){return t.data}).then(function(t){return t.url}).catch(function(t){return o.$log.warn("could not get resize image url",{error:t}),s.BLANK_GIF})},i.prototype.proxy=function(t){var e=this;return this.$http.post("/api/media/image_resize",{source:t}).then(function(t){return t.data}).then(function(t){return t.url}).catch(function(t){return e.$log.warn("could not get proxy image url",{error:t}),s.BLANK_GIF})},i.prototype.getAbsoluteUrl=function(t){var e;return"http"!==t.substr(0,4)&&(e=this.$location.protocol()+"://"+this.$location.host(),("http"===this.$location.protocol()&&80!==this.$location.port()||"https"===this.$location.protocol()&&443!==this.$location.port())&&(e+=":"+this.$location.port()),t=""+e+t),t},e.MediaService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){e=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.BLANK_GIF=i(306)}.apply(e,[i,e]);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t,e,i){this.$mdToast=t,this.$mdDialog=e,this.translate=i.instant}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$mdToast","$mdDialog","$translate"],i.prototype.toast=function(t,e,i,n){void 0===e&&(e={}),void 0===i&&(i=!0),void 0===n&&(n=4e3);n=this.$mdToast.simple().position("top center").parent(this.toastParent).hideDelay(n).textContent(i?this.translate(t,e):t);return this.$mdToast.show(n)},i.prototype.alert=function(t,e,i,n,o){void 0===e&&(e=null),void 0===i&&(i={}),void 0===o&&(o=!0);o=this.$mdDialog.alert().htmlContent(o?this.translate(t,i):t).ok(void 0===n?this.translate("MAIN.OK"):n);return 0<(null==e?void 0:e.length)&&o.title(this.translate(e,i)),this.$mdDialog.show(o)},i.prototype.confirm=function(t,e,i,n,o,s){return void 0===e&&(e=""),void 0===i&&(i={}),void 0===o&&(o=null),void 0===s&&(s=!0),null===(n=void 0===n?null:n)&&(n=this.translate("MAIN.OK")),null===o&&(o=this.translate("MAIN.CANCEL")),s=this.$mdDialog.confirm().htmlContent(s?this.translate(t,i):t).ok(n).cancel(o),0<e.length&&s.title(this.translate(e,i)),this.$mdDialog.show(s)},e.MessengerService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(11),i(8)],e=function(t,e,i,n){function o(t,e,i,n){this.$log=t,this.$q=e,this.$http=i,this.StorageService=n;t=this.StorageService.getAndRemoveItem("SESSION","mfa.token");null!==t&&(this.multifactorToken=t)}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","$q","$http","StorageService"],o.prototype.getFactors=function(){var e=this;return this.$http.get("/api/authentication/multifactor").then(function(t){return t.data}).then(function(t){return t.factors.map(function(t){return new i.Multifactor(t)}).sort(e.sortFactors)})},o.prototype.validateFactor=function(t,e,i){return this.$http.post("/api/authentication/multifactor/"+e,{response:i=void 0===i?null:i},{headers:{Authorization:"Bearer "+t}}).then(function(t){return t.data})},o.prototype.getToken=function(){var e=this;return this.$http.get("/api/authentication/multifactor/token").then(function(t){return t.data}).then(function(t){return e.setMultifactorToken(t.token),t})},o.prototype.getTokenWithPassword=function(t){var e=this;return this.$http.post("/api/authentication/multifactor/token",{password:t}).then(function(t){return t.data}).then(function(t){return e.setMultifactorToken(t.token),t})},o.prototype.setupOtp=function(t){var e=this;return this.$http.get("/api/authentication/multifactor/setup/onetimepassword?flavor="+t).then(function(t){return t.data}).then(function(t){return"enabled"===t.status?(e.$log.debug("Cannot setup one time password"),null):(t={otpType:t.otpType,token:e.multifactorToken},e.$http.post("/api/authentication/multifactor/setup/onetimepassword",t).then(function(t){return t.data}).then(function(t){return new i.OtpSetup(t)}))})},o.prototype.setupSmsFactor=function(t){t={phonenumber:t,token:this.multifactorToken};return this.$http.post("/api/authentication/multifactor/setup/sms",t).then(function(t){return t.data})},o.prototype.validateOtpSetup=function(t,e){t={otpType:t,authcode:e,token:this.multifactorToken};return this.$http.put("/api/authentication/multifactor/setup/onetimepassword",t).then(function(){return!0})},o.prototype.validateSmsSetup=function(t,e){t={phonenumber:t,authcode:e,token:this.multifactorToken};return this.$http.put("/api/authentication/multifactor/setup/sms",t).then(function(){return!0})},o.prototype.getBackupcodes=function(){var e=this;return this.$http.get("/api/authentication/multifactor/backupcodes?token="+this.multifactorToken).then(function(t){return t.status===n.HTTP_NO_CONTENT?e.generateBackupcodes():t.data})},o.prototype.generateBackupcodes=function(){var t={token:this.multifactorToken};return this.$http.post("/api/authentication/multifactor/backupcodes",t).then(function(t){return t.data})},o.prototype.removeFactor=function(t){return this.$http.delete("/api/authentication/multifactor/"+t+"?token="+this.multifactorToken).then(function(){return!0})},o.prototype.sortFactors=function(t,e){return t.isTotp()?-1:1},o.prototype.setMultifactorToken=function(t){this.multifactorToken=t},o.prototype.getMultifactorToken=function(){return this.multifactorToken},o.prototype.deleteMultifactorToken=function(){delete this.multifactorToken},o.prototype.mustVerifyIdentity=function(){return void 0===this.multifactorToken?this.getToken().then(function(t){return!1}).catch(function(t){return!0}):this.$q.resolve(!1)},e.MultifactorService=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t,e){this.$log=t,this.$http=e}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$log","$http"],i.prototype.isEmailActive=function(){return this.$http.get("/api/notifications/email").then(function(t){return t.data}).then(function(t){return t.sendNotificationsDefault})},i.prototype.getPushNotificationSubscriptions=function(){var e=this;return this.$http.get("/api/notifications/push").then(function(t){return t.data}).catch(function(t){return e.$log.warn("Error getting push notification subscriptions",{error:t}),{sendNotificationsDefault:!1,userTokens:[]}})},i.prototype.subscribePushNotifications=function(t,e){return this.$http.post("/api/notifications/push",{pushSubscriptionType:t,token:e}).then(function(){return!0})},i.prototype.toggleEmailNotifications=function(t){return this.$http.put("/api/notifications/email",{sendNotificationsDefault:t}).then(function(){return!0})},i.prototype.togglePushNotifications=function(t){return this.$http.put("/api/notifications/push",{sendNotificationsDefault:t}).then(function(){return t})},i.prototype.deletePushNotificationSubscription=function(t){return this.$http.delete("/api/notifications/push/"+t).then(function(){return!0})},e.NotificationService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(52)],e=function(t,e,i){function n(t,e){this.$http=t,this.Upload=e}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$http","Upload"],n.prototype.get=function(){return this.$http.get("/api/organization").then(function(t){return t.data})},n.prototype.updateOrganization=function(t){return this.$http.patch("/api/organization",t).then(function(t){return t.data})},n.prototype.getVerificationSuggestions=function(){return this.$http.get("/api/organization/verification_suggestions").then(function(t){return t.data})},n.prototype.getVerificationSuggestionsByEmail=function(t){t=i.encodeEmailForURI(t);return this.$http.get("/api/organization/verification_suggestions/"+t).then(function(t){return t.data})},n.prototype.removeVerificationSuggestions=function(t){t=i.encodeEmailForURI(t);return this.$http.delete("/api/organization/verification_suggestions/"+t).then(function(){return!0})},n.prototype.uploadVerificationSuggestions=function(t){return this.Upload.http({method:"POST",url:"/api/organization/verification_suggestions/validate",data:t,headers:{"Content-Type":"text/csv"},timeout:0})},n.prototype.importVerificationSuggestions=function(t){return this.$http.post("/api/organization/verification_suggestions",{items:t},{timeout:6e4}).then(function(){return!0})},n.prototype.listClaimedDomains=function(){return this.$http.get("/api/organization/domain_ownership").then(function(t){return t.data})},n.prototype.addClaimedDomain=function(t,e){return this.$http.post("/api/organization/domain_ownership",{domain:t,emailAlias:e}).then(function(){return!0})},n.prototype.verifyClaimedDomain=function(t){return this.$http.put("/api/organization/domain_ownership",{token:t}).then(function(){return!0})},n.prototype.removeClaimedDomain=function(t){return this.$http.delete("/api/organization/domain_ownership/"+t).then(function(){return!0})},n.prototype.forceJoinAccountsDomain=function(t){return this.$http.post("/api/organization/domain_ownership/"+t+"/force_join",{}).then(function(){return!0})},n.prototype.listEmailDomains=function(){return this.$http.get("/api/organization/domain_email").then(function(t){return t.data})},n.prototype.addEmailDomain=function(t){return this.$http.post("/api/organization/domain_email",{domain:t}).then(function(t){return t.data})},n.prototype.updateEmailDomain=function(t,e){return this.$http.patch("/api/organization/domain_email/"+t,{isInboundDirectDeliveryActive:e}).then(function(){return!0})},n.prototype.removeEmailDomain=function(t){return this.$http.delete("/api/organization/domain_email/"+t).then(function(){return!0})},n.prototype.listTrustedDomains=function(){return this.$http.get("/api/organization/trusted_domains").then(function(t){return t.data})},n.prototype.saveTrustedDomains=function(t){return this.$http.post("/api/organization/trusted_domains",t).then(function(t){return t.data})},n.prototype.getSmtpCredentials=function(){return this.$http.get("/api/organization/smtp_credentials").then(function(t){return t.data})},n.prototype.createSmtpCredentials=function(t){return this.$http.post("/api/organization/smtp_credentials",{description:t}).then(function(t){return t.data})},n.prototype.updateSmtpCredentials=function(t,e){return this.$http.patch("/api/organization/smtp_credentials/"+t,{isActive:e}).then(function(){return!0})},n.prototype.removeSmtpCredentials=function(t){return this.$http.delete("/api/organization/smtp_credentials/"+t,{}).then(function(){return!0})},n.prototype.getMessageExpirationPolicy=function(){return this.$http.get("/api/organization/message_expiration_policy").then(function(t){return t.data})},e.OrganizationService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t,e,i){this.$q=t,this.$http=e,this.Upload=i}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$q","$http","Upload"],i.prototype.createOrganizationalUnit=function(t,e,i){return this.$http.post("/api/organization/"+t+"/units",{name:e,scimIdentifier:i}).then(function(t){return t.data})},i.prototype.getOrganizationalUnit=function(t){return this.$http.get("/api/organization/"+t).then(function(t){return t.data})},i.prototype.updateOrganizationalUnit=function(t,e){return this.$http.patch("/api/organization/"+t,e).then(function(){return!0})},i.prototype.removeOrganizationalUnit=function(t){return this.$http.delete("/api/organization/"+t).then(function(){return!0})},i.prototype.uploadOrganizationalUnitLogo=function(t,e){return this.Upload.http({method:"POST",url:"/api/organization/"+t+"/logo",data:e,headers:{"Content-Type":"application/octet-stream"},timeout:0})},i.prototype.removeOrganizationalUnitLogo=function(t){return this.$http.delete("/api/organization/"+t+"/logo").then(function(){return!0})},i.prototype.getOrganizationalUnitFooters=function(t){return this.$http.get("/api/organization/"+t+"/email_footers").then(function(t){return t.data})},i.prototype.saveOrganizationalUnitFooter=function(t,e){return this.$http.post("/api/organization/"+t+"/email_footers",e).then(function(){return!0})},i.prototype.sendOrganizationalUnitFooterExample=function(t,e){return this.$http.post("/api/organization/"+t+"/email_footers/preview",e).then(function(){return!0})},i.prototype.getOrganizationalUnitPreNotificationEmails=function(t){return this.$http.get("/api/organization/"+t+"/pre_notification").then(function(t){return t.data})},i.prototype.saveOrganizationalUnitPreNotificationEmail=function(t,e,i,n){return this.$http.post("/api/organization/"+t+"/pre_notification",{body:e,subject:i,language:n}).then(function(){return!0})},i.prototype.sendOrganizationalUnitPreNotificationEmail=function(t,e,i,n){return this.$http.post("/api/organization/"+t+"/pre_notification/preview",{body:e,subject:i,language:n}).then(function(){return!0})},i.prototype.saveOrganizationalUnitPreNotificationStatus=function(t,e){return this.$http.patch("/api/organization/"+t+"/pre_notification",{enabled:e}).then(function(){return!0})},i.prototype.getOrganizationalUnitAccounts=function(t){return this.$http.get("/api/organization/"+t+"/accounts").then(function(t){return t.data}).then(function(t){return t.items})},i.prototype.getOrganizationalUnitFunctionalAccounts=function(t){return this.$http.get("/api/organization/"+t+"/functional_accounts").then(function(t){return t.data}).then(function(t){return t.items})},i.prototype.getOrganizationalUnitAssignableAccounts=function(t){return this.$http.get("/api/organization/"+t+"/assignable_accounts").then(function(t){return t.data}).then(function(t){return t.items})},i.prototype.moveAccountsToOrganizationalUnit=function(t,e){return this.$http.patch("/api/organization/"+t+"/accounts",{accountUuids:e}).then(function(t){return t.data})},e.OrganizationUnitService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(t,e){this.$http=t,this.$httpParamSerializerJQLike=e}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$http","$httpParamSerializerJQLike"],i.prototype.validateResetToken=function(t){return this.$http.get("/api/authentication/password/forgot",{authenticationRequired:!1,params:{token:t}}).then(function(t){return t.data})},i.prototype.initForget=function(t){return this.$http.post("/api/authentication/password/forgot",this.$httpParamSerializerJQLike({email_address:t}),{authenticationRequired:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(){return!0})},i.prototype.resetPassword=function(t,e,i){return this.$http.put("/api/authentication/password/forgot",{resetToken:t,password:e,recoveryCode:i},{authenticationRequired:!1}).then(function(){return!0})},i.prototype.changePassword=function(t,e){return this.$http.post("/api/authentication/password/change",{oldPassword:t,newPassword:e}).then(function(){return!0})},i.prototype.test=function(t){return this.$http.post("/api/authentication/password/test",{password:t},{authenticationRequired:!1}).then(function(t){return t.data})},e.PasswordService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(14)],e=function(t,e,r){function i(t,e,i,n,o,s){this.$log=t,this.$window=e,this.$timeout=i,this.$translate=n,this.AuthSessionService=o,this.MessengerService=s}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$log","$window","$timeout","$translate","AuthSessionService","MessengerService"],i.prototype.printConversation=function(t,i){var n=this;!1===this.isConversationLoaded(i)?this.MessengerService.toast("PRINT.NOTREADY",{},!0):this.createPrintWindow("share="+t.share+"&conversation="+t.id).then(function(e){try{e.document.title=t.subject,e.document.body.innerHTML=[n.generateHeader(),n.generateConversationHtml(i)].join("\n"),n.$timeout(function(){e.window.print()},250,!1)}catch(t){n.$log.error("Error creating print window DOM",{error:t}),e.close()}}).catch(function(t){n.$log.error("Error creating  print window",{error:t})})},i.prototype.isConversationLoaded=function(t){var e=!1;return[].slice.call(t.querySelectorAll("conversation-message")).forEach(function(t){""!==t.innerHTML&&(e=!0)}),e},i.prototype.createPrintWindow=function(t){var e=this.$window.location,e=e.href.replace(e.pathname,"")+"/print.html#/?"+t,i=this.$window.window.open(e,"print-"+t);return this.$timeout(function(){try{return i.addEventListener("unload",function(){i.close()}),i}catch(t){throw i.close(),t}},350,!1)},i.prototype.generateHeader=function(){return'\n\t\t<header>\n\t\t\t<div class="profile">'+this.AuthSessionService.getUsername()+"</div>\n\t\t</header>\n\t\t"},i.prototype.generateConversationHtml=function(o){var s=this,r=this.$window.document.createElement("div"),t=this.$window.document.body.querySelector("conversation-header .title .md-title").innerHTML,e=this.$window.document.body.querySelector("conversation-header .all-participants").innerHTML;return[].slice.call(o.querySelectorAll("conversation-message")).forEach(function(t,e){var i,n=t.cloneNode(!0);0===e&&[].slice.call(o.querySelectorAll("conversation-quote div.message-quoted")).forEach(function(t){void 0!==t&&(i=t.cloneNode(!0),s.fixConversationQuoteDisplay(i),s.fixConversationQuoteAttachmentsDisplay(i),s.appendConversationQuote(n,i))}),s.fixExpirationBar(n),s.fixHeaderDisplay(n),s.fixConversationAttachmentsDisplay(n),s.hideZivverIntegration(n),r.appendChild(n)}),'\n\t\t<div class="conversation">\n\t\t\t<h1>'+t+"</h1>\n\t\t\t<h2>"+e+"</h2>\n\t\t\t"+r.innerHTML+"\n\t\t</div>"},i.prototype.appendConversationQuote=function(t,e){t.querySelector("a.downloadMessage").appendChild(e)},i.prototype.fixExpirationBar=function(t){var e,t=t.querySelector("expiration-bar");null!==t&&((e=this.$window.document.createElement("span")).classList.add("expiration"),e.textContent=t.querySelector("span.description").innerHTML,t.replaceWith(e))},i.prototype.fixHeaderDisplay=function(t){var e,i,n=null!=(n=t.querySelectorAll("time")[1])?n:t.querySelectorAll("time")[0];null!==n&&((e=this.$window.document.createElement("span")).classList.add("time"),e.textContent=r(n.getAttribute("datetime")).format("D MMM YYYY, kk:mm"),t=(n=t.querySelector("md-card-header-text")).querySelector("span.md-title span.fullname")?n.querySelector("span.md-title span.fullname").innerHTML:"",i=n.querySelector("span.sender .sent-by").innerHTML,n.innerHTML='<span class="sender">'+(""!==t?t+" &lt;"+i+"&gt;":i)+"</span>",n.appendChild(e))},i.prototype.fixConversationAttachmentsDisplay=function(t){t=t.querySelector("conversation-attachments");if(null!==t){var e=this.$window.document.createElement("ul"),i=this.$window.document.createElement("h4");i.textContent=this.$translate.instant("PRINT.ATTACHMENTS")+":";for(var n=0,o=[].slice.call(t.querySelectorAll("span.filename"));n<o.length;n++){var s=o[n],r=this.$window.document.createElement("li");r.textContent=s.getAttribute("title"),e.appendChild(r)}t.parentNode.appendChild(i),t.parentNode.appendChild(e),t.parentNode.removeChild(t)}},i.prototype.fixConversationQuoteDisplay=function(t){var e,i=t.querySelector(".quote-information span.sender"),n=t.querySelector(".quote-information time"),o=t.querySelector("div.conversation-message-body.info div.message-body"),s=t.querySelector("conversation-message-body div.message-body");null!==s&&(null!==n&&(n.textContent=this.$translate.instant("PRINT.QUOTED")+r(n.getAttribute("datetime")).format("LLLL")),(e=this.$window.document.createElement("span")).classList.add("time"),e.appendChild(s),null!==i&&e.appendChild(i),null!==o&&e.appendChild(o),null!==n&&e.appendChild(n),t.appendChild(e),t.classList.add("quote"))},i.prototype.fixConversationQuoteAttachmentsDisplay=function(t){var e=t.querySelector("conversation-attachments");if(null!==e){var i=t.querySelector(".quote-information"),n=this.$window.document.createElement("ul"),o=this.$window.document.createElement("h4");o.textContent=this.$translate.instant("PRINT.ATTACHMENTS")+":";for(var s=0,r=[].slice.call(e.querySelectorAll("span.filename"));s<r.length;s++){var a=r[s],c=this.$window.document.createElement("li");c.textContent=a.getAttribute("title"),n.appendChild(c)}t.removeChild(i),t.appendChild(o),t.appendChild(n),e.parentNode.removeChild(e)}},i.prototype.hideZivverIntegration=function(t){t=t.querySelector("[data-zivver-integration]");null!==t&&t.setAttribute("style","display: none;")},e.PrintService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(53),i(110),i(11)],e=function(t,e,n,o,r){function i(t,e,i,n,o){var s=this;this.$rootScope=t,this.$q=e,this.$http=i,this.AuthSessionService=n,this.Upload=o,t.$on(r.AuthEvents.logoutSuccess,function(){return s.clearCachedProfile()})}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$rootScope","$q","$http","AuthSessionService","Upload"],i.prototype.get=function(){var t,e=this;return void 0===this.cachedProfilePromise&&((t=[]).push(this.$http.get("/api/profile").then(function(t){return t.data}).then(function(t){t=new o.Profile(t);return e.$rootScope.$broadcast("profile-fetched",{profile:t}),t})),t.push(this.progress()),this.cachedProfilePromise=this.$q.all(t).then(function(t){var e=t[0];return e.features=t[1],e})),this.cachedProfilePromise},i.prototype.save=function(t,e){var i=this;return this.$http.patch("/api/profile/"+t,n.removeEmptyProps(e)).then(function(t){return i.cachedProfilePromise=void 0,new o.Profile(t.data)}).then(function(e){return i.AuthSessionService.getAccountId()===t?i.progress().then(function(t){return e.features=t,i.$rootScope.$broadcast("profile-updated",{profile:e}),e}):e})},i.prototype.patchProfile=function(t,e){return this.$http.patch("/api/profile"+(e?"/"+e:""),t).then(function(){return!0})},i.prototype.uploadPicture=function(t,e){var i=this,e=this.Upload.http({method:"POST",url:"/api/profile"+(void 0!==e?"/"+e+"/picture":"/picture"),data:t,headers:{"Content-Type":"application/octet-stream"},timeout:0});return e.then(function(){i.cachedProfilePromise=void 0}),e},i.prototype.removePicture=function(t){return this.$http.delete("/api/profile"+(void 0!==t?"/"+t+"/picture":"/picture")).then(function(){return!0})},i.prototype.clearCachedProfile=function(){this.cachedProfilePromise=void 0},i.prototype.progress=function(){return this.$http.get("/api/profile/progress").then(function(t){return t.data})},i.prototype.deleteAccount=function(t){return this.$http.post("/api/profile/remove",{password:t}).then(function(){return!0})},i.prototype.getInitial=function(t,e){var i=/\w+/.exec(t),e=/\w+/.exec(e);return(t&&i?i:e)[0].charAt(0).toUpperCase()},e.ProfileService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(14)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n="ddd D MMM YYYY HH:mm";function o(t){this.$http=t}o.$inject=["$http"],o.prototype.getInaccessibles=function(){return this.$http.get("/api/keys/recovery/inaccessibles").then(function(t){return t.data}).then(function(t){return t.inaccessibles.map(function(t){return void 0!==t.recoverySent&&(t.recoverySent=i(t.recoverySent).format(n)),t.activeSince=i(t.activeSince).format(n),t.activeUntil=i(t.activeUntil).format(n),t}),t})},o.prototype.getLastCodeInfo=function(){return this.$http.get("/api/keys/recovery").then(function(t){return t.data}).then(function(t){return void 0!==t.lastSent&&(t.lastSent=i(t.lastSent).format(n)),t})},o.prototype.requestNewCode=function(){return this.$http.post("/api/keys/recovery",{}).then(function(){return!0})},o.prototype.requestRecovery=function(t){return this.$http.post("/api/keys/recovery/inaccessibles",t).then(function(t){return t.data})},e.RecoveryKeyService=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(43),i(15),i(8),i(13)],e=function(t,e,s,r,a,n){function i(t,e,i,n,o,s){this.$rootScope=t,this.$q=e,this.$log=i,this.$http=n,this.DraftsValidationService=o,this.WizardService=s}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$rootScope","$q","$log","$http","DraftsValidationService","WizardService"],i.prototype.send=function(t,e,i){e={draft:e.toRequestEntity(),downloadGrantToken:i};return this.$http.post("/api/conversations/"+t+"/draft/finalize",e).then(function(t){return t.data}).then(function(t){return new n.ConversationMessage(t.message)})},i.prototype.validate=function(t,i,e,n){var o=this,e={draft:i.toRequestEntity(),downloadGrantToken:e};return this.$http.put("/api/conversations/"+t+"/draft/validation",e).then(function(t){t.status===a.HTTP_ACCEPTED&&0===(null==(e=t.data.violations)?void 0:e.length)&&(t.data.violations=i.validation.inputViolations,t.data.validDraft=i.validation.validDraft);var e=new r.ValidationStatus(t.data,o.DraftsValidationService.getDismissedViolationsIds(i.id));return e.validationCompleted=t.status===a.HTTP_OK,e=e.addClientViolations(i.validation.clientViolations),o.$rootScope.$broadcast(s.DraftEvents.ValidationsUpdated,{validation:e}),e.hasViolations()&&!1===n&&o.WizardService.showWizardOnce(o.WizardService.WIZARDS.BUSINESSRULES),e})},e.ReplyService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=["A","ADDRESS","AREA","B","BLOCKQUOTE","BR","CAPTION","CODE","COL","COLGROUP","CONVERSATION-MESSAGE-BODY","CONVERSATION-REPLY-MESSAGE","DD","DEL","DIV","DL","DT","EM","FIGCAPTION","FIGURE","FONT","H1","H2","H3","H4","H5","H6","HR","I","IMG","INS","LI","MARK","MAP","OL","P","PRE","Q","S","SMALL","SPAN","STRIKE","STRONG","SUB","SUP","TABLE","TBODY","TD","THEAD","TFOOT","TH","TIME","TR","U","UL"];function n(t,e){this.$window=t,this.$log=e,this.disAllowedTagsSelector=i.reduce(function(t,e){return t+":not("+e+")"},"")}n.$inject=["$window","$log"],n.prototype.sanitizeHtml=function(t,e){for(var i=this.$window.document.createElement("div"),n=(i.style.display="none",i.style.visibility="hidden",i.insertAdjacentHTML("beforeend",t),-1<t.indexOf("data-zivver-integration")),o=0,s=[].slice.call(i.querySelectorAll(this.disAllowedTagsSelector));o<s.length;o++){var r=s[o];this.$log.warn("removing non-whitelisted tag "+r.tagName),this.removeElement(r)}for(var a=0,c=[].slice.call(i.querySelectorAll("img"));a<c.length;a++)r=c[a],this.sanitizeImg(r,e);for(var l=0,u=[].slice.call(i.querySelectorAll("td"));l<u.length;l++)r=u[l],this.sanitizeTable(r);for(var p=0,d=[].slice.call(i.querySelectorAll("a"));p<d.length;p++)r=d[p],this.sanitizeAnchor(r,0==n);for(var h=0,f=[].slice.call(i.querySelectorAll(":not(a):not(img):not(td)"));h<f.length;h++)r=f[h],this.sanitizeElement(r);return i},n.prototype.sanitizeAnchor=function(t,e){void 0===e&&(e=!0);var i=t.getAttribute("href"),n=t.getAttribute("style");this.removeAttributes(t),this.sanitizeStyle(t,n),null!==i&&(null===i.match(/^(call|ftp|http|https|mailto):/i)?this.$log.info("invalid href for a element",{href:i}):(t.target="_blank",t.rel=e?"noopener noreferrer":"opener",t.href=i))},n.prototype.sanitizeImg=function(t,e){var i,n=t.getAttribute("src"),o=t.getAttribute("alt"),s=t.width,r=t.height,a=e.map(function(t){return t.name});this.removeAttributes(t),null!==n&&(0<(null==(i=n.match(/^cid:(.*)?@(.*)$/))?void 0:i.length)&&(n=i[1]),-1<(i=a.indexOf(n))?!1===(a=e[i]).downloadable?this.$log.warn("inline image is marked as not downloadable",{fileId:a.id}):(t.classList.add("internal"),t.setAttribute("attachmentId",a.id)):"http"===n.substring(0,4)?(t.classList.add("external"),t.title=n):t.src=n,0<s&&(t.width=s),0<r)&&(t.height=r),null!==o&&(t.alt=o)},n.prototype.sanitizeTable=function(e){var i=this,n=e.getAttribute("style");[].slice.call(e.attributes).forEach(function(t){switch(t.name){case"align":case"valign":case"width":case"height":case"colspan":case"rowspan":break;case"style":i.sanitizeStyle(e,n);break;default:e.removeAttribute(t.name)}})},n.prototype.sanitizeElement=function(t){var e=t.getAttribute("style");this.removeAttributes(t),this.sanitizeStyle(t,e)},n.prototype.sanitizeStyle=function(n,t){var o,s=this;null!==(t=void 0===t?"":t)&&""!==t&&(t=t.replace(/\\r\\n/gi,"").split(";").map(function(t){return t.trim()}),o=[],t.forEach(function(t){if(""!==t.trim()){var t=t.split(":").map(function(t){return t.toLowerCase().trim()}),e=t[0],i=t[1];switch(e){case"font-family":"wingdings"===i.toLowerCase()&&"J"===n.innerHTML?n.innerHTML="":o.push(e+":"+i.replace(/"/gi,"'"));break;case"background":0<i.indexOf("url")?s.$log.info("invalid style property",{prop:e,val:i}):o.push(e+":"+i);break;case"position":"relative"===i.toLowerCase()&&o.push(e+":"+i);break;case"background-color":case"border":case"border-bottom":case"border-left":case"border-right":case"border-top":case"box-sizing":case"box-top":case"color":case"display":case"letter-spacing":case"line-height":case"max-height":case"max-width":case"outline":case"overflow":case"page":case"vertical-align":case"white-space":case"word-wrap":case"word-spacing":o.push(e+":"+i);break;default:0===e.indexOf("border")||0===e.indexOf("font")||0===e.indexOf("margin")||0===e.indexOf("padding")||0===e.indexOf("text")?o.push(e+":"+i):s.$log.info("invalid style property",{prop:e,val:i})}}}),0<o.length)&&n.setAttribute("style",o.join(";"))},n.prototype.removeAttributes=function(e){var i=["data-zivver-integration"];[].slice.call(e.attributes).filter(function(t){return-1<i.indexOf(t)}).forEach(function(t){return e.removeAttribute(t.name)})},n.prototype.removeElement=function(t){void 0!==t.remove?t.remove():t.parentNode.removeChild(t)},e.SanitizeService=n}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(){this.scrollDuration=350}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.scrollIntoView=function(t,e,i){var n,o,s,r=this,t=(void 0===i&&(i=!0),t.offsetTop-e.scrollTop),a=Math.abs(t),c=t<0?"up":"down",l=e.scrollTop+t,u=0,p=this.scrollDuration/16;!0===i&&(n=function(t){return t<.5?2*t*t:(4-2*t)*t-1},o=setInterval(function(){var t;s=16*u/r.scrollDuration,s=n(s)*a,p<u&&clearInterval(o),"down"==c&&(t=o,e.scrollTop<l?l<e.scrollTop+s?e.scrollTop=l:e.scrollTop+=s:clearInterval(t)),"up"==c&&(t=o,e.scrollTop>l?e.scrollTop-s<l?e.scrollTop=l:e.scrollTop-=s:clearInterval(t)),u++},16))},e.ScrollService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(9),i(155)],e=function(t,e,s,r){function i(t,e,i){this.$log=t,this.$q=e,this.$http=i}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$log","$q","$http"],i.prototype.getSettings=function(e){var t,i=this;return"USER"===e&&void 0!==this.cachedUserSettings?this.cachedUserSettings:(t=this.$http.get("/api/settings/"+e.toLowerCase()).then(function(t){return t.data}).then(function(t){return t.settings.map(function(t){return new r.Setting(e,t)})}),"USER"===e&&(this.cachedUserSettings=t),t.catch(function(t){return i.$log.error("Error getting settings",{error:t,type:e}),"USER"===e&&(i.cachedUserSettings=void 0),[]}))},i.prototype.getSetting=function(e,i,n){return this.getSettings(e).then(function(t){t=t.filter(function(t){return t.keyName===i}).shift();return void 0===t?new r.Setting(e,{keyName:i,valueData:n,enabled:!1}):t})},i.prototype.updateSetting=function(e,i,n){var o=this;return this.getSettings(e).then(function(t){t=s.__spreadArrays(t.filter(function(t){return t.keyName!==i}),[new r.Setting(e,{keyName:i,valueData:n})]);return o.updateSettings(e,t).then(function(t){return t.filter(function(t){return t.keyName===i}).shift()})})},i.prototype.updateSettings=function(e,t){var i=this,n=t.map(function(t){return t.keyName}),t={settings:t.map(function(t){return{forced:t.forced,keyName:t.keyName,valueData:t.valueData}})};return this.$http.put("/api/settings/"+e.toLowerCase(),t).then(function(t){return t.data}).then(function(t){return t.settings.filter(function(t){return-1<n.indexOf(t.keyName)}).map(function(t){return new r.Setting(e,t)})}).then(function(t){return"USER"===e&&(i.cachedUserSettings=i.$q.resolve(t)),t})},e.SettingsService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Setting=function(t,e){this.type=t,void 0!==e&&(this.keyName=e.keyName,this.valueData=e.valueData,this.enabled="true"===this.valueData,void 0!==e.forced)&&(this.forced=e.forced)}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(i){this.storage={getItem:function(t){return i.getItem("LOCAL",t,!1)},setItem:function(t,e){return i.setItem("LOCAL",t,e,!1)},removeItem:function(t){return i.removeItem("LOCAL",t)}}}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["StorageService"],i.prototype.storeToken=function(t,e){this.storage.setItem(this.getStorageKey(t),e)},i.prototype.hasToken=function(t){return null!==this.storage.getItem(this.getStorageKey(t))},i.prototype.getToken=function(t){t=this.storage.getItem(this.getStorageKey(t));return null===t?void 0:t},i.prototype.removeToken=function(t){this.storage.removeItem(this.getStorageKey(t))},i.prototype.getStorageKey=function(t){return"share.token."+t},e.ShareTokenService=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(8)],e=function(t,e,i){function n(t,e){this.$q=t,this.$http=e}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$q","$http"],n.prototype.getSignature=function(t,e){return this.$http.get("/api/profile/"+t+"/signature",{params:{context:e}}).then(function(t){if(t.status!==i.HTTP_NO_CONTENT)return t.data}).catch(function(t){if(t.status!==i.HTTP_NOT_FOUND)throw t})},n.prototype.setSignature=function(t,e){return this.$http.post("/api/profile/"+t+"/signature",e).then(function(){return!0})},e.SignatureService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9),i(307)],e=function(t,e,i,n){function o(t){this.$http=t,this.requestConfig={authenticationRequired:!1}}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$http"],o.prototype.signup=function(t,e){return this.$http.post("/api/signup",{email:t,captchaToken:e},this.requestConfig).then(function(){return!0})},o.prototype.create=function(t){return this.$http.post("/api/signup/create",t,this.requestConfig).then(function(){return!0})},o.prototype.validate=function(t){t=i.__assign(i.__assign({},this.requestConfig),{params:{token:t}});return this.$http.get("/api/signup/create",t).then(function(t){return t.data})},o.prototype.getInvite=function(t){t=i.__assign(i.__assign({},this.requestConfig),{params:{token:t}});return this.$http.get("/api/signup/invite",t).then(function(t){return t.data}).then(function(t){return new n.InviteInfo(t)})},o.prototype.acceptInvite=function(t,e,i){return this.$http.post("/api/signup/invite",{token:t,password:e,fullName:i},this.requestConfig).then(function(){return!0})},o.prototype.joinOrganization=function(t){return this.$http.post("/api/signup/join",{token:t}).then(function(){return!0})},o.prototype.verifySubscriptionId=function(t){t=i.__assign(i.__assign({},this.requestConfig),{params:{subscriptionId:t}});return this.$http.get("/api/signup/subscription",t).then(function(){return!0})},o.prototype.validateSubscription=function(t,e){return this.$http.put("/api/signup/subscription",{email:e,subscriptionId:t},this.requestConfig).then(function(){return!0})},o.prototype.existingAccountSubscriptionUpgrade=function(t,e){return this.$http.post("/api/signup/subscription/upgrade",{organizationName:t,subscriptionId:e}).then(function(){return!0})},o.prototype.validateCreateSubscription=function(t){t=i.__assign(i.__assign({},this.requestConfig),{params:{token:t}});return this.$http.get("/api/signup/subscription/create",t).then(function(t){return t.data})},o.prototype.createAccountWithSubscription=function(t){return this.$http.post("/api/signup/subscription/create",t,this.requestConfig).then(function(){return!0})},e.SignupService=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(25),i(11)],e=function(t,e,n,r){function i(t,e,i,n,o){var s=this;this.$rootScope=t,this.$log=e,this.$q=i,this.$http=n,this.$translate=o,t.$on(r.AuthEvents.logoutSuccess,function(){s.listSpecialsCache=void 0})}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$rootScope","$log","$q","$http","$translate"],i.prototype.listSpecials=function(t){var e=this;return void 0===t&&(t=!0),void 0!==this.listSpecialsCache&&t||(this.listSpecialsCache=this.$http.get("/api/specials").then(function(t){return t.data}).then(function(t){return t.specials.map(function(t){return new n.Special(t)})}).catch(function(t){return e.$log.warn("error getting user specials",{error:t}),[]})),this.listSpecialsCache},i.prototype.getSpecial=function(t){var e=this;return this.$http.get("/api/specials/"+t).then(function(t){return t.data}).then(function(t){return e.translateSpecial(new n.Special(t))})},i.prototype.getConversationFlow=function(t){var e=this;return this.$http.get("/api/specials/flow",{params:{conversation_uuid:t}}).then(function(t){return t.data}).then(function(t){t=new n.ConversationFlow(t);return t.responses.forEach(function(t){t.formDefinition=e.translateFormDefinition(t.formDefinition)}),t})},i.prototype.getMessageDefinition=function(t){var e=this;return this.$http.get("/api/specials/message_definitions/"+t).then(function(t){return t.data}).then(function(t){t=new n.MessageDefinition(t);return t.formDefinition=e.translateFormDefinition(t.formDefinition),t})},i.prototype.listOrganizationSpecials=function(){return this.$http.get("/api/specials/organization").then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new n.OrganizationSpecial(t)})})},i.prototype.listOrganizationSpecialUsers=function(t){return this.$http.get("/api/specials/organization/"+t+"/users").then(function(t){return t.data}).then(function(t){return t.users.map(function(t){return new n.SpecialUser(t)})})},i.prototype.inviteOrganisationUser=function(t,e){return this.$http.post("/api/specials/organization/"+t+"/users",e).then(function(){return!0})},i.prototype.updateOrganisationUser=function(t,e,i){return this.$http.put("/api/specials/organization/"+t+"/users/"+e,i).then(function(){return!0})},i.prototype.deleteOrgSpecialUser=function(t,e){return this.$http.delete("/api/specials/organization/"+t+"/users/"+e).then(function(){return!0})},i.prototype.getSpecialUserData=function(t,e){return this.$http.get("/api/specials/organization/"+t+"/users/"+e+"/user_information").then(function(t){return t.data})},i.prototype.updateSpecialUserData=function(t,e,i){return this.$http.put("/api/specials/organization/"+t+"/users/"+e+"/user_information",i).then(function(){return!0})},i.prototype.translateSpecial=function(t){var e=this;return t.flowInitiations.forEach(function(t){t.messageDefinition.formDefinition=e.translateFormDefinition(t.messageDefinition.formDefinition)}),t},i.prototype.translateFormDefinition=function(t){var e=this;return t.titleTranslated=this.getTranslated(t.title),t.sections.forEach(function(t){t.titleTranslated=e.getTranslated(t.title),t.components.forEach(function(t){t.labelTranslated=e.getTranslated(t.label),t.textTranslated=e.getTranslated(t.text),t.choices.forEach(function(t){t.labelTranslated=e.getTranslated(t.label)})})}),t},i.prototype.getResumedFormDefinition=function(t,i){return t.sections.forEach(function(t){t.components.forEach(function(t){var e;void 0!==t.key&&void 0===i.data[t.key]||void 0!==t.key&&((e=i.data[t.key])instanceof Array?t.answerArray=e.map(function(t){return new n.FormChoice({value:t})}):t.answer=t.setAnswer(e))})}),t},i.prototype.preOpenSections=function(t,o){var s=0;return t.sections.forEach(function(t,e){var i=t.components.filter(function(t){return!1===t.isStatic()}).filter(function(t){return!0===t.required}).filter(function(t){return!1===t.enablesOtherComponent()}).length,n=0;t.components.forEach(function(t){void 0!==t.key&&void 0!==o.data[t.key]&&!0===t.required&&!1===t.enablesOtherComponent()&&n++}),0!==n&&i===n&&e===s+1&&(t.setOpened(!0),s=e)}),t},i.prototype.getTranslated=function(t){var e=this.$translate.use();if(void 0!==t)return void 0!==t[e]?t[e]:t.nl},e.SpecialsService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(161)],e=function(t,e,i){function n(t){this.title=t.title,this.sections=t.sections.map(function(t){return new i.FormSection(t)}),this.subjectTemplate=t.subjectTemplate}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype.getComponentByKey=function(e){var i=void 0;return this.sections.some(function(t){if(t.hasComponentByKey(e))return i=t.getComponentByKey(e),!0}),i},e.FormDefinition=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(162)],e=function(t,e,i){function n(t,e){this.components=[],this.isOpened=!1,this.isCompleted=!1,this.isDisabled=!1,this.title=t.title,this.components=t.components.map(function(t){return new i.FormComponent(t)})}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype.hasComponentByKey=function(e){var t=this.components.filter(function(t){return t.key===e});return 0!==t.length&&(1===t.length||void 0)},n.prototype.getComponentByKey=function(e){var t=this.components.filter(function(t){return t.key===e});if(0===t.length)throw Error("Component '"+e+" not found");if(1<t.length)throw Error("Multiple components with key '"+e+" found");return t[0]},n.prototype.toSaveEntity=function(){var i={};return this.components.filter(function(t){return!1===t.isStatic()}).forEach(function(t){var e=t.getAnswer();null!==e&&("integer"===t.dataType?i[t.key]=Number(e):i[t.key]=e)}),i},n.prototype.setOpened=function(t){return this.isOpened=t,this},n.prototype.setCompleted=function(t){return this.isCompleted=t,this},n.prototype.setDisabled=function(t){return this.isDisabled=t,this},n.prototype.setFocusedComponent=function(e){var t=this.components.filter(function(t){return t.key===e});t&&t.length&&(t[0].focused=!0,this.focusedComponent=e)},n.prototype.getFirstComponent=function(){return this.components[0].key},e.FormSection=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(163)],e=function(t,e,i){function n(t){this.focused=!1,this.showError=!1,this.visible=!0,this.autocomplete=t.autocomplete,this.choices=(t.choices||[]).map(function(t){return new i.FormChoice(t)}),this.componentType=t.componentType,this.dataType=t.dataType,this.defaultValue=t.defaultValue,this.imgUrl=t.imgUrl,this.key=t.key,this.label=t.label,this.maxItems=t.maxItems,this.minItems=t.minItems,this.text=t.text,this.renderType=t.renderType,this.required=t.required,this.linkedComponents=t.linkedComponents,this.pattern=t.pattern,this.patternReferences=t.patternReferences,this.patternReplacementFileName=t.patternReplacementFileName}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype.getAnswer=function(){return void 0!==this.answer?this.answer.value:void 0!==this.answerArray?this.answerArray.map(function(t){return t.value}):null},n.prototype.setAnswer=function(e){var t=this.choices.filter(function(t){if(t.value===e)return t});return 1===t.length?t[0]:new i.FormChoice({value:e})},n.prototype.enablesOtherComponent=function(){var t=this.choices.filter(function(t){return void 0!==t.enables&&""!==t.enables});return t&&1===t.length},n.prototype.isStatic=function(){return"static"===this.componentType.toString().substr(0,6)},e.FormComponent=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.FormChoice=function(t){this.enables=t.enables,this.label=t.label,this.svg=t.svg,this.value=t.value,this.unselectable=t.unselectable,this.default=t.default,this.subject=t.subject}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(78)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FlowInitiation=function(t){this.allowAnyRecipient=t.allowAnyRecipient,this.allowedRecipients=t.allowedRecipients,this.fixedRecipients=t.fixedRecipients,this.messageDefinition=new i.MessageDefinition(t.messageDefinition)}}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/themes/img/logo.5a6b87.svg"},function(t,e,i){t.exports=i.p+"assets/v2/themes/img/logo.6992cd.svg"},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var c="pseudoStorage.local",l="pseudoStorage.session";function i(t,e,i,n,o){var s,r,a=this,e=(this.$window=t,this.$cookies=e,this.$injector=i,this.$timeout=n,this.ie11SessionStoragePrefix="","IE"===o.getBrowser().name&&(t=""!==this.$window.name?this.$window.name:"ffs_IE11_"+(new Date).getTime().toString(36)+"_",this.ie11SessionStoragePrefix=t,this.$window.name=t),!0);try{this.sessionStorage=this.$window.sessionStorage,this.localStorage=this.$window.localStorage}catch(t){this.warn("Error accessing localstorage or sessionStorage",{error:t}),e=!1}null!==this.localStorage&&null!==this.sessionStorage||(this.warn("LocalStorage and/or sessionStorage is null"),e=!1),!1!==e&&!1!==this.canWrite()||(i=this.$cookies.getObject(c)||{},n=this.$cookies.getObject(l)||{},this.$cookies.remove(c),this.$cookies.remove(l),s=this.localStorage=new u(i),r=this.sessionStorage=new u(n),this.$window.addEventListener("unload",function(){a.$cookies.putObject(c,s.getItems()),a.$cookies.putObject(l,r.getItems())}))}i.$inject=["$window","$cookies","$injector","$timeout","DeviceService"],i.prototype.setItem=function(t,e,i,n){void 0===n&&(n=!0),"SESSION"===t&&""!==this.ie11SessionStoragePrefix&&(e=this.ie11SessionStoragePrefix+e),this.getStorage(t).setItem(e,n?JSON.stringify(i):i)},i.prototype.getItem=function(e,i,t){void 0===t&&(t=!0),"SESSION"===e&&""!==this.ie11SessionStoragePrefix&&(i=this.ie11SessionStoragePrefix+i);var n=this.getStorage(e).getItem(i);if(null===n)return null;if(!1===t)return n;try{return JSON.parse(n)}catch(t){this.warn("Error parsing JSON from storage",{error:t,storage:e,key:i}),this.removeItem(e,i)}},i.prototype.getAndRemoveItem=function(t,e,i){i=this.getItem(t,e,i=void 0===i||i);return this.removeItem(t,e),i},i.prototype.removeItem=function(t,e){"SESSION"===t&&""!==this.ie11SessionStoragePrefix&&(e=this.ie11SessionStoragePrefix+e),this.getStorage(t).removeItem(e)},i.prototype.keys=function(t){return Object.keys(this.getStorage(t))},i.prototype.getStorage=function(t){switch(t){case"LOCAL":return this.localStorage;case"SESSION":return this.sessionStorage}},i.prototype.canWrite=function(){try{var t="test_"+ +new Date;return this.localStorage.setItem(t,t),this.localStorage.removeItem(t),this.sessionStorage.setItem(t,t),this.sessionStorage.removeItem(t),!0}catch(t){return this.warn("Error writing localstorage or sessionstorage",{error:t}),!1}},i.prototype.warn=function(t,e){var i=this;this.$timeout(function(){i.$injector.get("$log").warn(t,e)},1e3)},e.StorageService=i,n.prototype.clear=function(){this.items={}},n.prototype.getItem=function(t){return void 0===this.items[t]?null:this.items[t]},n.prototype.key=function(t){var e=Object.keys(this.items);return void 0===e[t]?null:e[t]},Object.defineProperty(n.prototype,"length",{get:function(){return Object.keys(this.items).length},enumerable:!0,configurable:!0}),n.prototype.removeItem=function(t){delete this.items[t]},n.prototype.setItem=function(t,e){this.items[t]=e},n.prototype.getItems=function(){return this.items};var u=n;function n(t){this.items={},this.items=t}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(321)],e=function(t,e,i){function n(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$http"],n.prototype.getSubscription=function(){return this.$http.get("/api/subscription").then(function(t){return new i.SubscriptionInfo(t.data)})},e.SubscriptionService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(8)],e=function(t,e,i){function n(t){this.$http=t}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$http"],n.prototype.getSurvey=function(t,e){return this.$http.get("/api/survey/"+t+"/"+e).then(function(t){return t.status!==i.HTTP_NO_CONTENT}).catch(function(){return!1})},n.prototype.removeSurvey=function(t,e){return this.$http.delete("/api/survey/"+t+"/"+e).then(function(){return!0})},e.SurveyService=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9),i(42)],e=function(t,e,o,n){function i(){}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.loadTheme=function(t,e){var i=this.createColorPalette(t.primaryColor),n=this.createColorPalette(t.accentColor),n=(t.wallpaperUrl||(t.backgroundColor=n[500]),o.__assign(o.__assign({},t),{accentPalette:n,primaryPalette:i})),i="\n\tbody.theme-custom.landing, body.theme-custom.auth {\n\t\tbackground-color: "+n.backgroundColor+" !important;\n\t}\n\n\tbody.theme-custom.landing, body.theme-custom.auth {\n\t\tbackground-size: cover !important;\n\t\tbackground: url("+n.wallpaperUrl+") no-repeat center center;\n\t}\n\n\tbody.theme-custom #zivver-main aside {\n\t\tbackground-color: "+n.accentPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main right-pane .rightpane-inner md-toolbar {\n\t\tbackground-color: "+n.accentPalette[600]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main md-content.conversations-list div.messageType .icons md-icon.new,\n\tbody.theme-custom #zivver-main md-content.drafts-list div.messageType .icons md-icon.new {\n\t\tcolor: "+n.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main md-content.conversations-list .div-list .div-list-item.active,\n\tbody.theme-custom #zivver-main md-content.drafts-list .div-list .div-list-item.active {\n\t\tbackground-color: "+n.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main conversation-message md-card md-card-header md-card-header-text span.sender a {\n\t\tcolor: "+n.primaryPalette[400]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main conversation-message md-card.selected {\n\t\tborder-color: "+n.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main .draft-text.ql-editor:focus-within {\n\t\tborder-color: "+n.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main .draft-text.ql-editor.ng-dirty {\n\t\tborder-color: "+n.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main .draft-text.rich-editor:focus-within {\n\t\tborder-color: "+n.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main a:link:not(.ces-button), body-theme-custom #zivver-main a:visited {\n\t\tcolor: "+n.primaryPalette[400]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main .recipients img:not(.disabled), body-theme-custom #zivver-main .md-user-avatar {\n\t\tbackground-color: "+n.primaryPalette[400]+" !important;\n\t}\n\n\tbody.theme-custom md-toolbar:not(.md-menu-toolbar) {\n\t\tbackground-color: "+n.primaryPalette[400]+";\n\t}\n\n\n\tbody.theme-custom .md-user-avatar {\n\t\tbackground-color: "+n.primaryPalette[400]+" !important;\n\t}\n\n\tbody.theme-custom .md-raised.md-primary.md-button {\n\t\tbackground-color: "+n.primaryPalette[500]+" !important;\n\t}\n\tbody.theme-custom .md-button.wrong-number-guest {\n\t\tcolor: "+n.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom .md-raised.md-primary.md-button[disabled] {\n\t\tbackground-color: rgba(0,0,0,.12) !important;\n\t}\n\n\tbody.theme-custom md-input-container:not(.md-input-invalid).md-input-focused .md-input {\n\t\tborder-color: "+n.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom md-input-container:not(.md-input-invalid).md-input-focused label {\n\t\tcolor: "+n.primaryPalette[500]+' !important;\n\t}\n\n\tbody.theme-custom header.app h1 a {\n\t\tbackground: transparent url("'+n.logoUrl+"\") center center no-repeat;\n\t\tbackground-size: contain;\n\t\twidth: 144px;\n\t\theight: 60px;\n\t}\n\n\tbody.theme-custom language-select.open-guest md-icon {\n\t\tcolor: 'white';\n\t\tcolor: "+n.languageColor+" !important;\n\t}\n\n\tbody.theme-custom language-select.open-guest md-select .md-select-value {\n\t\tcolor: 'white';\n\t\tcolor: "+n.languageColor+" !important;\n\t}\n\n\tbody.theme-custom avatar .picture:not(.disabled) {\n\t\tbackground-color: "+n.primaryPalette[500]+" !important;\n\t}\n";this.addStyleString(i),e&&window.sessionStorage.setItem("application.theme",JSON.stringify(t))},i.prototype.addStyleString=function(t){var e=document.createElement("style");e.innerHTML=t,document.body.appendChild(e),document.body.classList.add("theme-custom")},i.prototype.multiplyColors=function(t,e){var i=Math.floor(t.b*e.b/255),n=Math.floor(t.g*e.g/255);return{r:Math.floor(t.r*e.r/255),g:n,b:i}},i.prototype.hexToRgb=function(t){return{r:this.hexToR(t),g:this.hexToG(t),b:this.hexToB(t)}},i.prototype.hexToR=function(t){return parseInt(this.cutHex(t).substring(0,2),16)},i.prototype.hexToG=function(t){return parseInt(this.cutHex(t).substring(2,4),16)},i.prototype.hexToB=function(t){return parseInt(this.cutHex(t).substring(4,6),16)},i.prototype.cutHex=function(t){t=""+t;return"#"===t.charAt(0)||"#"===t.charAt(0)?t.substring(1,7):t},i.prototype.rgbToHex=function(t){return"#"+this.toHex(t.r)+this.toHex(t.g)+this.toHex(t.b)},i.prototype.toHex=function(t){t=parseInt(t,10);return isNaN(t)?"00":(t=Math.max(0,Math.min(t,255)),""+"0123456789abcdef".charAt((t-t%16)/16)+"0123456789abcdef".charAt(t%16))},i.prototype.mix=function(t,e,i){i=0===i?0:i||50;t=this.hexToRgb(t),e=this.hexToRgb(e),i/=100;return{r:Math.round((e.r-t.r)*i+t.r),g:Math.round((e.g-t.g)*i+t.g),b:Math.round((e.b-t.b)*i+t.b)}},i.prototype.createColorPalette=function(t){var t=void 0===t?n.COLOR_ROCKET_BLUE:t,e=n.COLOR_WHITE,i=this.multiplyColors(this.hexToRgb(t),this.hexToRgb(t)),i=this.rgbToHex(i);return{50:this.rgbToHex(this.mix(e,t,12)),100:this.rgbToHex(this.mix(e,t,30)),200:this.rgbToHex(this.mix(e,t,50)),300:this.rgbToHex(this.mix(e,t,70)),400:this.rgbToHex(this.mix(e,t,85)),500:this.rgbToHex(this.mix(e,t,100)),600:this.rgbToHex(this.mix(i,t,87)),700:this.rgbToHex(this.mix(i,t,70)),800:this.rgbToHex(this.mix(i,t,54)),900:this.rgbToHex(this.mix(i,t,25))}},e.ThemeService=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9)],e=function(t,e,i){var s,r,a,n;function o(t,e,i,n,o,s,r){this.$rootScope=t,this.$interval=e,this.$timeout=i,this.$http=n,this.$q=o,this.$log=s,this.$location=r,this.circuitBreakerTripped=!1,this.messageQueue=[],this.triggerPollDebounces={}}Object.defineProperty(e,"__esModule",{value:!0}),s={Ping:"Ping"},r={Pong:"Pong",TriggerPoll:"TriggerPoll",CircuitBreakerTripped:"CircuitBreakerTripped"},(a=e.WebSocketEvents||(e.WebSocketEvents={})).CONVERSATION_UPDATED="CONVERSATION_UPDATED",n={CONNECTING:0,0:"CONNECTING",OPEN:1,1:"OPEN",CLOSING:2,2:"CLOSING",CLOSED:3,3:"CLOSED"},o.$inject=["$rootScope","$interval","$timeout","$http","$q","$log","$location"],o.prototype.open=function(){var e=this;return this.hasSocketState([n.OPEN,n.CONNECTING])?this.$q.resolve():this.getWebsocketToken().then(function(t){return e.initSocket(t)}).catch(function(t){return e.$log.warn("Could not open websocket",{error:t})})},o.prototype.send=function(t,e){t=JSON.stringify(i.__assign({type:t},e));this.$log.debug("Sending message over websocket "+t),!1===this.isOpen()?(this.$log.debug("Cannot send data with websocket, because it is not open. Queueing it",{message:t}),this.messageQueue.push(t)):this.circuitBreakerTripped?this.$log.info("Cannot send data with websocket, because circuitbreaker was tripped, discarding message",{message:t}):this.webSocket.send(t)},o.prototype.close=function(){void 0===this.webSocket||this.hasSocketState([n.CLOSED,n.CLOSING])||this.webSocket.close()},o.prototype.isOpen=function(){return this.hasSocketState([n.OPEN])},o.prototype.onOpen=function(){var t=this;this.sendQueuedMessages(),this.$timeout(function(){t.send(s.Ping)},5e4)},o.prototype.onMessage=function(t){var e=this;if(void 0===t.data)this.$log.warn("Got message from websocket, without data",{event:t});else{var i=JSON.parse(t.data);switch(i.type){case r.TriggerPoll:var n=i.conversationUuid;void 0!==this.triggerPollDebounces[n]&&this.$timeout.cancel(this.triggerPollDebounces[n]),this.triggerPollDebounces[n]=this.$timeout(function(){e.$rootScope.$broadcast(a.CONVERSATION_UPDATED,n),e.triggerPollDebounces[n]=void 0},500);break;case r.CircuitBreakerTripped:var o=i.timeout;this.$log.warn("Websocket CircuitBreakerTripped",{waiting:o}),this.circuitBreakerTripped=!0,this.$timeout(function(){e.circuitBreakerTripped=!1},o||1e4);break;case r.Pong:this.$timeout(function(){e.isOpen()&&e.send(s.Ping)},5e4);break;default:this.$log.warn("Unexpected type for message from websocket",t)}}},o.prototype.onClose=function(){this.webSocket=void 0},o.prototype.initSocket=function(t){var e=this;try{return this.webSocket=new WebSocket(this.getUrl(t)),this.webSocket.onopen=function(){return e.onOpen()},this.webSocket.onclose=function(){return e.onClose()},this.webSocket.onmessage=function(t){return e.onMessage(t)},this.$timeout(function(){},250,!1)}catch(t){return this.$q.reject(t)}},o.prototype.getWebsocketToken=function(){return this.$http.post("/api/ws",{}).then(function(t){return t.data.token})},o.prototype.getUrl=function(t){var e=this.$location.host(),i=this.$location.port(),n=this.$location.protocol().replace("http","ws");return(-1===[80,443].indexOf(i)?n+"://"+e+":"+i+"/api/":n+"://"+e+"/api/")+"ws/"+t},o.prototype.hasSocketState=function(t){return void 0!==this.webSocket&&-1<t.indexOf(this.webSocket.readyState)},o.prototype.sendQueuedMessages=function(){var e=this;this.messageQueue.forEach(function(t){return e.webSocket.send(t)}),this.messageQueue=[]},e.WebSocketService=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(155),i(322)],e=function(t,e,i,n){function o(t,e,i,n,o,s){this.$mdDialog=t,this.$q=e,this.$log=i,this.$mdMedia=n,this.DeviceService=o,this.SettingsService=s,this.WIZARDS={VERIFICATION:"wizard-verification",BUSINESSRULES:"wizard-businessrules",MFA:"wizard-mfa"}}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$mdDialog","$q","$log","$mdMedia","DeviceService","SettingsService"],o.prototype.openWizard=function(t,e){var i=this;if(void 0===this.shownDialogPromise){if(!1===this.validWizardName(t))throw Error('Undfined wizard "'+t+'"');this.shownDialogPromise=this.$mdDialog.show(n.WizardDialog.factory(t,e)).finally(function(){i.shownDialogPromise=void 0})}return this.shownDialogPromise},o.prototype.showWizardOnce=function(e){var i=this;this.hasNotSeen(e).then(function(t){i.DeviceService.isDesktop()&&i.$mdMedia("gt-xs")&&i.openWizard(e,{}).finally(function(){return i.wizardIsSeen(t,!0)})})},o.prototype.getWizardSettingsKey=function(t){return"webapp."+t.replace("-",".")},o.prototype.close=function(){void 0!==this.shownDialogPromise&&this.$mdDialog.cancel("wizard cancelled by wizard service")},o.prototype.hasNotSeen=function(t){var e=this,i=this.getWizardSettingsKey(t);return this.SettingsService.getSetting("USER",i,!1).then(function(t){return t.enabled?e.$q.reject():e.$q.resolve(i)})},o.prototype.wizardIsSeen=function(t,e){t=new i.Setting("USER",{keyName:t,valueData:e});return this.SettingsService.updateSettings("USER",[t])},o.prototype.validWizardName=function(t){var e=this;return-1<Object.keys(this.WIZARDS).map(function(t){return e.WIZARDS[t]}).indexOf(t)},o.prototype.createDefaultController=function(){function e(){return t.$q.resolve(void 0)}var t=this,i={steps:1,selectedStep:0,nextEnabled:!0,completeEnabled:!0,swipeEnabled:!0,showCancel:!0,showComplete:!0,showNext:!0,showPrevious:!0,showDots:!0,showClose:!0,translations:{cancel:"MAIN.CANCEL",previous:"MAIN.BACK",next:"MAIN.NEXT",complete:"MAIN.OK"},backDelegate:e,cancelDelegate:e,closeDelegate:e,completeDelegate:e,nextDelegate:e,skipDelegate:e,dotsClickedDelegate:function(t){return!0!==i.disallowDotsClick&&(i.selectedStep=t),i.dotsClicked(),e()},restart:function(){},dotsClicked:function(){},onBack:function(){i.backDelegate()},onCancel:function(){i.cancelDelegate()},onClose:function(){i.closeDelegate()},onComplete:function(){i.completeDelegate()},onNext:function(){i.nextDelegate()},onSkip:function(){i.skipDelegate()}};return i},e.WizardService=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(323)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n="wizard-verification",o=(s.$inject=["$log","$translate","$q"],s.prototype.$onInit=function(){this.flow={"static-tab-1":{index:0,next:"static-tab-2"},"static-tab-2":{index:1,previous:"static-tab-1",next:"static-tab-3"},"static-tab-3":{index:2,previous:"static-tab-2",next:"static-tab-4"},"static-tab-4":{index:3,previous:"static-tab-3",next:"static-tab-5"},"static-tab-5":{index:4,previous:"static-tab-4"}};var t=this.wizardController;this.translateControls(t),this.setupFlow(),t.disallowDotsClick=!1,t.nextEnabled=!0},s.prototype.getTabIndex=function(t){var e,i=-1;for(e in this.flow)e===t&&(i=this.flow[e].index);return i},s.prototype.setTab=function(t,e){return this.wizardController.selectedStep=this.getTabIndex(t),this.currentTabLabel=t,this.setControl(t,e)},s.prototype.setControl=function(t,i){var n=this,o=(this.currentControl={completeEnabled:function(){},cancel:function(){return n.$q.resolve()},back:function(){return n.$q.resolve()},next:function(){return n.$q.resolve()},complete:function(){return n.$q.resolve()},skip:function(){return n.$q.resolve()},fail:function(t){n.$log.error("  wizard-verification fail called. error: ",t)}},this.wizardController);o.cancelDelegate=function(){return n.currentControl.cancel()},o.backDelegate=function(){return n.currentControl.back().then(function(){n.setTab(i[t].previous,i)})},o.nextDelegate=function(){return n.currentControl.next().then(function(){n.setTab(i[t].next,i)})},o.completeDelegate=function(){return n.currentControl.complete()},o.onSkip=function(){return n.currentControl.skip().then(function(){n.setTab(i[t].skip,i)})},o.dotsClickedDelegate=function(t){for(var e in n.flow)if(n.flow[e].index===t){n.setTab(e,i);break}return o.dotsClicked(),n.$q.resolve(void 0)}},s.prototype.defineFlow=function(t){return this.wizardController.steps=Object.keys(t).length,t},s.prototype.setupFlow=function(){var t=this.defineFlow(this.flow);this.setTab("static-tab-1",t)},s.prototype.translateControls=function(t){var e,i={cancel:n+".CANCEL",complete:n+".COMPLETE",previous:n+".PREVIOUS",next:n+".NEXT"};for(e in i)t.translations[e]=this.$translate.instant(i[e])},s);function s(t,e,i){this.$log=t,this.$translate=e,this.$q=i,this.currentTabLabel=""}e.WizardVerification=o,e.WizardVerificationModule=i.module("components.wizardVerification",[]).component("wizardVerification",{bindings:{params:"<",wizardController:"="},controller:o,templateUrl:r(324)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(325)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","$translate","$q"],o.prototype.$onInit=function(){this.flow={"static-tab-1":{index:0,next:"static-tab-2"},"static-tab-2":{index:1,previous:"static-tab-1",next:"static-tab-3"},"static-tab-3":{index:2,previous:"static-tab-2",next:"static-tab-4"},"static-tab-4":{index:3,previous:"static-tab-3"}};var t=this.wizardController;this.translateControls(t),this.setupFlow(),t.disallowDotsClick=!1,t.nextEnabled=!0},o.prototype.getTabIndex=function(t){var e,i=-1;for(e in this.flow)e===t&&(i=this.flow[e].index);return i},o.prototype.setTab=function(t,e){return this.wizardController.selectedStep=this.getTabIndex(t),this.currentTabLabel=t,this.setControl(t,e)},o.prototype.setControl=function(t,i){var n=this,o=(this.currentControl={completeEnabled:function(){},cancel:function(){return n.$q.resolve()},back:function(){return n.$q.resolve()},next:function(){return n.$q.resolve()},complete:function(){return n.$q.resolve()},skip:function(){return n.$q.resolve()},fail:function(t){n.$log.error("  wizard-businessrules fail called. error: ",t)}},this.wizardController);o.cancelDelegate=function(){return n.currentControl.cancel()},o.backDelegate=function(){return n.currentControl.back().then(function(){n.setTab(i[t].previous,i)})},o.nextDelegate=function(){return n.currentControl.next().then(function(){n.setTab(i[t].next,i)})},o.completeDelegate=function(){return n.currentControl.complete()},o.onSkip=function(){return n.currentControl.skip().then(function(){n.setTab(i[t].skip,i)})},o.dotsClickedDelegate=function(t){for(var e in n.flow)if(n.flow[e].index===t){n.setTab(e,i);break}return o.dotsClicked(),n.$q.resolve(void 0)}},o.prototype.defineFlow=function(t){return this.wizardController.steps=Object.keys(t).length,t},o.prototype.setupFlow=function(){var t=this.defineFlow(this.flow);this.setTab("static-tab-1",t)},o.prototype.translateControls=function(t){var e,i={cancel:s+".CANCEL",complete:s+".COMPLETE",previous:s+".PREVIOUS",next:s+".NEXT"};for(e in i)t.translations[e]=this.$translate.instant(i[e])};var n=o;function o(t,e,i){this.$log=t,this.$translate=e,this.$q=i,this.currentTabLabel=""}e.WizardBusinessRules=n;var s="wizard-businessrules";e.WizardBusinessRulesModule=i.module("components.wizardBusinessRules",[]).component("wizardBusinessRules",{bindings:{params:"<",wizardController:"="},controller:n,templateUrl:r(326)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,p){var i=[p,e,p(1),p(327),p(330),p(332),p(335),p(337),p(340)],e=function(t,e,i,n,o,s,r,a){Object.defineProperty(e,"__esModule",{value:!0});var c="wizard-mfa",l=(u.$inject=["$log","$mdDialog","$q","$timeout","$translate","MultifactorService","ProfileService"],u.prototype.$onInit=function(){var e=this,t=this.wizardController;this.translateControls(t),t.showDots=!1,t.showCancel=!1,t.swipeEnabled=!1,t.disallowDotsClick=!1,t.showClose=!!this.params&&this.params.allowClose,t.nextEnabled=!0,this.setupFlow(),this.MultifactorService.getFactors().then(function(t){e.hasTotpFactor=0<t.filter(function(t){return t.isTotp()}).length,e.hasSmsFactor=0<t.filter(function(t){return t.isSms()}).length}),this.ProfileService.get().then(function(t){e.isSmsAllowed=t.features.isSmsAllowed})},u.prototype.onChangeMfaChoice=function(){this.flow[this.currentTabLabel].next=this.mfaChoice,this.wizardController.nextEnabled=!0},u.prototype.getTabIndex=function(t){var e,i=-1;for(e in this.flow)e===t&&(i=this.flow[e].index);return i},u.prototype.setTab=function(t,e){return this.wizardController.selectedStep=this.getTabIndex(t),this.currentTabLabel=t,this.$timeout(function(){var t=document.querySelectorAll("input")[0];null!=t&&t.focus()},500),this.setControl(t,e)},u.prototype.setControl=function(e,i){var n=this,t=this.wizardController;this.currentControl={completeEnabled:function(){},cancel:function(){return n.$q.resolve()},back:function(){return n.$q.resolve()},next:function(){return n.$q.resolve()},complete:function(){return n.$q.resolve()},skip:function(){return n.$q.resolve()},fail:function(t){n.$log.error("  wizard-mfa fail called. error: ",t)}},t.cancelDelegate=function(){return n.currentControl.cancel()},t.backDelegate=function(){return n.currentControl.back().then(function(){e===n.MFA_AUTHENTICATOR_SETUP&&!1===n.isSmsAllowed?n.setTab(n.MFA_INTRO,i):n.setTab(i[e].previous,i),n.updateControls()})},t.nextDelegate=function(){return n.currentControl.next().then(function(t){n.configureNextTab(i,e,t),void 0!==i[e].next&&(e===n.MFA_INTRO&&!1===n.isSmsAllowed?n.setTab(n.MFA_AUTHENTICATOR_SETUP,i):e===n.MFA_AUTHENTICATOR_VALIDATE&&!1===n.isSmsAllowed?n.setTab(n.MFA_COMPLETE,i):n.setTab(i[e].next,i)),n.updateControls()})},t.completeDelegate=function(){return n.currentControl.complete().then(function(){return n.mfToReturn})},t.skipDelegate=function(){return n.currentControl.skip().then(function(){n.setTab(i[e].skip,i),n.updateControls()})}},u.prototype.configureNextTab=function(t,e,i){switch(e){case this.MFA_CHOICE:t[e].next=this.mfaChoice;break;case this.MFA_SMS_SETUP:case this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP:this.mfaSmsFactorId=i.factorId,this.phoneNumber=i.phoneNumber;break;case this.MFA_AUTHENTICATOR_SETUP:!0===this.hasTotpFactor&&(t[e].next=this.MFA_COMPLETE),this.totpSetup=i;break;case this.MFA_SMS_VALIDATE:case this.MFA_AUTHENTICATOR_SMS_BACKUP_VALIDATE:this.mfToReturn=i;break;case this.MFA_AUTHENTICATOR_VALIDATE:this.mfToReturn=i,!0===this.hasSmsFactor&&(t[e].next=this.MFA_COMPLETE)}},u.prototype.updateControls=function(){var t=this.wizardController;t.showPrevious=void 0!==this.flow[this.currentTabLabel].previous,t.showNext=void 0!==this.flow[this.currentTabLabel].next,this.currentTabLabel!==this.MFA_INTRO&&this.currentTabLabel!==this.MFA_CHOICE&&this.currentTabLabel!==this.MFA_COMPLETE||(t.showNext=!0,t.nextEnabled=!0)},u.prototype.setupFlow=function(){return this.wizardController.steps=Object.keys(this.flow).length,this.setTab(this.MFA_INTRO,this.flow)},u.prototype.translateControls=function(t){var e,i={cancel:c+".CANCEL",close:c+".CLOSE",complete:c+".COMPLETE",next:c+".NEXT",previous:c+".PREVIOUS",skip:c+".SKIP"};for(e in i)t.translations[e]=this.$translate.instant(i[e])},u);function u(t,e,i,n,o,s,r){this.$log=t,this.$mdDialog=e,this.$q=i,this.$timeout=n,this.$translate=o,this.MultifactorService=s,this.ProfileService=r,this.MFA_INTRO="mfa-intro",this.MFA_CHOICE="mfa-choice",this.MFA_SMS_SETUP="mfa-sms-setup",this.MFA_SMS_VALIDATE="mfa-sms-validate",this.MFA_AUTHENTICATOR_SETUP="mfa-authenticator-setup",this.MFA_AUTHENTICATOR_VALIDATE="mfa-authenticator-validate",this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP="mfa-authenticator-sms-setup",this.MFA_AUTHENTICATOR_SMS_BACKUP_VALIDATE="mfa-authenticator-sms-validate",this.MFA_COMPLETE="mfa-complete",this.currentTabLabel="",this.mfaChoice=this.MFA_AUTHENTICATOR_SETUP,this.flow={},this.flow[this.MFA_INTRO]={index:0,next:this.MFA_CHOICE},this.flow[this.MFA_CHOICE]={index:1,previous:this.MFA_INTRO},this.flow[this.MFA_SMS_SETUP]={index:2,previous:this.MFA_CHOICE,next:this.MFA_SMS_VALIDATE},this.flow[this.MFA_SMS_VALIDATE]={index:3,previous:this.MFA_SMS_SETUP,next:this.MFA_COMPLETE},this.flow[this.MFA_AUTHENTICATOR_SETUP]={index:4,previous:this.MFA_CHOICE,next:this.MFA_AUTHENTICATOR_VALIDATE},this.flow[this.MFA_AUTHENTICATOR_VALIDATE]={index:5,previous:this.MFA_AUTHENTICATOR_SETUP,next:this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP},this.flow[this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP]={index:6,next:this.MFA_AUTHENTICATOR_SMS_BACKUP_VALIDATE,skip:this.MFA_COMPLETE},this.flow[this.MFA_AUTHENTICATOR_SMS_BACKUP_VALIDATE]={index:7,previous:this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP,next:this.MFA_COMPLETE},this.flow[this.MFA_COMPLETE]={index:8}}e.WizardMfa=l,e.WizardMfaModule=i.module("components.wizardMfa",[n.MfaTotpSetupModule.name,o.MfaTotpValidateModule.name,s.MfaSmsSetupModule.name,r.MfaSmsValidateModule.name,a.MfaBackupCodesModule.name]).component("wizardMfa",{bindings:{params:"<",wizardController:"="},controller:l,templateUrl:p(341)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9),i(378),i(42)],e=function(t,e,n,o,i){Object.defineProperty(e,"__esModule",{value:!0});var s=[i.COLOR_ROCKET_BLUE,i.COLOR_MIDNIGHT_BLUE,i.COLOR_SKY_BLUE];e.ShowConfetti=function(){var t={particleCount:3,angle:60,spread:60,startVelocity:60,colors:s};requestAnimationFrame(function(){return function t(e,i){o.default(n.__assign(n.__assign({},e),{origin:{x:0,y:.6},angle:60})),o.default(n.__assign(n.__assign({},e),{origin:{x:1,y:.6},angle:120})),i<200&&requestAnimationFrame(function(){return t(e,i+1)})}(t,0)})}}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,a){var i=[a,e,a(1),a(33),a(398)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0});var o={archive:a(399),contacts:a(400),conversations:a(401),drafts:a(402),mfaRequired:a(403),trash:a(404)},s=(r.$inject=["$http","$mdMedia","$state","$uiRouterGlobals","AppSwitcherService","AuthSessionService","StorageService"],r.prototype.$onInit=function(){var t;this.isSpecial=void 0!==this.AppSwitcherService.getContext().specialId,this.isSpecial||(this.requiresMfaSetup=!1===(null==(t=this.profileProgress)?void 0:t.hasSecondAuthenticationFactor)&&!1===this.AuthSessionService.isDelegate(),this.setTexts(),this.setImage())},r.prototype.setTexts=function(){var t;!0===(!0===this.requiresMfaSetup&&this.isAllowedItem())?(this.text=".MFA",this.buttonText=".BUTTON.MFA"):(t="."+this.item.toUpperCase(),!1===this.$mdMedia("gt-sm")&&(t+="-SMALL"),this.text=t,this.link=this.$state.href("drafts.create"))},r.prototype.setImage=function(){!0===(!0===this.requiresMfaSetup&&this.isAllowedItem())?this.image=o.mfaRequired:this.image=o[this.item]},r.prototype.buttonAction=function(){!0===(!0===this.requiresMfaSetup&&this.isAllowedItem())?(this.StorageService.setItem("SESSION","security.redirect",{name:this.$state.current.name,params:this.$uiRouterGlobals.params}),this.$state.go("settings.security",{highlight:"2fa"})):this.$state.go("drafts.create")},r.prototype.isAllowedItem=function(){return-1===this.item.indexOf("contacts")&&"trash"!==this.item},r);function r(t,e,i,n,o,s,r){this.$http=t,this.$mdMedia=e,this.$state=i,this.$uiRouterGlobals=n,this.AppSwitcherService=o,this.AuthSessionService=s,this.StorageService=r}e.PlaceholderModule=i.module("components.Placeholder",[n.AppSwitcherModule.name]).component("placeholder",{bindings:{item:"<",profileProgress:"<?"},controller:s,templateUrl:a(405)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,u){var i=[u,e,u(1),u(13),u(179),u(180),u(230),u(27),u(433)],e=function(t,e,i,n,o,s,r,a){Object.defineProperty(e,"__esModule",{value:!0}),l.$inject=["$element","$log","$mdDialog","$mdMedia","$q","$rootScope","$scope","$state","$timeout","AuthSessionService","ConversationsService","LabelService","MessengerService","PrintService"],l.prototype.$onInit=function(){var i=this;this.actions=[],void 0!==this.conversation&&void 0!==this.share&&(this.hasAccess=this.share.isAccessGranted(),this.participantsInfo=this.getParticipantsInfo(this.conversation.participants),this.allParticipants=this.conversation.participants.map(function(t){return t.fullNameAndEmail().replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}).join(", "),this.profile.isGuest()?this.addGuestActions():this.addNonGuestActions(),this.$scope.$watch(function(){return i.conversation.participants.length},function(t,e){e!==t&&(i.participantsInfo=i.getParticipantsInfo(i.conversation.participants))}))},l.prototype.$onChanges=function(t){void 0===t.conversation&&void 0===t.share||this.$onInit()},l.prototype.openInfoPane=function(){this.hasAccess&&(this.showInfoPane=!0)},l.prototype.sidePaneClosed=function(){this.showInfoPane=!1},l.prototype.trash=function(){this.moveConversation(n.SystemLabel.TRASH)},l.prototype.archive=function(){this.moveConversation(n.SystemLabel.ARCHIVE)},l.prototype.moveToInbox=function(){this.moveConversation(n.SystemLabel.INBOX)},l.prototype.deleteForever=function(){var e=this,t=a.WarningDialog.factory({title:"conversation-header.DELETE.TITLE",explanation:"conversation-header.DELETE.EXPLANATION",submitText:"conversation-header.DELETE.CONFIRM",type:a.WarningDialogTypes.error});this.$mdDialog.show(t).then(function(){e.ConversationsService.removeConversation(e.conversation.share).then(function(){e.MessengerService.toast("conversation-header.MOVE.SUCCESS-DELETE"),e.$rootScope.$broadcast("conversation-moved",e.conversation.id)}).catch(function(t){e.$log.warn("Error deleting conversation forever",{error:t,share:e.conversation.share})})})},l.prototype.openActionsMenu=function(t,e){this.$scope.$broadcast("conversation-menu:open"),t.open(e)},l.prototype.editLabels=function(t){var e=this,i=o.LabelsDialog.factory("SELECT",this.conversation.labelIdList);i.targetEvent=t,this.$mdDialog.show(i).then(function(t){e.ConversationsService.setConversationLabels(e.conversation,t).then(function(){e.LabelService.getLabelsAndBroadcast()})})},l.prototype.printConversation=function(){this.PrintService.printConversation(this.conversation,this.$element[0].parentElement)},l.prototype.replyToAll=function(){this.$rootScope.$broadcast("reply-all")},l.prototype.addNonGuestActions=function(){var t="inbox"===this.conversation.systemLabel.name,e="archive"===this.conversation.systemLabel.name,i="trash"===this.conversation.systemLabel.name;this.actions.push({icon:2<this.conversation.participants.length?"reply_all":"reply",onClick:"replyToAll",label:2<this.conversation.participants.length?".REPLY-TO-ALL":".REPLY"}),(t||e)&&this.actions.push({icon:"forward",onClick:"forwardConversation",label:".FORWARD"}),this.hasAccess&&this.actions.push({icon:"print",onClick:"printConversation",label:".PRINT"}),t?this.actions.push({icon:"archive",onClick:"archive",label:".MOVE.ARCHIVE"}):e&&this.actions.push({icon:"move_to_inbox",onClick:"moveToInbox",label:".MOVE.INBOX"}),(t||e)&&(this.hasAccess&&this.actions.push({icon:"local_offer",onClick:"editLabels",label:".EDIT-LABELS"}),this.actions.push({icon:"delete",onClick:"trash",label:".MOVE.TRASH"})),i&&(this.actions.push({icon:"move_to_inbox",onClick:"moveToInbox",label:".MOVE.INBOX"}),this.actions.push({icon:"delete_forever",onClick:"deleteForever",label:".MOVE.DELETE"})),this.hasAccess&&this.actions.push({icon:"info",onClick:"openInfoPane",label:".CONVERSATION-INFO"})},l.prototype.addGuestActions=function(){this.actions.push({icon:2<this.conversation.participants.length?"reply_all":"reply",onClick:"replyToAll",label:2<this.conversation.participants.length?".REPLY-TO-ALL":".REPLY"}),this.actions.push({icon:"print",onClick:"printConversation",label:".PRINT"}),this.actions.push({icon:"info",onClick:"openInfoPane",label:".CONVERSATION-INFO"})},l.prototype.getParticipantsInfo=function(t){return(1===t.length?t[0].fullNameAndEmail():t.map(function(t){return t.fullNameOrEmail()}).join(", ")).replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},l.prototype.moveConversation=function(e){var i=this;this.ConversationsService.moveConversation(this.conversation,e).then(function(){i.MessengerService.toast("conversation-header.MOVE.SUCCESS-"+e),i.$rootScope.$broadcast("conversation-moved",i.conversation.id)}).catch(function(t){i.MessengerService.toast("conversation-header.MOVE.ERROR"),i.$log.warn("Error moving conversation",{error:t,target:e})})},l.prototype.forwardConversation=function(){var t=this.messages.filter(function(t){return!1===t.revoked&&!1===t.deleted}).map(function(t){return t.id}),e={draftType:"forward",quote:{conversationId:this.conversation.id,messageIds:t},share:this.share,subject:"FW: "+this.conversation.subject};0===t.length?this.MessengerService.alert("DRAFTS.EDIT.FORWARD.ALL-REVOKED.ERROR"):this.$state.go("drafts.create",e)};var c=l;function l(t,e,i,n,o,s,r,a,c,l,u,p,d,h){this.$element=t,this.$log=e,this.$mdDialog=i,this.$mdMedia=n,this.$q=o,this.$rootScope=s,this.$scope=r,this.$state=a,this.$timeout=c,this.AuthSessionService=l,this.ConversationsService=u,this.LabelService=p,this.MessengerService=d,this.PrintService=h,this.participantsInfo="",this.showInfoPane=!1,this.hasAccess=!1}e.ConversationHeaderModule=i.module("components.conversationHeader",[o.LabelsDialogModule.name,s.ConversationInfoModule.name,r.ReplaceFilterModule.name,a.WarningDialogModule.name]).component("conversationHeader",{bindings:{conversation:"<",messages:"<",profile:"<",share:"<"},controller:c,template:u(434)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(13),r(8),r(410)],e=function(t,e,i,n,o){function s(t,e,i,n,o,s,r,a){var c=this;this.$scope=t,this.$log=e,this.$timeout=i,this.$mdDialog=n,this.LabelService=o,this.openIn=s,this.labels=[],this.mode="LOADING",this.searchFor="",this.selection={},this.afterEdit="SELECT",this.labelColors=this.LabelService.getColors(),"SELECT"===this.openIn?this.loadLabels().then(function(){c.labels.forEach(function(t){c.selection[t.id]=-1<r.indexOf(t.id)}),0===c.labels.length?c.newLabel():c.mode="SELECT"}):(this.afterEdit="CLOSE",void 0===a?this.newLabel():this.editLabel(a))}Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$scope","$log","$timeout","$mdDialog","LabelService","openIn","conversationLabels","label"],s.prototype.getLabels=function(){var e=this.searchFor.toLowerCase();return this.labels.filter(function(t){return-1<t.name.toLowerCase().indexOf(e)})},s.prototype.editLabel=function(t){this.label=new n.Label(t),this.mode="EDIT",this.watchLabel()},s.prototype.removeLabel=function(){var e=this;this.labels=this.labels.filter(function(t){return t.id!==e.label.id}),this.selection[this.label.id]=void 0,this.LabelService.removeLabel(this.label.id),this.mode="SELECT"},s.prototype.newLabel=function(){var t=this;this.label=new n.Label,this.label.name=this.searchFor,this.label.labelColor=this.labelColors[Math.floor(Math.random()*this.labelColors.length)],this.mode="EDIT",0<this.searchFor.length&&this.$timeout(function(){t.labelForm.$setDirty()}),this.watchLabel()},s.prototype.setLabelColor=function(t){this.label.labelColor=t,this.labelForm.$setDirty()},s.prototype.submit=function(){var e=this;"SELECT"===this.mode?this.$mdDialog.hide(this.labels.filter(function(t){return e.selection[t.id]})):void 0===this.label.id&&this.isLabelDuplicate(this.label.name)?this.labelForm.labelName.$setValidity("duplicate",!1):!1===this.isValidName(this.label.name)?this.labelForm.labelName.$setValidity("validName",!1):this.labelForm.$valid&&this.labelForm.$dirty&&(void 0===this.label.id?this.LabelService.createLabel(this.label.name,this.label.labelColor).then(function(t){e.selection[t.id]=!0}):this.LabelService.updateLabel(this.label.id,this.label.name,this.label.labelColor)).then(function(){if(e.unwatchLabel(),"CLOSE"!==e.afterEdit)return e.loadLabels().then(function(){e.mode="SELECT"});e.$mdDialog.hide()},function(t){t.status===o.HTTP_CONFLICT?e.labelForm.labelName.$setValidity("duplicate",!1):t.status===o.HTTP_BAD_REQUEST?e.labelForm.labelName.$setValidity("validName",!1):e.$log.warn("Error saving label",{error:t})})},s.prototype.cancel=function(){"EDIT"!==this.mode||"EDIT"===this.openIn?this.$mdDialog.cancel():(this.unwatchLabel(),this.label=void 0,this.searchFor="",this.mode="SELECT")},s.prototype.close=function(){this.$mdDialog.cancel()},s.prototype.loadLabels=function(){var e=this;return this.LabelService.getLabels().then(function(t){e.labels=t.userLabels})},s.prototype.watchLabel=function(){var i=this;this.unwatchLabel=this.$scope.$watch(function(){return i.label.name},function(t,e){void 0!==i.labelForm&&t!==e&&(i.labelForm.labelName.$setValidity("duplicate",!0),i.labelForm.labelName.$setValidity("validName",!0))})},s.prototype.isLabelDuplicate=function(t){return-1<this.labels.map(function(t){return t.name}).indexOf(t)},s.factory=function(t,e,i){return{controller:s,locals:{conversationLabels:e,label:i,openIn:t},templateUrl:r(411)}},s.prototype.isValidName=function(t){return!(-1<t.indexOf(",")||"-"===t.charAt(0)||30<t.length)},e.LabelsDialog=s,e.LabelsDialogModule=i.module("common.labelsDialog",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,c){var i=[c,e,c(1),c(15),c(55),c(183),c(431)],e=function(t,e,i,n,o,s){Object.defineProperty(e,"__esModule",{value:!0}),a.$inject=["$scope","$element","$q","$timeout","$log","ConversationsService","DraftsValidationService","$mdToast","$translate"],a.prototype.$onInit=function(){var n=this;this.canAdd=!1===this.profile.isGuest(),void 0!==this.conversation.flow&&(this.canAdd=this.conversation.flow.allowAddAnyRecipient||0<this.conversation.flow.allowedAddRecipients.length),!1!==this.canAdd&&(this.accessRightGrant=this.$q(function(e,i){n.ConversationsService.getShare(n.conversation.share).then(function(t){e(t.accessRightGrant)}).catch(function(t){n.$log.error("[conversation-info] Error getting accessRightGrant",{error:t}),i(t)})}))},a.prototype.add=function(){var i=this;this.draft=new n.Draft,this.adding=!0,this.validDraft=!1,this.unWatchDraftRecipients=this.$scope.$watch(function(){return i.draft.recipients},function(t,e){t!==e&&i.validateRecipients()},!0),this.unWatchDraftValidating=this.$scope.$watch(function(){return i.draft.isValidating},function(){i.setIconStatus()}),this.unWatchDraftValidation=this.$scope.$watch(function(){return i.draft.validation},function(){i.violationsUnresolved=i.draft.validation.violationsUnresolved,i.setIconStatus(),i.setViolationDescription()},!0)},a.prototype.cancel=function(){this.unWatchDraftRecipients(),this.unWatchDraftValidating(),this.unWatchDraftValidation(),this.adding=!1,this.draft=void 0},a.prototype.saveRecipients=function(){var t,i=this;!1!==this.validDraft&&0!==this.getRecipientsWithValidEmail().length&&(this.submitting=!0,(t=this.accessRightGrant.then(function(t){return i.ConversationsService.addNewParticipants(i.conversation.id,i.getRecipientsWithValidEmail(),t.token)})).then(function(){return i.ConversationsService.get(i.conversation.id)}).then(function(t){i.conversation.participants=t.participants,i.$scope.$emit(o.Events.Updated,i.conversation.participants);var e=i.$mdToast.simple().parent(i.$element).position("top left").textContent(i.$translate.instant("conversation-info.TOAST.ADD-OK"));i.$mdToast.show(e),void 0!==t.flow&&(i.canAdd=t.flow.allowAddAnyRecipient||0<t.flow.allowedAddRecipients.length)}),t.catch(function(t){i.$log.error("Could not add participants to conversation",{error:t})}),t.finally(function(){i.adding=!1,i.submitting=!1}))},a.prototype.validateRecipients=function(){var t,e=this;void 0!==this.validationTimeout&&(this.$timeout.cancel(this.validationTimeout),this.validationTimeout=void 0),this.validating&&this.draft.isModified?this.validationTimeout=this.$timeout(function(){e.validateRecipients()},1e3):(0===this.draft.recipients.length&&(this.draft.validation.violationsUnresolved=[]),0===this.getRecipientsWithValidEmail().length?this.validDraft=!1:(this.validating=!0,(t=this.accessRightGrant.then(function(t){return e.ConversationsService.validateNewParticipants(e.conversation.id,e.getRecipientsWithValidEmail(),t.token)})).then(function(t){t=new n.ValidationStatus(t);t.validationCompleted=!0,t=t.addClientViolations(e.draft.validation.clientViolations),e.draft.validation=t,e.validDraft=e.draft.validation.validDraft&&0===e.draft.recipients.filter(function(t){return!1===t.emailIsValid}).length&&0<e.getRecipientsWithValidEmail().length,e.$timeout(function(){e.draft.isModified=!1,e.validating=!1},500)}),t.catch(function(t){e.$log.warn("Error validating adding recipients to conversation",{error:t})})))},a.prototype.getRecipientsWithValidEmail=function(){return this.draft.recipients.filter(function(t){return t.emailIsValid})},a.prototype.setIconStatus=function(){var t,e,i;void 0!==this.violationsUnresolved&&(t=(i=this.DraftsValidationService.getIconStatus(this.draft.validation,this.draft.isValidating)).iconStatus,e=i.icon,i=i.info,this.iconStatus=t,this.icon=e,this.info=i)},a.prototype.setViolationDescription=function(){this.violationDescription=this.pickViolationDescription()},a.prototype.pickViolationDescription=function(){if(void 0!==this.violationsUnresolved)return 0<this.draft.validation.getErrors().length?this.draft.validation.getErrors()[0].description:0<this.draft.validation.getWarnings().length?this.draft.validation.getWarnings()[0].description:0<this.draft.validation.getSuggestions().length?this.draft.validation.getSuggestions()[0].description:void 0};var r=a;function a(t,e,i,n,o,s,r,a,c){this.$scope=t,this.$element=e,this.$q=i,this.$timeout=n,this.$log=o,this.ConversationsService=s,this.DraftsValidationService=r,this.$mdToast=a,this.$translate=c,this.adding=!1,this.canAdd=!0,this.icon="lock",this.iconStatus="unknown",this.infoType="CONVERSATION",this.submitting=!1,this.validDraft=!1,this.validating=!1}e.ConversationInfo=r,e.ConversationInfoModule=i.module("components.ConversationInfo",[s.DraftRecipientsModule.name,o.ParticipantsListModule.name]).component("conversationInfo",{bindings:{conversation:"<",profile:"<"},controller:r,templateUrl:c(432)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(24)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.prototype.$onInit=function(){var e=this;1<this.participants.length&&(this.participants=this.participants.filter(function(t){return t.email!==e.profile.email}))},s.prototype.$onChanges=function(t){void 0!==t.participants&&void 0!==t.participants.currentValue&&(this.participants=t.participants.currentValue)};var o=s;function s(){}e.ParticipantAvatarsModule=i.module("components.ParticipantAvatars",[n.AvatarModule.name]).component("participantAvatars",{bindings:{participants:"<",profile:"<"},controller:o,template:r(414)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(82),r(417)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.prototype.$onChanges=function(t){void 0!==t.showFiles&&!0===t.showFiles.currentValue&&(this.showFiles=0<this.files.length),void 0!==t.showRecipients&&!0===t.showRecipients.currentValue&&(this.showRecipients=0<this.violation.recipients.length),this.getViolationStatus()},s.prototype.getFileNames=function(){var e=[],i={};return this.files.forEach(function(t){return i[t.id]=t}),this.violation.files.forEach(function(t){e.push(void 0===i[t]?"Unknown file "+t:i[t].name)}),e},s.prototype.getViolationStatus=function(){var t=this.violation.violationLevel;!0===this.violation.showStopper||"error"===t||"warning"===t?(this.icon="error",this.violationStatus="error"):(this.icon="lock",this.violationStatus="suggestion")};var o=s;function s(){this.files=[],this.showFiles=!1,this.showRecipients=!1}e.DraftViolationItemModule=i.module("components.DraftViolationItem",[n.IfEmptyFilterModule.name]).component("draftViolationItem",{controller:o,bindings:{violation:"<",files:"<",showRecipients:"<",showFiles:"<"},templateUrl:r(418),transclude:!0})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,d){var i=[d,e,d(9),d(1),d(15),d(38),d(426),d(8),d(76),d(24),d(429)],e=function(t,e,s,i,r,n,o,a,c,l){Object.defineProperty(e,"__esModule",{value:!0});var u=new RegExp(n.EMAIL_REGEX,"i"),n=(p.$inject=["$scope","$timeout","$q","$http","$log","$translate","ContactsService","DraftsRecipientsService"],p.prototype.$onInit=function(){var i=this;this.showBcc=0<this.recipients.filter(function(t){return"bcc"===t.recipientType}).length,this.updateTypeRecipients(),this.$scope.$watch(function(){return i.recipients},function(t,e){!1!==i.recipientsChanged(t,e)&&(i.validation=i.validation.removeViolationByBusinessRuleId(r.ClientViolationTypes.RecipientsInvalid),i.recipients=i.checkEmailAddresses(t),i.updateTypeRecipients(),0<(e=i.recipients.filter(function(t){return!1===t.emailIsValid})).length)&&i.addInvalidRecipientViolation(e)},!0),this.typeRecipients.forEach(function(t){void 0!==t.accessRightSetup&&0!==t.verifications.length||i.getContact(t.email).then(function(t){return i.updateRecipient(t)})}),this.useFlowRecipients()&&this.flow.allowedAddRecipients.forEach(function(t){i.getContact(t).then(function(t){return i.allowedFlowRecipients.push(t.toRecipient())})})},p.prototype.onPaste=function(t){var e,o=this,i=(t.clipboardData||window.clipboardData).getData("Text");""===i?this.$log.warn("DraftRecipients onPaste had no (plain text) contents? ",{event:t}):(t.preventDefault(),t.stopPropagation(),i=(t=this.DraftsRecipientsService.extractRecipientsUsingRegex(i).reduce(function(t,e){var i=s.__spreadArrays(o.typeRecipients,t[0]).map(function(t){return t.email}),n=e.emailIsValid?0:1;return t[-1<i.indexOf(e.email)?2:n].push(e),t},[[],[],[]]))[0],e=t[1],0<(t=t[2]).length&&this.$log.info("Ignoring "+t.length+" duplicate email addresses after paste"),i.forEach(function(t){o.addRecipient(t),o.$timeout(function(){o.getContact(t.email).then(function(t){return o.updateRecipient(t)})},60,!0)}),this.addInvalidRecipients(e))},p.prototype.onAdd=function(t){var e=this;this.getContact(t.email).then(function(t){return e.updateRecipient(t)})},p.prototype.searchContacts=function(){var n=this,o=this.searchFor.toLowerCase();return this.$q(function(i){return""===o&&i([]),n.useFlowRecipients()?i(n.allowedFlowRecipients.filter(function(t){return!1===n.hasRecipient(t.email)})):n.contactsAutoComplete(o).then(function(t){var e;-1===t.map(function(t){return t.email}).indexOf(o)&&!1===n.hasRecipient(o)?((e=new r.Recipient).email=o,i(s.__spreadArrays(t,[e]))):i(t)})})},p.prototype.recipientsChanged=function(t,i){var n;return t!==i&&(t.length!==i.length||(n=!1,t.forEach(function(t,e){n||(e=JSON.stringify(i[e].toRequestEntity()),JSON.stringify(t.toRequestEntity())!==e&&(n=!0))}),n))},p.prototype.addInvalidRecipients=function(i){var n=this;i.forEach(function(t,e){n.contactsAutoComplete(t.email).then(function(t){1===t.length&&(i[e]=t[0])}),i[e].accessRightSetup=void 0,i[e].verifications=[],n.typeRecipients.push(i[e])})},p.prototype.addInvalidRecipientViolation=function(t){this.validation=this.validation.addClientViolation(new r.Violation({businessRuleId:r.ClientViolationTypes.RecipientsInvalid,violationCategory:"humanerror",violationType:"bcc"===this.recipientType?"bccRecipients":"toRecipients",violationLevel:"error",description:this.$translate.instant("DRAFTS.EDIT.VALIDATION.INVALID-RECIPIENTS"),recipients:t.map(function(t){return t.email}),showStopper:!0,id:0}))},p.prototype.contactsAutoComplete=function(t){var e=this,t={term:t,limit:15},i=this.typeRecipients.map(function(t){return t.email});return this.$http.get("/api/contacts/autocomplete",{params:t}).then(function(t){return t.data}).then(function(t){return t.items.filter(function(t){return-1===i.indexOf(t.email)})}).then(function(t){return t.map(function(t){var e=new r.Recipient;return e.email=t.email,e.fullName=void 0!==t.fullName&&""!==t.fullName?t.fullName:void 0,e.picture=t.picture,e})}).catch(function(t){return e.$log.warn("Error searching contacts",{error:t}),e.$q.resolve([])})},p.prototype.checkEmailAddresses=function(t){return t.map(function(t){return t.emailIsValid=!(void 0===t.email||!1===u.test(t.email)),t})},p.prototype.addRecipient=function(t){this.typeRecipients=s.__spreadArrays(this.typeRecipients,[t])},p.prototype.updateRecipient=function(t){var e,i=this.typeRecipients.map(function(t){return t.email}).indexOf(t.email);-1!==i&&((e=new r.Recipient(this.typeRecipients[i])).verifications=t.verifications,void 0===e.fullName&&void 0!==t.fullName&&(e.fullName=t.fullName),void 0===e.accessRightSetup&&(e.accessRightSetup=t.toRecipient().accessRightSetup),void 0===e.phonenumber&&(e.phonenumber=t.phonenumber),void 0===e.language&&(e.language=t.personal.language),this.typeRecipients[i]=e,this.updateDraftRecipients())},p.prototype.getContact=function(e){var i=this;return this.ContactsService.get(e).catch(function(t){t.status!==a.HTTP_NOT_FOUND&&i.$log.warn("Unexpected error trying to get a contact",{error:t,email:e});t=new c.Contact;return t.email=e,t})},p.prototype.hasRecipient=function(e){return 0<this.typeRecipients.filter(function(t){return t.email===e}).length},p.prototype.useFlowRecipients=function(){return void 0!==this.flow&&!1===this.flow.allowAddAnyRecipient&&0<this.flow.allowedAddRecipients.length},p.prototype.updateTypeRecipients=function(){this.typeRecipients="bcc"===this.recipientType?this.recipients.filter(function(t){return"bcc"===t.recipientType}):this.recipients.filter(function(t){return"bcc"!==t.recipientType})},p.prototype.onShowBcc=function(){this.showBcc=!0,this.autofocus=!1,this.$scope.$emit("show-bcc",!0)},p.prototype.updateDraftRecipients=function(){var e=this;this.recipients=this.recipients.filter(function(t){return t.recipientType!==e.recipientType}).concat(this.typeRecipients.map(function(t){return t.recipientType=e.recipientType,t}))},p);function p(t,e,i,n,o,s,r,a){this.$scope=t,this.$timeout=e,this.$q=i,this.$http=n,this.$log=o,this.$translate=s,this.ContactsService=r,this.DraftsRecipientsService=a,this.autocomplete=!0,this.recipients=[],this.hideLabel=!1,this.hideButton=!1,this.hideAutocomplete=!1,this.showBcc=!1,this.searchFor="",this.typeRecipients=[],this.allowedFlowRecipients=[]}e.DraftRecipientsModule=i.module("components.DraftRecipients",[l.AvatarModule.name,o.RecipientChipModule.name]).component("draftRecipients",{controller:n,template:d(430),bindings:{autofocus:"<",autocomplete:"<?",flow:"<",recipients:"=",recipientType:"<?",hideLabel:"<?",hideButton:"<?",hideAutocomplete:"<?",validation:"="}}).directive("mdBlur",["$timeout","$mdUtil",function(o,s){return{require:"^mdAutocomplete",restrict:"A",link:function(e,t,i,n){o(function(){var t=n.blur;n.blur=function(){e.$eval(i.mdBlur,{$mdAutocomplete:n}),s.nextTick(function(){t.call(n)})}})}}}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,a){var i=[a,e,a(1),a(8),a(435)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0});var o="code.sent",s=(r.$inject=["$log","$rootScope","$timeout","$translate","$scope","$state","$window","AccessRightGrantService","ConversationsService","StorageService","MessengerService"],r.prototype.$onInit=function(){var t,i=this;this.zivverUrl="https://zivver.eu",void 0===this.conversation?(this.error=!0,this.$state.go("conversations.error",{error:"UNKNOWN"},{location:!1})):(this.participants=this.conversation.participants.map(function(t){return t.fullNameOrEmail()}).join("; "),this.share.isGeneratedCodeAccessRight()?(this.urlType="access-code",this.challengeSent=!0,this.setFocus()):this.share.isPasswordAccessRight()?(this.urlType="access-code",this.inputType="password",this.challengeSent=!0,this.setFocus()):this.share.isSmsAccessRight()?(this.urlType="sms-code",this.inputPattern="[0-9]*"):this.share.isEmailAccessRight()?(t=this.StorageService.getItem("LOCAL",o+"."+this.conversation.id),this.urlType="verification-email",this.inputPattern="[0-9]*",this.preventDoubleClick=!1,t&&(this.emailStep="submitCode",this.setFocus())):this.share.isZivverAccessRight()&&this.$state.go("conversations.error",{error:"ZIVVER-ACCESSRIGHT",conversation:this.conversation,label:this.label},{location:!1}),this.$rootScope.$on("$translateChangeSuccess",function(){i.generateSupportUrl()}),this.$scope.$applyAsync(function(){i.generateSupportUrl()}),this.$scope.$watch(function(){return i.formValues.response},function(t,e){void 0!==e&&i.resetCustomErrors(),void 0===t&&(i.isError=!1,i.form.$setPristine())}),(this.share.isEmailAccessRight()||this.share.isPasswordAccessRight())&&((t=this.$window.document.querySelectorAll("div.main-view div.auth.landing main")[0])&&t.classList.add("new-challenge"),this.$scope.$watch(function(){return i.emailStep},function(t){"submitCode"===t&&i.$scope.$applyAsync(function(){i.$scope.$watch(function(){return i.form.response.$error.pattern},function(t,e){!0===e&&i.form.$setPristine()})})})))},r.prototype.triggerChallenge=function(t){var e=this;void 0===t&&(t=!0),this.inProgress||(this.inProgress=!0,this.preventDoubleClick=!0===t,this.ConversationsService.triggerAccessRight(this.share).then(function(){e.challengeSent=!0,e.StorageService.setItem("LOCAL",o+"."+e.conversation.id,!0),!0===t&&e.triggerToast()}).catch(function(t){e.$log.error("Could not trigger accessRightChallenge",{share:e.share.id,error:t}),e.error=!0,e.screen="CHALLENGE"}).finally(function(){e.inProgress=!1,e.setFocus(),e.$timeout(function(){e.preventDoubleClick=!1},6e4)}))},r.prototype.triggerToast=function(){var t=this.share.isEmailAccessRight()?this.profile.email:this.share.getChallengeInformation();return this.MessengerService.toast("conversation-challenge.RESEND-"+this.share.getAccessRightType().toUpperCase()+"-TOAST",{info:t},!0,8e3)},r.prototype.notifySender=function(){var e=this;this.ConversationsService.notifySender(this.share).then(function(){return e.notified=!0}).catch(function(t){e.error=!0,e.screen="NOTIFY",e.$log.error("Could not notify",{share:e.share.id,error:t})})},r.prototype.validateChallenge=function(){var e=this;this.inProgress||(this.inProgress=!0,this.resetCustomErrors(),void 0===this.formValues.response?(this.isError=!0,this.inProgress=!1,this.form.response.$setValidity("required",!1),this.setFocus()):this.ConversationsService.validateAccessRight(this.share,this.formValues.response).then(function(t){e.share.accessRightGrant=t,e.AccessRightGrantService.setGrant(e.share.id,t),e.StorageService.removeItem("LOCAL",o+"."+e.conversation.id),void 0!==e.messageId&&void 0!==e.fileId?e.goToDownloadAttachment():e.viewConversation()}).catch(function(t){t.status===n.HTTP_BAD_REQUEST?(e.form.response.$setValidity(e.share.getAccessRightType(),!1),e.setFocus()):e.$log.warn("Unexpected error validating accessRights",{error:t})}).finally(function(){return e.inProgress=!1}))},r.prototype.setWrongNumber=function(){(this.isWrongNumber=!0)===this.challengeSent&&(this.challengeSent=!1,this.isChallengeSent=!0)},r.prototype.back=function(){this.error=!1,!(this.isWrongNumber=!1)===this.isChallengeSent&&(this.challengeSent=!0)},r.prototype.reloadPage=function(){this.$window.location.reload()},r.prototype.nextStep=function(){this.emailStep="submitCode",this.setFocus()},r.prototype.requestEmailCode=function(){this.triggerChallenge(!1),this.nextStep()},r.prototype.showEmailVerificationTemplate=function(){return!1===this.error&&!0===this.share.isEmailAccessRight()},r.prototype.showNotMyNumberButton=function(){return!1===this.challengeSent&&this.share.isSmsAccessRight()&&!1===this.isWrongNumber&&this.profile.isGuest()},r.prototype.showSendCodeButton=function(){return!1===this.challengeSent&&!1===this.isWrongNumber&&(this.share.isSmsAccessRight()||this.share.isEmailAccessRight())},r.prototype.showNotifyButton=function(){return this.share.isSmsAccessRight()&&!0===this.isWrongNumber},r.prototype.showMainActions=function(){return this.challengeSent&&!this.share.isEmailAccessRight()},r.prototype.showSecondaryActions=function(){return(this.challengeSent||!0===this.isWrongNumber)&&(this.share.isSmsAccessRight()||this.share.isEmailAccessRight())},r.prototype.showRequestCodeInfo=function(){return this.share.isEmailAccessRight()&&"requestCode"===this.emailStep},r.prototype.showSubmitCodeOrCodeInfo=function(){return this.share.isEmailAccessRight()&&"submitCode"===this.emailStep||this.share.isPasswordAccessRight()},r.prototype.disableButton=function(){return 0===this.formValues.response||this.form.response.$invalid||this.form.response.$pristine||this.inProgress},r.prototype.generateSupportUrl=function(){var t=this.$translate.use().toLowerCase();this.supportUrl="https://docs.zivver.com/"+t+"/guest/open-zivver-message-with-"+this.urlType+".html"},r.prototype.resetCustomErrors=function(){this.isError=!1,this.share.isGeneratedCodeAccessRight()?this.form.response.$setValidity("generatedCode",!0):this.share.isPasswordAccessRight()?this.form.response.$setValidity("password",!0):this.share.isSmsAccessRight()?this.form.response.$setValidity("sms",!0):this.share.isEmailAccessRight()&&this.form.response.$setValidity("email",!0)},r.prototype.setFocus=function(){var e=this;this.$timeout(function(){var t=e.$window.document.getElementById("response");null!==t&&t.focus()},200)},r.prototype.viewConversation=function(){return this.$state.go("conversations.view",{conversationId:this.share.conversationId,conversation:this.conversation,share:this.share,label:this.label},{location:"replace"})},r.prototype.goToDownloadAttachment=function(){return this.$state.transitionTo("landing-download-attachment",{shareId:this.share.id,messageId:this.messageId,fileId:this.fileId},{location:"replace"})},r.prototype.summarizeRecipients=function(t,e){void 0===e&&(e=3);var i=this.conversation.participants.map(function(t){return t.fullNameOrEmail()}),n=i.slice(0,e).join(", ");return i.length>e&&(n+="... + "+(i.length-e)),n},r);function r(t,e,i,n,o,s,r,a,c,l,u){this.$log=t,this.$rootScope=e,this.$timeout=i,this.$translate=n,this.$scope=o,this.$state=s,this.$window=r,this.AccessRightGrantService=a,this.ConversationsService=c,this.StorageService=l,this.MessengerService=u,this.notified=!1,this.challengeSent=!1,this.error=!1,this.formValues={},this.inputPattern=".*",this.inputType="text",this.inProgress=!1,this.isChallengeSent=!1,this.isError=!1,this.isWrongNumber=!1,this.preventDoubleClick=!1,this.emailStep="requestCode",this.hasAccessCode=!0}e.ConversationChallenge=s,e.ConversationChallengeModule=i.module("components.ConversationChallenge",[]).component("conversationChallenge",{bindings:{conversation:"<",sender:"<",profile:"<",share:"<",expired:"<",label:"<",messageId:"<",fileId:"<"},controller:s,template:a(436)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/img/sent.33034d.svg"},function(t,e,s){var i=[s,e,s(1),s(444)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$rootScope","$scope","$log","$window","$element","$timeout","$translate","$injector","$transitions","hotkeys","MediaService","ConversationsService"],o.prototype.$onInit=function(){var t=this;this.contentEl=this.$element[0].querySelectorAll(".preview .content")[0],this.imageAttachments=this.attachments.filter(function(t){return t.isImage()}),this.canNavigate=1<this.imageAttachments.length,this.previewAttachment.isImage()&&this.$element[0].querySelectorAll("img")[0].addEventListener("load",function(){t.$scope.$applyAsync(function(){t.loading=!1})}),this.loadAttachment("current")},o.prototype.exitCarousel=function(){this.previewAttachment=void 0,this.unregisterStateChange()},o.prototype.showNext=function(t){t.preventDefault(),t.stopPropagation(),this.canNavigate&&this.loadAttachment("next")},o.prototype.showPrevious=function(t){t.preventDefault(),t.stopPropagation(),this.canNavigate&&this.loadAttachment("prev")},o.prototype.getNoPreviewImage=function(){return"NL"!==this.$translate.use().toUpperCase()?s(446):s(445)},o.prototype.loadAttachment=function(t){var e=this,i=(this.loading=!0,this.urls={},2*this.$window.document.documentElement.clientHeight),n=2*this.$window.document.documentElement.clientWidth,o=this.getAttachment(t);this.ConversationsService.getFileDownloadUrl(this.share,o.id).then(function(t){return e.urls.download=t,e.MediaService.resize(t,n,i,"fitIn")}).then(function(t){o.isSvg()?(e.urls.preview=e.urls.download,e.loading=!1):e.urls.preview=t,e.previewAttachment=o}).catch(function(t){e.$log.error("Error getting urls for image in carousel",{error:t,fileUuid:o.id}),e.urls.preview=e.getNoPreviewImage(),e.loading=!1})},o.prototype.registerShortcuts=function(){var e=this;this.hotkeys.bindTo(this.$scope).add({combo:["enter","space","right","down"],callback:function(t){e.showNext(t)}}).add({combo:["left","up"],callback:function(t){e.showPrevious(t)}}).add({combo:["esc","backspace","q"],callback:function(t){t.preventDefault(),e.exitCarousel()}})},o.prototype.registerStateChange=function(){var t=this;this.unregisterStateChange=this.$transitions.onStart({},function(){t.$element[0].parentNode.removeChild(t.$element[0]),t.unregisterStateChange()})},o.prototype.downloadAttachment=function(t){t.stopPropagation()},o.prototype.getAttachment=function(t){var e,i,n=this.previewAttachment.id;switch(t){case"current":e=this.imageAttachments.filter(function(t){return t.id===n}).shift();break;case"next":e=(i=this.imageAttachments.map(function(t){return t.id}).indexOf(n))===this.imageAttachments.length-1?this.imageAttachments[0]:this.imageAttachments[i+1];break;case"prev":e=0===(i=this.imageAttachments.map(function(t){return t.id}).indexOf(n))?this.imageAttachments[this.imageAttachments.length-1]:this.imageAttachments[i-1]}return e},o.prototype.printAttachment=function(t){t.preventDefault(),t.stopPropagation(),this.previewAttachment.isImage()&&void 0!==this.urls.preview&&(this.$window.document.getElementById("noprinting").style.display="none",window.print(),this.$window.document.getElementById("noprinting").style.display="")};var n=o;function o(t,e,i,n,o,s,r,a,c,l,u,p){this.$rootScope=t,this.$scope=e,this.$log=i,this.$window=n,this.$element=o,this.$timeout=s,this.$translate=r,this.$injector=a,this.$transitions=c,this.hotkeys=l,this.MediaService=u,this.ConversationsService=p,this.canNavigate=!1,this.loading=!0,this.target="_self",this.imageAttachments=[],this.registerShortcuts(),this.registerStateChange(),this.$window.document.body.appendChild(this.$element[0])}e.AttachmentCarousel=n,e.AttachmentCarouselModule=i.module("components.AttachmentsCarousel",[]).component("attachmentCarousel",{controller:n,bindings:{attachments:"<",previewAttachment:"=",share:"<"},templateUrl:s(447)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(448)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n={added:"success",deleted:"warning","deleted-own":"warning",inaccessible:"warning",left:"notification",removed:"warning",revoked:"notification",suspended:"warning",unknown:"notification","quotes-conversation-revoked":"warning","quotes-revoked":"warning"},o=(s.$inject=["$translate"],s.prototype.$onInit=function(){this.eventLevel=n[this.event.eventType.toString()]||"notification",this.setIcon(),this.setText()},s.prototype.setIcon=function(){switch(this.eventLevel){case"notification":case"success":this.icon="info";break;case"warning":this.icon="warning"}},s.prototype.setText=function(){var t=this.event.originator,e=this.event.subject;this.text=this.$translate.instant("conversation-event."+this.event.eventType.toUpperCase(),{actor:t,participant:e})},s.prototype.openInfoPane=function(){this.showInfoPane=!0},s.prototype.isResolveRequired=function(){var t,e=this,i=null==(t=this.conversation)?void 0:t.participants.filter(function(t){return t.email===e.profile.email}).shift();if("inaccessible"===this.event.eventType)for(var n=0,o=this.conversation.participants.filter(function(t){return!0===t.accessRight.verificationProblem});n<o.length;n++)if(o[n].email===this.event.originator&&void 0===i.accessRight.canChangeAccessRight)return!0;return!1},s);function s(t){this.$translate=t}e.ConversationEventModule=i.module("components.conversationEvent",[]).component("conversationEvent",{bindings:{conversation:"<",event:"<",profile:"<",showInfoPane:"="},controller:o,template:r(449)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t,e){var i,e=e?(i=1024,["Ki","Mi","Gi","Ti","Pi","Ei","Zi","Yi"]):(i=1e3,["k","M","G","T","P","E","Z","Y"]),n=Math.log(t)/Math.log(i)|0;return(t/Math.pow(i,n)).toFixed(1)+" "+(0<n?e[n-1]+"B":"Bytes")}Object.defineProperty(e,"__esModule",{value:!0}),e.formatBytes=n,e.FormatBytesFilterModule=i.module("filters.formatBytes",[]).filter("formatBytes",function(){return n})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(13),r(489)],e=function(t,e,o,i){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$log","$state","$window","$timeout","ConversationsService"],s.prototype.$onInit=function(){var t=this;this.sender=this.getSender(),this.allRecipients=this.quote.conversationInfo.quoteRecipients.map(function(t){return new i.Participant(t)}).map(function(t){return t.fullNameOrEmail()}).join(", "),this.$timeout(function(){t.initRecipientsExpandability()}),this.$window.addEventListener("resize",function(){t.$timeout(function(){t.initRecipientsExpandability()})})},s.prototype.getSender=function(){if(void 0!==this.quote.conversationInfo){if(void 0!==this.quote.conversationInfo.quotedParticipant)return new i.Participant(this.quote.conversationInfo.quotedParticipant);throw new Error("quotedParticipant is undefined on quoted conversation")}},s.prototype.initRecipientsExpandability=function(){var i=this;this.areRecipientsExpanded=this.quote.messages.reduce(function(t,e){return t[e.id]=!1,t},{}),this.areRecipientsExpandable=this.quote.messages.reduce(function(t,e){return t[e.id]=i.isElementTruncated("recipients-"+e.id),t},{})},s.prototype.getRecipients=function(e){return this.allRecipients.split(", ").filter(function(t){return t!==(e.fullName||e.email)}).join(", ")},s.prototype.isOwnMessage=function(t){return t.sender===this.profile.email},s.prototype.showOriginal=function(){var e=this;this.ConversationsService.get(this.quote.conversationInfo.id).then(function(t){e.$state.go("conversations.open",{shareId:t.share,label:t.systemLabel.name},{reload:!0})})},s.prototype.toggleSelectMessage=function(t){var e=this.selectedMessages.indexOf(t);-1===e?this.selectedMessages.push(t):void 0!==this.selectedMessages&&this.selectedMessages.splice(e,1),this.selectedMessages.sort(function(t,e){return Number(t)-Number(e)})},s.prototype.isSelectedMessage=function(t){return this.isForwardedConversation&&-1<this.selectedMessages.indexOf(t)},s.prototype.isSenderVisible=function(t){return!1===t.isBcc||!0===this.isSenderUniqueParticipant()},s.prototype.areRecipientsVisible=function(t){return(!1===t.isBcc||!1===this.isSenderUniqueParticipant())&&0<this.getRecipients(t.participant).length},s.prototype.isSenderUniqueParticipant=function(){return void 0===this.quote.conversationInfo.quoteRecipients||1===this.quote.conversationInfo.quoteRecipients.length&&this.quote.conversationInfo.quoteRecipients[0].email===this.sender.email},s.prototype.toggleRecipientsExpansion=function(t){void 0!==this.areRecipientsExpandable[t]&&!1!==this.areRecipientsExpandable[t]&&(this.areRecipientsExpanded[t]=!this.areRecipientsExpanded[t])},s.prototype.getAreRecipientsExpanded=function(t){return void 0!==this.areRecipientsExpanded[t]&&this.areRecipientsExpanded[t]},s.prototype.getAreRecipientsExpandable=function(t){return void 0!==this.areRecipientsExpandable[t]&&this.areRecipientsExpandable[t]},s.prototype.isElementTruncated=function(t){var e,t=this.$window.document.getElementById(t),i=o.element(t).parent(),n=!1;return null!=t&&null!=i&&(i.addClass("overflow-visible"),e=t.offsetWidth,i.removeClass("overflow-visible"),n=t.parentElement.clientWidth<=e),n};var n=s;function s(t,e,i,n,o){this.$log=t,this.$state=e,this.$window=i,this.$timeout=n,this.ConversationsService=o,this.areRecipientsExpanded={},this.areRecipientsExpandable={}}e.ConversationQuoteModule=o.module("components.ConversationQuote",[]).component("conversationQuote",{bindings:{conversation:"<",isForwardedConversation:"<",profile:"<",quote:"<",selectedMessages:"=",share:"<"},controller:n,template:r(490)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,o){function i(t,e,i,n){return void 0===i&&(i=""),void 0===n&&(n=!1),e=void 0===e?t.length:e,!o.isString(t)||t.length<=e?t:t.substring(0,n?-1===t.indexOf(" ",e)?t.length:t.indexOf(" ",e):e)+i}Object.defineProperty(e,"__esModule",{value:!0}),e.TruncateFilterModule=o.module("filters.truncate",[]).filter("truncate",function(){return i})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,a){var i=[a,e,a(1),a(33),a(11),a(498)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$log","$translate","SpecialsService","AuthSessionService","AppSwitcherService"],r.prototype.$onInit=function(){this.AuthSessionService.hasScope(o.Scopes.SENDMESSAGES)&&void 0===this.AppSwitcherService.getContext().specialId&&this.options.push({icon:"create",label:this.translate("DRAFT"),state:"drafts.create"}),this.AuthSessionService.hasScope(o.Scopes.SPECIALSUSER)&&this.getSpecials()},r.prototype.getSpecials=function(){var e=this;this.SpecialsService.listSpecials().then(function(t){t.filter(function(t){return"active"===t.status&&0<t.flowInitiations.length}).filter(function(t){return t.id===e.AppSwitcherService.getContext().specialId}).forEach(function(t){e.options.push({label:e.translate("SPECIAL",{name:t.flowInitiations[0].messageDefinition.name.toLowerCase()}),icon:"mode_edit",state:"drafts.special",stateParams:{specialId:t.id,special:t}})})})},r.prototype.translate=function(t,e){return this.$translate.instant("compose-button."+t,e)};var s=r;function r(t,e,i,n,o){this.$log=t,this.$translate=e,this.SpecialsService=i,this.AuthSessionService=n,this.AppSwitcherService=o,this.options=[],this.speedDialOpen=!1}e.ComposeButton=s,e.ComposeButtonModule=i.module("components.ComposeButton",[n.AppSwitcherModule.name]).component("composeButton",{controller:s,template:a(499)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,u){var i=[u,e,u(9),u(1),u(15),u(520),u(8),u(525)],e=function(t,e,o,i,c,n,s){Object.defineProperty(e,"__esModule",{value:!0});var r=[s.ERR_CONNECTION_REFUSED,s.HTTP_INTERNAL_SERVER_ERROR,s.HTTP_BAD_GATEWAY,s.HTTP_SERVICE_UNAVAILABLE,s.HTTP_GATEWAY_TIMEOUT],a="draft-attachments",s=(l.$inject=["$scope","$log","$q","$timeout","$transitions","$translate","FilesOutService"],l.prototype.$onInit=function(){var i=this;this.files=o.__spreadArrays(this.draft.files),this.$scope.$on("files-dropped",function(t,e){i.uploadFiles(e)}),this.$scope.$on("conversations.replied",function(){i.files=[]}),this.$scope.$on("attachments-removed",function(t,e){e.forEach(function(t){return i.removeFile(t)})}),this.$scope.$watch(function(){return i.uploadsInProgress.length},function(){i.doUpload()})},l.prototype.uploadFiles=function(t){var r=this,a=[];t.forEach(function(t){var e=window.URL.createObjectURL(t),i=t.name,n=t.size,o=t.type||"application/octet-stream",s=new c.DraftAttachment;if(s.fileId=e,s.name=i,s.size=n,s.fileType=o,r.files.push(s),t.size>r.FilesOutService.getMaxFileSize())return r.createInvalidFile(s,c.ClientViolationTypes.FileSize);n=r.files.filter(function(t){return void 0===t.upload||void 0===t.upload.error});r.filesToUpload[e]=t,50<n.length?(r.createInvalidFile(s,c.ClientViolationTypes.MaxFiles),r.draft.filesTooMany.push({id:e,name:i})):a.push(e)}),a.map(function(e){return r.files.filter(function(t){return t.id===e})[0]}).reduce(function(t,e){return t.then(function(){return r.$timeout(function(){},250,!1)}).then(function(){return r.createFileSlotAndInitiateMultipartUpload(e)})},this.$q.resolve()).then(function(){return r.doUpload()})},l.prototype.removeFile=function(e){this.files=this.files.filter(function(t){return t.id!==e.id}),void 0!==e.upload&&this.abortUploadForFile(e),this.draft.removeAttachment(e),this.FilesOutService.remove(e.fileslotId),this.checkInvalidFilesForUpload(),void 0!==this.draft.validation.violationsUnresolved.filter(function(t){return t.businessRuleId===c.ClientViolationTypes.MaxFiles}).shift()&&this.draft.files.length<=50&&(this.draft.validation=this.draft.validation.removeViolationByBusinessRuleId(c.ClientViolationTypes.MaxFiles)),this.removeFileAndBlob(e)},l.prototype.checkInvalidFilesForUpload=function(){var t=this,e=this.files.filter(function(t){return void 0!==t.upload&&t.upload.error===c.ClientViolationTypes.MaxFiles}).shift();void 0!==e&&(delete e.upload.error,this.createFileSlotAndInitiateMultipartUpload(e).then(function(){return t.doUpload()}))},l.prototype.createFileSlotAndInitiateMultipartUpload=function(e){var i=this;return this.FilesOutService.createFileSlot(e.name,e.size,e.fileType,!1).then(function(t){return e.fileslotId=t.fileslotId,i.FilesOutService.initMultipart(e)}).then(function(t){return e.calculateParts(t.parts,t.partSize)}).then(function(){e.parts.forEach(function(t){i.uploadQueue.push({attempts:0,fileId:e.fileId,fileslotId:e.fileslotId,part:t.part,start:t.start,end:t.end})})}).catch(function(t){i.$log.warn("Creating fileslot or initialising multipart failed",{error:t}),void 0===e.upload&&(e.upload={aborted:!0,progress:0,loaded:0,partsLeft:e.parts.length}),i.removeFileAndBlob(e),e.upload.error=c.ClientViolationTypes.UploadFailed})},l.prototype.doUpload=function(){var e,t,i,n=this;this.draft.isUploading=0<this.uploadsInProgress.length,2<this.uploadsInProgress.length+1||0===this.uploadQueue.length||(e=this.uploadQueue.shift(),t=this.filesToUpload[e.fileId],i=this.files.filter(function(t){return t.fileslotId===e.fileslotId}).shift(),void 0===t?(this.$log.warn("upload task is missing file to upload",{task:e,attachment:i}),this.removeFile(i)):(e.attempts++,this.uploadsInProgress.push(o.__assign({},e)),this.FilesOutService.readMultipart(t,e.start,e.end).then(function(t){return n.FilesOutService.uploadPart(i,e.part,t)}).then(function(){n.onUploadEnd(e.fileslotId,e.part),0===i.upload.partsLeft&&n.FilesOutService.finishMultipart(e.fileslotId).then(function(){n.draft.addAttachment(i),delete i.upload,n.removeFileAndBlob(i),delete i.fileId})}).catch(function(t){i.upload.aborted||(n.onUploadEnd(e.fileslotId,e.part),-1<r.indexOf(t.status)&&e.attempts<3?(n.$log.info("Failed multipart upload, will retry",{task:e}),n.uploadQueue.unshift(o.__assign({},e))):(n.$log.warn("Uploading multipart failed with unretryable status or too many attempts",{task:e,responseStatus:t.status}),i.upload.error=c.ClientViolationTypes.UploadFailed,n.abortUploadForFile(i)))})))},l.prototype.abortUploadForFile=function(e){this.uploadQueue=this.uploadQueue.filter(function(t){return t.fileId!==e.fileId}),this.uploadsInProgress=this.uploadsInProgress.filter(function(t){return t.fileId!==e.fileId}),void 0!==e.upload&&(e.upload.aborted=!0,e.parts.filter(function(t){return void 0!==t.abort}).forEach(function(t){return t.abort()}),this.removeFileAndBlob(e))},l.prototype.onUploadEnd=function(e,i){this.uploadsInProgress=this.uploadsInProgress.filter(function(t){return!(t.fileslotId===e&&t.part===i)})},l.prototype.createInvalidFile=function(t,e){t.upload={error:e,aborted:!0,partsLeft:0,loaded:-1,progress:-1};var i=new c.Violation;switch(i.violationLevel="warning",i.showStopper=!0,i.id=e.toString()+"-"+t.id,i.businessRuleId=e.toString(),e){case c.ClientViolationTypes.MaxFiles:i.description=this.$translate.instant(a+".VIOLATION-MAXFILES",{max:50});break;case c.ClientViolationTypes.FileSize:i.description=this.$translate.instant(a+".VIOLATION-MAXSIZE"),this.removeFileAndBlob(t)}i.files=[t.id],this.draft.validation=this.draft.validation.addClientViolation(i)},l.prototype.removeFileAndBlob=function(t){void 0!==t.fileId&&(window.URL.revokeObjectURL(t.fileId),delete this.filesToUpload[t.fileId])},l);function l(t,e,i,n,o,s,r){this.$scope=t,this.$log=e,this.$q=i,this.$timeout=n,this.$transitions=o,this.$translate=s,this.FilesOutService=r,this.files=[],this.filesToUpload={},this.uploadQueue=[],this.uploadsInProgress=[]}e.DraftAttachmentsModule=i.module("components.DraftAttachments",[n.DraftAttachmentChipModule.name]).component("draftAttachments",{bindings:{draft:"="},controller:s,template:u(526)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,b){var i=[b,e,b(1),b(572),b(574),b(576),b(579),b(582),b(585),b(588),b(594),b(597),b(599),b(601),b(603),b(605),b(607),b(609),b(611),b(614)],e=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v,g,S){Object.defineProperty(e,"__esModule",{value:!0}),y.$inject=["$log","$timeout"],y.prototype.$onInit=function(){this.formCtrl=this.specialsForm.formCtrl},y.prototype.setComponentVisibility=function(t,e){try{this.section.getComponentByKey(t).visible=e}catch(t){this.$log.warn("Could not get component",{error:t})}},y.prototype.closeAllSectionsBelow=function(){this.specialsForm.closeAllStepsBelow(this.stepperIndex)},y.prototype.openPreviousSection=function(){0<this.specialsForm.numberSteps&&0<this.stepperIndex&&this.specialsForm.goToStep(this.stepperIndex-1)},y.prototype.openNextSection=function(){var e=this;0<this.specialsForm.numberSteps&&this.stepperIndex<this.specialsForm.numberSteps&&(0===this.containsInputs().length?(this.section.isCompleted=!0,this.specialsForm.goToStep(this.stepperIndex+1)):!0===this.validateSectionInstant()?(this.section.isCompleted=!0,this.specialsForm.goToStep(this.stepperIndex+1),this.specialsForm.onSectionCompleted().catch(function(t){e.$log.error("error saving special section: ",{error:t})})):this.specialsForm.jumpToFirstError(this.errorList))},y.prototype.openSection=function(){!1===this.section.isDisabled&&this.specialsForm.goToStep(this.stepperIndex)},y.prototype.cancel=function(){this.specialsForm.onCancelForm()},y.prototype.isStepCurrent=function(){return this.specialsForm.getCurrentStep()===this.stepperIndex},y.prototype.isStepFirst=function(){return!0===this.isStepCurrent()&&1===this.stepperIndex==1},y.prototype.isStepLast=function(){return this.stepperIndex===this.specialsForm.numberSteps},y.prototype.containsInputs=function(){return this.section.components.filter(function(t){return!1===t.isStatic()})},y.prototype.validateSectionInstant=function(){this.errorList=[];var t=this.containsInputs().map(function(t){return t.key});return 0<t.length?(this.errorList=this.specialsForm.validateComponents(t),this.sectionValid=0===this.errorList.length):0===t.length&&(this.sectionValid=!0),this.sectionValid},y.prototype.setComponentRequired=function(t,e){this.section.getComponentByKey(t).required=e},y.prototype.cancelValidation=function(){void 0!==this.validateTimeout&&(this.$timeout.cancel(this.validateTimeout),this.validateTimeout=void 0)},y.prototype.validateSection=function(){var t=this;this.cancelValidation(),this.validateTimeout=this.$timeout(function(){t.validateSectionInstant()},150,!0)},y.prototype.submitSpecial=function(){var e=this;this.cancelValidation(),this.errorList=this.specialsForm.validateForm(),this.formValid=0===this.errorList.length,!0===this.formValid?this.specialsForm.onSectionCompleted().then(function(){return e.isSent=!1,e.isSentFailed=!1,e.isSubmitting=!0,e.specialsForm.onSubmitSpecial()}).then(function(){e.isSent=!0}).catch(function(t){e.isSentFailed=!0,e.failMessage=t,e.$log.error("submitSpecial .catch => error during sending: ",t)}):this.specialsForm.jumpToFirstError(this.errorList)},y.prototype.logUnkownComponent=function(t){return this.$log.warn("Unkown component",{component:t})," \x3c!-- unkown component: "+JSON.stringify(t)+" --\x3e"};var $=y;function y(t,e){this.$log=t,this.$timeout=e,this.isSubmitting=!1,this.isSent=!1,this.isSentFailed=!1,this.sectionValid=!0,this.formValid=!0,this.errorList=[]}e.SpecialsSection=$,e.SpecialsSectionModule=i.module("components.SpecialsSection",[n.SpecialsHiddenModule.name,o.SpecialsInputCheckboxModule.name,s.SpecialsInputCheckboxesModule.name,r.SpecialsInputCheckboxesSvgModule.name,a.SpecialsInputDateModule.name,c.SpecialsInputFilenamePatternModule.name,l.SpecialsInputImageModule.name,u.SpecialsInputRadioButtonModule.name,p.SpecialsInputSelectModule.name,d.SpecialsInputSsnModule.name,h.SpecialsInputTextAutocompleteModule.name,f.SpecialsInputTextModule.name,m.SpecialsInputTextareaModule.name,v.SpecialsStaticImageModule.name,g.SpecialsStaticTextModule.name,S.SpecialsStaticTextHeaderModule.name]).component("specialsSection",{controller:$,bindings:{section:"=",stepperTitle:"<",stepperIndex:"<"},templateUrl:b(615),require:{specialsForm:"^specialsForm"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/index.6b0fc0.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/special.0fb4b5.html"},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){i=[i,e,i(1),i(14)],e=function(t,e,i,n){function o(t,e){return void 0===e&&(e="LL"),n(t).format(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.MomentDateFilterModule=i.module("filters.momentDate",[]).filter("momentDate",function(){return o})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Invite=function(t){this.id=null,this.email=null,this.expireDate=null,this.fullName=null,this.invitedBy=null,this.inviteMessage=null,this.notificationSend=null,this.responseDate=null,void 0!==t&&(this.id=t.id,this.email=t.email,this.status=t.status,this.expireDate=void 0===t.expireDate?null:t.expireDate,this.fullName=void 0===t.fullName?null:t.fullName,this.invitedBy=void 0===t.invitedBy?null:t.invitedBy,this.inviteMessage=void 0===t.inviteMessage?null:t.inviteMessage,this.notificationSend=void 0===t.notificationSend?null:t.notificationSend,this.responseDate=void 0===t.responseDate?null:t.responseDate)}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(1),i(361)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$scope","$timeout"],o.prototype.copyToClipboard=function(){var t=this,e=document.getElementById(this.$scope.copiedId),e=(("password"!==e.type?e:(this.trailingInput=document.createElement("textarea"),this.trailingInput.value=e.value,this.trailingInput.setAttribute("readonly",""),document.body.appendChild(this.trailingInput),this.trailingInput)).select(),document.execCommand("Copy"));return window.getSelection().removeAllRanges(),this.trailingInput&&(document.body.removeChild(this.trailingInput),this.trailingInput=void 0),e&&(this.$timeout(function(){t.isCopied=!1},3e3),this.isCopied=!0)};var n=o;function o(t,e){this.$scope=t,this.$timeout=e,this.isCopied=!1}e.CopyToClipboardDirectiveModule=i.module("common.CopyToClipboardDirective",[]).directive("copyToClipboard",function(){return{restrict:"AE",template:'\n\t\t\t<div flex\n\t\t\t\t layout="column"\n\t\t\t\t class="copy-to-clipboard"\n\t\t\t>\n\t\t\t\t<div class="copy--icon">\n\t\t\t\t\t<md-icon class="input-icon" ng-click="$ctrl.copyToClipboard()">\n\t\t\t\t\t\t<md-tooltip md-direction="top" md-delay="500">\n\t\t\t\t\t\t\t<translate>MAIN.COPY</translate>\n\t\t\t\t\t\t</md-tooltip>\n\t\t\t\t\t\tcontent_copy\n\t\t\t\t\t</md-icon>\n\t\t\t\t</div>\n\t\t\t\t<div ng-show="$ctrl.isCopied === true" class="copy--confirmation">\n\t\t\t\t\t<translate>MAIN.COPIED</translate>\n\t\t\t\t</div>\n\t\t\t</div>',scope:{copiedId:"@"},replace:!0,controller:n,controllerAs:"$ctrl"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,c){var i=[c,e,c(1),c(8),c(419)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0});var o={US:[1],AS:[1684],AI:[1264],AG:[1268],BS:[1242],BB:[1246],BM:[1441],VG:[1284],CA:[1204,1226,1236,1249,1250,1289,1306,1343,1365,1387,1403,1416,1418,1431,1437,1438,1450,1506,1514,1519,1548,1579,1581,1587,1604,1613,1639,1647,1672,1705,1709,1742,1778,1780,1782,1807,1819,1825,1867,1873,1902,1905],KY:[1345],DM:[1767],DO:[1809,1829,1849],GD:[1473],GU:[1671],JM:[1876,1658],MS:[1664],MP:[1670],PR:[1787,1939],KN:[1869],LC:[1758],VC:[1784],SX:[1721],TT:[1868],TC:[1649],VI:[1340]},s={GB:[44],GG:[441481],IM:[441624],JE:[441534]},r=(a.$inject=["$log","$scope","GeoService"],a.prototype.$onInit=function(){var e=this;this.getCountriesInfo(),this.$scope.$watch(function(){return e.phoneNumber},function(t){t?(void 0!==e.form&&(!0!==e.required&&void 0!==e.form.phoneNumber&&e.form.phoneNumber.$setValidity("invalidPhoneNumber",!0),!0!==e.smsConflict)&&void 0!==e.form.phoneNumber&&e.form.phoneNumber.$setValidity("sameNumber",!0),e.validatePhoneNumber()):e.required&&e.autofocus&&void 0!==e.form.phoneNumber&&(e.form.phoneNumber.$setValidity("required",!1),e.form.phoneNumber.$setDirty())}),this.$scope.$watch(function(){return e.smsConflict},function(t){!0===t?(e.form.phoneNumber.$error.sameNumber=!0,e.form.phoneNumber.$setValidity("sameNumber",!1)):(e.form.phoneNumber.$error.sameNumber=!1,e.form.phoneNumber.$setValidity("sameNumber",!0))})},a.prototype.getCountriesInfo=function(){var i=this;this.GeoService.getCountriesInfo().then(function(t){i.countries=t.sort(function(t,e){return t.name>e.name?1:-1}),void 0===i.phoneNumber||""===i.phoneNumber?i.GeoService.getCurrentCountryIso().then(function(e){0!==i.countries.filter(function(t){return t.iso===e}).length&&(i.selectedCountry=i.countries.filter(function(t){return t.iso===e})[0]),i.loading=!1}):i.GeoService.validatePhonenumber(i.phoneNumber).then(function(e){0!==i.countries.filter(function(t){return t.iso===e.region}).length&&(i.selectedCountry=i.countries.filter(function(t){return t.iso===e.region})[0]),i.phoneNumber=e.formattedNumber,i.loading=!1})})},a.prototype.validatePhoneNumber=function(){var i=this,t=void 0===this.selectedCountry?void 0:this.selectedCountry.iso;this.GeoService.validatePhonenumber(this.phoneNumber,t).then(function(e){!1===e.canReceiveSms?i.form.phoneNumber.$setValidity("cannotReceiveSms",!1):(i.form.phoneNumber.$setValidity("cannotReceiveSms",!0),i.form.phoneNumber.$setValidity("invalidPhoneNumber",!0),!0===i.required&&i.form.phoneNumber.$setValidity("required",!0),void 0!==i.form.verificationID&&i.form.verificationID.$setValidity("verificationProblem",!0)),void 0!==e.formattedNumber&&(i.form.phoneNumber.$setViewValue(""+e.formattedNumber),i.form.phoneNumber.$render()),0!==i.countries.filter(function(t){return t.iso===e.region}).length&&(i.selectedCountry=i.countries.filter(function(t){return t.iso===e.region})[0])}).catch(function(t){i.form.phoneNumber.$setValidity("cannotReceiveSms",!0),i.phoneNumber&&(i.form.phoneNumber.$setViewValue(""+i.phoneNumber),i.form.phoneNumber.$render()),t.status!==n.HTTP_CONFLICT&&i.$log.warn("Unexpected error for phone number validation",{error:t}),t.status===n.HTTP_CONFLICT&&i.form.phoneNumber.$setValidity("invalidPhoneNumber",!1)}).finally(function(){i.checkCountryCode(),i.checkAreaCode()})},a.prototype.isPhoneInputInvalid=function(){return void 0!==this.form.phoneNumber&&this.form.phoneNumber.$dirty&&this.form.phoneNumber.$invalid},a.prototype.checkCountryCode=function(){var e=this,t=this.countries.filter(function(t){t=e.phoneNumber.match("^(\\+|(00))("+t.code+")");return null!==t&&1<=t.length});0!==t.length&&(this.selectedCountry=t[0])},a.prototype.checkAreaCode=function(){var t=this.phoneNumber.replace(/^(\s|\D|\+|00)*/g,"");"1"===t.charAt(0)&&this.findCountryISOForAreaCode(t,o),"4"===t.charAt(0)&&"4"===t.charAt(1)&&this.findCountryISOForAreaCode(t,s)},a.prototype.findCountryISOForAreaCode=function(t,n){var o=this;Object.keys(n).forEach(function(e){var i=t;n[e].some(function(t){if(new RegExp("^"+t.toString(),"g").test(i))return 0!==o.countries.filter(function(t){return t.iso===e}).length&&(o.selectedCountry=o.countries.filter(function(t){return t.iso===e})[0],!0)})})},a.prototype.changeCountryCode=function(){void 0!==this.phoneNumber&&(this.phoneNumber=""),this.form.countryCode.$setPristine()},a);function a(t,e,i){this.$log=t,this.$scope=e,this.GeoService=i,this.loading=!0}e.InputPhonenumber=r,e.InputPhonenumberModule=i.module("components.inputPhonenumber",[]).component("inputPhonenumber",{bindings:{autofocus:"<",form:"=",phoneNumber:"=",required:"<",smsConflict:"<"},controller:r,template:c(420)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t,e,i){if(void 0!==t)return e=new RegExp(e,"g"),t.replace(e,i)}Object.defineProperty(e,"__esModule",{value:!0}),e.replace=n,e.ReplaceFilterModule=i.module("filters.replace",[]).filter("replace",function(){return n})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(509)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$scope"],o.prototype.copyToClipboard=function(){var t,e,i,n,o;if(!navigator.userAgent.match(/ipad|ipod|iphone/i))return this.$scope.readOnlyContent?((n=document.createElement("input")).value=this.$scope.readOnlyContent,n.setAttribute("readonly",""),document.body.appendChild(n),n.select(),document.execCommand("Copy"),document.body.removeChild(n),this.isCopied=!0):(document.getElementById(this.$scope.copiedId).select(),o=document.execCommand("Copy"),window.getSelection().removeAllRanges(),o&&(this.isCopied=!0));o=(n=document.getElementById(this.$scope.copiedId)).contentEditable,t=n.readOnly,n.contentEditable="true",n.readOnly=!0,(e=document.createRange()).selectNodeContents(n),(i=window.getSelection()).removeAllRanges(),i.addRange(e),n.setSelectionRange(0,999999),n.contentEditable=o,n.readOnly=t,document.execCommand("copy")};var n=o;function o(t){this.$scope=t,this.isCopied=!1}e.CopyToClipboardTooltipDirectiveModule=i.module("common.CopyToClipboardTooltipDirective",[]).directive("copyToClipboardTooltip",function(){return{restrict:"AE",template:'\n\t\t\t<div flex\n\t\t\t\t layout="column"\n\t\t\t\t class="copy-to-clipboard-tooltip"\n\t\t\t>\n\t\t\t\t<div class="copy-icon" ng-mouseEnter="$ctrl.isCopied = false">\n\t\t\t\t\t<md-icon class="input-icon" ng-click="$ctrl.copyToClipboard()">\n\t\t\t\t\t\tcontent_copy\n\t\t\t\t\t</md-icon>\n\t\t\t\t\t<md-tooltip md-direction="bottom" class="copy-tooltip">\n\t\t\t\t\t\t<translate ng-hide="$ctrl.isCopied">MAIN.COPY</translate>\n\t\t\t\t\t\t<translate ng-show="$ctrl.isCopied" >MAIN.COPIED</translate>\n\t\t\t\t\t</md-tooltip>\n\t\t\t\t</div>\n\t\t\t</div>',scope:{copiedId:"@",readOnlyContent:"@"},replace:!0,controller:n,controllerAs:"$ctrl"}})}.apply(e,i);void 0!==e&&(t.exports=e)},,,,,,,,function(t,e,i){t.exports=i(240)},function(t,e,i){i=[i,e,i(1),i(38),i(245),i(51),i(670),i(762)],e=function(t,e,i,n,o,s){Object.defineProperty(e,"__esModule",{value:!0}),window.addEventListener("error",function(t){var e,i;"Object doesn't support property or method 'createEventObject'"!==t.message&&(s.setCustomUrl(document.location.href),s.trackError(t.message,t.filename,t.lineno,t.colno,t.error),(e=new XMLHttpRequest).open("POST","/api/log"),e.setRequestHeader("Content-Type","application/json"),e.onerror=function(t){},i=document.location.href.replace(new RegExp(n.TOKEN_REGEX,"g"),function(t){return"{token}."+t.split(".").pop()}).replace(new RegExp(n.UUID_REGEX,"g"),function(t){return"{uuid}-"+t.split("-").pop()}),e.send(JSON.stringify({message:("[FATAL] "+t.message).substr(0,255),channel:"WEBAPP",level:"ERROR",context:{colno:t.colno,file:t.filename,lineno:t.lineno,stacktrace:null!=(t=null==(e=t.error)?void 0:e.stack)?t:"",url:i}})))}),i.bootstrap(document.body,[o.zivver.name],{strictDi:!0})}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.EMAIL_REGEX="([!#-'*+\\\\/-9=?A-Z^-~-]+(\\.[!#-'*+\\\\/-9=?A-Z^-~-]+)*)@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+"}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TOKEN_REGEX="eyJ0[A-Za-z0-9-_.+=]+|Z1\\.\\d+\\.\\d+\\.[A-Za-z0-9-_+/=]+"}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.UUID_REGEX="[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}"}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,E){var i=[E,e,E(1),E(246),E(257),E(258),E(71),E(268),E(269),E(270),E(274),E(388),E(647),E(33),E(32),E(656),E(657),E(37),E(196),E(197),E(661),E(663),E(665),E(667)],e=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v,g){function S(e){v.ErrorRoutes.forEach(function(t){return e.state(t)})}function $(t,e,i,n){var o=document.body,s=[],e=(e.onSuccess({},function(t){t=t.to();o.setAttribute("state",t.name),void 0!==s&&(s.forEach(function(t){return o.classList.remove(t)}),s=[]),void 0!==t.data&&void 0!==t.data.bodyClass&&(s=t.data.bodyClass.split(" ")).forEach(function(t){return o.classList.add(t)})}),n.getItem("SESSION","application.theme"));e&&("string"!=typeof e?i.loadTheme(e,!1):g.loadTheme(e))}function y(e,i,n,o,s){var r=!1;e.$on("api::tooManyConnectionErrors",function(){var t;r||(t=i.navigator.onLine?"UNAVAILABLE":"OFFLINE",t=o.instant("MAIN.API-ERROR."+t),t=n.alert().textContent(t).ok(o.instant("MAIN.TRY-AGAIN")),r=!0,n.show(t).then(function(){e.$broadcast("api::connectionErrorsReset"),r=!1,s.reload()}))})}function b(t){t.onSuccess({},function(t){var e=t.injector().get("$anchorScroll"),i=t.injector().get("$document"),n=t.injector().get("$mdUtil"),t=t.injector().get("$timeout"),o=i.find("body");e("top"),t(function(){var t=n.findFocusTarget(o);void 0!==t&&(t.focus(),n.forceFocus(t))},250,!1)})}function w(t,e,i,n,o,s,r){e.debugInfoEnabled(!1),e.cssClassDirectivesEnabled(!1),e.commentDirectivesEnabled(!1),i.hashPrefix(""),i.html5Mode(!0),n.defaults.secure="https:"===window.location.protocol,o.errorOnUnhandledRejections(!1),t.constant("$MD_THEME_CSS",""),r.skipClickHijack(),s.iconSet("ziv",E(669),24)}S.$inject=["$stateProvider"],$.$inject=["$rootScope","$transitions","ThemeService","StorageService"],y.$inject=["$rootScope","$window","$mdDialog","$translate","$state"],b.$inject=["$transitions"],w.$inject=["$provide","$compileProvider","$locationProvider","$cookiesProvider","$qProvider","$mdIconProvider","$mdGestureProvider"],Object.defineProperty(e,"__esModule",{value:!0}),e.zivver=i.module("zivver",["ngAnimate","ngAria","ngCookies","ngMessages","ngSanitize","ngMaterial",n.UiRouterConfigModule.name,r.I18nModule.name,o.ApiInterceptorModule.name,a.MdTooltipDirectiveModule.name,c.HelpDirectiveModule.name,l.ZivverExternalsModule.name,f.ZivverServicesModule.name,u.AuthModule.name,p.AppModule.name,d.LandingModule.name,m.DocumentTitleServiceModule.name,h.AppSwitcherModule.name]).config(w).config(S).config(s.decorateMdDialog).run(b).run($).run(y)}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(763),i(8),i(38),i(11),i(102),i(51),i(256)],e=function(t,e,i,r,a,n,c,l,u){Object.defineProperty(e,"__esModule",{value:!0}),e.UiRouterConfigModule=i.module("zivver.configUiRouter",["ui.router","oc.lazyLoad"]).config(["$urlServiceProvider",function(t){t.config.type("uuid",{encode:function(t){return t},decode:function(t){return t},is:function(t){return"string"==typeof t},equals:function(t,e){return t===e},pattern:new RegExp(n.UUID_REGEX)}),t.config.type("token",{encode:function(t){return t},decode:function(t){return t},is:function(){return!0},equals:function(){return!0},pattern:new RegExp(n.TOKEN_REGEX)}),t.rules.initial({state:"login"}),t.rules.when(new RegExp("/localhost/"),function(){return{state:"conversations.index"}}),t.rules.when("",function(){}),t.rules.otherwise({state:"_errors.not_found",params:{},options:{notify:!0,reload:!1}})}]).run(["$log","$timeout","$state","$transitions","$window",function(e,t,i,n,o){n.onBefore({},function(t){i=(e=t).injector().get("AuthSessionService"),n=e.injector().get("LoginService"),o=e.to(),s=e.params(),a=!0,r=i.isAuthenticated(),i=i.hasRefreshToken();var e,i,n,o,s,r,a=!1===(a=void 0!==o.data&&void 0!==o.data.authorizationRequired?o.data.authorizationRequired:a)?r&&"login"===o.name?e.router.stateService.target("conversations.label"):i&&"login"===o.name?(n.setLoginDestination("conversations.label"),e.router.stateService.target("login-refresh")):void 0:!1===r?(n.setLoginDestination(o.name,s),e.router.stateService.target(i?"login-refresh":"login",s)):void 0;return void 0!==a?a:void 0!==(r=function(t){var e=t.injector().get("AuthSessionService"),i=t.injector().get("LoginService"),n=t.injector().get("StorageService"),o=t.to(),s=t.params();if(!1!==e.isAuthenticated()){var r=[],a=e.getScopes();if(0!==(r=void 0!==o.data&&void 0!==o.data.scopesRequired?o.data.scopesRequired:r).length&&!e.hasScopes(r))return e.hasScope(c.Scopes.FACTORAUTHENTICATOR)&&1===a.length?(i.setLoginDestination(o.name,s),t.router.stateService.target("login-extra-factor")):e.hasScope(c.Scopes.CHANGEPASSWORD)&&1===a.length&&"login-forced-password-change"!==o.name?(i.setLoginDestination(o.name,s),t.router.stateService.target("login-forced-password-change")):e.hasScope(c.Scopes.SUDOADMIN)&&0===o.name.indexOf("organization")?(i.setLoginDestination(o.name,s),i=t.router.stateService.href(o.name,s),n.setItem("SESSION","admin.destination",i),t.router.stateService.target("redirect-to-new-webapp",{url:"/admin/password"})):e.isDelegate()&&0===o.name.indexOf("organization")?t.router.stateService.target("conversations.label"):t.router.stateService.target("_errors.permissions",{prevState:o.name,prevParams:o.params,scopes:{required:r,given:a}})}}(t))?r:void 0}),n.onBefore({to:function(t){return t.data.isMigrated}},function(t){return t.router.stateService.target("redirect-to-new-webapp",{url:t.to().data.migratedUrl})});var s=t();n.onSuccess({},function(e){t.cancel(s),s=t(function(){var t;u.setCustomUrl(l.anonymizeStateUrl(e),!1),u.trackPageView(e.to().name),e.to().data.doNotTrack||(0===e.to().name.indexOf("conversations.")?void 0!==(t=e.params().conversationId)&&u.setConversationContext(t):u.deleteConversationContext())},500,!1)}),i.defaultErrorHandler(function(t){t instanceof r.Rejection&&(2===t.type||3===t.type)||(t.detail.status===a.HTTP_UNAUTHORIZED?i.go("login-401",t.detail.data):t.detail.status===a.HTTP_NOT_FOUND?i.go("_errors.not_found"):(e.error("Error changing to state",{error:t}),i.go("_errors.state_change")))})}])}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ERR_CONNECTION_REFUSED=-1,e.ZERO_RESPONSE=0,e.HTTP_OK=200,e.HTTP_ACCEPTED=202,e.HTTP_NO_CONTENT=204,e.HTTP_BAD_REQUEST=400,e.HTTP_UNAUTHORIZED=401,e.HTTP_FORBIDDEN=403,e.HTTP_NOT_FOUND=404,e.HTTP_NOT_ACCEPTABLE=406,e.HTTP_CONFLICT=409,e.HTTP_GONE=410,e.HTTP_PRECONDITION_FAILED=412,e.HTTP_UNPROCESSABLE_ENTITY=422,e.HTTP_LOCKED=423,e.HTTP_TOO_MANY_REQUESTS=429,e.HTTP_INTERNAL_SERVER_ERROR=500,e.HTTP_BAD_GATEWAY=502,e.HTTP_SERVICE_UNAVAILABLE=503,e.HTTP_GATEWAY_TIMEOUT=504}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(){}Object.defineProperty(e,"__esModule",{value:!0}),i.scopesChanged="auth-scopes-changed",i.logoutSuccess="auth-logout-success",i.logoutOtherTab="auth-logout-other-tab",i.notAuthenticated="auth-not-authenticated",e.AuthEvents=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),(e=e.GrantType||(e.GrantType={})).authorization_code="authorization_code",e.password="password",e.refresh_token="refresh_token",e.delegate="delegate"}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(t){void 0!==t&&(this.challengeInformation=t.challengeInformation,this.factorType=t.factorType,this.id=t.id)}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.isSms=function(){return"sms"===this.factorType},i.prototype.isTotp=function(){return"rfc6238_totp"===this.factorType},e.Multifactor=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function o(t){void 0!==t&&(this.setRequiredProperties(t),this.setOptionalProperties(t))}Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.setRequiredProperties=function(t){for(var e=0,i=o.requiredProperties;e<i.length;e++){var n=i[e];if(void 0===t[n])throw Error("Missing property "+n+" for Recipient");this[n]=t[n]}},o.prototype.setOptionalProperties=function(t){for(var e=0,i=o.optionalProperties;e<i.length;e++){var n=i[e];void 0!==t[n]&&(this[n]=t[n])}},o.requiredProperties=["otpType","status","id","secret","account","qrcode"],o.optionalProperties=["period","digits","counter"],e.OtpSetup=o}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),(e=e.Scopes||(e.Scopes={})).CHANGEPASSWORD="CHANGEPASSWORD",e.FACTORAUTHENTICATOR="FACTORAUTHENTICATOR",e.LIMITEDACCESS="LIMITEDACCESS",e.LIMITEDREPLYMESSAGES="LIMITEDREPLYMESSAGES",e.ORGANIZATIONADMIN="ORGANIZATIONADMIN",e.PROFILEWRITE="PROFILEWRITE",e.RECEIVEMESSAGES="RECEIVEMESSAGES",e.SENDMESSAGES="SENDMESSAGES",e.SPECIALSADMIN="SPECIALSADMIN",e.SPECIALSUSER="SPECIALSUSER",e.SUDOADMIN="SUDOADMIN",e.USERADMIN="USERADMIN",e.USERREGISTRATION="USERREGISTRATION",e.USERECOVERYCODE="USERECOVERYCODE"}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},,function(t,e,i){i=[i,e,i(9),i(1),i(11),i(8)],e=function(t,e,a,i,c,l){function n(t,e,i,n,o,s){var r=this;this.$rootScope=t,this.$q=e,this.$log=i,this.$injector=n,this.$timeout=o,this.AuthSessionService=s,this.connectionErrors=0,this.rateLimiter={waitUntil:0},this.request=function(t){return 0!==t.url.indexOf("/api/")?t:5<r.connectionErrors?(r.$rootScope.$broadcast("api::tooManyConnectionErrors"),r.$q.reject(new Error("too many requests"))):(t.url=t.url.replace("/api/","/api/"),0<r.rateLimiter.waitUntil?r.waitForSomeTime(r.getTimeUntilRatelimiterIsReset()).then(function(){return r.checkAuthentication(t)}):r.checkAuthentication(t))},this.response=function(t){var e=t.config;return!1!==r.isApiRequest(e.url)&&(r.connectionErrors=0<r.connectionErrors?r.connectionErrors-1:0),t},this.responseError=function(t){var e,i=t.config;if(void 0===i)return r.$q.reject(t);var n=i.method;if(!1===r.shouldHandleError(i.url))return r.$q.reject(t);var o=null!=(e=i.retries)?e:1;switch(t.status){case l.HTTP_UNAUTHORIZED:r.isAuthenticationRequired(i,!1)&&r.$rootScope.$broadcast(c.AuthEvents.notAuthenticated,t);break;case l.HTTP_TOO_MANY_REQUESTS:if(-1===i.url.indexOf("/api/ws"))return r.retryRateLimitedRequest(t);case l.HTTP_INTERNAL_SERVER_ERROR:case l.HTTP_BAD_GATEWAY:case l.HTTP_SERVICE_UNAVAILABLE:if("GET"===n&&o<=5)return r.retryFailedRequest(i,1e3+r.randomMilliseconds(0,2e3),o);r.connectionErrors++,r.$log.debug("We now have "+r.connectionErrors+" failed requests");break;case l.ERR_CONNECTION_REFUSED:var s=i.timeout;if("GET"===n&&void 0!==s&&"number"==typeof s&&o<=5)return r.retryFailedRequest(a.__assign(a.__assign({},i),{timeout:2*s}),1e3+r.randomMilliseconds(1e3,3e3),o)}return r.$q.reject({status:t.status,statusText:t.statusText,data:t.data,headers:t.headers,url:t.config.url})},this.$rootScope.$on("api::connectionErrorsReset",function(){r.connectionErrors=0})}Object.defineProperty(e,"__esModule",{value:!0}),e.ApiInterceptorModule=i.module("common.ApiInterceptor",[]),n.$inject=["$rootScope","$q","$log","$injector","$timeout","AuthSessionService"],n.prototype.checkAuthentication=function(e){return!1===this.isAuthenticationRequired(e)?this.$q.resolve(e):this.AuthSessionService.isAuthenticated()?this.$q.resolve(a.__assign(a.__assign({},e),{headers:a.__assign(a.__assign({},e.headers),{Authorization:"Bearer "+this.AuthSessionService.getAccessToken()})})):this.AuthSessionService.hasRefreshToken()?this.$injector.get("LoginService").refresh().then(function(t){if(t.mfaRequired)throw Error("AuthInterceptor refresh resulted in MFA required. Not yet implemented");return a.__assign(a.__assign({},e),{headers:a.__assign(a.__assign({},e.headers),{Authorization:"Bearer "+t.accessToken})})}):void 0},n.prototype.isApiRequest=function(t){return void 0!==t&&0===t.indexOf("/api/")},n.prototype.isAuthenticationRequired=function(t,e){return void 0===e&&(e=!0),!1!==this.isApiRequest(t.url)&&(!e||void 0===t.headers||void 0===t.headers.Authorization)&&(void 0===t.authenticationRequired||t.authenticationRequired)},n.prototype.shouldHandleError=function(t){return void 0!==t&&!1!==this.isApiRequest(t)},n.prototype.retryFailedRequest=function(t,e,i){var n=this.$injector.get("$http");return this.waitForSomeTime(e).then(function(){return t.retries=i+1,n(t)})},n.prototype.retryRateLimitedRequest=function(t){var e=this.$injector.get("$http"),i=1e3*parseInt(null!=(i=t.headers("Retry-After"))?i:"3");return this.enableRateLimiter(i),this.waitForSomeTime(this.getTimeUntilRatelimiterIsReset()).then(function(){return e(t.config)})},n.prototype.waitForSomeTime=function(t){return this.$timeout(function(){},t,!1)},n.prototype.randomMilliseconds=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},n.prototype.enableRateLimiter=function(t){var e=this,i=Date.now(),t=i+t,t=(void 0!==this.rateLimiter.cancelTimeout&&this.$timeout.cancel(this.rateLimiter.cancelTimeout),this.rateLimiter.waitUntil=Math.max(this.rateLimiter.waitUntil,t),this.rateLimiter.waitUntil-i);this.rateLimiter.cancelTimeout=this.$timeout(function(){e.rateLimiter.waitUntil=0},t)},n.prototype.getTimeUntilRatelimiterIsReset=function(){var t=Date.now();return this.rateLimiter.waitUntil-t+this.randomMilliseconds(250,2500)},e.ApiInterceptorModule.service("ApiInterceptor",n).config(["$httpProvider",function(t){t.interceptors.push(["$injector",function(t){return t.get("ApiInterceptor")}]),t.defaults.headers.common.Accept="application/json",t.defaults.headers.common["Zivver-User-Agent"]="Zivver WebApp/2.20.216  API/1.58.36",t.useApplyAsync(!0)}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9)],e=function(t,e,o){function i(t){t.decorator("$mdDialog",["$delegate","$mdMedia",function(t,e){var i=t.show.bind(t),n={controllerAs:"$ctrl",fullscreen:!1===e("gt-sm"),clickOutsideToClose:!0,escapeToClose:!0};return t.show=function(t){return i(o.__assign(o.__assign({},n),t))},t}])}i.$inject=["$provide"],Object.defineProperty(e,"__esModule",{value:!0}),e.decorateMdDialog=i}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,i){var n={"./de":261,"./nl":262};function o(t){t=s(t);return i(t)}function s(t){if(i.o(n,t))return n[t];throw(t=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",t}o.keys=function(){return Object.keys(n)},o.resolve=s,(t.exports=o).id=260},,,,,function(t,e,i){t.exports=i.p+"assets/v2/i18n/en.02bf00.json"},function(t,e,i){t.exports=i.p+"assets/v2/i18n/de.087aac.json"},function(t,e,i){t.exports=i.p+"assets/v2/i18n/nl.6ddfec.json"},function(t,e,i){i=[i,e,i(72),i(1)],e=function(t,e,i,n){function o(t){return[t[void 0!==(new i.UAParser).getResult().device.type?1:0]]}o.$inject=["$delegate"],Object.defineProperty(e,"__esModule",{value:!0}),e.MdTooltipDirectiveModule=n.module("ziv.MdTooltipDirective",[]).directive("mdTooltip",function(){return{replace:!0,template:'<span style="display:none"></span>',scope:{},link:function(t,e){e.remove(),t.$destroy()}}}).decorator("mdTooltipDirective",o)}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.HelpDirectiveModule=i.module("zivver.HelpDirective",[]).directive("help",function(){return{replace:!1,template:'\n<md-icon>help_outline</md-icon>\n<md-tooltip md-direction="left" md-delay="200"><ng-transclude></ng-transclude></md-tooltip>\n',transclude:!0}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(271),i(273)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ZivverExternalsModule=i.module("zivver.external",["cfp.hotkeys","ngFileUpload"])}.apply(e,i);void 0!==e&&(t.exports=e)},,,,function(t,e,f){var i=[f,e,f(1),f(103),f(277),f(104),f(286),f(358),f(228),f(226),f(362),f(364),f(375),f(80),f(386)],e=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h){Object.defineProperty(e,"__esModule",{value:!0}),e.AuthModule=i.module("zivver.auth",[r.LoginModule.name,a.LogoutModule.name,l.MomentDateFilterModule.name,p.SignupModule.name,c.CopyToClipboardDirectiveModule.name,n.FooterDonsModule.name,o.ForgotPasswordModule.name,s.LanguageSelectModule.name,r.LoginModule.name,a.LogoutModule.name,p.SignupModule.name,u.ShowPasswordDirectiveModule.name,d.SubscriptionModule.name,h.VersionModule.name]).config(["$stateProvider",function(t){t.state("_auth_layout",{template:f(387),data:{authorizationRequired:!1,bodyClass:"auth"}})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<footer translate-namespace=footer-dons> <a ng-href="{{ $ctrl.url }}" target=_blank translate>.LABEL</a> </footer> '},function(t,e,s){var i=[s,e,s(1),s(278),s(279),s(281)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),e.ForgotPasswordModule=i.module("auth.forgotPassword",[n.ForgotPasswordControllerModule.name,o.ResetPasswordControllerModule.name]),e.ForgotPasswordModule.config(["$stateProvider",function(t){t.state({parent:"_auth_layout",name:"forgot-password",url:"/forgot-password?email",templateUrl:s(282),controller:n.ForgotPasswordController,controllerAs:"$ctrl",data:{title:"Forgot password"},params:{email:{squash:!0,default:void 0}}}),t.state({parent:"_auth_layout",name:"forgot-password-reset",url:"/forgot-password/reset/:token",templateUrl:s(283),controller:o.ResetPasswordController,controllerAs:"$ctrl",data:{}})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t,e){this.PasswordService=t,this.substate="FORM",this.formValues={};t=e.params.email;this.formValues.username=t}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["PasswordService","$uiRouterGlobals"],n.prototype.submitForm=function(){var t=this;this.substate="LOADING",this.PasswordService.initForget(this.formValues.username).then(function(){t.substate="FINISH"}).catch(function(){t.substate="ERROR"})},e.ForgotPasswordController=n,e.ForgotPasswordControllerModule=i.module("auth.forgot-password.ForgotPasswordController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(14),i(8),i(73)],e=function(t,e,i,s,r,n){function o(t,e,i,n){var o=this;this.$log=t,this.$uiRouterGlobals=e,this.$timeout=i,this.PasswordService=n,this.substate=a.LOADING,this.resetInfo=null,this.noRecoverySent=!1,this.skipRecovery=!1,this.submittingForm=!1,this.token=this.$uiRouterGlobals.params.token,null===this.token?this.substate=a.ERROR:this.PasswordService.validateResetToken(this.token).then(function(t){o.resetInfo=t,void 0===o.resetInfo.recoverySent?o.noRecoverySent=!0:o.resetInfo.recoverySent=s(o.resetInfo.recoverySent).format("ddd D MMM YYYY HH:mm"),o.substate=a.FORM}).catch(function(t){t.status===r.HTTP_CONFLICT||t.status===r.HTTP_GONE?o.substate=a.EXPIRED:(o.substate=a.ERROR,o.$log.error("Error resetting password",{error:t}))})}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","$uiRouterGlobals","$timeout","PasswordService"],o.prototype.resetPassword=function(){var e=this,t=!1===this.skipRecovery&&void 0!==this.form.recoveryCode?this.form.recoveryCode.$viewValue:void 0;return this.substate=a.LOADING,this.submittingForm=!0,this.PasswordService.resetPassword(this.token,this.form.password.$viewValue,t).then(function(){e.substate=a.FINISH}).catch(function(t){switch(t.status){case r.HTTP_FORBIDDEN:e.substate=a.RECOVERY,e.$timeout(function(){e.form.recoveryCode.$setValidity("codeInvalid",!1),e.form.recoveryCode.$setDirty()},100,!0);break;case r.HTTP_CONFLICT:case r.HTTP_GONE:e.substate=a.EXPIRED;break;default:e.$log.error("unexpected error resetting password",{error:t}),e.substate=a.ERROR}}).finally(function(){e.submittingForm=!1})},o.prototype.nextStep=function(){!0===this.noRecoverySent?this.resetPassword():this.substate=a.RECOVERY},o.prototype.isResetDisabled=function(){return!0===this.submittingForm||!1===this.skipRecovery&&(!0===this.form.$invalid||void 0===this.form.recoveryCode||void 0===this.form.recoveryCode.$viewValue||""===this.form.recoveryCode.$viewValue)},e.ResetPasswordController=o,c.LOADING="LOADING",c.FORM="FORM",c.RECOVERY="RECOVERY",c.FINISH="FINISH",c.ERROR="ERROR",c.EXPIRED="EXPIRED";var a=c;function c(){}e.ResetPasswordControllerModule=i.module("auth.forgot-password.ResetPasswordController",[n.PasswordStrengthDirectiveModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/forgot-password.3d6e8e.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/reset-password.96fdff.html"},function(t,e,i){},function(t,e){t.exports='<label> <md-icon>language</md-icon> </label> <md-select ng-model=$ctrl.language aria-label="Choose language"> <md-option ng-repeat="(key, lang) in ::$ctrl.availableLanguages" ng-value=key>{{lang}}</md-option> </md-select> '},function(t,e,d){var i=[d,e,d(1),d(287),d(288),d(289),d(344),d(345),d(346),d(347),d(11),d(348),d(351)],e=function(t,e,i,n,o,s,r,a,c,l,u,p){Object.defineProperty(e,"__esModule",{value:!0}),e.LoginModule=i.module("auth.login",[s.LoginControllerModule.name,r.LoginErrorControllerModule.name,a.LoginSsoConflictControllerModule.name,o.ExtraFactorControllerModule.name,c.SsoControllerModule.name,n.AuthorizeControllerModule.name,p.PasswordChangeModule.name,l.OAuthControllerModule.name]),e.LoginModule.config(["$stateProvider",function(t){t.state({parent:"_auth_layout",name:"login",url:"/login?email",template:d(352),controller:s.LoginController,controllerAs:"$ctrl",data:{title:"Log in to Zivver",bodyClass:"auth login"},params:{email:void 0,recipient:void 0,username:void 0}}),t.state({parent:"_auth_layout",name:"login-extra-factor",url:"/login/extra-factor",templateUrl:d(353),controller:o.ExtraFactorController,controllerAs:"$ctrl",data:{authorizationRequired:!0,bodyClass:"auth extra-factor",scopesRequired:[u.Scopes.FACTORAUTHENTICATOR]}}),t.state({parent:"_auth_layout",name:"login-authorize",url:"/login/authorize?page&code",controller:n.AuthorizeController,controllerAs:"$ctrl",template:'<md-progress-linear md-mode="query"></md-progress-linear>',params:{page:"/conversations/inbox"},data:{authorizationRequired:!1,bodyClass:"auth login-sso login-refresh"}}),t.state({parent:"_auth_layout",name:"login-sso",url:"/login/sso/:token",controller:c.SsoController,controllerAs:"$ctrl",template:d(354),data:{authorizationRequired:!1,bodyClass:"auth login-sso login-refresh"}}),t.state({parent:"_auth_layout",name:"login-forced-password-change",url:"/login/change-password",data:{authorizationRequired:!0,bodyClass:"auth extra-factor",scopesRequired:[u.Scopes.CHANGEPASSWORD]},params:{oldPassword:void 0},resolve:{oldPassword:["$transition$",function(t){return t.params().oldPassword}]},template:'<password-change old-password="$resolve.oldPassword"></password-change>'}),t.state({parent:"_auth_layout",name:"login-401",controller:r.LoginErrorController,controllerAs:"$ctrl",templateUrl:d(355),params:{reason:void 0,details:{}}}),t.state({parent:"_auth_layout",name:"login-sso-conflict",controller:a.LoginSsoConflictController,controllerAs:"$ctrl",templateUrl:d(356),params:{actualUser:void 0,targetUser:void 0,idpUrl:void 0}}),t.state({parent:"_auth_layout",name:"oauth-login",url:"/oauth/login?client_id&username&redirect_uri",template:d(357),data:{authorizationRequired:!0},controllerAs:"$ctrl",controller:l.OAuthController})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(8)],e=function(t,e,i,n){function o(t,e,i,n,o){this.$log=t,this.$state=e,this.$uiRouterGlobals=i,this.LoginService=n,this.AuthSessionService=o;t=this.$uiRouterGlobals.params.code;void 0===t&&e.go("_errors.not_found"),this.login(t)}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","$state","$uiRouterGlobals","LoginService","AuthSessionService"],o.prototype.login=function(t){var s=this;return this.AuthSessionService.forgetMe(),this.LoginService.authCodeLogin(t,!1).then(function(t){var e,i,n=s.$uiRouterGlobals.params.page,o={};switch(n){case"conversations/inbox":i="conversation.label";break;case"settings/profile":i="settings.profile";break;case"settings/security":i="settings.security";break;default:0===n.indexOf("conversations/open")?o={shareId:n.split("/")[1]}:0===n.indexOf("pod")?(i=(e=n.split("/"))[0],o={conversation:e[1],message:e[2],recipient:e[3]}):(s.$log.warn("Unexpected value for `page` param: "+n),i="conversations.label")}s.LoginService.handleLoginResult(t,i,o)}).catch(function(t){t.status===n.HTTP_UNAUTHORIZED&&void 0!==t.data?!1===s.LoginService.check401Response(t.data)&&s.$state.go("login-401",{reason:"CODE_EXPIRED"}):s.$log.error("Error logging in with authorization code",{error:t})})},e.AuthorizeController=o,e.AuthorizeControllerModule=i.module("auth.login.AuthorizeController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(11)],e=function(t,e,i,m){Object.defineProperty(e,"__esModule",{value:!0});var n="mfa.session";function o(t,e,i,n,o,s,r,a,c,l,u,p,d){var h=this,f=(this.$log=t,this.$mdDialog=e,this.$scope=i,this.$state=n,this.$rootScope=o,this.$timeout=s,this.$translate=r,this.$q=a,this.$window=c,this.AuthSessionService=l,this.MultifactorService=u,this.LoginService=p,this.StorageService=d,this.factors=[],this.substate="LOADING",this.error=null,this.icon=null,this.codeLabel=null,this.hideTrustedDeviceCheckbox=!1,this.username=l.getUsername(),this.trustedDevice=!1,this.init(),this.$scope.$watch(function(){return h.challengeResponse},function(){void 0!==h.form&&h.form.challengeResponse.$setValidity("validationResult",!0)}),i.$on(m.AuthEvents.logoutOtherTab,function(t,e){f(),h.onLogoutOtherTab(e.username)}))}o.$inject=["$log","$mdDialog","$scope","$state","$rootScope","$timeout","$translate","$q","$window","AuthSessionService","MultifactorService","LoginService","StorageService"],o.prototype.init=function(){var e=this;this.LoginService.isTrustedDevice().then(function(t){if(t)return e.goToLoginDestination();e.MultifactorService.getFactors().then(function(t){if(e.factors=t,0===e.factors.length)return e.$log.error("MFA required but factors list empty"),e.$state.go("logout",{});e.selectFactor(e.factors[0]),e.$timeout(function(){e.substate="FORM",e.registerFocusEventListener()})})})},o.prototype.onLogoutOtherTab=function(t){var e=this,i=this.$mdDialog.confirm().textContent(this.$translate.instant("APP.ERROR.LOGGED-OUT-OTHER-TAB")).hasBackdrop(!0).ok(this.$translate.instant("APP.RE-LOGIN")).cancel(this.$translate.instant("MAIN.CANCEL"));this.$rootScope.$broadcast(m.AuthEvents.logoutSuccess),this.AuthSessionService.forgetMe(t),this.$mdDialog.show(i).then(function(){e.$state.go("login",{username:t},{location:"replace"})},function(){e.$window.location.href="https://www.zivver.com"})},o.prototype.submitForm=function(){var t,e=this;this.form.$invalid||(void 0===(t=this.AuthSessionService.getAccessToken())?(this.$log.info("cannot yet submit MFA form, accessToken expired. Refreshing first"),this.LoginService.refresh().then(function(){e.submitForm()}).catch(function(t){e.$log.info("refreshing accessToken for MFA submitForm failed",{error:t})})):this.MultifactorService.validateFactor(t,this.activeFactor.id,this.challengeResponse).then(function(t){if(t.mfaRequired)return e.$state.reload();e.AuthSessionService.setScopes(t.scope.split(" ")),e.substate="VALIDATED",e.trustDevice().then(function(){e.$timeout(function(){e.goToLoginDestination(),e.setMfaForOtherTabs(),e.removeFocusEventListener()},2e3,!1)})},this.validationError.bind(this)))},o.prototype.removeFocusEventListener=function(){void 0!==this.focusEventListener&&(this.$window.removeEventListener("focus",this.focusEventListener),this.focusEventListener=void 0)},o.prototype.registerFocusEventListener=function(){var e=this;this.focusEventListener=function(t){e.checkMfaStatus()},this.$timeout(function(){e.$window.addEventListener("focus",e.focusEventListener)})},o.prototype.checkMfaStatus=function(){this.StorageService.getItem("LOCAL",n)===this.AuthSessionService.getSessionId()&&this.$window.location.reload()},o.prototype.setMfaForOtherTabs=function(){this.AuthSessionService.isUserInLocalStorage(this.username)&&(this.StorageService.removeItem("LOCAL",n),this.StorageService.setItem("LOCAL",n,this.AuthSessionService.getSessionId()))},o.prototype.changeFactor=function(){this.nextFactor.id!==this.activeFactor.id&&this.selectFactor(this.nextFactor),this.substate="FORM"},o.prototype.chooseOtherFactor=function(){this.form.$setPristine(),this.challengeResponse=null,this.nextFactor=this.activeFactor,this.substate="CHOOSE-OTHER-METHOD"},o.prototype.validationError=function(){this.form.challengeResponse.$setValidity("validationResult",!1)},o.prototype.selectFactor=function(t){void 0!==this.activeFactor&&t.id===this.activeFactor.id||((this.activeFactor=t).isSms()?(this.sendSMScode(),this.icon="ziv:verification-sms",this.codeLabel="AUTH.LOGIN.EXTRAFACTOR.FORM.SMS.LABEL"):t.isTotp()?(this.icon="ziv:verification-app",this.codeLabel="AUTH.LOGIN.EXTRAFACTOR.FORM.TOTP.LABEL"):this.$log.error("Unexpected factorType",{factorType:t.factorType}))},o.prototype.sendSMScode=function(){var e=this,t=this.AuthSessionService.getAccessToken();void 0===t?(this.$log.info("cannot yet trigger sending SMS, accessToken expired. Refreshing first"),this.LoginService.refresh().then(function(){e.sendSMScode()}).catch(function(t){e.$log.info("refreshing accessToken for MFA sendSMScode failed",{error:t})})):this.MultifactorService.validateFactor(t,this.activeFactor.id).then(function(){e.$log.debug("SMS sent")},function(t){e.$log.warn("Error response after triggering multifactor SMS",{error:t}),e.substate="ERROR",e.error="Unexpected error occurred"})},o.prototype.goToLoginDestination=function(){var t;if(!this.LoginService.getNewWebappDestination())return t=this.LoginService.getLoginDestination(),this.LoginService.clearLoginDestination(),this.$state.go(t.stateName,t.stateParams,{location:"replace"});this.$state.go("redirect-to-new-webapp",{location:"replace"})},o.prototype.trustDevice=function(){var e=this;return!1===this.trustedDevice?this.$q.resolve():this.LoginService.trustDevice().catch(function(t){e.$log.error("Could not trust device",{error:t})})},e.ExtraFactorController=o,e.ExtraFactorControllerModule=i.module("auth.login.ExtraFactorController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(32),i(11),i(8),i(75)],e=function(t,e,i,n,o,s,S){function r(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m){var v,g=this,t=(this.$http=t,this.$log=e,this.$mdDialog=i,this.$q=n,this.$scope=o,this.$state=s,this.$timeout=r,this.$translate=a,this.$window=c,this.AccessRightGrantService=l,this.AuthSessionService=u,this.LoginService=p,this.MessengerService=d,this.StorageService=h,this.$rootScope=f,this.error=!1,this.expiration=S.LONG_SESSION_EXPIRATION,this.expirationDays=S.LONG_SESSION_EXPIRATION/60/60/24,this.formValues={},this.isMobileApp=!1,this.submittingForm=!1,m.params),e=t.username;this.formValues.username=null!=(i=null!=e?e:t.recipient)?i:t.email,this.isMobileApp&&(v=new URL("/api/"),this.signupUrl=v.origin+"/signup"),this.$rootScope.$on("profile-fetched",function(t,e){var i;"personal"!==e.profile.accountType||"drafts.edit"===(e=p.getTempLoginDestination()).stateName&&null!=(i=e.stateParams)&&i.conversationStarterUuid||("conversations.open"===e.stateName?p.setNewWebappDestination("mail/open/"+e.stateParams.shareId+"?beta=1"):p.setNewWebappDestination("mail/label/inbox?beta=1"),g.$state.go("redirect-to-new-webapp",{location:"replace"}))}),this.$scope.$watch(function(){return g.formValues.username},function(t){null!=t&&""!==t&&g.$timeout(function(){g.checkAddressForSaml(t)},50,!1)}),this.isMobileApp&&(v=new URL("/api/"),this.signupUrl=v.origin+"/signup")}Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$http","$log","$mdDialog","$q","$scope","$state","$timeout","$translate","$window","AccessRightGrantService","AuthSessionService","LoginService","MessengerService","StorageService","$rootScope","$uiRouterGlobals"],r.prototype.submitForm=function(){var e=this;this.form.$invalid||(this.error=!1,this.formValues.rememberMe?this.LoginService.setRememberMe(!0):this.LoginService.setRememberMe(!1),this.submittingForm=!0,this.logoutOtherUser().then(function(t){t?e.LoginService.login(e.formValues.username,e.formValues.password).then(function(t){return e.loginSuccess(t)}).catch(function(t){return e.loginFailed(t)}):e.submittingForm=!1}))},r.prototype.logoutOtherUser=function(){var t=this.StorageService.getItem("LOCAL","auth.session");return null!==t&&t.username!==this.formValues.username?(t=this.$mdDialog.confirm().textContent(this.$translate.instant("AUTH.LOGIN.DIALOG-LOGOUT-OTHER.EXPLANATION",{otherUser:t.username})).hasBackdrop(!0).ok(this.$translate.instant("AUTH.LOGIN.DIALOG-LOGOUT-OTHER.CONFIRM")).cancel(this.$translate.instant("MAIN.CANCEL")),this.$mdDialog.show(t).then(function(){return!0}).catch(function(){return!1})):this.$q.resolve(!0)},r.prototype.loginSuccess=function(t){this.AccessRightGrantService.clear(),this.AuthSessionService.hasScope(o.Scopes.FACTORAUTHENTICATOR)&&this.AuthSessionService.getScopes().length<=2?this.$state.go("login-extra-factor"):this.AuthSessionService.hasScope(o.Scopes.CHANGEPASSWORD)&&this.AuthSessionService.getScopes().length<=2?this.$state.go("login-forced-password-change",{oldPassword:this.formValues.password}):this.LoginService.getNewWebappDestination()?this.$state.go("redirect-to-new-webapp",{location:"replace"}):this.LoginService.handleLoginResult(t)},r.prototype.loginFailed=function(t){this.submittingForm=!1,t.status===s.HTTP_UNAUTHORIZED?!1===this.LoginService.check401Response(t.data)&&(this.error=".ERRORS.CREDENTIALS"):0!==t.status&&(this.error=".ERRORS.BADREQUEST")},r.prototype.checkAddressForSaml=function(i){var n=this,t=(void 0!==this.abortSsoCheck&&(this.abortSsoCheck(),this.abortSsoCheck=void 0),this.$q(function(t){n.abortSsoCheck=t}));this.$http.get("/api/sso/saml",{authenticationRequired:!1,params:{email_address:i},timeout:t}).then(function(e){e.data.forceRedirect?(n.storeSsoTargetUsername(i),n.openRedirectUrl(e.data.redirectUrl)):n.$translate(["AUTH.LOGIN.SSO.CONFIRM.TEXT","AUTH.LOGIN.SSO.CONFIRM.SAML","AUTH.LOGIN.SSO.CONFIRM.PASSWORD"]).then(function(t){n.MessengerService.confirm(t["AUTH.LOGIN.SSO.CONFIRM.TEXT"],"",{},t["AUTH.LOGIN.SSO.CONFIRM.SAML"],t["AUTH.LOGIN.SSO.CONFIRM.PASSWORD"],!1).then(function(){n.storeSsoTargetUsername(i),n.openRedirectUrl(e.data.redirectUrl)},function(){n.$window.document.getElementById("password").focus()})})}).catch(function(t){t.status!==s.HTTP_NOT_FOUND&&n.$log.error("Unexpected error checking /sso/saml",{error:t})})},r.prototype.openRedirectUrl=function(t){this.StorageService.setItem("SESSION",n.SSO_IDP_URL_STORAGE_KEY,t),this.$window.location.href=t},r.prototype.storeSsoTargetUsername=function(t){this.StorageService.setItem("SESSION",n.SSO_TARGET_USERNAME_STORAGE_KEY,t)},e.LoginController=r,e.LoginControllerModule=i.module("auth.login.LoginController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AccessRightGrant=function(t){this.accessRights=[],this.accessRights=t.accessRights||[],this.token=t.token}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(74)],e=function(t,e,i){function n(t,e){this.counters={files:0,messages:0,unread:0},this.isSelected=!1,this.customLabels=[],void 0!==t&&(this.id=t.id,this.specialId=t.specialId,this.counters=t.counters,this.created=t.created,this.displayAsChat=t.displayAsChat,this.readMarker=t.readMarker,this.sendNotifications=t.sendNotifications,this.sendNotificationsDefault=t.sendNotificationsDefault,this.lastMessage=t.lastMessage,this.labelIdList=t.labels,this.participants=t.participants.map(function(t){return new i.Participant(t)}).sort(function(t,e){return t.fullNameOrEmail().localeCompare(e.fullNameOrEmail())}),this.subject=t.subject||null,this.share=t.share||null,this.createdDate=new Date(this.created),this.lastMessageDate=new Date(this.lastMessage),this.readMarkerDate=new Date(this.readMarker),void 0!==e)&&this.updateLabelCollection(e)}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype.summarizeParticipants=function(e,t){void 0===t&&(t=3);var i=this.participants.filter(function(t){return t.email!==e.email}).map(function(t){return t.fullNameOrEmail()}),n=(i=0===i.length?this.participants.map(function(t){return t.fullNameOrEmail()}):i).slice(0,t).join(", ");return i.length>t&&(n+="... + "+(i.length-t)),n},n.prototype.updateLabelCollection=function(t){var e=this,i=t.sysLabels.filter(function(t){return-1<e.labelIdList.indexOf(t.id)});1===i.length?this.systemLabel=i[0]:0===i.length&&0<t.sysLabels.length&&(this.systemLabel=t.sysLabels[0]),this.customLabels=t.userLabels.filter(function(t){return-1<e.labelIdList.indexOf(t.id)})},n.prototype.removeLabelById=function(e){this.labelIdList=this.labelIdList.filter(function(t){return t!==e})},e.Conversation=n}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(t){void 0!==t&&(this.createdDate=new Date(t.created),this.originator=t.originator,this.subject=t.subject,this.eventType=t.eventType,"removed"===this.eventType)&&this.originator===this.subject&&(this.eventType="left")}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return["event",this.createdDate.getTime(),this.eventType,this.originator,this.subject].join("-")},enumerable:!0,configurable:!0}),e.ConversationEvent=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Label=function(t){void 0!==t&&(this.counter=t.counter,this.id=t.id,this.isSystemLabel=t.isSystemLabel,this.labelColor=t.labelColor,this.name=this.isSystemLabel?t.name.toLowerCase():t.name)}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=["inbox","archive","trash"];function n(t){this.sysLabels=[],this.userLabels=[],this.sysLabels=t.filter(function(t){return!0===t.isSystemLabel}),this.userLabels=t.filter(function(t){return!1===t.isSystemLabel}),this.sortCollection()}n.prototype.sortCollection=function(){this.sysLabels.sort(this.sysLabelSorter),this.userLabels.sort(function(t,e){return t.name.localeCompare(e.name)})},n.prototype.sysLabelSorter=function(t,e){return i.indexOf(t.name)>i.indexOf(e.name)?1:-1},n.prototype.getAll=function(){return this.sysLabels.concat(this.userLabels)},n.prototype.add=function(t){this.userLabels.push(t),this.sortCollection()},n.prototype.update=function(e,i){this.userLabels=this.userLabels.map(function(t){return t.id===e&&(t.name=i.name,t.labelColor=i.color),t}),this.sortCollection()},n.prototype.remove=function(e){this.userLabels=this.userLabels.filter(function(t){return t.id!==e}),this.sortCollection()},e.LabelCollection=n}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(42)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.LabelColors=((e={})[i.COLOR_CLOVER_GREEN]=[i.COLOR_MINT_GREEN],e[i.COLOR_TANGERINE_YELLOW]=[i.COLOR_LIGHT_YELLOW],e[i.COLOR_CARROT_ORANGE]=[i.COLOR_APRICOT_ORANGE],e[i.COLOR_LAVA_RED]=[i.COLOR_COTTON_PINK],e[i.COLOR_INDIGO_PURPLE]=[i.COLOR_LAVANDER_PURPLE],e[i.COLOR_HOT_MAGENDA]=[i.COLOR_LIGHT_MAGENDA],e[i.COLOR_RICK_GOLD]=[i.COLOR_LIGHT_GOLD],e[i.COLOR_SLATE_GREY]=[i.COLOR_FOG_GREY],e[i.COLOR_INK_BLACK]=[i.COLOR_SILVER_GREY],e)}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){function i(){}Object.defineProperty(e,"__esModule",{value:!0}),i.Updated="labels:updated",i.Deleted="labels:deleted",e.LabelEvents=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(t){this.accessRights=[],this.accessRights=t.accessRights,this.accessRight=t.accessRights[0],this.conversationCreatorAccountUuid=t.conversationCreatorAccountUuid,this.conversationId=t.conversationId,this.id=t.id}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.setAccessRightGrant=function(t){this.accessRightGrant=t},i.prototype.getAccessRightType=function(){return this.accessRight.accessType},i.prototype.getChallengeInformation=function(){return this.accessRight.challengeInformation},i.prototype.isAccessGranted=function(){return void 0!==this.accessRightGrant&&this.accessRights.length===this.accessRightGrant.accessRights.length},i.prototype.isEmailAccessRight=function(){return"email"===this.getAccessRightType()},i.prototype.isGeneratedCodeAccessRight=function(){return"generatedCode"===this.getAccessRightType()},i.prototype.isSmsAccessRight=function(){return"sms"===this.getAccessRightType()},i.prototype.isPasswordAccessRight=function(){return"password"===this.getAccessRightType()},i.prototype.isZivverAccessRight=function(){return"zivver"===this.getAccessRightType()},e.Share=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),(e=e.SystemLabel||(e.SystemLabel={})).INBOX="INBOX",e.ARCHIVE="ARCHIVE",e.TRASH="TRASH"}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.BusinessRule=function(t){this.allowEnabled=t.allowEnabled,this.blocking=t.blocking,this.businessRuleId=t.businessRuleId,this.category=t.category,this.description=t.description,this.displayName=t.displayName,this.enabled=t.enabled,this.id=t.id,this.violationLevel=t.violationLevel}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(){}Object.defineProperty(e,"__esModule",{value:!0}),i.RecipientsInvalid="client::recipients:invalid",i.MaxFiles="client::files:maxfiles",i.FileSize="client::files:filesize",i.UploadFailed="client::files:uploadfailed",e.ClientViolationTypes=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(9),i(77),i(119),i(121),i(122)],e=function(t,e,i,n,o,s,r){function a(t){this._contentType="text/html",this._recipients=[],this.files=[],this.draftType="plain",this.filesTooMany=[],this.isModified=!1,this.isUploading=!1,this.isValidating=!1,this.isSaving=!1,this.isSending=!1,this.isSelected=!1,this.validation=new o.ValidationStatus,void 0!==t&&(this._body=t.body,this._contentType=t.contentType,this._subject=t.subject,this._recipients=t.recipients.map(function(t){return new n.Recipient(t)}),this.id=t.id,this.createdDate=new Date(t.created),this.draftType=t.draftType,this.files=t.files.map(function(t){return new r.DraftAttachment(t)}),this.messageDefinitionId=t.messageDefinitionId,this.modifiedDate=new Date(t.modified),this.scheduledExpiration=t.scheduledExpiration,this.readOnlyToRecipient=t.readOnlyToRecipient,t.quote instanceof s.DraftQuote?this.quote=t.quote:void 0!==t.quote&&(this.quote=new s.DraftQuote(t.quote)))}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(a.prototype,"body",{get:function(){return this._body||""},set:function(t){this._body=t,this.isModified=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"subject",{get:function(){return this._subject},set:function(t){this._subject=t,this.isModified=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"contentType",{get:function(){return this._contentType},set:function(t){this._contentType=t,this.isModified=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"recipients",{get:function(){return this._recipients},set:function(t){this._recipients=t,this.isModified=!0},enumerable:!0,configurable:!0}),a.prototype.addAttachment=function(t){this.files.push(t),this.isModified=!0},a.prototype.removeAttachment=function(e){var t=this.files.length;this.files=this.files.filter(function(t){return t.id!==e.id}),this.validation=this.validation.removeViolationsForFile(e.fileslotId),this.isModified=t!==this.files.length||this.isModified},a.prototype.isPlain=function(){return"plain"===this.draftType},a.prototype.isForward=function(){return"forward"===this.draftType},a.prototype.isReply=function(){return"reply"===this.draftType},a.prototype.toRequestEntity=function(){return{id:this.id,body:this.sanitizeDraftBody(),contentType:this.contentType,creatorType:"webapp",draftType:this.draftType,files:this.files.map(function(t){return t.fileslotId}),messageDefinitionId:this.messageDefinitionId,recipients:this.recipients.filter(function(t){return t.emailIsValid}).map(function(t){return t.toRequestEntity()}),scheduledExpiration:this.scheduledExpiration,subject:this.subject}},a.prototype.getFilenameById=function(e){var t=i.__spreadArrays(this.files,this.filesTooMany).filter(function(t){return t.id===e});return t.length?t.shift().name:e},a.prototype.summarizeRecipients=function(e,t){void 0===t&&(t=3);var i=this.recipients.filter(function(t){return t.email!==e.email}).filter(function(t){return!0===t.emailIsValid}).map(function(t){return t.fullNameOrEmail()}),n=i.slice(0,t).join(", ");return i.length>t&&(n+="... + "+(i.length-t)),n},a.prototype.sanitizeDraftBody=function(){var t=this.body.indexOf('<div id="conversation-reply-messages-textarea"'),e=this.body;return 0<t&&(e=(e=(e=(e=this.body.substring(0,t)).replace("<div><br><br><br></div>","")).replace("<div><br></div><div><br><br></div>","")).replace("<div><br><br></div>","")),this.switchImgSource(e)},a.prototype.switchImgSource=function(t){if("text/html"!==this.contentType)return t;var e=document.createElement("div");e.innerHTML=t;for(var i=0,n=[].slice.call(e.querySelectorAll("img"));i<n.length;i++){var o=n[i];o.title&&(o.src=o.title,o.removeAttribute("title"))}return e.innerHTML},a.prototype.hasBodyContent=function(){var t,e=this.body.indexOf('<div id="conversation-reply-messages-textarea"'),e=(0<e&&((t=document.createElement("div")).innerHTML=this.body.substring(0,e),t.innerHTML=t.innerHTML.replace("<div><br><br><br></div>",""),t.innerHTML=t.innerHTML.replace("<div><br></div><div><br><br></div>","")),"text/html"===this.contentType?this.body.indexOf("<div><br><br> --"):this.body.indexOf("\n\n--"));return 0<=e&&(void 0===t?(t=document.createElement("div")).innerHTML=this.body.substring(0,e).replace("<div><br></div>",""):t.innerHTML=t.innerHTML.substring(0,e).replace("<div><br></div>","")),void 0===t&&0<(null==(e=this.body)?void 0:e.length)||0<(null==t?void 0:t.innerHTML.replace(/\s/g,"").length)},e.Draft=a}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.FinalizeResult=function(t){this.conversation=t.conversation}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(){}Object.defineProperty(e,"__esModule",{value:!0}),i.error="violation-error",i.success="violation-success",i.okay="violation-okay",i.suggestion="violation-suggestion",i.unknown="violation-unknown",i.validating="violation-validating",i.warning="violation-warning",e.ViolationClassNames=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e){t.exports=function(){return new Worker("/assets/v2/workers/linkify.worker.js")}},function(t,e,i){t.exports=i.p+"assets/v2/img/blank.d89746.gif"},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.InviteInfo=function(t){this.fullName=null,this.inviteMessage=null,this.inviterFullName=null,this.inviterOrganisation=null,void 0!==t&&(this.email=t.email,this.eligible=t.eligible,this.expireDate=t.expireDate,this.fullName=t.fullName||null,this.inviteMessage=t.inviteMessage||null,this.inviterEmail=t.inviterEmail,this.inviterFullName=t.inviterFullName||null,this.inviterOrganisation=t.inviterOrganisation||null,this.nickName=t.nickName,this.notificationSend=t.notificationSend,this.status=t.status)}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(78)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationFlow=function(t){this.responses=[],this.allowNormalReply=t.allowNormalReply,this.allowQuote=t.allowQuote,this.allowAddAnyRecipient=t.allowAddAnyRecipient,this.allowedAddRecipients=t.allowedAddRecipients||[],this.specialId=t.specialId,this.responses=t.responses.map(function(t){return new i.MessageDefinition(t)})}}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.OrganizationSpecial=function(t){this.users=[],this.additionalInfo=t.additionalInfo,this.description=t.description,this.id=t.id,this.name=t.name,this.roles=t.roles}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=[i,e,i(37),i(164)],e=function(t,e,i,n){function o(t){this.id=t.id,this.name=t.name,this.status=t.status,this.theme=t.theme,this.description=t.description,this.additionalInfo=t.additionalInfo,this.flowInitiations=void 0!==t.flowInitiations?t.flowInitiations.map(function(t){return new n.FlowInitiation(t)}):[],this.staticImageUrls=i.importSpecialTheme(this.theme).staticImageUrls,this.setStaticImagUrls()}Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.setStaticImagUrls=function(){var e=this;this.flowInitiations=this.flowInitiations.map(function(t){return t.messageDefinition.formDefinition.sections=t.messageDefinition.formDefinition.sections.map(function(t){return t.components=t.components.map(function(t){return"staticImage"===t.componentType&&(t.imgUrl=e.staticImageUrls[t.imgUrl]),t}),t}),t})},e.Special=o}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/themes/telede/theme.css"},function(t,e,i){t.exports=i.p+"assets/v2/themes/teleecg/theme.css"},function(t,e,i){e=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.logoSvg=i(165),e.iconSvg=i(315),e.staticImageUrls={"/assets/themes/telede/intro.svg":i(316)}}.apply(e,[i,e]);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/themes/img/icon.5f7da1.svg"},function(t,e,i){t.exports=i.p+"assets/v2/themes/img/intro.3e9de0.svg"},function(t,e,i){e=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.logoSvg=i(166),e.iconSvg=i(318),e.staticImageUrls={}}.apply(e,[i,e]);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/themes/img/icon.435cd5.svg"},function(t,e,i){i=function(t,e){function i(t){void 0!==t&&(this.id=t.id,this.email=t.email,this.name=t.name,this.role=t.role)}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.toRequestEntity=function(t){var e={name:this.name,message:this.message,role:this.role.id};return!0===(t=void 0!==t&&t)?e.resendInvite=this.resendInvite:e.email=this.email,e},e.SpecialInvite=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){function i(t){this.id=t.id,this.email=t.email,this.name=t.name,this.role=t.role,this.status=t.status}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.getNameOrEmail=function(){return void 0!==this.name?this.name:this.email},e.SpecialUser=i}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.SubscriptionInfo=function(t){var e=this;this.features=new Map,this.plan=t.plan,this.maxAccounts=t.maxAccounts,t.features.forEach(function(t){e.features.set(t,t)})}}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,c){var i=[c,e,c(1),c(32),c(173),c(174),c(175),c(342)],e=function(t,e,i,n,o,s,r){function a(t,e,i,n,o,s,r,a,c,l){var u=this;this.$mdDialog=t,this.$mdMedia=e,this.$translate=i,this.$timeout=n,this.$scope=o,this.$window=s,this.$injector=r,this.name=a,this.steps=c,this.params=l,this.dots=[],this.viewportListeners=[],this.$timeout(function(){u.getContainer()},1e3),this.nameDefault=this.name,this.createWizardController(),this.translateControls(),this.watchForStepUpdates(),this.updateOnViewportChanges()}Object.defineProperty(e,"__esModule",{value:!0}),a.$inject=["$mdDialog","$mdMedia","$translate","$timeout","$scope","$window","$injector","name","steps","params"],a.factory=function(t,e){return{controller:a,locals:{name:t,steps:e.steps,params:e.params},templateUrl:c(343)}},a.prototype.onKeydown=function(t){var e=this.wizardController;13===t&&(e.steps===e.selectedStep+1&&e.completeEnabled&&e.showComplete?e.onComplete():e.nextEnabled&&e.showNext&&e.onNext())},a.prototype.destroy=function(){var e=this;this.$injector.get("WizardService").close(),this.selectedStepWatch(),this.numStepsWatch(),this.viewportListeners.forEach(function(t){return t.apply(e)})},a.prototype.createWizardController=function(){var e=this,t=this.$injector.get("WizardService"),i=this.wizardController=t.createDefaultController();i.steps=this.steps||1,i.nextEnabled=!1,i.restart=function(){e.name=e.nameDefault,void 0!==e.params.wizardError&&delete e.params.wizardError},i.dotsClicked=function(){},i.onCancel=function(t){i.cancelDelegate().then(function(){e.destroy(),e.$mdDialog.cancel(t)})},i.onBack=function(){i.backDelegate().then(function(){})},i.onNext=function(){i.nextDelegate().then(function(){})},i.onComplete=function(){i.completeDelegate().then(function(t){e.destroy(),e.$scope.$broadcast("download:backupCodes"),e.$mdDialog.hide(t)})},i.onSkip=function(){i.skipDelegate().then(function(){})},i.onClose=function(){i.cancelDelegate().then(function(){e.$mdDialog.hide()})}},a.prototype.translateControls=function(){var t,e=this.wizardController.translations;for(t in e)this.wizardController.translations[t]=this.$translate.instant(e[t])},a.prototype.watchForStepUpdates=function(){var t=this,e=this.wizardController;this.selectedStepWatch=this.$scope.$watch(function(){return e.selectedStep},function(){t.updateDots()}),this.numStepsWatch=this.$scope.$watch(function(){return e.steps},function(){t.updateDots()})},a.prototype.updateDots=function(){this.dots=Array(this.wizardController.steps+1).join("d").split("").map(function(t){return"faded"}),this.dots[this.wizardController.selectedStep]="current"},a.prototype.updateOnViewportChanges=function(){var i=this;this.viewportListeners=[n.DeviceService.Events.OrientationChanged].map(function(t){return i.$scope.$on(t,function(t,e){return i.fixOrientationChange(e)})})},a.prototype.fixOrientationChange=function(t){var e=this;"portrait"===t&&this.$timeout(function(){e.container.removeAttribute("style"),e.container.setAttribute("style","top: 0px; height: 100%;")},100)},a.prototype.getContainer=function(){this.container=[].slice.call(this.$window.document.getElementsByClassName("md-dialog-container"))[0]},e.WizardDialog=a,e.WizardDialogModule=i.module("components.wizardDialog",[o.WizardVerificationModule.name,s.WizardBusinessRulesModule.name,r.WizardMfaModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/WizardVerification.c9b65c.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/WizardBusinessRules.8f62ca.html"},function(t,e,r){var i=[r,e,r(1),r(11),r(328)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["MultifactorService","MessengerService","DeviceService","$log","$window","$q"],s.prototype.$onInit=function(){var e=this;this.MultifactorService.setupOtp("totp").then(function(t){e.totpSetup=new n.OtpSetup(t),e.qrCode="data:image/png;base64,"+e.totpSetup.qrcode}),this.control.next=function(){return e.$q.resolve(e.totpSetup)}},s.prototype.copyAuthCode=function(){try{var t=this.$window.document.getElementById("manualAuthCode"),e=document.createRange(),i=this.$window.getSelection();e.selectNodeContents(t),i.removeAllRanges(),i.addRange(e),document.execCommand("copy"),this.MessengerService.toast("mfa-totp-setup.COPIED",{},!0)}catch(t){this.$log.info("mfa-totp-setup :: user tried to copy totp code but command does not exist: "+t)}};var o=s;function s(t,e,i,n,o,s){this.MultifactorService=t,this.MessengerService=e,this.DeviceService=i,this.$log=n,this.$window=o,this.$q=s,this.qrCode=null}e.MfaTotpSetupModule=i.module("components.mfaTotpSetup",[]).component("mfaTotpSetup",{bindings:{control:"=",totpSetup:"<",isSetup:"<"},controller:o,templateUrl:r(329)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/MfaTotpSetup.c15044.html"},function(t,e,a){var i=[a,e,a(1),a(11),a(8)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$scope","$q","$log","MultifactorService"],r.prototype.$onInit=function(){var e=this;this.control.next=function(){var t=e.form.authenticatorCode;return t.$valid?e.MultifactorService.validateOtpSetup("rfc6238_totp",e.authenticatorCode).then(function(){return new n.Multifactor({id:e.totpSetup.id,factorType:"rfc6238_totp"})}).catch(function(t){return t.status===o.HTTP_FORBIDDEN&&(e.MultifactorService.deleteMultifactorToken(),e.form.authenticatorCode.$setValidity("tokenExpired",!1)),t.status===o.HTTP_CONFLICT?e.form.authenticatorCode.$setValidity("otpValidationResult",!1):e.$log.error("MfaTotpValidate::validateCode() unknown error: "+t.toString()),e.$q.reject(t)}):(t.$setDirty(),document.getElementById("authenticatorCode").focus(),e.$q.reject("authenticator code invalid"))}},r.prototype.$postLink=function(){var e=this;this.$scope.$watch(function(){return e.authenticatorCode},function(t){null!==t&&void 0!==e.form&&e.form.authenticatorCode.$setValidity("otpValidationResult",!0)})};var s=r;function r(t,e,i,n){this.$scope=t,this.$q=e,this.$log=i,this.MultifactorService=n}e.MfaTotpValidateModule=i.module("components.mfaTotpValidate",[]).component("mfaTotpValidate",{bindings:{control:"=",totpSetup:"<",isSetup:"<"},controller:s,templateUrl:a(331)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/MfaTotpValidate.21e1fd.html"},function(t,e,a){var i=[a,e,a(1),a(8),a(333)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0});var o="phoneNumber",s=(r.$inject=["$scope","$window","$q","MultifactorService"],r.prototype.$onInit=function(){var e=this;this.control.next=function(){var t=e.form[o];return t.$valid?e.sendCode().then(function(t){return e.$q.resolve(t)}):(t.$setDirty(),e.$window.document.getElementById(o).focus(),e.$q.reject("phone number invalid"))}},r.prototype.$postLink=function(){var t=this;this.$scope.$watch(function(){return t.phoneNumber},function(){t.smsConflict=!1})},r.prototype.sendCode=function(){var e=this;return this.MultifactorService.setupSmsFactor(this.phoneNumber).then(function(t){return{factorId:t.id,phoneNumber:e.phoneNumber}}).catch(function(t){t.status===n.HTTP_FORBIDDEN&&(e.MultifactorService.deleteMultifactorToken(),e.error=!0),t.status===n.HTTP_CONFLICT&&(e.smsConflict=!0)})},r);function r(t,e,i,n){this.$scope=t,this.$window=e,this.$q=i,this.MultifactorService=n,this.error=!1}e.MfaSmsSetup=s,e.MfaSmsSetupModule=i.module("components.MfaSmsSetup",[]).component("mfaSmsSetup",{bindings:{control:"=",phoneNumber:"<",context:"@"},controller:s,templateUrl:a(334)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/MfaSmsSetup.ad74c1.html"},function(t,e,c){var i=[c,e,c(1),c(8),c(11)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0});var s="authcode",r=(a.$inject=["$scope","$log","$window","$q","MultifactorService","MessengerService"],a.prototype.$onInit=function(){var i=this;this.control.next=function(){var e=i.form[s];return e.$valid?i.MultifactorService.validateSmsSetup(i.phoneNumber,i.authcode).then(function(){return new o.Multifactor({id:i.factorId,challengeInformation:i.phoneNumber,factorType:"sms"})}).catch(function(t){return t.status===n.HTTP_FORBIDDEN&&(i.MultifactorService.deleteMultifactorToken(),e.$setDirty(),e.$setValidity("tokenExpired",!1)),t.status===n.HTTP_CONFLICT&&(e.$setDirty(),e.$setValidity("otpValidationResult",!1)),i.$q.reject(t)}):(e.$setDirty(),i.$window.document.getElementById(s).focus(),i.$q.reject("no code entered"))}},a.prototype.$postLink=function(){var e=this;this.$scope.$watch(function(){return e.authcode},function(t){null!==t&&void 0!==e.form&&e.form[s].$setValidity("otpValidationResult",!0)})},a.prototype.reSendCode=function(){var e=this;this.MultifactorService.setupSmsFactor(this.phoneNumber).then(function(t){e.MessengerService.toast("mfa-sms-validate.RESEND.TOAST",{},!0),e.factorId=t.id}).catch(function(t){t.status===n.HTTP_FORBIDDEN&&e.$log.error("RE-sending 2FA code to a phone number but multifactor access token has expired already"),t.status===n.HTTP_CONFLICT&&e.$log.error("RE-sending 2FA code to a phone number that already had 2FA sms set up for it, this should not occur.")})},a);function a(t,e,i,n,o,s){this.$scope=t,this.$log=e,this.$window=i,this.$q=n,this.MultifactorService=o,this.MessengerService=s}e.MfaSmsValidate=r,e.MfaSmsValidateModule=i.module("components.MfaSmsValidate",[]).component("mfaSmsValidate",{bindings:{control:"=",phoneNumber:"<",factorId:"="},controller:r,templateUrl:c(336)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/MfaSmsValidate.537708.html"},function(t,e,r){var i=[r,e,r(1),r(8),r(338)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$http","$log","$scope","$timeout","$injector","MultifactorService","DeviceService"],s.prototype.$onInit=function(){var i=this;this.introText=void 0===this.introText?"SECURITY-SETTINGS":this.introText,this.isDesktop=this.DeviceService.isDesktop(),this.getBackupCodes(),this.$scope.$on("download:backupCodes",function(){i.getDownloadLink().then(function(t){var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("download","backupCodes"),i.DeviceService.simulateMouseClick(e),i.$timeout(function(){e.remove()},1e3)})})},s.prototype.getBackupCodes=function(){this.fetchBackupCodes()},s.prototype.generateBackupCodes=function(){this.fetchBackupCodes(!0)},s.prototype.fetchBackupCodes=function(t){var e=this,t=(void 0===t&&(t=!1),this.loading=!0,this.error=!1,t?this.MultifactorService.generateBackupcodes():this.MultifactorService.getBackupcodes());t.then(function(t){e.codes=t.authcodes,e.generatedAt=new Date(t.creationTime)}),t.catch(function(t){t.status===n.HTTP_FORBIDDEN&&e.MultifactorService.deleteMultifactorToken(),e.$log.warn("Error getting backup codes",{error:t}),e.error=!0}),t.finally(function(){e.loading=!1})},s.prototype.downloadCodes=function(t){var i,n=this;!1===this.canDownload&&(t.preventDefault(),"A"!==(i=t.target).tagName&&(i=i.parentElement),this.getDownloadLink().then(function(t){var e;n.downloadLink=t;try{e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1})}catch(t){(e=document.createEvent("MouseEvent")).initEvent("click",!1,!1,{view:window})}n.$timeout(function(){n.canDownload=!0,i.dispatchEvent(e),n.$timeout(function(){n.canDownload=!1,n.downloadLink=void 0},250,!1)})}))},s.prototype.getDownloadLink=function(){var e=this,t=this.MultifactorService.getMultifactorToken(),i="authentication/multifactor/backupcodes/download",t=this.$http.get("/api/"+i+"?token="+t);return t.catch(function(t){e.$log.warn("<mfa-backup-codes> Error obtaining download_token",{error:t})}),t.then(function(t){return"/api/"+i+"/content?download_token="+t.data.token})};var o=s;function s(t,e,i,n,o,s,r){this.$http=t,this.$log=e,this.$scope=i,this.$timeout=n,this.$injector=o,this.MultifactorService=s,this.DeviceService=r,this.loading=!0,this.error=!1,this.canDownload=!1}e.MfaBackupCodesModule=i.module("components.mfa-backup-codes",[]).component("mfaBackupCodes",{bindings:{introText:"@"},controller:o,templateUrl:r(339)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/MfaBackupCodes.6ee4fb.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/WizardMfa.626fb4.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/WizardDialog.36972e.html"},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t,e){this.$state=t,this.AuthSessionService=e,this.reason=t.params.reason,this.details=t.params.details,this.details.username=this.AuthSessionService.getUsername(),this.translateNs="AUTH.LOGIN-401."+this.reason}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$state","AuthSessionService"],e.LoginErrorController=n,e.LoginErrorControllerModule=i.module("auth.login.LoginErrorController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(32)],e=function(t,e,i,n){function o(t,e,i){this.$window=t,this.$state=e,this.StorageService=i,this.actualUser=e.params.actualUser,this.targetUser=e.params.targetUser,this.idpUrl=e.params.idpUrl;t=new URL(this.idpUrl);this.idpBaseUrl=t.origin,this.idpDomain=t.hostname}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$window","$state","StorageService"],o.prototype.continueAsActualUser=function(){this.StorageService.setItem("SESSION",n.SSO_TARGET_USERNAME_STORAGE_KEY,this.actualUser),this.openRedirectUrl(this.idpUrl)},o.prototype.openRedirectUrl=function(t){this.$window.location.href=t},e.LoginSsoConflictController=o,e.LoginSsoConflictControllerModule=i.module("auth.login.LoginSsoConflictController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(8)],e=function(t,e,i,r){function n(t,e,i,n,o,s,r,a,c,l){var u=this,t=(this.$http=t,this.$log=e,this.$q=i,this.$scope=n,this.$state=o,this.$window=s,this.AuthSessionService=r,this.LoginService=a,this.StorageService=c,this.formValues={},this.subState="LOADING",l.params.token);this.token=t,this.checkAdoption(this.token),this.$scope.$watch(function(){return u.formValues},function(){void 0!==u.form&&u.form.password.$setValidity("validationResult",!0)},!0)}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$http","$log","$q","$scope","$state","$window","AuthSessionService","LoginService","StorageService","$uiRouterGlobals"],n.prototype.submitForm=function(){var e=this;this.submittingForm=!0,this.adoptToken(this.token,this.formValues.password).then(function(t){if(t.status===r.HTTP_OK)return e.login(e.token);t.status===r.HTTP_FORBIDDEN?e.form.password.$setValidity("validationResult",!1):t.status===r.HTTP_GONE?e.setError("GONE"):e.setError()}).catch(function(t){e.setError(),e.$log.warn("Uncaught error submitting SSO form",{error:t})}).finally(function(){e.submittingForm=!1})},n.prototype.checkAdoption=function(e){var i=this,t=this.adoptToken(e);t.then(function(t){if(t.status===r.HTTP_OK)return i.login(e);switch(t.status){case r.HTTP_NOT_FOUND:case r.HTTP_CONFLICT:i.submittingForm=!1,i.subState="FORM",i.username=t.data.email;break;case r.HTTP_GONE:i.setError("GONE");break;default:i.setError()}}),t.catch(function(){i.setError()})},n.prototype.login=function(t){var i=this;return this.LoginService.ssoLogin(t).then(function(t){i.LoginService.getNewWebappDestination()?i.$state.go("redirect-to-new-webapp",{location:"replace"}):i.LoginService.handleLoginResult(t)}).catch(function(t){if(t instanceof Error)return"SSO_TARGET_USER_MISMATCH"===t.name?i.$state.go("login-sso-conflict",t.extras):void i.setError();var e=!1;if(t.status===r.HTTP_UNAUTHORIZED)e=i.LoginService.check401Response(t.data);else if(t.status===r.HTTP_NOT_FOUND&&i.AuthSessionService.isAuthenticated())return i.$state.go("conversations.index");!1===e&&(i.setError(),i.$log.error("Error logging in with SSO",{error:t}))})},n.prototype.adoptToken=function(t,e){var n=this,o={authenticationRequired:!1},s={samlResponseJwt:t};return void 0!==e&&(s.password=e),this.$q(function(e,i){return n.$http.put("/api/sso/saml/adopt_saml_key",s,o).then(function(t){e(t)}).catch(function(t){(-1<[r.HTTP_CONFLICT,r.HTTP_NOT_FOUND,r.HTTP_FORBIDDEN,r.HTTP_GONE].indexOf(t.status)?e:(n.$log.error("Unexpected error in SsoController::adoptToken",{error:t}),i))(t)})})},n.prototype.setError=function(t){void 0===t&&(t="ERROR"),this.subState="ERROR",this.error=t},e.SsoController=n,e.SsoControllerModule=i.module("auth.login.SsoController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t,e,i,n,o){var s=this,r=(this.formSubmitted=!1,n.getUsername()),a=(i.params.username||"").toLowerCase();n.isAuthenticated()&&r!==a&&""!==a?(n.forgetMe(),o.setLoginDestination(e.current.name,i.params),e.go("login",{username:a})):(o=(r=t.document.getElementById("oAuthForm")).querySelectorAll("input[name=client_id]")[0],e=r.querySelectorAll("input[name=zivver_refresh_token]")[0],a=r.querySelectorAll("input[name=redirect_uri]")[0],r.action="/api/authentication/authorize",r.addEventListener("submit",function(){return!0===s.formSubmitted}),a.value=i.params.redirect_uri,o.value=i.params.client_id,e.value=n.getRefreshToken(),r.submit())}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$window","$state","$uiRouterGlobals","AuthSessionService","LoginService"],e.OAuthController=n,e.OAuthControllerModule=i.module("auth.login.OAuthController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(8),r(349)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$scope","$http","$state","$mdDialog","$translate","AuthSessionService","LoginService","PasswordService"],s.prototype.$onInit=function(){var t=this;this.passwords.old=this.oldPassword,this.$scope.$watch(function(){return t.passwords.old},function(){void 0!==t.form&&void 0!==t.form.oldPassword&&t.form.oldPassword.$setValidity("passwordIncorrect",!0)})},s.prototype.updatePassword=function(){var t,e=this;this.passwords.next=this.form.password.$viewValue,this.passwords.old===this.passwords.next?(t=this.$mdDialog.alert().textContent(this.$translate.instant("password-change.NEW-PASSWORD-EQUALS-OLD")).ok(this.$translate.instant("MAIN.OK")),this.$mdDialog.show(t)):(this.sending=!0,this.PasswordService.changePassword(this.passwords.old,this.passwords.next).then(function(){e.AuthSessionService.forgetMe(),e.LoginService.login(e.username,e.passwords.next).then(function(){var t=e.LoginService.getLoginDestination();return e.LoginService.clearLoginDestination(),e.$state.go(t.stateName,t.stateParams,{location:"replace"})}).catch(function(t){e.sending=!1,e.$state.go("login",{username:e.username})})}).catch(function(t){e.sending=!1,t.status===n.HTTP_UNAUTHORIZED?e.form.oldPassword.$setValidity("passwordIncorrect",!1):(t=e.$mdDialog.alert().textContent(e.$translate.instant("password-change.ERRORS.OTHER")).ok(e.$translate.instant("MAIN.OK")),e.$mdDialog.show(t).then(function(){e.AuthSessionService.forgetMe(e.username),e.$state.go("login",{username:e.username},{location:"replace"})}))}))};var o=s;function s(t,e,i,n,o,s,r,a){this.$scope=t,this.$http=e,this.$state=i,this.$mdDialog=n,this.$translate=o,this.AuthSessionService=s,this.LoginService=r,this.PasswordService=a,this.passwords={old:void 0,next:void 0},this.sending=!1,this.username=this.AuthSessionService.getUsernameFromStorage()}e.PasswordChangeModule=i.module("components.passwordChange",[]).component("passwordChange",{bindings:{oldPassword:"<"},controller:o,templateUrl:r(350)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/PasswordChange.85c473.html"},function(t,e,i){},function(t,e){t.exports='<form name=$ctrl.form class=login novalidate ng-submit=$ctrl.submitForm() translate-namespace=AUTH.LOGIN> <h2 class=md-headline data-qa=login-form-title> <translate>.TITLE</translate> </h2> <h3 class=md-subhead> <translate>.SUBTITLE</translate> </h3> <div class=warning ng-show="$ctrl.error !== false" ng-class="{ \'warning-show\' : $ctrl.error !== false }" data-qa=warning-login> <md-icon>warning</md-icon> <translate ng-if="$ctrl.error !== false">{{$ctrl.error}}</translate> </div> <md-input-container class=input-icon-label md-is-error="!$ctrl.form.username.$pristine && $ctrl.form.username.$invalid"> <md-icon class=md-primary>mail</md-icon> <label for=username> <translate>.FORM.EMAIL.LABEL</translate> </label> <input type=email id=username name=username required tabindex=0 md-autofocus md-no-asterisk autocomplete=off ng-model=$ctrl.formValues.username ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }" placeholder=" " data-qa=username /> <div ng-messages=$ctrl.form.username.$error> <div ng-message=required data-qa=required-email translate>.FORM.EMAIL.ERRORS.REQUIRED</div> <div ng-message=email data-qa=invalid-email translate>.FORM.EMAIL.ERRORS.EMAIL</div> </div> </md-input-container> <md-input-container class=input-icon-label md-is-error="$ctrl.form.password.$dirty && $ctrl.form.password.$invalid"> <md-icon class=md-primary>lock</md-icon> <label for=password> <translate>.FORM.PASSWORD.LABEL</translate> </label> <input type=password id=password name=password required ng-model=$ctrl.formValues.password md-no-asterisk placeholder=" " autocomplete=current-password data-qa=password /> <show-password password=password></show-password> </md-input-container> <div class=actions> <md-checkbox ng-model=$ctrl.formValues.rememberMe ng-model-options="{ updateOn: \'default\', debounce: { \'default\': 0 } }" aria-label="Remember me" class=md-primary data-qa=remember-me-checkbox> <translate translate-value-expiration="{{ $ctrl.expirationDays }}">.FORM.REMEMBERME.LABEL</translate> </md-checkbox> <md-button type=submit class="md-raised md-primary" ng-disabled="$ctrl.submittingForm || $ctrl.form.$invalid" data-qa=login-btn> <translate>.FORM.SUBMIT.LABEL</translate> </md-button> </div> <div class=warning ng-show=$ctrl.formValues.rememberMe ng-class="{ \'warning-show\' : $ctrl.formValues.rememberMe }"> <md-icon>warning</md-icon> <translate>.FORM.REMEMBERME.WARNING</translate> </div> <div class=secondary-links> <span class=forgot-password> <a ui-sref="forgot-password({email: $ctrl.formValues.username})" translate>.ACTIONS.FORGOTPASSWORD</a> </span> <span class=signup> <a ui-sref="signup({email: $ctrl.formValues.username})" translate ng-if="$ctrl.isMobileApp !== true"> .ACTIONS.SIGNUP </a> <a href={{$ctrl.signupUrl}} target=_blank translate ng-if="$ctrl.isMobileApp === true"> .ACTIONS.SIGNUP </a> </span> </div> </form> '},function(t,e,i){t.exports=i.p+"assets/v2/tpl/extraFactor.d2a321.html"},function(t,e){t.exports='<div translate-namespace=AUTH.LOGIN.SSO> <div class=loader ng-if="$ctrl.subState === \'LOADING\'"> <md-progress-linear md-mode=query></md-progress-linear> </div> <div ng-if="$ctrl.subState === \'ERROR\'"> <p translate>{{ \'.\' + $ctrl.error }}</p> </div> <form name=$ctrl.form class=login novalidate ng-if="$ctrl.subState === \'FORM\'" ng-submit=$ctrl.submitForm()> <h2 class=md-headline> <translate>.TITLE</translate> </h2> <h3 class=md-subhead> <translate translate-value-username="{{ $ctrl.username }}">.SUBTITLE</translate> </h3> <p class=intro translate> .INTRO </p> <md-input-container class=input-icon-label md-is-error="!$ctrl.form.password.$pristine && $ctrl.form.password.$invalid"> <md-icon class=md-primary>lock</md-icon> <label for=password> <translate>.FORM.PASSWORD.LABEL</translate> </label> <input type=password id=password name=password required ng-model=$ctrl.formValues.password md-no-asterisk placeholder=" "/> <show-password password=password></show-password> <div ng-messages=$ctrl.form.password.$error> <div ng-message=required translate>.FORM.PASSWORD.REQUIRED</div> <div ng-message=validationResult translate>.FORM.PASSWORD.INVALID</div> </div> </md-input-container> <div class=actions> <span flex></span> <md-button type=submit class="md-raised md-primary" ng-disabled="$ctrl.submittingForm || $ctrl.form.$invalid"> <translate>.ACTIONS.SUBMIT</translate> </md-button> </div> </form> </div> '},function(t,e,i){t.exports=i.p+"assets/v2/tpl/login-401.03f49c.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/login-sso-conflict.4d4c40.html"},function(t,e){t.exports="<form id=oAuthForm enctype=application/x-www-form-urlencoded method=post> <input type=hidden name=response_type value=code /> <input type=hidden name=client_id /> <input type=hidden name=zivver_refresh_token /> <input type=hidden name=redirect_uri /> </form> "},function(t,e,o){var i=[o,e,o(1),o(359)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),e.LogoutModule=i.module("auth.logout",[n.LogoutControllerModule.name]),e.LogoutModule.config(["$stateProvider",function(t){t.state("logout",{parent:"_auth_layout",controller:n.LogoutController,controllerAs:"$ctrl",templateUrl:o(360),data:{authorizationRequired:!1},params:{serverLogout:!0,message:"DEFAULT"}})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(11)],e=function(t,e,i,c){function n(t,e,i,n,o,s,r){var a=this,t=(this.$window=t,this.$state=e,n.params),e=t.message,n=t.serverLogout,t=(this.message=e,s.getAccessToken());s.forgetMe(),n&&void 0!==t&&r.logout(t),i.$broadcast(c.AuthEvents.logoutSuccess),o.$on("$destroy",function(){a.goToLogin()})}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$window","$state","$rootScope","$uiRouterGlobals","$scope","AuthSessionService","LoginService"],n.prototype.goToLogin=function(){this.$window.location.href="/login"},e.LogoutController=n,e.LogoutControllerModule=i.module("auth.logout.LogoutController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/index.81a2e9.html"},function(t,e,i){},function(t,e,i){i=[i,e,i(1),i(363)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$scope","$timeout"],o.prototype.$onInit=function(){var t=this;this.$timeout(function(){t.field=document.getElementById(t.$scope.password)},0)},o.prototype.toggleVisibility=function(){this.isVisible=!this.isVisible,this.isVisible?this.field.setAttribute("type","text"):this.field.setAttribute("type","password")};var n=o;function o(t,e){this.$scope=t,this.$timeout=e,this.isVisible=!1}e.ShowPasswordDirectiveModule=i.module("common.directive.ShowPasswordDirective",[]).directive("showPassword",function(){return{restrict:"E",template:'\n\t\t\t\t<div class="show-password">\n\t\t\t\t\t<md-icon\n\t\t\t\t\t\ttabindex="-1"\n\t\t\t\t\t\tclass="input-icon"\n\t\t\t\t\t\tng-click="$ctrl.toggleVisibility()"\n\t\t\t\t\t\tng-show="$ctrl.isVisible === true"\n\t\t\t\t\t>\n\t\t\t\t\t\tvisibility_off\n\t\t\t\t\t</md-icon>\n\t\t\t\t\t<md-icon\n\t\t\t\t\t\ttabindex="-1"\n\t\t\t\t\t\tclass="input-icon"\n\t\t\t\t\t\tng-click="$ctrl.toggleVisibility()"\n\t\t\t\t\t\tng-show="$ctrl.isVisible === false"\n\t\t\t\t\t>\n\t\t\t\t\t\tvisibility\n\t\t\t\t\t</md-icon>\n\t\t\t\t</div>\n\t\t\t\t',scope:{password:"@"},controller:n,controllerAs:"$ctrl"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,a){var i=[a,e,a(1),a(365),a(366),a(370),a(371)],e=function(t,e,i,n,o,s){function r(t){return t.forgetMe()}r.$inject=["AuthSessionService"],Object.defineProperty(e,"__esModule",{value:!0}),e.SignupModule=i.module("auth.signup",[n.SignupControllerModule.name,o.CreateControllerModule.name,s.InviteControllerModule.name]),e.SignupModule.config(["$stateProvider",function(t){t.state({abstract:!0,parent:"_auth_layout",name:"_signup",url:"/signup",template:"<ui-view></ui-view>"}),t.state({parent:"_signup",name:"signup_old_url_redirect",url:"",onEnter:["$state",function(t){return t.go("signup")}]}),t.state({parent:"_signup",name:"signup",url:"/freemium?{email}",templateUrl:a(372),controller:n.SignupController,controllerAs:"$ctrl",data:{title:"Sign up for Zivver, for free"},params:{email:{squash:!0,default:void 0}},resolve:{logoutExistingUser:r,captchaConfig:["$http",function(t){return t.get("/assets/v2/captcha-config.json").then(function(t){return t.data})}]}}),t.state({parent:"_signup",name:"signup-create",url:"/create/:token?theme",params:{theme:{squash:!0,default:void 0}},templateUrl:a(373),controller:o.CreateController,controllerAs:"$ctrl",resolve:{logoutExistingUser:r}}),t.state({parent:"_signup",name:"signup-invite",url:"/invite/:token?theme",params:{theme:{squash:!0,default:void 0}},templateUrl:a(374),controller:s.InviteController,controllerAs:"$ctrl"})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t,e,i,n,o,s,r){this.captchaConfig=t,this.$translate=e,this.$log=i,this.SignupService=n,this.$timeout=o,this.$window=s,this.formValues={},this.error=!1,this.errorTitle=!1,this.isHuman=!1,this.submittingForm=!1,this.substate=a.FORM;t=r.params.email;this.formValues.email=t,this.lang=null==(e=this.$translate.use())?void 0:e.toLowerCase()}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["captchaConfig","$translate","$log","SignupService","$timeout","$window","$uiRouterGlobals"],n.prototype.$onInit=function(){this.initCaptcha()},n.prototype.showCaptcha=function(){return this.captchaConfig.enabled},n.prototype.submitForm=function(){var t,e=this;this.form.$invalid||(this.submittingForm=!0,this.SignupService.signup(this.formValues.email,null!=(t=this.captchaToken)?t:"").then(function(){e.substate=a.DONE}).catch(function(t){e.errorTitle=".FAILED.TITLE",e.error=".FAILED.DESCRIPTION",e.substate=a.ERROR,e.$log.warn("Error signing up",{error:t})}))},n.prototype.isDisabled=function(){return this.submittingForm||this.form.$invalid||this.captchaConfig.enabled&&!0!==this.isHuman},n.prototype.initCaptcha=function(){var e=this;!1!==this.captchaConfig.enabled&&this.$timeout(function(t){e.renderTurnstile()})},n.prototype.renderTurnstile=function(){var e=this;if(null==this.$window.turnstile)this.$log.error("Turnstile library not loaded");else{var t=document.getElementById("signup-turnstile");if(t)try{this.$window.turnstile.render(t,{sitekey:this.captchaConfig.sitekey,callback:function(t){e.$timeout(function(){e.onCaptchaSuccess(t)})},size:"flexible",theme:"light"})}catch(t){this.$log.error("Error rendering Turnstile",t)}else this.$log.error("Turnstile container not found")}},n.prototype.onCaptchaSuccess=function(t){this.captchaToken=t,this.isHuman=!0},e.SignupController=n,o.FORM="FORM",o.DONE="DONE",o.ERROR="ERROR";var a=o;function o(){}e.SignupControllerModule=i.module("auth.signup.SignupController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(8),i(367),i(73)],e=function(t,e,i,r,n,o){Object.defineProperty(e,"__esModule",{value:!0}),s.LOADING="LOADING",s.CREATE="CREATE",s.CANCEL="CANCEL",s.DONE="DONE",s.ERROR="ERROR";var a=s;function s(){}function c(t,e,i,n,o){var s=this,t=(this.$log=t,this.$state=e,this.$uiRouterGlobals=i,this.SignupService=n,this.LoginService=o,this.loading=!0,this.error=null,this.substate=a.LOADING,this.formValues={},this.email=null,this.$uiRouterGlobals.params.token);this.token=t,n.validate(this.token).then(function(t){s.email=t.emailAddress,s.subscription=t.subscription,s.substate=a.CREATE}).catch(function(t){t.status===r.HTTP_GONE?s.error=".ERRORS.TOKENEXPIRED":(s.$log.error("Error validating signup",{error:t}),s.error=".ERRORS.GENERICERROR"),s.substate=a.ERROR}).finally(function(){s.loading=!1})}c.$inject=["$log","$state","$uiRouterGlobals","SignupService","LoginService"],c.prototype.submitCreate=function(){this.form.$invalid||this.activate()},c.prototype.activate=function(){var e=this,t=(this.substate=a.LOADING,this.formValues.password=this.form.password.$viewValue,{accountType:"personal",fullName:this.formValues.fullName,password:this.formValues.password,token:this.token});this.SignupService.create(t).then(function(){e.substate=a.DONE}).catch(function(t){e.substate=a.ERROR,t.status===r.HTTP_GONE?e.error="AUTH.SIGNUP.CREATE.ERRORS.TOKENEXPIRED":(e.$log.warn("signup failed",{error:t}),e.error="AUTH.SIGNUP.CREATE.ERRORS.GENERICERROR")})},c.prototype.login=function(){var t=this,e=this.LoginService.login(this.email,this.formValues.password),i={};void 0!==this.$uiRouterGlobals.params.theme&&(i={afterComplete:{stateName:"settings.specials",stateParams:{}}}),e.then(function(){return t.$state.go("conversations.label",i,{location:"replace"})})},c.prototype.signup=function(){this.$state.go("signup")},c.prototype.change=function(){this.substate=a.CREATE,this.formValues.tos=!1},c.prototype.passwordStrongAndMatch=function(){return void 0!==this.form.password.$strength&&this.form.password.$viewValue===this.form.passwordAgain.$viewValue&&2<this.form.password.$strength.score},e.CreateController=c,e.CreateControllerModule=i.module("auth.signup.CreateController",[n.PasswordComponentModule.name,o.PasswordStrengthDirectiveModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(73),r(368)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$scope"],s.prototype.$onInit=function(){var t=this;this.$scope.$watchGroup([function(){return t.password},function(){return t.passwordAgain},function(){return t.form.password.$strength.score}],function(){t.comparePasswordFields()})},s.prototype.comparePasswordFields=function(){this.form.passwordAgain.$setValidity("validator",void 0===this.password||this.password===this.passwordAgain),this.passwordStrongAndMatch=void 0!==this.password&&this.password===this.passwordAgain&&this.form.password.$valid};var o=s;function s(t){this.$scope=t,this.passwordStrongAndMatch=!1}e.PasswordComponent=o,e.PasswordComponentModule=i.module("components.passwordComponent",[n.PasswordStrengthDirectiveModule.name]).component("passwordComponent",{bindings:{form:"=",icons:"<",reset:"<",password:"<",passwordAgain:"<"},controller:o,templateUrl:r(369)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/PasswordComponent.d02d4b.html"},function(t,e,i){i=[i,e,i(1),i(8)],e=function(t,e,i,c){function n(t,e,i,n,o,s,r){var a=this,t=(this.$log=t,this.$state=e,this.$uiRouterGlobals=i,this.AuthSessionService=n,this.SignupService=o,this.StorageService=s,this.LoginService=r,this.token=null,this.inviteInfo=null,this.formValues={},this.submittingForm=!1,this.state="LOADING",this.$uiRouterGlobals.params.token);if(this.token=t,null===this.token)throw Error("Token is missing");this.SignupService.getInvite(this.token).then(function(t){if(a.inviteInfo=t,"validRegistered"===a.inviteInfo.eligible){if(a.AuthSessionService.getUsername()!==a.inviteInfo.email)return a.AuthSessionService.forgetMe(),a.LoginService.setLoginDestination(a.$state.current.name,a.$state.params),a.$state.go("login",{username:a.inviteInfo.email});a.joinOrganization()}else a.AuthSessionService.forgetMe(),a.state="FORM"},function(t){a.state="ERROR",t.status===c.HTTP_CONFLICT?(a.inviteInfo=t.data,"invalidBecauseAdmin"===a.inviteInfo.eligible?a.error=".ERRORS.ADMIN":"invalidBecauseDomainClaimed"===a.inviteInfo.eligible?a.error=".ERRORS.DOMAIN-CLAIMED":"invalidBecauseFunctional"===a.inviteInfo.eligible?a.error=".ERRORS.FUNCTIONAL":"invalidBecauseSuspended"===a.inviteInfo.eligible?a.error=".ERRORS.SUSPENDED":"invalidAlreadyMember"===a.inviteInfo.eligible?a.error=".ERRORS.ALREADY-MEMBER":"invalidOrganizationCantInvite"===a.inviteInfo.eligible?a.error=".ERRORS.CANNOT-INVITE":"invalidTokenExpired"===a.inviteInfo.eligible&&(a.error=".ERRORS.TOKEN-EXPIRED")):a.error=".ERRORS.GENERIC"})}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$log","$state","$uiRouterGlobals","AuthSessionService","SignupService","StorageService","LoginService"],n.prototype.joinOrganization=function(){var e=this;this.SignupService.joinOrganization(this.token).then(function(){e.state="JOINED",e.error=void 0,e.AuthSessionService.forgetMe()},function(t){e.state="ERROR",t.status===c.HTTP_GONE?e.error=".ERRORS.GONE":(e.error=".ERRORS.GENERIC",e.$log.error("Signup failed",{error:t}))})},n.prototype.submitForm=function(){var e=this,t=(this.submittingForm=!0,(null===this.inviteInfo.fullName?this.formValues:this.inviteInfo).fullName);this.formValues.password=this.form.password.$viewValue,this.SignupService.acceptInvite(this.token,this.formValues.password,t).then(function(){e.state="DONE"}).catch(function(t){e.state="ERROR",t.status===c.HTTP_GONE?e.error=".ERRORS.GONE":t.status===c.HTTP_NOT_FOUND?e.error=".ERRORS.UNKNOWN":(e.error=".ERRORS.GENERIC",e.$log.error("Signup failed",{error:t}))}).finally(function(){e.submittingForm=!1})},n.prototype.ok=function(){var t=this,e=this.LoginService.login(this.inviteInfo.email,this.formValues.password),i={};void 0!==this.$uiRouterGlobals.params.theme&&(i={afterComplete:{stateName:"settings.specials",stateParams:{}}}),e.then(function(){return t.$state.go("conversations.label",i,{location:"replace"})})},n.prototype.goToLogin=function(){return this.$state.go("login",{username:this.inviteInfo.email})},n.prototype.passwordStrongAndMatch=function(){return void 0!==this.form.password.$strength&&this.form.password.$viewValue===this.form.passwordAgain.$viewValue&&2<this.form.password.$strength.score},e.InviteController=n,e.InviteControllerModule=i.module("auth.signup.InviteController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/signup.f73d0c.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/create.197b59.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/invite.68b5ad.html"},function(t,e,a){var i=[a,e,a(1),a(376),a(377),a(379),a(79)],e=function(t,e,i,n,o,s){function r(t){return t.forgetMe()}r.$inject=["AuthSessionService"],Object.defineProperty(e,"__esModule",{value:!0}),e.SubscriptionModule=i.module("auth.subscription",[n.SubscriptionControllerModule.name,o.SubscriptionUpgradeControllerModule.name,s.SubscriptionCreateControllerModule.name]),e.SubscriptionModule.config(["$stateProvider",function(t){t.state({abstract:!0,parent:"_auth_layout",name:"_subscription",url:"/subscription",template:"<ui-view></ui-view>"}),t.state({parent:"_subscription",name:"subscription-create",url:"/create/{token:token}?theme",params:{theme:{squash:!0,default:void 0}},templateUrl:a(381),controller:s.SubscriptionCreateController,controllerAs:"$ctrl",resolve:{logoutExistingUser:r}}),t.state({parent:"_subscription",name:"validate",url:"/validate/{subscriptionId}?email",templateUrl:a(382),controller:n.SubscriptionValidateController,controllerAs:"$ctrl",data:{title:"Validate Subscription"},params:{subscriptionId:{squash:!0,default:void 0},email:{squash:!0,default:void 0}}}),t.state({parent:"_subscription",name:"upgrade",url:"/upgrade/{subscriptionId}",templateUrl:a(383),controller:o.SubscriptionUpgradeController,controllerAs:"$ctrl",data:{authorizationRequired:!0,title:"Upgrade Subscription"},params:{subscriptionId:{squash:!0,default:void 0}}})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(8),i(79)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0});var o="AUTH.SUBSCRIPTION";function s(t,e,i){this.$log=t,this.SignupService=e,this.submittingForm=!1;t=i.params,e=t.subscriptionId,i=t.email;this.subscriptionId=e,this.email=i,this.validateSubscription(this.subscriptionId)}s.$inject=["$log","SignupService","$uiRouterGlobals"],s.prototype.validateSubscription=function(t){var e=this;this.subState="CHECKING",this.SignupService.verifySubscriptionId(t).then(function(){e.subState="DONE"}).catch(function(t){switch(e.subState="ERROR",e.$log.warn("Error validating subscription",{error:t}),t.status){case n.HTTP_NOT_FOUND:e.errorMessage=o+".ERROR.NOT-FOUND";break;case n.HTTP_GONE:e.errorMessage=o+".ERROR.NOT-AVAILABLE";break;default:e.errorMessage=o+".ERROR.GENERIC"}})},s.prototype.submitForm=function(){var e=this;this.form.$invalid||(this.subState="LOADING",this.SignupService.validateSubscription(this.subscriptionId,this.email).then(function(){e.subState="SUCCESS"}).catch(function(t){e.subState="ERROR",e.$log.warn("Error validating subscription",{error:t})}))},e.SubscriptionValidateController=s,e.SubscriptionControllerModule=i.module("auth.subscription.SubscriptionController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(8),i(176),i(79)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0});var s="AUTH.SUBSCRIPTION";function r(t,e,i,n,o,s,r,a){this.$log=t,this.$state=e,this.$translate=i,this.AuthSessionService=n,this.LoginService=o,this.SettingsService=s,this.SignupService=r,this.submittingForm=!1;t=a.params.subscriptionId;this.subscriptionId=t,this.subState="FORM"}r.$inject=["$log","$state","$translate","AuthSessionService","LoginService","SettingsService","SignupService","$uiRouterGlobals"],r.prototype.submitForm=function(){var e=this;this.form.$invalid||(this.submittingForm=!0,this.SignupService.existingAccountSubscriptionUpgrade(this.organizationName,this.subscriptionId).then(function(){e.SettingsService.updateSetting("USER","webapp.showAdminTutorial","true").then(function(){e.subState="SUCCESS",e.submittingForm=!1,o.ShowConfetti()})}).catch(function(t){switch(e.subState="ERROR",e.submittingForm=!1,e.$log.warn("Error upgrading subscription",{error:t}),t.status){case n.HTTP_BAD_REQUEST:e.errorMessage=s+".ERROR.BAD-REQUEST";break;case n.HTTP_NOT_FOUND:e.errorMessage=s+".ERROR.NOT-FOUND";break;case n.HTTP_GONE:e.errorMessage=s+".ERROR.NOT-AVAILABLE";break;default:e.errorMessage=s+".ERROR.GENERIC"}}))},r.prototype.logout=function(){this.submittingForm=!0,this.LoginService.setLoginDestination("organization.overview"),this.AuthSessionService.forgetMe(),this.$state.go("login",{username:this.email},{location:"replace"})},e.SubscriptionUpgradeController=r,e.SubscriptionUpgradeControllerModule=i.module("auth.subscription.UpgradeSubscriptionController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,i){i=[i,e,i(1),i(8),i(176),i(380)],e=function(t,e,i,l,n){Object.defineProperty(e,"__esModule",{value:!0});var u="AUTH.SUBSCRIPTION";function o(t,e,i,n,o,s,r,a){var c=this,t=(this.$location=t,this.$log=e,this.$state=i,this.$translate=n,this.$uiRouterGlobals=o,this.LoginService=s,this.SettingsService=r,this.SignupService=a,this.formValues={},this.email=void 0,this.error=null,this.submittingForm=!1,this.$uiRouterGlobals.params.token);this.token=t,this.subState="LOADING",this.SignupService.validateCreateSubscription(this.token).then(function(t){c.email=t.emailAddress,c.subState="CREATE"}).catch(function(t){switch(c.subState="ERROR",c.$log.error("Error validating signup",{error:t}),t.status){case l.HTTP_CONFLICT:c.error=u+".ERROR.DUPLICATE";break;case l.HTTP_GONE:c.error=u+".ERROR.TOKEN-EXPIRED";break;default:c.error=u+".ERROR.GENERIC"}})}o.$inject=["$location","$log","$state","$translate","$uiRouterGlobals","LoginService","SettingsService","SignupService"],o.prototype.submitCreate=function(){var e=this,t=(this.subState="LOADING",this.formValues.password=this.form.password.$viewValue,this.submittingForm=!0,{fullName:this.formValues.fullName,language:this.$translate.use(),organizationName:this.formValues.organizationName,password:this.formValues.password,token:this.token});this.SignupService.createAccountWithSubscription(t).then(function(){e.subState="DONE",e.submittingForm=!1,n.ShowConfetti()}).catch(function(t){e.subState="ERROR",e.$log.error("Creating account with subscription failed: ",{error:t}),t.status===l.HTTP_GONE?e.error=u+".ERROR.TOKEN-EXPIRED":e.error=u+".ERROR.GENERIC"})},o.prototype.login=function(){var e=this;this.submittingForm=!0,this.LoginService.login(this.email,this.formValues.password).then(function(){e.SettingsService.updateSetting("USER","webapp.showAdminTutorial","true").then(function(){return e.$state.go("organization.overview",{},{location:"replace"})}).catch(function(t){e.submittingForm=!1,e.$log.error("failed to update key",{error:t})})})},e.SubscriptionCreateController=o,e.SubscriptionCreateControllerModule=i.module("auth.subscription.SubscriptionCreateController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/subscription-create.600572.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/subscription-validate.36b3e7.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/subscription-upgrade.24b564.html"},function(t,e,i){},function(t,e){t.exports='<span> <md-tooltip ng-if=":: $ctrl.withApi">API {{ $ctrl.api }}, BACKEND: {{ $ctrl.backend }}, BACKEND-API {{ $ctrl.backendApi }}</md-tooltip> v{{:: $ctrl.app }} </span> '},function(t,e,i){},function(t,e){t.exports="<div class=auth translate-cloak> <header> <h1><a ui-sref=login>Zivver</a></h1> </header> <main ui-view></main> <footer> <version></version> </footer> </div> <language-select></language-select> "},function(t,e,y){var i=[y,e,y(1),y(389),y(390),y(391),y(392),y(11),y(393),y(516),y(623),y(626),y(629),y(634),y(637),y(638),y(639),y(640),y(641),y(642)],e=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v,g,S){function $(e,i,t){return t.get().then(function(t){var e=i.use();return t.language!==e&&i.use(t.language),t}).catch(function(t){e.error("Could not resolve profile in app/index",{error:t})})}$.$inject=["$log","$translate","ProfileService"],Object.defineProperty(e,"__esModule",{value:!0}),e.AppModule=i.module("zivver.app",[n.AppControllerModule.name,u.BackButtonModule.name,c.ConversationsModule.name,l.DraftsModule.name,p.ProfileMenuModule.name,o.RedirectToNewWebappControllerModule.name,s.RefreshControllerModule.name,r.PodControllerModule.name,d.SidenavModule.name,h.SupportMenuModule.name,f.ClickOutsideDirectiveModule.name]),e.AppModule.config(["$stateProvider","hotkeysProvider",function(e,t){t.includeCheatSheet=!1,e.state({abstract:!0,name:"_app_layout",resolve:{profile:$},data:{authorizationRequired:!0,scopesRequired:[a.Scopes.LIMITEDACCESS],bodyClass:"app"},template:y(643),controller:n.AppController,controllerAs:"$app"}),e.state({abstract:!0,name:"_verify_layout",resolve:{profile:$},data:{authorizationRequired:!0,scopesRequired:[a.Scopes.LIMITEDACCESS],bodyClass:"app"},template:y(644),controller:n.AppController,controllerAs:"$app"}),e.state({name:"login-refresh",controller:s.RefreshController,controllerAs:"$ctrl",template:y(645),data:{authorizationRequired:!1,bodyClass:"app login-refresh",doNotTrack:!0}}),e.state({name:"redirect-to-new-webapp",controller:o.RedirectToNewWebappController,data:{bodyClass:"app login-refresh",doNotTrack:!0},params:{url:""}}),e.state({name:"pod",url:"/pod?conversation&message&recipient",controller:r.PodController,templateUrl:y(646),controllerAs:"$ctrl",data:{authorizationRequired:!0},onEnter:["$state","$transition$",function(t,e){if(void 0===e.params().conversation||void 0===e.params().message)return t.go("conversations.label",{label:"inbox"})}]}),e.state({name:"authentication.admin",url:"/authentication/admin",data:{isMigrated:!0,migratedUrl:"/admin/password"}}),m.ContactsRoutes.forEach(function(t){return e.state(t)}),g.SettingsRoutes.forEach(function(t){return e.state(t)}),S.SpecialsRoutes.forEach(function(t){return e.state(t)}),v.OrganizationRoutes.forEach(function(t){return e.state(t)})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(11),i(37),i(51)],e=function(t,e,$,y,n,b){function i(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m){var v=this,g=(this.$rootScope=t,this.$scope=e,this.$window=i,this.$timeout=n,this.$cacheFactory=o,this.$state=s,this.$transitions=r,this.$mdDialog=a,this.$translate=c,this.AuthSessionService=l,this.LoggerService=u,this.LoginService=p,this.DeviceService=d,this.WebSocketService=h,this.StorageService=f,this.profile=m,this.isFreemium=!1,this.isGuest=!0,this.isMobile=!1,this.lang=this.$translate.use().toLowerCase(),this.isTablet=!1,this.isGuest=this.profile.isGuest(),this.isFreemium=this.profile.isPersonal(),this.isMobile=this.DeviceService.isMobile(),this.isTablet=this.DeviceService.isTablet(),this.operatingSystem=this.DeviceService.getOS(),this.LoggerService.addToDefaultContext("accountType",m.accountType),void 0!==m.uuid&&(b.setUserId(m.uuid),this.AuthSessionService.isDelegate()&&b.setDelegationContext(l.getMainAccountId(),m.uuid),this.LoggerService.addToDefaultContext("accountUuid",m.uuid)),this.$scope.$on("profile-updated",function(t,e){v.profile.language!==e.profile.language&&v.$translate.use(e.profile.language),v.profile=e.profile}),this.$rootScope.$on(y.AuthEvents.logoutSuccess,function(){v.loggedOutReset()}),this.$rootScope.$on("$translateChangeSuccess",function(){v.lang=v.$translate.use().toLowerCase()}),this.$scope.$on(y.AuthEvents.notAuthenticated,function(t,e){g(),v.onNotAuthenticated(e.data)})),S=this.$scope.$on(y.AuthEvents.logoutOtherTab,function(t,e){S(),v.onLogoutOtherTab(e.username)});this.$transitions.onStart({},function(t){$.element(document.body).hasClass("md-dialog-is-showing")&&(t.abort(),a.cancel())}),this.$timeout(function(){v.openWebsocket()},1e3)}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$rootScope","$scope","$window","$timeout","$cacheFactory","$state","$transitions","$mdDialog","$translate","AuthSessionService","LoggerService","LoginService","DeviceService","WebSocketService","StorageService","profile"],i.prototype.filesDropped=function(t){this.$rootScope.$broadcast("files-dropped",t)},i.prototype.toggleSidenav=function(t){void 0!==t&&(t.stopPropagation(),t.preventDefault()),this.$rootScope.$broadcast("sidenav:toggle")},i.prototype.loggedOutReset=function(){for(var t=0,e=Object.keys(this.$cacheFactory.info());t<e.length;t++){var i=e[t];if("templates"===i)break;this.$cacheFactory.get(i).removeAll()}this.LoggerService.resetDefaultContext(),this.WebSocketService.close(),b.clearUserContext(),this.StorageService.removeItem("SESSION","auth.username"),this.profile.isGuest()&&n.unloadTheme()},i.prototype.onNotAuthenticated=function(t){var e=this;this.LoginService.check401Response(t)||(this.AuthSessionService.hasRefreshToken()?(t=this.$mdDialog.alert().textContent(this.$translate.instant("APP.ERROR.LOGGED-OUT-TEMPORARILY")).hasBackdrop(!0).ok(this.$translate.instant("APP.REFRESH")),this.$mdDialog.show(t).then(function(){e.LoginService.setLoginDestination(e.$state.current.name,e.$state.params),e.$state.go("login-refresh")})):(this.$rootScope.$broadcast(y.AuthEvents.logoutSuccess),this.LoginService.setLoginDestination(this.$state.current.name,this.$state.params),this.$state.go("login",{},{location:"replace"})))},i.prototype.onLogoutOtherTab=function(t){var e=this,i=this.$mdDialog.confirm().textContent(this.$translate.instant("APP.ERROR.LOGGED-OUT-OTHER-TAB")).hasBackdrop(!0).ok(this.$translate.instant("APP.RE-LOGIN")).cancel(this.$translate.instant("MAIN.CANCEL"));this.$rootScope.$broadcast(y.AuthEvents.logoutSuccess),this.AuthSessionService.forgetMe(t),this.$mdDialog.show(i).then(function(){e.LoginService.setLoginDestination(e.$state.current.name,e.$state.params),e.$state.go("login",{username:e.isGuest?null:t},{location:"replace"})},function(){e.$window.location.href="https://www.zivver.com"})},i.prototype.openWebsocket=function(){var t,e=this;"visible"===this.$window.document.visibilityState&&this.WebSocketService.open(),this.$window.document.addEventListener("visibilitychange",function(){void 0!==t&&e.$timeout.cancel(t),t=e.$timeout(function(){t=void 0,"visible"===e.$window.document.visibilityState?e.WebSocketService.open():e.WebSocketService.close()},6e4,!1)})},e.AppController=i,e.AppControllerModule=$.module("zivver.app.AppController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t,e,i,n,o){this.$window=t,this.$uiRouterGlobals=e,this.LoginService=i,this.AuthSessionService=n,this.StorageService=o;i=this.LoginService.getNewWebappDestination()||e.params.url&&e.params.url.trim()||"mail/label/inbox?beta=1",n=this.AuthSessionService.getRefreshToken(),o=this.AuthSessionService.getUsername();this.StorageService.setItem("SESSION","auth.username",o),this.StorageService.setItem("SESSION","session::"+o,n),this.LoginService.clearNewWebappLoginDestination(),t.open(i,"_self")}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$window","$uiRouterGlobals","LoginService","AuthSessionService","StorageService"],e.RedirectToNewWebappController=n,e.RedirectToNewWebappControllerModule=i.module("app.RedirectToNewWebappController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(11),i(8)],e=function(t,e,i,n,o){function s(t,e,i,n,o,s,r,a,c,l,u){this.$rootScope=t,this.$scope=e,this.$log=i,this.$timeout=n,this.$location=o,this.$q=s,this.$state=r,this.$mdDialog=a,this.$translate=c,this.LoginService=l,this.AuthSessionService=u,this.authenticationError=!1,this.connectionError=!1,this.attempts=0,this.refresh()}Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$rootScope","$scope","$log","$timeout","$location","$q","$state","$mdDialog","$translate","LoginService","AuthSessionService"],s.prototype.tryAgain=function(){var t=this;this.attempts=0,this.connectionError=!1,this.$rootScope.$broadcast("api::connectionErrorsReset"),this.$rootScope.$applyAsync(function(){return t.refresh()})},s.prototype.loginAgain=function(){var t=this.AuthSessionService.getUsernameFromStorage();this.LoginService.clearLoginDestination(),this.AuthSessionService.forgetMe(),this.$rootScope.$broadcast(n.AuthEvents.logoutSuccess),this.$state.go("login",{username:t})},s.prototype.refresh=function(){var e=this,t=this.LoginService.refresh(!0).then(function(t){return e.attempts=0,e.$timeout.cancel(e.refreshTimeout),t}).catch(function(t){e.refreshFailed(t)}),i=this.$q(function(t){e.$timeout(t,500)});this.$q.all([t,i]).then(function(t){t=t[0];e.$scope.$$destroyed||(e.LoginService.getNewWebappDestination()&&"/authentication/admin"!==e.$location.url()?e.$state.go("redirect-to-new-webapp",{location:"replace"}):e.LoginService.handleLoginResult(t))})},s.prototype.refreshFailed=function(t){var e=this;this.$scope.$$destroyed||(t.status===o.HTTP_UNAUTHORIZED?this.LoginService.check401Response(t.data)||(this.authenticationError=!0):(t=5e3+5e3*this.attempts,this.$log.debug("Refreshing failed, trying again in "+t/1e3+" seconds"),this.attempts++,5<this.attempts?this.connectionError=!0:this.refreshTimeout=this.$timeout(function(){e.$scope.$$destroyed||e.refresh()},t,!1)))},e.RefreshController=s,e.RefreshControllerModule=i.module("app.RefreshController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(8)],e=function(t,e,i,n){function o(t,e,i){this.$log=t,this.ConversationsService=e,this.loading=!0,this.error=!1;t=i.params,e=t.conversation,i=t.message,t=t.recipient;this.conversation=e,this.message=i,this.recipient=t,this.getProofOfDelivery()}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","ConversationsService","$uiRouterGlobals"],o.prototype.getProofOfDelivery=function(){var e=this;this.ConversationsService.getProofOfDeliveryReport(this.conversation,this.message,this.recipient).then(function(t){window.open(t+"&content_disposition=false","_self")}).catch(function(t){t.status===n.HTTP_NOT_FOUND?e.errorMessage=".NOT-FOUND":e.errorMessage=".GENERAL",e.error=!0,e.$log.error("Could not get proof of delivery download token",{error:t})}).finally(function(){e.loading=!1})},e.PodController=o,e.PodControllerModule=i.module("app.PodController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,f){var i=[f,e,f(1),f(394),f(406),f(437),f(443),f(497),f(13),f(24),f(503),f(231),f(510)],e=function(t,e,i,n,o,s,r,a,c,l,u,p){function d(e,i,t,n,o,s){var r,a;return s.isGuest()||(r=t.params().shareId,!1===o.hasToken(r))?e.resolve(!1):(a=o.getToken(r),n.verifyAdoptShareToken(a).then(function(t){return!1===t.isAdoptable?e.resolve(!1):n.adoptShareToken(a).then(function(){return o.removeToken(r),e.resolve(!0)}).catch(function(t){return o.removeToken(r),i.error("adopting shareToken failed",{error:t}),e.resolve(!1)})}).catch(function(t){return o.removeToken(r),i.error("verifying shareToken failed",{error:t}),e.resolve(!1)}))}function h(n,t,o,s,r){return t(function(e){var t=new c.Label,i=(t.name="inbox",t.isSystemLabel=!0,new c.LabelCollection([t]));if(r.isGuest())return e(i);o.getLabels().then(function(t){s.setLabels(t),e(t)}).catch(function(t){n.warn("Error getting labels",{error:t}),e(i)})})}d.$inject=["$q","$log","$transition$","KeysService","ShareTokenService","profile"],h.$inject=["$log","$q","LabelService","ConversationsService","profile"],Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationsModule=i.module("app.conversations",[l.AvatarModule.name,u.ConversationErrorModule.name,n.IndexControllerModule.name,a.ListControllerModule.name,o.OpenControllerModule.name,s.ReplyControllerModule.name,r.ViewControllerModule.name,p.CopyToClipboardTooltipDirectiveModule.name]),e.ConversationsModule.config(["$stateProvider",function(t){t.state({abstract:!0,parent:"_app_layout",name:"conversations",url:"/conversations",data:{title:"Conversations",bodyClass:"app conversations"},resolve:{labelCollection:h,profileProgress:["ProfileService",function(t){return t.progress()}]},views:{"list@_app_layout":{template:f(511),controller:a.ListController,controllerAs:"$ctrl"},"main@_app_layout":{template:"<div class='conversations' layout='row' layout-wrap ui-view></div>"}}}),t.state({name:"conversations.label",url:"/{label}?{keywords}",controller:n.IndexController,controllerAs:"$ctrl",template:f(512),params:{keywords:{squash:!0},label:"inbox"},reloadOnSearch:!1}),t.state({name:"conversations.open",url:"/open/{shareId:uuid}?recipient&showInfo&deliverMessageId",controller:o.OpenController,controllerAs:"$ctrl",template:f(513),resolve:{shareTokenAdopt:d},params:{label:"inbox",deliverMessageId:void 0,recipient:{squash:!0}}}),t.state({name:"conversations.view",url:"/{label}/{conversationId:uuid}?{keywords}",controller:r.ViewController,controllerAs:"$ctrl",template:f(514),params:{label:"inbox",keywords:{squash:!0},showInfo:void 0,deliverMessageId:void 0},reloadOnSearch:!1}),t.state({name:"conversations.reply",url:"/reply/{label}/{conversationId:uuid}",controller:s.ReplyController,controllerAs:"$ctrl",template:f(515),params:{label:"inbox"},onEnter:["$state","$transition$","profileProgress","MessengerService","$translate",function(t,e,i,n,o){!1===i.canSendFromWebapp&&(i=o.instant("DRAFTS.ALERT-SENDING-PROHIBITED"),n.alert(i),e.abort())}],resolve:{profileProgress:["ProfileService",function(t){return t.progress()}]}}),t.state({name:"conversations.error",params:{conversation:void 0,share:void 0,error:"UNKNOWN",recovery:void 0,label:"inbox"},component:"conversationError"}),t.state({name:"conversations.index",url:"/index",onEnter:["$state",function(t){return t.go("conversations.label",{label:"inbox"})}]}),t.state({name:"conversations.view-from-mail",url:"/view/{conversationId:uuid}",params:{reply:null},onEnter:["$state","$transition$",function(t,e){return t.go("conversations.view",{conversationId:e.params().conversationId})}]})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(177)],e=function(t,e,i,n){function o(t,e,i){this.profileProgress=t,this.$mdMedia=e;t=i.params.label;this.label=t,"archive"===this.label?this.placeholderItem="archive":"trash"===this.label?this.placeholderItem="trash":this.placeholderItem="conversations"}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["profileProgress","$mdMedia","$uiRouterGlobals"],e.IndexController=o,e.IndexControllerModule=i.module("app.conversations.IndexController",[n.PlaceholderModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/img/app_icon.e6f97f.svg"},function(t,e){t.exports='<div ng-if="$ctrl.contexts.length > 1"> <a ng-click=$ctrl.toggleDropdown() class=dropdown-toggle> <img ng-src="{{ $ctrl.current.icon }}" width=40 height=40 /> <md-icon>{{ $ctrl.open ? \'arrow_drop_up\' : \'arrow_drop_down\' }}</md-icon> </a> <div class=dropdown ng-if="$ctrl.open === true"> <ul> <li ng-repeat="$item in $ctrl.contexts track by $index" ng-click=$ctrl.activateContext($item) ng-class="{ active : $item.specialId === $ctrl.current.specialId }"> <img ng-src="{{:: $item.icon }}" width=40 height=40 /> <span>{{:: $item.name }}</span> </li> </ul> </div> </div> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/img/archive.33377b.svg"},function(t,e,i){t.exports=i.p+"assets/v2/img/contacts.335659.svg"},function(t,e,i){t.exports=i.p+"assets/v2/img/conversations.4d9365.svg"},function(t,e,i){t.exports=i.p+"assets/v2/img/drafts.0e28ae.svg"},function(t,e,i){t.exports=i.p+"assets/v2/img/extra-security.e98714.svg"},function(t,e,i){t.exports=i.p+"assets/v2/img/trash.bbc227.svg"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/Placeholder.4a2941.html"},function(t,e,i){i=[i,e,i(9),i(1),i(33),i(8),i(407),i(178),i(184)],e=function(t,e,r,i,n,a,o,s,c){function l(t,e,i,n,o,s,r,a){var c=this,t=(this.$log=t,this.$state=e,this.$uiRouterGlobals=i,this.AppSwitcherService=n,this.ConversationsService=o,this.DelegateAccountService=s,this.LoginService=r,this.profile=a,this.loading=!0,this.$uiRouterGlobals.params),l=t.shareId,u=t.label;this.label=u,void 0!==l&&this.ConversationsService.getShare(l).then(function(t){if(c.share=t,!a.isGuest()||!1!==t.isAccessGranted())return c.ConversationsService.get(t.conversationId).then(function(t){c.conversation=t})}).then(function(){var t,e;void 0!==c.conversation&&c.conversation.specialId!==c.AppSwitcherService.getContext().specialId?(c.$log.debug("conversation special id does not match context's. Switching"),t="conversations.open",e={shareId:l,label:u},void 0===c.conversation.specialId?c.AppSwitcherService.switchContext(c.AppSwitcherService.getDefaultContext(),t,e):c.AppSwitcherService.switchToSpecialId(c.conversation.specialId,t,e).then(function(t){t||(c.$log.warn("Switching to special failed, context not found or active",{specialId:c.conversation.specialId}),c.share.isAccessGranted()?c.goToConversationView():c.loading=!1)})):c.share.isAccessGranted()?c.goToConversationView():c.loading=!1}).catch(function(t){return c.handleShareErrors(t)})}Object.defineProperty(e,"__esModule",{value:!0}),l.$inject=["$log","$state","$uiRouterGlobals","AppSwitcherService","ConversationsService","DelegateAccountService","LoginService","profile"],l.prototype.handleShareErrors=function(t){var e,i,n,o,s=this;this.share={id:this.$uiRouterGlobals.params.shareId},t.status===a.HTTP_FORBIDDEN?(n=void 0,"notAdopted"===(i=(e=t.data).reason)?n="ADOPT":"notDecryptable"===i&&(n="DECRYPT"),this.goToErrorState(n,e.recovery)):t.status===a.HTTP_NOT_FOUND?void 0!==(o=this.$uiRouterGlobals.params.recipient)&&o!==this.profile.email?this.DelegateAccountService.getDelegations().then(function(t){var t=t.reduce(function(t,e){return r.__spreadArrays(t,e.aliases,[e.email])},[]),e=t.filter(function(t){return t===o})[0];void 0!==e?(s.delegate=e,s.loading=!1):(s.goToErrorState("NOT_FOUND"),s.$log.info("recipient was not in list of delegates",{recipient:o,delegates:t}))}).catch(function(t){s.goToErrorState("NOT_FOUND"),s.$log.error("error getting delegations in OpenController",{error:t})}):this.goToErrorState("NOT_FOUND"):(this.goToErrorState("UNKNOWN"),this.$log.error("unexpected error in conversations/OpenController",{error:t}))},l.prototype.goToConversationView=function(){var t=void 0!==this.conversation.systemLabel?this.conversation.systemLabel.name:"inbox";-1===this.conversation.customLabels.map(function(t){return t.name}).concat([t]).indexOf(this.label)&&(this.label=t),this.$state.go("conversations.view",r.__assign(r.__assign({},this.$uiRouterGlobals.params),{conversationId:this.share.conversationId,label:this.label}),{location:"replace"})},l.prototype.goToErrorState=function(t,e){this.$state.go("conversations.error",{conversation:this.conversation||this.$uiRouterGlobals.params.conversation,share:this.share||this.$uiRouterGlobals.params.share,error:t=void 0===t?"UNKNOWN":t,recovery:e},{location:!1})},e.OpenController=l,e.OpenControllerModule=i.module("app.conversations.OpenController",[n.AppSwitcherModule.name,o.ConversationForDelegateModule.name,s.ConversationHeaderModule.name,c.ConversationChallengeModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(54),r(408)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$window","$timeout","$state","LoginService","StorageService"],s.prototype.switchToDelegate=function(){var t=this;this.switched=!0,this.LoginService.switchAccount(this.delegate).then(function(){n.locationReload("conversations.open",{shareId:t.shareId,recipient:void 0},t.$window,t.$state,t.StorageService)})};var o=s;function s(t,e,i,n,o){this.$window=t,this.$timeout=e,this.$state=i,this.LoginService=n,this.StorageService=o,this.switched=!1}e.ConversationForDelegateModule=i.module("components.conversationForDelegate",[]).component("conversationForDelegate",{bindings:{delegate:"<",profileEmail:"<",shareId:"<"},controller:o,templateUrl:r(409)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/ConversationForDelegate.3d03cd.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/LabelsDialog.592549.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/Avatar.5a0652.html"},function(t,e){t.exports='<div ng-switch=$ctrl.participants.length> <div class="participants participant-single" ng-switch-when=0> <span></span> </div> <div class="participants participant-single" ng-switch-when=1> <avatar avatar-entity=$ctrl.participants[0] avatar-size=md></avatar> </div> <div class="participants participant-multiple" layout=row layout-align="center center" layout-wrap ng-switch-default> <avatar ng-repeat="participant in $ctrl.participants.slice(0,3)" avatar-entity=participant avatar-size=xs></avatar> <div class=extra-participants ng-if="$ctrl.participants.length > 3"> <span>+{{ $ctrl.participants.length - 3 }}</span> </div> </div> </div> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/WarningDialog.612e6e.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/DraftViolationItem.5005c5.html"},function(t,e,i){},function(t,e){t.exports='<div class=phone-number-container ng-class="{\'phone-input-invalid\': $ctrl.isPhoneInputInvalid()}" translate-namespace=input-phonenumber layout=row layout-align="start center"> <div layout=row layout-margin ng-if="$ctrl.loading === true"> <md-progress-circular md-mode=query md-diameter=20></md-progress-circular> </div> <md-input-container class=country-code ng-if="$ctrl.loading === false"> <md-select id=countryCode name=countryCode ng-model=$ctrl.selectedCountry aria-label="Choose country code" ng-change=$ctrl.changeCountryCode()> <md-option ng-repeat="country in $ctrl.countries" ng-value=country> <div flex layout=row layout-align="space-between center"> <div class="flag flag-{{country.iso.toLowerCase()}}"></div> <div class=country-explicit> <span>{{country.name}}</span> <span class=dark-gray>(+{{country.code}})</span> </div> </div> </md-option> </md-select> </md-input-container> <md-input-container class=phone-number-input flex md-is-error="$ctrl.form.phoneNumber.$dirty && $ctrl.form.phoneNumber.$invalid"> <label translate> {{ \'.PLACEHOLDER\' + ($ctrl.required ? \'\' : \'-OPTIONAL\') }} </label> <input type=tel id=phoneNumber name=phoneNumber aria-label="Enter phone number" ng-required=$ctrl.required autocomplete=off ng-model=$ctrl.phoneNumber ng-model-options="{ updateOn: \'default blur paste\', debounce: { \'default\': 1000, \'blur\': 0, \'paste\' : 0 } }" md-autofocus="$ctrl.autofocus === true" md-no-asterisk data-qa=phoneNumber> <div ng-messages=$ctrl.form.phoneNumber.$error class=error-message> <div ng-message=required translate>.ERROR.REQUIRED</div> <div ng-message=cannotReceiveSms translate>.ERROR.CANNOT-RECEIVE-SMS</div> <div ng-message=invalidPhoneNumber translate>.ERROR.INVALID-NUMBER</div> <div ng-message=sameNumber translate>.ERROR.SAME-NUMBER-CONFLICT</div> </div> </md-input-container> </div> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/RecipientDialog.7f5511.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/img/bcc.18652a.svg"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/ParticipantsList.b347d0.html"},function(t,e,c){var i=[c,e,c(1),c(15),c(81),c(24),c(427)],e=function(t,e,i,o,n,s){Object.defineProperty(e,"__esModule",{value:!0}),a.$inject=["$scope","$element","$q","$mdDialog","ContactsService"],a.prototype.$onInit=function(){var t;this.disabled=null!=(t=this.disabled)&&t},a.prototype.setIcon=function(){var t=this.validation.getViolationsForRecipient(this.recipient).map(function(t){return t.violationLevel});this.showIcon=void 0!==this.recipient.accessRightSetup&&"generatedCode"!==this.recipient.accessRightSetup.accessType&&0===t.length||t.some(function(t){return-1===t.indexOf("error")})},a.prototype.showDialog=function(){var e=this,t=new n.RecipientDialog;t.resolve.recipient=function(){return void 0!==e.recipient.verifications?e.$q.resolve(i.copy(e.recipient)):e.ContactsService.get(e.recipient.email).then(function(t){return t.toRecipient()})},t.locals.validation=this.validation,t.locals.violations=this.validation.getViolationsForRecipient(this.recipient),this.$mdDialog.show(t).then(function(t){e.recipient=i.extend(e.recipient,t.recipient),e.setIcon()})},a.prototype.setViolationsClass=function(){var t,e,i,n=this;this.disabled?(this.mdChip.addClass(o.ViolationClassNames.unknown),this.iconStatus="unknown",this.icon="lock"):(Object.keys(o.ViolationClassNames).map(function(t){return n.mdChip.removeClass(o.ViolationClassNames[t])}),e=(t=this.validation.getViolationsForRecipient(this.recipient)).map(function(t){return t.violationLevel}),i=t.filter(function(t){return!0===t.showStopper}),this.validation.validationCompleted&&0===t.length||-1<e.indexOf("suggestion")&&0===i.length?(this.mdChip.addClass(o.ViolationClassNames.okay),this.iconStatus="verified",this.icon="lock"):-1<e.indexOf("error")?(this.mdChip.addClass(o.ViolationClassNames.error),this.iconStatus="error",this.icon="error"):0<i.length||-1<e.indexOf("warning")?(this.mdChip.addClass(o.ViolationClassNames.warning),this.iconStatus="warning",this.icon="error"):(this.mdChip.addClass(o.ViolationClassNames.unknown),this.iconStatus="unknown",this.icon="lock"))};var r=a;function a(t,e,i,n,o){var s=this;this.$scope=t,this.$element=e,this.$q=i,this.$mdDialog=n,this.ContactsService=o,this.icon="lock",this.iconStatus="unknown",this.showIcon=!1,this.mdChip=this.$element.parent().parent().parent(),this.$scope.$watch(function(){return s.validation.violationsUnresolved},function(){s.setViolationsClass(),s.setIcon()})}e.RecipientChipModule=i.module("components.recipientChip",[s.AvatarModule.name,n.RecipientDialogModule.name]).component("recipientChip",{bindings:{recipient:"=",validation:"<",disabled:"<?"},controller:r,templateUrl:c(428),transclude:!0})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/RecipientChip.68291c.html"},function(t,e,i){},function(t,e){t.exports='<div class=recipients-row layout=row layout-align="space-between start" translate-namespace=DRAFTS.EDIT.RECIPIENTS> <label class=recipient-label ng-if=$ctrl.recipientType ng-class="{ \'no-display\' : $ctrl.hideLabel }" translate>{{ \'.\' + $ctrl.recipientType | uppercase }}</label> <md-chips ng-model=$ctrl.typeRecipients ng-change=$ctrl.updateDraftRecipients() class=md-contact-chips ng-class="{\n\t\t\t\'no-button\' : $ctrl.showBcc || $ctrl.hideButton,\n\t\t\t\'label-only\' : !$ctrl.showBcc && !$ctrl.hideLabel && $ctrl.recipientType ===\'bcc\',\n\t\t\t\'chips-only\' : !$ctrl.showBcc && $ctrl.hideLabel\n\t\t}" md-require-match=true md-on-add=$ctrl.onAdd($chip) flex> <md-chip-template> <recipient-chip recipient=$chip validation=$ctrl.validation disabled="$ctrl.autocomplete === false" data-qa=draft-email-recipients></recipient-chip> </md-chip-template> <md-autocomplete data-qa=draft-email-recipients-search md-autofocus=$ctrl.autofocus md-autoselect=true md-delay=300 md-dropdown-items=11 md-escape-options=none md-items="item in $ctrl.searchContacts(term)" md-item-text=item.email md-menu-class=md-contact-chips-suggestions md-min-length=3 md-no-cache=true md-search-text=$ctrl.searchFor ng-if=$ctrl.autocomplete ng-paste=$ctrl.onPaste($event) placeholder="{{\'DRAFTS.EDIT.RECIPIENTS.ADD-RECIPIENT\' | translate }}" ng-class="{ \'no-display\': $ctrl.hideAutocomplete }"> <md-item-template> <div ng-attr-title={{item.email}} class=contact-suggestion layout=row flex=100> <avatar avatar-entity=item avatar-size=md></avatar> <div class=contact-details layout=column layout-align="center start" ng-class="{\n\t\t\t\t\t\t\t\'double-line\': item.fullName !== undefined && item.email !== undefined,\n\t\t\t\t\t\t\t\'single-line\': item.fullName === undefined\n\t\t\t\t\t\t}"> <div ng-if="item.fullName !== undefined" class="contact-name truncate" md-highlight-text=$ctrl.searchFor md-highlight-flags=ig> {{item.fullName}} </div> <div ng-if="item.email !== undefined" class="contact-email truncate" md-highlight-text=$ctrl.searchFor md-highlight-flags=ig> {{item.email}} </div> </div> </div> </md-item-template> </md-autocomplete> </md-chips> <md-button id=bcc-toggle class=md-primary ng-class="{ \'no-display\': $ctrl.hideLabel || $ctrl.hideButton }" ng-click=$ctrl.onShowBcc() ng-if="$ctrl.showBcc === false && $ctrl.recipientType ===\'to\'" data-qa=button-bcc> <translate>.BCC</translate> </md-button> </div> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/ConversationInfo.38e19f.html"},function(t,e,i){},function(t,e){t.exports='<div translate-namespace=conversation-header class=zv-subheader layout=row> <aside class=header flex></aside> <aside class="header middle" layout=row layout-align="space-between center" layout-padding> <back-button hide-gt-sm ng-if=":: $ctrl.profile.isGuest() === false"></back-button> <div hide-gt-sm ng-if=":: $ctrl.profile.isGuest()"></div> <div ng-if=$ctrl.conversation class=title ng-class="{ \'title-disabled\': $ctrl.hasAccess === false }" ng-click=$ctrl.openInfoPane() flex> <h5 class="md-title truncate">{{:: $ctrl.conversation.subject }}</h5> <div layout=row layout-align="space-between center"> <div class=participants-amount ng-class="{\'truncate\': $ctrl.$mdMedia(\'xs\')}" data-qa=participants-amount> <span class=participant-length>{{ $ctrl.conversation.participants.length}}</span> <md-icon class=icon-16>person</md-icon> </div> <div layout=row class=truncate> <span class=participants>{{ $ctrl.participantsInfo }}</span> <span class=all-participants hide>{{ $ctrl.allParticipants }}</span> </div> </div> </div> <div class=actions layout=row layout-align="end center" hide-xs ng-if="$ctrl.actions.length > 0"> <md-button aria-label=Reply ng-repeat="action in $ctrl.actions | limitTo: 1" ng-click=$ctrl[action.onClick]($event); class="md-primary main-action" md-ink-ripple=false ng-class=action.icon> <md-icon ng-if="$ctrl.conversation.participants.length <= 2">reply</md-icon> <md-icon ng-if="$ctrl.conversation.participants.length > 2">reply_all</md-icon> <translate ng-if="$ctrl.conversation.participants.length <= 2">.REPLY</translate> <translate ng-if="$ctrl.conversation.participants.length > 2">.REPLY-TO-ALL</translate> </md-button> <md-menu md-position-mode="target-right target"> <md-button aria-label="More options" class="md-primary action-menu" md-ink-ripple=false ng-click="$ctrl.openActionsMenu($mdMenu, $event)"> <md-icon md-menu-origin>more_vert</md-icon> <translate>.MORE</translate> </md-button> <md-menu-content width=4> <md-menu-item ng-repeat="action in $ctrl.actions" ng-class=action.icon> <md-button ng-click=$ctrl[action.onClick]($event) data-qa="{{ \'ACTION\' + action.label|replace: \'\\\\.\':\'-\' | lowercase}}"> <md-icon>{{ action.icon }}</md-icon> <span translate>{{ action.label }}</span> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> <div class=actions layout=row layout-align="end center" hide-gt-xs ng-if="$ctrl.actions.length > 0"> <md-button aria-label=Reply ng-repeat="action in $ctrl.actions | limitTo: 1" ng-click=$ctrl[action.onClick]($event); class=md-icon-button ng-class=action.icon> <md-tooltip md-delay=500> <translate>{{ action.label }}</translate> </md-tooltip> <md-icon>{{ action.icon }}</md-icon> </md-button> <md-menu md-position-mode="target-right target"> <md-button aria-label="More options" class=md-icon-button ng-click="$ctrl.openActionsMenu($mdMenu, $event)"> <md-icon md-menu-origin>more_vert</md-icon> </md-button> <md-menu-content width=4> <md-menu-item ng-class=action.icon ng-repeat="action in $ctrl.actions track by $index"> <md-button ng-click=$ctrl[action.onClick]($event); class=""> <md-icon>{{ action.icon }}</md-icon> <span translate>{{ action.label }}</span> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> </aside> <aside class=header flex></aside> <sidepane ng-if="$ctrl.showInfoPane === true" on-close=$ctrl.sidePaneClosed()> <pane-title> <translate>.INFO-PANE-TITLE</translate> </pane-title> <pane-content> <conversation-info profile=$ctrl.profile conversation=$ctrl.conversation></conversation-info> </pane-content> </sidepane> </div> '},function(t,e,i){},function(t,e,i){t.exports='<form name=$ctrl.form novalidate autocomplete=off translate-namespace=conversation-challenge> <div ng-if="$ctrl.showEmailVerificationTemplate() === true" ng-switch=$ctrl.emailStep class="challenge email-verification"> <div ng-switch-when=requestCode class="animated-step step-request-code"> <div class=email-intro> <h3 translate>.EMAIL.STEPS.REQUEST.TITLE</h3> </div> <div class=explanation> <span translate translate-value-email="{{ $ctrl.profile.email }}"> .EMAIL.STEPS.REQUEST.EXPLANATION </span> </div> <md-button class="md-raised md-primary" data-qa=send-code-button ng-click=$ctrl.requestEmailCode()> <translate>.EMAIL.ACTIONS.SEND</translate> </md-button> <div class="small-note go-next-step"> <span translate>.EMAIL.STEPS.REQUEST.OWNED</span> <button class=link ng-click=$ctrl.nextStep()> <translate>.EMAIL.ACTIONS.NEXT-STEP</translate> </button> </div> </div> <div ng-switch-when=submitCode class="animated-step step-submit-code"> <div class=email-intro> <h3 translate>.EMAIL.STEPS.SUBMIT.TITLE</h3> </div> <div class=explanation> <span translate translate-values="{subject: $ctrl.conversation.subject, email: $ctrl.profile.email}"> .EMAIL.STEPS.SUBMIT.EXPLANATION </span> </div> <md-input-container class=access-code md-is-error="($ctrl.form.response.$pristine === false && $ctrl.form.response.$invalid) || ($ctrl.isError)"> <label for=response> <translate>.EMAIL.LABEL</translate> </label> <input id=response name=response ng-model=$ctrl.formValues.response ng-attr-type="{{ $ctrl.inputType }}" ng-attr-pattern="{{ $ctrl.inputPattern }}" data-qa=code-response-input required md-no-asterisk> <div ng-messages=$ctrl.form.response.$error data-qa=email-input-error> <div ng-message=required translate>.EMAIL.ERRORS.REQUIRED</div> <div ng-message=pattern translate>.EMAIL.ERRORS.PATTERN</div> <div ng-message=email translate>.EMAIL.ERRORS.INCORRECT</div> </div> </md-input-container> <md-button class="md-raised md-primary" ng-click=$ctrl.validateChallenge() data-qa=email-unlock-button> <translate>.EMAIL.UNLOCK</translate> </md-button> <div class="small-note get-new-code"> <translate>.RESEND-EMAIL.INTRO</translate> <button class=link ng-click=$ctrl.triggerChallenge() ng-class="$ctrl.preventDoubleClick ? \'disabled\' : \'resend\'"> <translate>.RESEND-EMAIL.SEND</translate> </button> </div> </div> </div> <div class="challenge access-code" ng-if="$ctrl.error === false && $ctrl.share.isPasswordAccessRight()"> <div class=challenge-content ng-if="$ctrl.notified === false"> <div class=intro-block ng-if=$ctrl.hasAccessCode> <h3 translate>.ACCESS-CODE.TITLE</h3> <p> <span translate>.ACCESS-CODE.INTRO</span> </p> </div> <div class=intro-block ng-if="$ctrl.hasAccessCode === false"> <h3 translate>.ACCESS-CODE.NOTIFY-TITLE</h3> <p> <span translate>.ACCESS-CODE.NOTIFY-INTRO</span> </p> </div> <div class=content-block> <md-input-container class=access-code ng-if=$ctrl.hasAccessCode md-no-float md-is-error="$ctrl.form.response.$pristine === false && $ctrl.form.response.$invalid" flex> <label for=response translate>.ACCESS-CODE.LABEL</label> <input autofocus md-no-asterisk id=response name=response ng-attr-type="{{ $ctrl.inputType }}" ng-attr-pattern="{{ $ctrl.inputPattern }}" ng-model=$ctrl.formValues.response data-qa=access-code-response-input required/> <div ng-messages=$ctrl.form.response.$error> <div ng-message=password data-qa=incorrect-access-code translate>.ACCESS-CODE.ERROR</div> <div ng-message=required translate>.ACCESS-CODE.REQUIRED</div> </div> </md-input-container> <md-button class="md-raised md-primary" ng-if=$ctrl.hasAccessCode ng-disabled=$ctrl.disableButton() ng-click=$ctrl.validateChallenge() data-qa=unlock-button> <translate>.ACCESS-CODE.UNLOCK</translate> </md-button> <md-button class="md-raised md-primary" ng-click=$ctrl.notifySender() ng-if="$ctrl.hasAccessCode === false" data-qa=button-notify-sender-access> <translate>.ACCESS-CODE.NOTIFY-SENDER</translate> </md-button> <div class=small-note ng-if="$ctrl.hasAccessCode && $ctrl.profile.isGuest()"> <a href=# ng-click="$ctrl.hasAccessCode = false" data-qa=link-doNot-accessCode translate>.ACCESS-CODE.IDK</a> </div> </div> </div> <div class="challenge-content notified" ng-if=$ctrl.notified> <div class=intro-block data-qa=no-accessCode-notified> <span translate>.ACCESS-CODE.NOTIFIED-MESSAGE</span> </div> <img class=notified-image src='+i(185)+' /> </div> </div> <div layout=row layout-fill layout-wrap layout-margin ng-if="$ctrl.error === false && $ctrl.share.isEmailAccessRight() === false && $ctrl.share.isPasswordAccessRight() === false"> <div ng-if="$ctrl.notified === false" ng-class="{ \'centered\' : $ctrl.share.isSmsAccessRight() }"> <p flex=100 ng-if=$ctrl.share.isGeneratedCodeAccessRight()> <translate>.GENERATED-CODE.INTRO</translate> </p> <p flex=100 ng-if=$ctrl.share.isSmsAccessRight()> </p><div ng-if="$ctrl.challengeSent === false && $ctrl.isWrongNumber === false"> <div> <h2 class=md-title layout-align=center data-qa=sms-header> <translate>.SMS.TITLE</translate> </h2> </div> <div> <span translate translate-value-phone="{{ $ctrl.share.getChallengeInformation() }}">.SMS.INTRO</span> </div> </div> <div ng-if="$ctrl.challengeSent === true && $ctrl.share.isSmsAccessRight()"> <div> <h2 class=md-title layout-align=center> <translate>.SMS.SENT-TITLE</translate> </h2> </div> <div> <span translate translate-value-phone="{{ $ctrl.share.getChallengeInformation() }}">.SMS.SENT</span> </div> </div> <div ng-if="$ctrl.isWrongNumber === true"> <div> <h2 class=md-title layout-align=center> <translate>.SMS.WRONG-NUMBER.TITLE</translate> </h2> </div> <div> <span translate translate-value-phone="{{ $ctrl.share.getChallengeInformation() }}">.SMS.WRONG-NUMBER.INTRO</span> </div> </div> <p></p> </div> <div class=notified ng-if="$ctrl.notified === true" flex=100> <h2 class=md-title layout-align=center data-qa=no-sms-notified> <translate>.SMS.WRONG-NUMBER.NOTIFIED.TITLE</translate> </h2> <p> <translate>.SMS.WRONG-NUMBER.NOTIFIED.MESSAGE</translate> </p> <img src='+i(185)+' /> </div> <div ng-if="$ctrl.inProgress === true" flex=100 layout=row layout-sm=column class="md-actions progress"> <p> <md-progress-circular class=md-hue-2 md-diameter=16px></md-progress-circular> <translate ng-if=$ctrl.share.isSmsAccessRight()>.SENDING-SMS</translate> </p> </div> <div flex=100 layout=row ng-if=$ctrl.showMainActions()> <md-input-container md-is-error="$ctrl.form.response.$pristine === false && $ctrl.form.response.$invalid" flex> <label for=response> <translate ng-if=$ctrl.share.isGeneratedCodeAccessRight()>.GENERATED-CODE.LABEL</translate> <translate ng-if=$ctrl.share.isSmsAccessRight()>.SMS.LABEL</translate> </label> <input name=response aria-label="Enter code" ng-model=$ctrl.formValues.response ng-attr-type="{{ $ctrl.inputType }}" ng-attr-pattern="{{ $ctrl.inputPattern }}" required md-no-asterisk placeholder=" " autofocus data-qa=verification-input-code> <div ng-messages=$ctrl.form.response.$error> <div ng-message=generatedCode> <translate>.GENERATED-CODE.ERROR</translate> </div> <div ng-message=sms data-qa=incorrect-sms-code> <translate>.SMS.ERROR</translate> </div> </div> </md-input-container> </div> <div ng-if="$ctrl.notified === false" flex=100 class=md-actions layout=column layout-align="space-between stretch"> <md-button layout-margin class="md-primary md-raised" ng-disabled="$ctrl.form.$invalid || $ctrl.inProgress" ng-if=$ctrl.showMainActions() ng-click=$ctrl.validateChallenge() data-qa=verification-unlock-button> <md-icon>lock</md-icon> <translate>.SMS-UNLOCK</translate> </md-button> <md-button layout-margin class="md-raised md-primary" ng-click=$ctrl.triggerChallenge(false) ng-if=$ctrl.showSendCodeButton() ng-disabled=$ctrl.inProgress aria-label="Send me my code" data-qa=sms-get-code-button> <translate ng-if=$ctrl.share.isSmsAccessRight()>.SEND-SMS</translate> </md-button> <md-button layout-margin class="md-primary wrong-number-guest" ng-click=$ctrl.setWrongNumber() ng-if=$ctrl.showNotMyNumberButton() ng-disabled=$ctrl.inProgress aria-label="This is not my number" data-qa=sms-notMyNumber-button> <translate>.SMS.WRONG-NUMBER.BUTTON</translate> </md-button> <md-button layout-margin class="md-primary md-raised" ng-click=$ctrl.notifySender() ng-if=$ctrl.showNotifyButton() ng-disabled=$ctrl.inProgress aria-label=Notify data-qa=sms-notifySender-button> <translate>.SMS.WRONG-NUMBER.NOTIFY</translate> </md-button> <md-button layout-margin class="md-primary wrong-number-guest" ng-click=$ctrl.back() ng-if=$ctrl.showNotifyButton() ng-disabled=$ctrl.inProgress aria-label="Go back"> <translate>.SMS.WRONG-NUMBER.BACK</translate> </md-button> </div> <div ng-if="$ctrl.share.isSmsAccessRight() && $ctrl.showSecondaryActions() === false" flex=100 layout=row layout-align="center center"> <a ng-href={{$ctrl.supportUrl}} target=_blank translate>.GET-SUPPORT</a> </div> <div flex=100 layout=row layout-align="space-around center" class="md-actions secondary" ng-if=$ctrl.showSecondaryActions()> <div ng-if="$ctrl.inProgress === false && $ctrl.isWrongNumber === false"> <a href=# ng-click=$ctrl.triggerChallenge() ng-class="$ctrl.preventDoubleClick ? \'disabled\' : \'resend\'"> <translate ng-if=$ctrl.share.isSmsAccessRight()>.RESEND-SMS</translate> </a> </div> <div ng-if=$ctrl.share.isSmsAccessRight()> <a ng-href={{$ctrl.supportUrl}} target=_blank translate>.GET-SUPPORT</a> </div> <div ng-if="$ctrl.share.isSmsAccessRight() && $ctrl.profile.isGuest() && $ctrl.isWrongNumber === false"> <a href=# ng-click=$ctrl.setWrongNumber() ng-disabled=$ctrl.inProgress aria-label="This is not my number"> <translate>.SMS.WRONG-NUMBER.BUTTON</translate> </a> </div> </div> </div> <div class="challenge message-info" ng-if="$ctrl.error === false && ($ctrl.share.isEmailAccessRight() || $ctrl.share.isPasswordAccessRight())"> <p ng-if=$ctrl.showRequestCodeInfo() class=small-note translate> .INFO.INTRO </p> <p ng-if=$ctrl.showSubmitCodeOrCodeInfo() class=small-note translate> .INFO.INTRO.SUBMIT </p> <p class=info> <span class="label small-note" translate>.INFO.SUBJECT</span> <span class=small-note>{{$ctrl.conversation.subject}}</span> </p> <p class="info truncate"> <span class="label small-note" translate>.INFO.PARTICIPANTS</span> <span class="small-note recipients">{{ $ctrl.summarizeRecipients($ctrl.profile) }}</span> <md-tooltip md-delay=500 md-direction=top class=challenge-participant-tooltip> <span>{{$ctrl.participants}}</span> </md-tooltip> </p> <p class=support> <a class=small-note ng-href={{$ctrl.zivverUrl}} target=_blank>Zivver</a> <span class=small-note translate> .INFO.SUPPORT</span> <a class=small-note ng-href={{$ctrl.supportUrl}} target=_blank translate>.INFO.WHY</a> </p> </div> <div ng-if="$ctrl.error === true" layout=row layout-fill layout-wrap layout-margin> <div class=notified flex=100> <p layout-align=center> <translate ng-if="$ctrl.screen === \'CHALLENGE\'">.ERROR.CHALLENGE</translate> <translate ng-if="$ctrl.screen === \'NOTIFY\'">.ERROR.NOTIFY</translate> </p> <div flex=100 class=md-actions layout=column layout-align="space-between stretch"> <md-button layout-margin ng-click=$ctrl.reloadPage() class="md-primary md-raised"> <translate>.ERROR.RETRY</translate> </md-button> </div> </div> </div> </form> '},function(t,e,i){i=[i,e,i(9),i(1),i(14),i(43),i(8),i(15),i(55),i(83),i(440),i(27)],e=function(t,e,S,i,n,o,s,r,a,c,l,u){Object.defineProperty(e,"__esModule",{value:!0});var p="CONVERSATIONS.REPLY";function d(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v){var g=this,t=(this.$log=t,this.$mdDialog=e,this.$q=i,this.$rootScope=n,this.$scope=o,this.$state=s,this.$timeout=r,this.$transitions=a,this.$uiRouterGlobals=c,this.ContactsService=l,this.ConversationsService=u,this.DeviceService=p,this.MessengerService=d,this.OrganizationService=h,this.ReplyService=f,this.StorageService=m,this.profile=v,this.loading=!0,this.loadingMessages=!0,this.isMSBrowser=!1,this.recipients=[],this.messagesAndEvents=[],this.isExpirationEnabled=!1,this.changesForValidation=0,this.validationAttempts=0,this.showDraft=!1,this.showValidationBar=!1,this.showViolationsSidePane=!1,this.showInfoPane=!1,this.showSwitchButton=!0,this.$uiRouterGlobals.params.label);this.label=t,this.ConversationsService.get(this.$uiRouterGlobals.params.conversationId).then(function(e){return g.conversation=e,g.messagesAndEvents=Array.apply(null,Array(g.conversation.counters.messages)).map(function(t,e){return{id:"placeholder-"+e}}),g.initDraft(),g.ConversationsService.getShare(e.share).then(function(t){return!1===(g.share=t).isAccessGranted()?g.$state.go("conversations.open",S.__assign(S.__assign({},g.$uiRouterGlobals.params),{shareId:t.id})):void 0!==g.conversation.specialId?g.$state.go("conversations.open",S.__assign(S.__assign({},g.$uiRouterGlobals.params),{shareId:e.share})):void g.loadMessages()}).catch(function(t){g.$log.error("Error getting conversation share",{error:t}),g.$state.go("conversations.open",S.__assign(S.__assign({},g.$uiRouterGlobals.params),{shareId:e.share}))})}).catch(function(t){g.$log.error("Error getting conversation info",{error:t}),void 0!==g.conversation?g.$state.go("conversations.open",S.__assign(S.__assign({},g.$uiRouterGlobals.params),{shareId:g.conversation.share})):g.$state.go("conversations.error",{error:"NOT_FOUND"},{location:!1})}).finally(function(){g.loading=!1})}d.$inject=["$log","$mdDialog","$q","$rootScope","$scope","$state","$timeout","$transitions","$uiRouterGlobals","ContactsService","ConversationsService","DeviceService","MessengerService","OrganizationService","ReplyService","StorageService","profile"],d.prototype.error=function(t){this.$state.go("conversations.error",{error:t,conversation:this.conversation},{location:!1})},d.prototype.$onDestroy=function(){this.$timeout.cancel(this.draftModifiedTimeout),this.$timeout.cancel(this.validationTimeout),this.$timeout.cancel(this.saveTimeout),this.saveDraft()},d.prototype.initDraft=function(){var s=this;this.isMSBrowser=this.DeviceService.isMSBrowser(),this.showSwitchButton=!1===this.isMSBrowser,this.draft=new r.Draft,this.convertParticipantsToRecipients(),this.restoreSavedDraft(),!1===this.profile.isGuest()&&(void 0===this.draft.scheduledExpiration?this.getDefaultExpirationPolicy().then(function(){s.timeLeft=s.setTimeLeft()}).catch(function(){s.getDefaultExpirationPolicy()}):(this.isExpirationEnabled=void 0!==this.draft.scheduledExpiration.expiresIn,this.timeLeft=this.setTimeLeft())),this.draft.id=this.conversation.share,this.isMSBrowser&&(this.draft.contentType="text/plain"),this.showDraft=!0,this.$scope.$watch(function(){return s.draft.isModified},function(t){t&&(s.changesForValidation++,s.draft.isModified=!1,s.draft.validation.validationCompleted=!1,s.$timeout.cancel(s.draftModifiedTimeout),s.draftModifiedTimeout=s.$timeout(function(){s.validateDraft()},500),s.$timeout.cancel(s.saveTimeout),s.saveTimeout=s.$timeout(function(){return s.saveDraft()},150))}),this.$scope.$on(o.DraftEvents.ValidationsUpdated,function(t,e){s.draft.validation=e.validation,!1===s.showValidationBar&&e.validation.hasViolations()&&(s.showValidationBar=!0)}),this.$scope.$on(a.Events.Updated,function(t,e){s.conversation.participants=e}),this.$transitions.onBefore({},function(e){var i,n=e.to(),o=e.params();if(s.draft.isUploading)return s.$log.debug("preventing navigation away because we are still uploading"),i=u.WarningDialog.factory({explanation:"draft-attachments.CONFIRM-LEAVE-WHILE-UPLOADING",submitText:"MAIN.YES",cancelText:"MAIN.NO",type:u.WarningDialogTypes.error}),new Promise(function(t){s.$mdDialog.show(i).then(function(){s.draft.files.filter(function(t){return void 0!==t.upload}),s.draft.isUploading=!1,e.router.stateService.target(n,o)}).catch(function(){e.abort()}).finally(function(){t()})})})},d.prototype.saveDraft=function(){var t,e,i;0===this.draft.body.length&&0===this.draft.files.length?this.removeSavedDraft():this.draft.isSending||(t=(i=this.draft.toRequestEntity()).body,e=i.contentType,i=i.scheduledExpiration,this.StorageService.setItem("LOCAL",this.getDraftSaveKey(),{body:t,contentType:e,files:this.draft.files.map(function(t){return{id:t.id,name:t.name,size:t.size,inline:t.inline}}),scheduledExpiration:i}))},d.prototype.loadMessages=function(){var e,i=this;this.ConversationsService.listMessages(this.conversation.id,this.share.accessRightGrant.token,this.profile.email).then(function(t){e=t.items.map(function(t){return t.isNew=t.createdDate>i.conversation.readMarkerDate,t}),i.messagesAndEvents=[].concat(e,t.events).sort(function(t,e){return t.createdDate<e.createdDate?1:-1})}).catch(function(t){t.status===s.HTTP_FORBIDDEN?i.error("FORBIDDEN"):t.status===s.HTTP_NOT_FOUND?0<e.length?i.error("LOGGEDOUT"):(i.$log.warn("loading conversation messages resulted in a 404"),i.error("UNKNOWN")):t.status===s.HTTP_UNAUTHORIZED?i.error("LOGGEDOUT"):t.status===s.ERR_CONNECTION_REFUSED||t.status===s.ZERO_RESPONSE?i.$log.info("No clue what happend, try again"):(i.$log.error("unexpected error loading conversation messages",{error:t}),i.error("UNKNOWN"))}).finally(function(){i.loadingMessages=!1,i.$timeout(function(){i.$scope.$broadcast("conversation-reply-messages.add")},1e3)})},d.prototype.convertParticipantsToRecipients=function(){var e=this,i=[];this.conversation.participants.forEach(function(t){t=e.ContactsService.get(t.email).then(function(t){return t.toRecipient()});i.push(t)}),this.$q.all(i).then(function(t){e.recipients=t}).catch(function(t){e.$log.error("Could not convert participants to recipients")})},d.prototype.validateDraft=function(){var e=this;this.$timeout.cancel(this.validationTimeout),this.draft.isModified?this.draft.isModified=!1:0===this.changesForValidation||this.draft.isValidating||0===this.draft.body.length&&0===this.draft.files.length||(this.draft.isValidating=!0,this.changesForValidation=0,this.validationAttempts++,this.ReplyService.validate(this.conversation.id,this.draft,this.share.accessRightGrant.token,this.profile.isGuest()).then(function(t){(e.draft.validation=t).validationCompleted?e.validationAttempts=0:e.validationTimeout=e.$timeout(function(){e.changesForValidation++,e.validateDraft()},1e3*e.validationAttempts,!1)}).catch(function(t){e.$log.warn("Error validating reply draft",{error:t}),e.MessengerService.toast(p+".ERROR.VALIDATION")}).finally(function(){e.draft.isValidating=!1}))},d.prototype.send=function(){var e,i=this;this.$timeout.cancel(this.validationTimeout),this.$timeout.cancel(this.saveTimeout),!1!==this.preSend()&&(this.draft.isSending=!0,void 0!==this.draft.scheduledExpiration&&(this.draft.scheduledExpiration={action:this.draft.scheduledExpiration.action,expiresAt:n().add(n.duration(this.draft.scheduledExpiration.expiresIn)).toISOString()}),e=this.draft.id,this.draft.contentType,this.draft.id=null,this.ReplyService.send(this.conversation.id,this.draft,this.share.accessRightGrant.token).then(function(t){i.removeSavedDraft(),i.StorageService.removeItem("LOCAL","ignoredViolations"+e),i.$state.go("conversations.view",{label:i.label,conversationId:i.conversation.id},{location:"replace"})}).catch(function(t){i.MessengerService.toast(p+".ERROR.SEND"),i.$log.error("Could not reply in conversation",{error:t}),i.draft.isSending=!1}))},d.prototype.cancel=function(){var t=this,e=this.draft.id,i=u.WarningDialog.factory({title:"DRAFTS.CANCEL-DIALOG.TITLE",explanation:"DRAFTS.CANCEL-DIALOG.CONFIRMATION",submitText:"DRAFTS.CANCEL-DIALOG.SUBMIT",cancelText:"DRAFTS.CANCEL-DIALOG.CANCEL",type:u.WarningDialogTypes.warning});this.$mdDialog.show(i).then(function(){t.draft.isUploading=!1,null!==t.draft.id&&(t.removeSavedDraft(),t.StorageService.removeItem("LOCAL","ignoredViolations"+e)),t.$state.go("conversations.view",{conversationId:t.conversation.id},{location:"replace"})})},d.prototype.openValidationsSidePane=function(){this.showViolationsSidePane=!0},d.prototype.closeValidationsSidePane=function(){this.showViolationsSidePane=!1},d.prototype.openViolationSidePane=function(){this.showViolationsSidePane=!0},d.prototype.closeViolationsSidePane=function(){this.showViolationsSidePane=!1},d.prototype.setTimeLeft=function(){return n().add(n.duration(this.draft.scheduledExpiration.expiresIn)).fromNow(!0)},d.prototype.isDraftValid=function(){return!1===this.draft.isModified&&this.draft.validation.validationCompleted&&this.draft.validation.validDraft&&0===this.draft.validation.violationsUnresolved.length},d.prototype.preSend=function(){return!(this.draft.isValidating||(this.draft.isUploading?(this.$log.info("Trying to finalize draft while still uploading"),1):this.draft.isSending||(0<this.draft.validation.violationsUnresolved.length?(this.openViolationSidePane(),this.$log.info("Trying to finalize draft with unresolved violations"),1):!1===this.isDraftValid()&&(this.openViolationSidePane(),this.$log.info("Trying to finalize draft that is invalid"),1))))},d.prototype.openExpirationDialog=function(){var i=this,t={isDraft:!0,isEnabled:this.isExpirationEnabled,scheduledExpiration:this.draft.scheduledExpiration},t=c.ExpirationDialog.factory(t);this.$mdDialog.show(t).then(function(t){var e;t.isEnabled?(e=u.WarningDialog.factory({title:p+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.TITLE",explanation:p+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.SCHEDULED",submitText:"MAIN.OK",type:"delete"===t.scheduledExpiration.action?u.WarningDialogTypes.error:u.WarningDialogTypes.info}),i.$mdDialog.show(e).then(function(){i.setExpirationData(t)})):i.setExpirationData(t)})},d.prototype.setExpirationData=function(t){this.isExpirationEnabled=t.isEnabled,!1===this.isExpirationEnabled?this.draft.scheduledExpiration=void 0:(this.draft.scheduledExpiration=S.__assign({},t.scheduledExpiration),this.timeLeft=this.setTimeLeft()),this.draft.isModified=!0},d.prototype.getDefaultExpirationPolicy=function(){var n=this;return this.$q(function(e,i){n.OrganizationService.getMessageExpirationPolicy().then(function(t){n.isExpirationEnabled=t.automaticScheduledExpiration,t.automaticScheduledExpiration&&(n.draft.scheduledExpiration={action:t.defaults.action,expiresIn:t.defaults.duration},n.timeLeft=n.setTimeLeft()),e()}).catch(function(t){n.$log.error("Unable to retrieve organization default expiration policy",{error:t}),i()})})},d.prototype.editorToggle=function(){var t;this.draft.contentType="text/html"===this.draft.contentType?"text/plain":"text/html","text/plain"===this.draft.contentType?(this.$scope.$broadcast("conversation-reply-messages.remove"),(t=document.createElement("div")).innerHTML=this.draft.body,this.draft.body=t.innerText):this.draft.body=this.draft.body.slice(0,this.draft.body.indexOf("\n\n--\n")),this.saveDraft()},d.prototype.removeSavedDraft=function(){this.StorageService.removeItem("LOCAL",this.getDraftSaveKey())},d.prototype.restoreSavedDraft=function(){var e=this,t=this.StorageService.getItem("LOCAL",this.getDraftSaveKey());null===t?"text/html"===this.draft.contentType&&this.$scope.$applyAsync(function(){e.$scope.$broadcast("signature.add",!1)}):(this.draft.body=t.body,this.draft.contentType=t.contentType,this.draft.scheduledExpiration=t.scheduledExpiration,t.files.length&&t.files.forEach(function(t){e.draft.files.push(new r.DraftAttachment(t))}))},d.prototype.getDraftSaveKey=function(){return"reply.draft."+this.conversation.share},e.ReplyController=d,e.ReplyControllerModule=i.module("app.conversations.ReplyController",[l.ConversationReplyMessageModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/ExpirationDialog.67ed45.html"},function(t,e,r){var i=[r,e,r(1),r(13),r(441)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$log"],s.prototype.$onInit=function(){this.showCounters=this.profile.email===this.message.sender,this.contentType=this.message.contentType.replace("/","-");try{this.sender=this.getSender()}catch(t){this.$log.error("Error getting sender in ConversationMessage",{error:t,messageId:this.message.id,shareId:this.share.id})}},s.prototype.isRevokedBccQuote=function(){return void 0!==this.message.quote&&!0===this.message.revoked&&void 0!==this.message.quote.messages[0]&&!0===this.message.quote.messages[0].isBcc&&null===this.message.quote.messages[0].body},s.prototype.showRevokedNotice=function(){return(void 0===this.message.deleted||!1===this.message.deleted)&&this.message.revoked},s.prototype.getSender=function(){var t,e=this;if(void 0!==this.conversation)return void 0!==(t=this.conversation.participants.filter(function(t){return t.email===e.message.sender})[0])?t:new n.Participant({email:this.message.sender,active:!0});throw new Error("no conversation nor quote defined")};var o=s;function s(t){this.$log=t}e.ConversationReplyMessage=o,e.ConversationReplyMessageModule=i.module("components.ConversationReplyMessage",[]).component("conversationReplyMessage",{bindings:{conversation:"<",message:"<",profile:"<",share:"<"},controller:o,template:r(442)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<div id="msg-{{:: $ctrl.message.id }}" translate-namespace=conversation-reply-message layout-wrap class=message-quoted ng-class="{\n\t\t\'own\' : $ctrl.message.isOwn === true,\n\t\t\'new\': $ctrl.message.isNew === true,\n\t\t\'revoked\' : $ctrl.message.revoked === true\n\t}"> <div class="fill-width header quote-information" layout=row layout-align="space-between center"> <span class="sender truncate" ng-if=$ctrl.sender.fullName> {{:: $ctrl.sender.fullName + \' (\' + $ctrl.sender.email + \')\' }} </span> <span class="sender truncate" ng-if="$ctrl.sender.fullName === null"> {{:: $ctrl.sender.email }} </span> <span flex></span> <div class=attachment-counter ng-if="$ctrl.message.files.length > 0"> <span>{{:: $ctrl.message.files.length }}</span> <md-icon aria-label="Attachment counter">attach_file</md-icon> </div> <time ng-if="$ctrl.message.isBcc === false" class=moment-date datetime="{{:: $ctrl.message.createdDate | date : \'yyyy-MM-dd HH:mm:ss\' }}"> {{:: $ctrl.message.createdDate | momentAgo }} </time> <md-checkbox aria-label="select message" class=md-primary ng-click=$ctrl.toggleSelectMessage(message.id) ng-checked=$ctrl.isSelectedMessage(message.id) ng-if=$ctrl.isForwardedConversation></md-checkbox> </div> <div ng-switch=":: $ctrl.message.contentType" ng-class="[ $ctrl.contentType, { \'no-counters\' : $ctrl.showCounters === false } ]"> <div class=revoked-notice ng-if=$ctrl.showRevokedNotice()> <p translate translate-compile ng-if=$ctrl.isRevokedBccQuote()> .REVOKED-OWN-MESSAGE.BCC-ORIGINAL </p> </div> <conversation-special ng-switch-when=application/zivver-special+json ng-if="$ctrl.message.revoked === false" message=$ctrl.message share=$ctrl.share></conversation-special> <conversation-message-body ng-switch-default class=conversation-message-body id=":: $ctrl.conversation.id + \'-\' + $ctrl.message.id" content-type=":: $ctrl.message.contentType" body=":: $ctrl.message.body" inline-images=":: $ctrl.message.files" share=$ctrl.share></conversation-message-body> <conversation-quote ng-if=":: $ctrl.message.quote && $ctrl.isRevokedBccQuote() === false" quote=":: $ctrl.message.quote" conversation=$ctrl.conversation profile=$ctrl.profile share=$ctrl.share class=conversation-quote></conversation-quote> </div> </div> '},function(t,e,i){i=[i,e,i(9),i(1),i(32),i(13),i(8),i(11),i(186),i(187),i(178),i(180),i(450),i(453),i(189),i(491),i(50),i(494),i(27)],e=function(t,e,$,n,o,y,i,s,r,a,c,l,u,p,d,h,f,m,v){Object.defineProperty(e,"__esModule",{value:!0});var g="CONVERSATIONS.VIEW";function S(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v,g){var S=this,t=(this.$anchorScroll=t,this.$animate=e,this.$log=i,this.$mdDialog=n,this.$rootScope=o,this.$scope=s,this.$state=r,this.$uiRouterGlobals=a,this.$timeout=c,this.$window=l,this.ConversationsService=u,this.MessengerService=p,this.$mdMedia=d,this.StorageService=h,this.SurveyService=f,this.WebSocketService=m,this.labelCollection=v,this.profile=g,this.hasEvents=!1,this.loading=!0,this.messages=[],this.messagesAndEvents=[],this.suspendedEvents=[],this.isSurveyAvailable=!1,this.showSurvey=!1,this.lastRefresh=Date.now(),this.isRefreshing=!1,this.$uiRouterGlobals.params.label);this.label=t,this.showInfoPane=this.$uiRouterGlobals.params.showInfo||!1,this.messagesViewEl=this.$window.document.getElementsByClassName("messages-view")[0],this.$animate.enabled(this.messagesViewEl,!1),this.registerEvents(),this.ConversationsService.get(this.$uiRouterGlobals.params.conversationId).then(function(e){return S.conversation=e,S.suspendedEvents=e.participants.filter(function(t){return!1===t.active}).map(function(t){var e=new y.ConversationEvent;return e.eventType="suspended",e.originator=t.email,e}),S.messagesAndEvents=Array.apply(null,Array(S.conversation.counters.messages)).map(function(t,e){return{id:"placeholder-"+e}}),S.ConversationsService.getShare(e.share).then(function(t){if(!1===(S.share=t).isAccessGranted())return S.$state.go("conversations.open",$.__assign($.__assign({},S.$uiRouterGlobals.params),{shareId:t.id}));S.loadMessages();var e=S.$uiRouterGlobals.params.deliverMessageId;void 0!==e&&S.deliverMessageDirect(e,t.accessRightGrant.token),S.profile.isGuest()&&S.SurveyService.getSurvey("customer_effort_score",t.id).then(function(t){S.isSurveyAvailable=t,S.setShowSurvey()})}).catch(function(t){S.$log.error("Error getting conversation share",{error:t}),S.$state.go("conversations.open",$.__assign($.__assign({},S.$uiRouterGlobals.params),{shareId:e.share}))})}).catch(function(t){S.$log.error("Error getting conversation info",{error:t}),void 0!==S.conversation?S.$state.go("conversations.open",$.__assign($.__assign({},S.$uiRouterGlobals.params),{shareId:S.conversation.share})):S.$state.go("conversations.error",{error:"NOT_FOUND"},{location:!1})}).finally(function(){S.loading=!1})}S.$inject=["$anchorScroll","$animate","$log","$mdDialog","$rootScope","$scope","$state","$uiRouterGlobals","$timeout","$window","ConversationsService","MessengerService","$mdMedia","StorageService","SurveyService","WebSocketService","labelCollection","profile"],S.prototype.loadMessages=function(){var e=this;"hidden"===this.$window.document.visibilityState&&0<this.messages.length?this.initRefresh():(this.isRefreshing=!0,this.ConversationsService.listMessages(this.conversation.id,this.share.accessRightGrant.token,this.profile.email).then(function(t){e.lastRefresh=Date.now(),e.messages=t.items.map(function(t){return t.isNew=t.createdDate>e.conversation.readMarkerDate,t}),e.messagesAndEvents=[].concat(e.messages,t.events).sort(function(t,e){return t.createdDate>e.createdDate?1:-1}),e.hasEvents=0!==t.events.length,e.updateReadMarker(),e.autoScroll(),e.isRefreshing=!1,e.initRefresh()}).catch(function(t){t.status===i.HTTP_FORBIDDEN?e.error("FORBIDDEN"):t.status===i.HTTP_NOT_FOUND?0<e.messages.length?e.error("LOGGEDOUT"):(e.$log.warn("loading conversation messages resulted in a 404"),e.error("UNKNOWN")):t.status===i.HTTP_UNAUTHORIZED?e.error("LOGGEDOUT"):t.status===i.ERR_CONNECTION_REFUSED||t.status===i.ZERO_RESPONSE?(e.$log.info("No clue what happend, try again"),e.initRefresh()):(e.$log.error("unexpected error loading conversation messages",{error:t}),e.error("UNKNOWN"))}).finally(function(){e.loading=!1}))},S.prototype.refresh=function(){var t;this.$scope.$$destroyed||(t=Date.now(),this.isRefreshing||t-this.lastRefresh<3e4?this.initRefresh():this.loadMessages())},S.prototype.updateReadMarker=function(){var e,t=this;0===this.messages.length||"hidden"===this.$window.document.visibilityState||(e=this.getLastMessage()).createdDate<=this.conversation.readMarkerDate||(this.readMarkerUpdateTimeout&&this.$timeout.cancel(this.readMarkerUpdateTimeout),this.readMarkerUpdateTimeout=this.$timeout(function(){t.messages.filter(function(t){return t.isNew}).forEach(function(t){t.isNew=t.createdDate>e.createdDate}),t.conversation.readMarkerDate=e.createdDate,t.conversation.readMarker=e.createdDateString,t.conversation.counters.unread=0,t.ConversationsService.updateReadMarker(t.conversation.id,t.conversation.readMarker),t.$rootScope.$broadcast("conversation:updated",t.conversation)},1e3,!1))},S.prototype.closeSurvey=function(){this.isSurveyAvailable=!1,this.setShowSurvey(),this.SurveyService.removeSurvey("customer_effort_score",this.share.id)},S.prototype.setShowSurvey=function(){this.showSurvey=this.isSurveyAvailable&&!1===this.$mdMedia("xs")},S.prototype.onConversationReplied=function(t){var e=this;t.isNew=!1,t.isOwn=!0,this.messages.push(t),this.messagesAndEvents.push(t),this.loadMessages(),this.$timeout(function(){e.$anchorScroll("msg-"+t.id)},300,!1),this.conversation.readMarkerDate=t.createdDate,this.$rootScope.$broadcast("conversation:updated",this.conversation)},S.prototype.initRefresh=function(){var t=this;this.WebSocketService.isOpen()||this.$timeout(function(){t.refresh()},3e4,!1)},S.prototype.error=function(t){this.$state.go("conversations.error",{error:t,conversation:this.conversation},{location:!1})},S.prototype.registerEvents=function(){function t(){return i.$timeout(function(){return i.refresh()},500)}var e,i=this;this.$scope.$on(y.LabelEvents.Updated,function(t,e){i.labelCollection=e,void 0!==i.conversation&&i.conversation.updateLabelCollection(i.labelCollection)}),this.$scope.$on(y.LabelEvents.Deleted,function(t,e){i.conversation.removeLabelById(e)}),this.$scope.$on("conversations.replied",function(t,e){i.onConversationReplied(e)}),this.$scope.$on("conversations.participants",function(t,e){i.conversation.participants=e}),this.$scope.$on(s.AuthEvents.logoutOtherTab,function(){i.error("LOGGEDOUT")}),this.$scope.$on("push.conversations",function(t,e){i.conversation.share===e.shareId&&i.$state.reload()}),this.$scope.$on(o.WebSocketEvents.CONVERSATION_UPDATED,function(t,e){e===i.conversation.id&&i.loadMessages()}),this.$scope.$on("conversation:updated",function(t,e){i.conversation=e,i.refresh()}),this.$window.document.addEventListener("visibilitychange",t),this.$scope.$on("$destroy",function(){i.$window.document.removeEventListener("visibilitychange",t)}),void 0!==this.messagesViewEl&&this.messagesViewEl.addEventListener("scroll",function(){void 0!==e&&i.$timeout.cancel(e),e=i.$timeout(function(){i.StorageService.setItem("SESSION","offset."+i.share.id,i.messagesViewEl.scrollTop.toString())},250,!1)})},S.prototype.getLastMessage=function(){return this.messages[this.messages.length-1]},S.prototype.autoScroll=function(){var t,e=this,i=(this.autoScroll=n.noop,this.StorageService.getItem("SESSION","offset."+this.share.id));i?this.$timeout(function(){e.messagesViewEl.scrollTop=i},300,!1):0<(t=0===(t=this.messages.filter(function(t){return t.isNew}).slice(0,1)).length?this.messages.slice(-1):t).length&&this.$timeout(function(){e.$anchorScroll("msg-"+t[0].id)},300,!1)},S.prototype.openSidePane=function(){this.showInfoPane=!0},S.prototype.sidePaneClosed=function(){this.showInfoPane=!1},S.prototype.deliverMessageDirect=function(t,e){var i=this;this.ConversationsService.deliverMessage(this.conversation.id,parseInt(t),e).then(function(){i.showDeliverMessageDialog()}).catch(function(t){i.showDeliverMessageDialog(t.status)})},S.prototype.showDeliverMessageDialog=function(t){var e;switch(t){case i.HTTP_FORBIDDEN:e="FORBIDDEN";break;case i.HTTP_NOT_FOUND:e="NOT-FOUND";break;case i.HTTP_GONE:e="GONE";break;default:e="SUCCESS"}t=v.WarningDialog.factory({title:g+".DELIVER-MESSAGE-DIALOG."+e+".TITLE",explanation:g+".DELIVER-MESSAGE-DIALOG."+e+".EXPLANATION",cancelText:"MAIN.OK",hideSubmit:!0,type:v.WarningDialogTypes.info});this.$mdDialog.show(t).then(function(){})},e.ViewController=S,e.ViewControllerModule=n.module("app.conversations.ViewController",[r.AttachmentCarouselModule.name,a.ConversationEventModule.name,c.ConversationHeaderModule.name,l.ConversationInfoModule.name,u.ConversationLabelModule.name,p.ConversationMessageModule.name,d.ConversationQuoteModule.name,h.ConversationReplyModule.name,f.SidepaneModule.name,m.SurveyToolModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/img/no-preview_NL.4920a6.svg"},function(t,e,i){t.exports=i.p+"assets/v2/img/no-preview_EN.9767e2.svg"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/AttachmentCarousel.b6617e.html"},function(t,e,i){},function(t,e){t.exports='<div class=event-container translate-namespace=conversation-event ng-class=$ctrl.eventLevel> <div class=icon> <md-icon ng-bind=$ctrl.icon></md-icon> </div> <span class=text data-qa=revoked-message-text> {{ $ctrl.text }} </span> <div> <md-button ng-if=$ctrl.isResolveRequired() ng-click=$ctrl.openInfoPane() data-qa=button-resolve-notified> <translate>.RESOLVE</translate> </md-button> <time class=moment-date datetime="{{:: $ctrl.event.createdDate | date : \'yyyy-MM-dd HH:mm:ss\' }}" ng-if="$ctrl.event.createdDate !== undefined && $ctrl.isResolveRequired() === false"> {{ $ctrl.event.createdDate | momentAgo }} </time> </div> </div> '},function(t,e,a){var i=[a,e,a(1),a(13),a(42),a(451)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$log","$scope","ConversationsService","LabelService"],r.prototype.$onInit=function(){this.mini=void 0!==this.mini&&this.mini,this.backgroundColor=this.getPastelColorFor(this.label),this.registerEvents()},r.prototype.registerEvents=function(){var i=this;this.$scope.$on(n.LabelEvents.Updated,function(t,e){e=e.userLabels.filter(function(t){return t.id===i.label.id})[0];i.label.labelColor=e.labelColor})},r.prototype.$doCheck=function(){this.backgroundColor=this.getPastelColorFor(this.label)},r.prototype.removeSelf=function(){var e=this,t=this.conversation.customLabels.filter(function(t){return t.id!==e.label.id}),t=this.ConversationsService.setConversationLabels(this.conversation,t);t.then(function(){e.LabelService.getLabelsAndBroadcast()}),t.catch(function(t){e.$log.warn("Setting labels failed...",t)})},r.prototype.getPastelColorFor=function(t){if(!1===t.isSystemLabel)return void 0===n.LabelColors[t.labelColor]?(this.$log.warn("No pastel color defined for "+t.labelColor),o.COLOR_WHITE):n.LabelColors[t.labelColor];switch(t.name.toLowerCase()){case"inbox":return o.COLOR_SKY_BLUE;case"archive":return o.COLOR_APRICOT_ORANGE;default:return o.COLOR_WHITE}};var s=r;function r(t,e,i,n){this.$log=t,this.$scope=e,this.ConversationsService=i,this.LabelService=n}e.ConversationLabelComponent=s,e.ConversationLabelModule=i.module("components.ConversationLabel",[]).component("conversationLabel",{bindings:{label:"<",mini:"<",conversation:"<"},controller:s,template:a(452)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports="<div class=pricetag ng-class=\"{ 'pricetag-mini' : $ctrl.mini }\" ng-style=\"{'background': $ctrl.backgroundColor, 'border-color': $ctrl.label.labelColor}\"> <div ng-if=\"$ctrl.mini === false\" ng-click=$ctrl.removeSelf() class=remove> <md-icon>close</md-icon> </div> {{ $ctrl.label.name }} </div> "},function(t,e,E){var i=[E,e,E(9),E(1),E(14),E(13),E(454),E(464),E(467),E(470),E(474),E(15),E(475),E(50),E(27),E(478),E(83),E(481),E(484),E(24),E(487)],e=function(t,e,s,i,n,o,r,a,c,l,u,p,d,h,f,m,v,g,S,$){Object.defineProperty(e,"__esModule",{value:!0});var y="conversation-message",b=(w.$inject=["$scope","$element","$injector","$log","$q","$rootScope","$state","$timeout","$mdDialog","$translate","ConversationsService","DeviceService","MessengerService","PrintService"],w.prototype.$onInit=function(){var t=this;this.canCreateDraft=!1===this.profile.isGuest(),this.showCounters=this.profile.email===this.message.sender,this.contentType=this.message.contentType.replace("/","-"),void 0!==this.conversation&&(this.canQuote=void 0===this.conversation.flow||this.conversation.flow.allowQuote);try{this.sender=this.getSender()}catch(t){this.$log.error("Error getting sender in ConversationMessage",{error:t,messageId:this.message.id,shareId:this.share.id})}this.$scope.$on("reset-access-from-bar",function(){return t.unRevokeAccess()}),this.$scope.$on("edit-settings-from-bar",function(){return t.revokeAccess()})},w.prototype.openMenu=function(t,e){t.open(e)},w.prototype.revokeAccess=function(){var o=this,t={isDraft:!1,isEnabled:void 0!==this.message.scheduledExpiration&&void 0!==this.message.scheduledExpiration.expiresAt,scheduledExpiration:s.__assign({},this.message.scheduledExpiration)},e=v.ExpirationDialog.factory(t);this.$q(function(i,n){o.$mdDialog.show(e).then(function(t){var e;!1===t.isEnabled?o.ConversationsService.unscheduleAccessRemoval(o.conversation.id,o.message.id).then(function(){o.$log.debug("Scheduled expiration removed",{conversationId:o.conversation.id,messageId:o.message.id}),o.MessengerService.toast(y+".COUNTERMAND.SUCCESS",{},!0),i()}).catch(function(t){o.$log.error("An error has occurred while removing a scheduled expiration",{error:t}),o.MessengerService.toast(y+".COUNTERMAND.ERROR",{},!0),n(t)}):void 0!==t.scheduledExpiration.expiresIn?(e=f.WarningDialog.factory({title:y+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.TITLE",explanation:y+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.SCHEDULED",submitText:"MAIN.OK",type:"delete"===t.scheduledExpiration.action?f.WarningDialogTypes.error:f.WarningDialogTypes.info}),o.$mdDialog.show(e).then(function(){o.ConversationsService.scheduleAccessRemoval(o.conversation.id,o.message.id,{expiresIn:t.scheduledExpiration.expiresIn,action:t.scheduledExpiration.action}).then(function(){o.message.scheduledExpiration=s.__assign({},t.scheduledExpiration),i()}).catch(function(t){return n(t)})})):(e=f.WarningDialog.factory({title:y+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.TITLE",explanation:y+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.DIRECT",submitText:"MAIN.OK",type:"delete"===t.scheduledExpiration.action?f.WarningDialogTypes.error:f.WarningDialogTypes.info}),o.$mdDialog.show(e).then(function(){o.ConversationsService.revokeMessage(o.conversation.id,o.message.id,t.scheduledExpiration.action).then(function(){o.message.scheduledExpiration=s.__assign({},t.scheduledExpiration),o.message.revoked=!0,i()}).catch(function(t){n(t)})}))})}).then(function(){o.$log.debug("Scheduled access revoke set",{conversationId:o.conversation.id,messageId:o.message.id,action:o.message.scheduledExpiration.action,date:o.message.scheduledExpiration.expiresAt}),o.$rootScope.$broadcast("conversation:updated",o.conversation)}).catch(function(t){o.$log.error("Error occurred while trying to revoke the message",{error:t}),o.MessengerService.toast(y+".REVOKE-ERROR",{},!0)})},w.prototype.unRevokeAccess=function(){var t=this,e=f.WarningDialog.factory({title:y+".UNREVOKE-TITLE",explanation:y+".UNREVOKE-CONFIRM",submitText:"MAIN.OK",type:f.WarningDialogTypes.info});this.$mdDialog.show(e).then(function(){t.ConversationsService.unrevokeMessage(t.conversation.id,t.message.id).then(function(){t.message.revoked=!1})})},w.prototype.downloadMessage=function(e,t){var i=this;void 0!==this.downloadMessageUrl?(this.DeviceService.simulateMouseClick(this.$element[0].querySelector(".downloadMessage")),this.$timeout(function(){i.downloadMessageUrl=void 0},500,!1)):(e.preventDefault(),this.ConversationsService.getMessageDownloadUrl(this.share,this.conversation.id,this.message.id,t).then(function(t){i.downloadMessageUrl=t,i.DeviceService.simulateMouseClick(e.target)}).catch(function(t){i.$log.error("Could not get attachment download url",{error:t})}))},w.prototype.replyMessage=function(){this.forkMessage("reply",[this.message.participant])},w.prototype.forwardMessage=function(){this.forkMessage("forward")},w.prototype.printMessage=function(){this.PrintService.printConversation(this.conversation,this.$element[0].parentElement)},w.prototype.downloadProofOfDelivery=function(t){var e=this;this.ConversationsService.getProofOfDeliveryReport(this.conversation.id,this.message.id,t?this.profile.uuid:void 0).then(function(t){window.open(t+"&content_disposition=false")}).catch(function(t){e.$log.error("Could not get proof of delivery download token",{error:t})})},w.prototype.sendCopyToInbox=function(){var i=this;this.ConversationsService.getSecurityLevel(this.profile.email).then(function(t){var e="dane"===t?"dane":"tls",t=S.SendCopyDialog.factory({email:i.profile.email,level:e});i.$mdDialog.show(t).then(function(){i.ConversationsService.sendCopyToInbox(i.conversation.id,i.message.id,e.toLowerCase())})}).catch(function(t){i.MessengerService.toast("send-copy-dialog.ERROR"),i.$log.error("Error getting security level",{error:t})})},w.prototype.openSidePane=function(){this.showSidePane=!0},w.prototype.closeSidePane=function(){this.showSidePane=!1},w.prototype.showExpirationBar=function(){return!0===this.message.revoked||(void 0!==this.message.scheduledExpiration?this.message.scheduledExpiration.action&&this.message.scheduledExpiration.expiresAt&&!1===this.message.deleted:void 0)},w.prototype.isRevokedBccQuote=function(){return void 0!==this.message.quote&&!0===this.message.revoked&&void 0!==this.message.quote.messages[0]&&!0===this.message.quote.messages[0].isBcc&&null===this.message.quote.messages[0].body},w.prototype.showOriginal=function(){var e=this;this.ConversationsService.get(this.message.quote.conversationInfo.id).then(function(t){e.$state.go("conversations.open",{shareId:t.share,label:t.systemLabel.name},{reload:!0})})},w.prototype.showRevokedNotice=function(){return(void 0===this.message.deleted||!1===this.message.deleted)&&this.message.revoked},w.prototype.getMessageAction=function(){return void 0===this.message.scheduledExpiration&&!0===this.message.revoked&&this.message.isOwn?"revoked-own":this.message.isOwn&&void 0!==this.message.scheduledExpiration.action?"revoke"===this.message.scheduledExpiration.action?"revoke-own-recipients":"revoke-own-everyone":"revoke"!==this.message.scheduledExpiration.action||this.message.sender?this.message.scheduledExpiration.action:"revoke-no-actor"},w.prototype.hasActions=function(){return!0===this.message.isOwn||!0===this.canCreateDraft},w.prototype.showSenderWithLink=function(){return void 0===this.message.sentByDelegate&&(!1===this.message.isOwn||void 0===this.message.isOwn)&&!0===this.canCreateDraft},w.prototype.showSender=function(){return void 0===this.message.sentByDelegate&&(!0===this.message.isOwn||!1===this.canCreateDraft)},w.prototype.forkMessage=function(t,e){var i,n=this;!1===this.canCreateDraft?(i=g.GuestForwardDialog.factory({conversationId:this.conversation.id,email:this.profile.email,messageId:this.message.id}),this.$mdDialog.show(i).then(function(){n.sendCopyToInbox()}).catch()):(i={draftType:t,quote:{conversationId:this.conversation.id,messageIds:[this.message.id]},share:this.share,subject:("forward"===t?"FW":"RE")+": "+this.conversation.subject},void 0!==e&&(i.recipients=e.map(function(t){return new p.Recipient({email:t.email,fullName:t.fullName})})),this.$state.go("drafts.create",i))},w.prototype.getSender=function(){var t,e=this;if(void 0!==this.conversation)return void 0!==(t=this.conversation.participants.filter(function(t){return t.email===e.message.sender})[0])?t:new o.Participant({email:this.message.sender,active:!0});throw new Error("no conversation nor quote defined")},w);function w(t,e,i,n,o,s,r,a,c,l,u,p,d,h){this.$scope=t,this.$element=e,this.$injector=i,this.$log=n,this.$q=o,this.$rootScope=s,this.$state=r,this.$timeout=a,this.$mdDialog=c,this.$translate=l,this.ConversationsService=u,this.DeviceService=p,this.MessengerService=d,this.PrintService=h,this.showSidePane=!1}e.ConversationMessage=b,e.ConversationMessageModule=i.module("components.ConversationMessage",[$.AvatarModule.name,r.ConversationAttachmentsModule.name,a.ConversationMessageBodyModule.name,c.ConversationSpecialModule.name,m.ExpirationBarModule.name,l.MessageCountersModule.name,d.MessageInfoComponentModule.name,u.MomentAgoFilterModule.name,h.SidepaneModule.name,f.WarningDialogModule.name]).component("conversationMessage",{bindings:{conversation:"<",message:"<",profile:"<",share:"<"},controller:b,template:E(488)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,d){var i=[d,e,d(1),d(188),d(186),d(455),d(50),d(13),d(460)],e=function(t,e,i,n,o,s,r,a){Object.defineProperty(e,"__esModule",{value:!0});var c=d(461),l=d(462),u=(p.$inject=["$element","$injector","$log","$rootScope","$timeout","ConversationsService","DeviceService","MediaService","MessengerService"],p.prototype.$onChanges=function(t){var e=this,t=t.message;void 0!==t&&t.isFirstChange()&&void 0!==t.currentValue.files&&(t=t.currentValue.files,this.attachmentsNumber=t.filter(function(t){return t.downloadable}).length,this.attachmentsSize=t.reduce(function(t,e){return e.downloadable&&t+e.size},0),t.forEach(function(t){(e.canPreview(t)?(e.getPreviewThumbnail(t),e.previews):e.noPreviews).push(t)}))},p.prototype.preview=function(t,e){var i=this;t.stopPropagation(),t.preventDefault(),this.ConversationsService.getFileDownloadUrl(this.share,e.id).then(function(t){e.isPdf()?window.open(t+"&content_disposition=false","_blank"):i.previewAttachment=e})},p.prototype.downloadAttachment=function(t,e){var i,n=this;!1===e.downloadable?(t.preventDefault(),this.$log.warn("Attached file is not downloadable",{share:this.share.id,file:e.id}),this.MessengerService.toast("conversation-attachments.NOT-DOWNLOADABLE")):null===(i=t.currentTarget).getAttribute("href")?(t.preventDefault(),this.ConversationsService.getFileDownloadUrl(this.share,e.id).then(function(t){i.setAttribute("href",t),n.DeviceService.simulateMouseClick(i)})):this.$timeout(function(){return i.removeAttribute("href")},1e3)},p.prototype.downloadAllAttachments=function(t){var e=this,i=t.currentTarget;null===i.getAttribute("href")?(t.preventDefault(),this.ConversationsService.getFileDownloadAllUrl(this.share,this.message.id).then(function(t){i.setAttribute("href",t),e.DeviceService.simulateMouseClick(i)})):this.$timeout(function(){return i.removeAttribute("href")},1e3)},p.prototype.getPreviewThumbnail=function(e){var i=this;e.isPdf()?e.setBackgroundImage(l,!0):e.isImage()&&(e.setBackgroundImage(c,!0),this.ConversationsService.getFileDownloadUrl(this.share,e.id).then(function(t){e.isSvg()?e.setBackgroundImage(t,!1):i.MediaService.resize(t,240,150,"fitIn").then(function(t){i.preloadImage(e,t)})}))},p.prototype.canPreview=function(t){var e=t.fileType.split("/")[1];return!(!t.isImage()||"heic"===e)||!!t.isPdf()},p.prototype.preloadImage=function(t,e){var i=this,n=this.$element[0],o=document.createElement("img");o.src=e,o.classList.add("preload"),o.onload=function(){t.setBackgroundImage(e,!1),i.$rootScope.$broadcast("image-preloaded",t,e),n.removeChild(o)},o.onerror=function(){i.$log.error("Could not load attachment thumbnail",{fileId:t.id,fileSize:t.size}),n.removeChild(o)},n.appendChild(o)},p.prototype.isSelectedAttachment=function(t){return!0===this.showSidePane&&void 0!==this.attachment&&this.attachment.id===t.id},p.prototype.openPaneInfo=function(t,e){t.preventDefault(),this.attachment=e,this.openSidePane()},p.prototype.openSidePane=function(){this.showSidePane=!0},p.prototype.closeSidePane=function(){this.showSidePane=!1},p.prototype.toggleAttachments=function(){this.isAttachmentsCollapsed=!this.isAttachmentsCollapsed,this.previewsLimit=this.getAttachmentsLimit(this.previews.length),this.noPreviewsLimit=this.getAttachmentsLimit(this.noPreviews.length)},p.prototype.showToggleAttachments=function(){return 3<this.previews.length||3<this.noPreviews.length},p.prototype.getAttachmentsLimit=function(t){return this.isAttachmentsCollapsed||t<=3?t:3},p);function p(t,e,i,n,o,s,r,a,c){this.$element=t,this.$injector=e,this.$log=i,this.$rootScope=n,this.$timeout=o,this.ConversationsService=s,this.DeviceService=r,this.MediaService=a,this.MessengerService=c,this.previews=[],this.noPreviews=[],this.isAttachmentsCollapsed=!1,this.noPreviewsLimit=3,this.previewsLimit=3,this.showSidePane=!1}e.ConversationAttachments=u,e.ConversationAttachmentsModule=i.module("zivver.components.conversationAttachments",[o.AttachmentCarouselModule.name,s.AttachmentInfoModule.name,n.FormatBytesFilterModule.name,r.SidepaneModule.name]).component("conversationAttachments",{bindings:{message:"<",profile:"<",share:"<"},controller:u,template:d(463)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(13),r(456)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$scope","$log","ConversationsService"],s.prototype.$onInit=function(){var t=this;void 0===this.share||void 0===this.attachment?this.$log.warn("AttachmentInfo: Share or Attachment undefined"):this.$scope.$watch(function(){return t.attachment.id},function(){t.getAttachmentInfo()},!0)},s.prototype.getAttachmentInfo=function(){var e=this;this.ConversationsService.getAttachmentInfo(this.share.id,this.attachment.id).then(function(t){e.opens=t.openedBy.map(function(t){return new n.Participant(t)}).sort(e.sortParticipants),e.notYetOpened=t.notYetOpenedBy.map(function(t){return new n.Participant(t)}).sort(e.sortParticipants)}).catch(function(t){403===t.status?e.$log.debug("Not all attachment info is provided to recipients of a message"):e.$log.warn("Error getting attachment info",{error:t})})},s.prototype.sortParticipants=function(t,e){return t.fullNameOrEmail().localeCompare(e.fullNameOrEmail())};var o=s;function s(t,e,i){this.$scope=t,this.$log=e,this.ConversationsService=i,this.opens=[],this.notYetOpened=[]}e.AttachmentInfoModule=i.module("zivver.components.AttachmentInfo",[]).component("attachmentInfo",{bindings:{profile:"<",share:"<",attachment:"<"},controller:o,templateUrl:r(457)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/AttachmentInfo.2187ed.html"},function(t,e,i){},function(t,e){t.exports='<md-sidenav md-component-id=sidepane class=md-sidenav-right> <md-toolbar class=md-theme-light layout=row layout-align="space-between center"> <md-button class=md-icon-button data-qa=message-info-back-button ng-click=$ctrl.closePane()> <md-icon>arrow_forward</md-icon> </md-button> <h1 class="md-toolbar-tools md-truncate" ng-transclude=title data-qa=message-details></h1> </md-toolbar> <md-content ng-transclude=content></md-content> </md-sidenav> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/img/filetype-image.25416e.svg"},function(t,e,i){t.exports=i.p+"assets/v2/img/filetype-pdf.4a83b2.svg"},function(t,e){t.exports='<div translate-namespace=conversation-attachments> <div class=previews> <div ng-repeat="att in $ctrl.previews | limitTo: $ctrl.previewsLimit track by att.id" class=attachment ng-class="{ \'selected\' : $ctrl.isSelectedAttachment(att) }" id="{{ \'preview-\' + att.id }}"> <div class=preview ng-click="$ctrl.preview($event, att);" ng-style=att.style> <md-icon>remove_red_eye</md-icon> </div> <a class=download ng-click="$ctrl.downloadAttachment($event, att);" download="{{:: att.name }}" target=_blank> <md-icon>file_download</md-icon> <span class="truncate filename" title="{{:: att.name }} ({{:: att.size | formatBytes }})"> {{ att.name }} </span> </a> <a class=info ng-click="$ctrl.openPaneInfo($event, att);"> <md-icon>info</md-icon> </a> </div> </div> <div class=noPreviews> <div ng-repeat="att in $ctrl.noPreviews | limitTo: $ctrl.noPreviewsLimit track by att.id" ng-class="{ \'selected\' : $ctrl.isSelectedAttachment(att) }" class=attachment> <a class=download ng-click="$ctrl.downloadAttachment($event, att);" ng-href="{{ att.downloadUrl }}" download="{{:: att.name }}" target=_blank> <md-icon>file_download</md-icon> <span class="truncate filename" title="{{:: att.name }} ({{:: att.size | formatBytes }})"> {{ att.name }} </span> </a> <a class=info ng-click="$ctrl.openPaneInfo($event, att);"> <md-icon>info</md-icon> </a> </div> </div> <div class=download-all> <span class=show-more ng-click=$ctrl.toggleAttachments() ng-if="$ctrl.showToggleAttachments() === true"> <md-icon ng-class="$ctrl.isAttachmentsCollapsed ? \'expand\' : \'collapse\'"> keyboard_arrow_down </md-icon>{{ $ctrl.attachmentsNumber }} <translate ng-if="$ctrl.attachmentsNumber === 1">.DOWNLOAD-ALL.ATTACHMENT</translate> <translate ng-if="$ctrl.attachmentsNumber > 1">.DOWNLOAD-ALL.ATTACHMENTS</translate> ({{ $ctrl.attachmentsSize | formatBytes }}) </span> <span ng-if="$ctrl.showToggleAttachments() === false"> {{ $ctrl.attachmentsNumber }} <translate ng-if="$ctrl.attachmentsNumber === 1">.DOWNLOAD-ALL.ATTACHMENT</translate> <translate ng-if="$ctrl.attachmentsNumber > 1">.DOWNLOAD-ALL.ATTACHMENTS</translate> ({{ $ctrl.attachmentsSize | formatBytes }}) </span> <a ng-if="$ctrl.message.batchDownload && $ctrl.attachmentsNumber > 1" ng-click=$ctrl.downloadAllAttachments($event) ng-href="" download=Attachments target=_blank> <md-icon>file_download</md-icon> <translate>.DOWNLOAD-ALL.BUTTON</translate> </a> </div> <attachment-carousel ng-if="$ctrl.previewAttachment !== undefined" attachments=$ctrl.previews preview-attachment=$ctrl.previewAttachment share=":: $ctrl.share"> </attachment-carousel> <sidepane ng-if="$ctrl.showSidePane === true && $ctrl.message.files.length > 0" on-close=$ctrl.closeSidePane()> <pane-title> <translate>.ATTACHMENT-PANE</translate> </pane-title> <pane-content> <attachment-info ng-if="$ctrl.attachment !== undefined" attachment=$ctrl.attachment share=$ctrl.share profile=$ctrl.profile></attachment-info> </pane-content> </sidepane> </div> '},function(t,e,s){var i=[s,e,s(1),s(465)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$q","$filter","$sce","ConversationsService","LinkifyService","MediaService","SanitizeService"],o.prototype.$onInit=function(){switch(this.contentType){case"text/html":this.setHtmlContent();break;case"text/plain":this.setTextContent()}this.contentType=this.contentType.replace("/","-")},o.prototype.setTextContent=function(){var t;this.body&&(t=(t=this.$filter("linky")(this.body,"_blank",{rel:"noopener noreferrer"})).replace(/(\r\n|\n\r|\r|\n|&#10;&#13;|&#13;&#10;|&#10;|&#13;)/g,"<br/>$1"),this.trustedBody=this.$sce.trustAsHtml(t))},o.prototype.setHtmlContent=function(){for(var e=this,n=[],t=this.SanitizeService.sanitizeHtml(this.body,this.inlineImages),o=this,i=0,s=[].slice.call(t.querySelectorAll("img"));i<s.length;i++)!function(e){var t,i;e.classList.contains("external")?(i=o.MediaService.proxy(e.getAttribute("title")).then(function(t){e.setAttribute("src",t)}),n.push(i)):e.classList.contains("internal")&&(t=e.getAttribute("attachmentId"),i=o.ConversationsService.getFileDownloadUrl(o.share,t).then(function(t){e.setAttribute("src",t)}),n.push(i))}(c=s[i]);for(var r=0,a=[].slice.call(t.querySelectorAll("table"));r<a.length;r++){var c=a[r],l=document.createElement("div");l.style.overflowX="auto",c.parentElement.insertBefore(l,c),l.appendChild(c)}this.$q.all(n).then(function(){e.trustedBody=e.$sce.trustAsHtml(t.innerHTML),"null"!==t.innerHTML&&e.LinkifyService.convertStringToLink(e.id,t.innerHTML).then(function(t){e.trustedBody=e.$sce.trustAsHtml(t)})})};var n=o;function o(t,e,i,n,o,s,r){this.$q=t,this.$filter=e,this.$sce=i,this.ConversationsService=n,this.LinkifyService=o,this.MediaService=s,this.SanitizeService=r}e.ConversationMessageBody=n,e.ConversationMessageBodyModule=i.module("components.ConversationMessageBody",[]).component("conversationMessageBody",{bindings:{body:"<",contentType:"<",id:"<",inlineImages:"<",share:"<"},controller:n,template:s(466)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<div class="message-body content-type-{{ $ctrl.contentType }}" ng-bind-html=$ctrl.trustedBody ng-if="$ctrl.body.length > 0"> </div> '},function(t,e,c){var i=[c,e,c(1),c(14),c(25),c(141),c(468)],e=function(t,e,i,s,o,n){Object.defineProperty(e,"__esModule",{value:!0}),a.$inject=["$q","$log","ConversationsService","SpecialsService","MediaService"],a.prototype.$onInit=function(){var n=this,t=this.SpecialsService.translateFormDefinition(new o.FormDefinition(this.message.messageDefinition.formDefinition));try{this.specialData=JSON.parse(this.message.body)}catch(t){return void this.$log.error("ConversationSpecial::Could not parse special JSON",{error:t})}t.sections.forEach(function(t){t.components.forEach(function(t){var e,i=n.specialData.data[t.key];void 0===i?t.visible=!1:("inputImage"===t.componentType&&(e=[].concat(n.message.files,n.message.inlineImages).filter(function(t){return t.id===i})[0],n.images.push(e),t.attachment=e,n.renderImageItem(t)),i instanceof Array?t.answerArray=i.map(function(t){return new o.FormChoice({value:t})}):t.answer=new o.FormChoice({value:i}))})}),this.sections=t.sections.filter(function(t){return 0<t.components.filter(function(t){return void 0!==t.renderType}).length}).filter(function(t){return 0<t.components.filter(function(t){return null!==t.getAnswer()}).length})},a.prototype.renderTextItem=function(i){var n,t,o=this,e=i.getAnswer();return null===e?"-":"inputDate"===i.componentType?s(e).format("D MMMM YYYY"):(t=[],t=e instanceof Array?e:[e],(void 0!==i.choices&&0<i.choices.length?(n=[],t.forEach(function(e){var t=i.choices.filter(function(t){return t.value===e});0===t.length?o.$log.warn("Could not find choice for answer",{answer:e,choices:i.choices}):n.push(t[0].labelTranslated)}),n):t).join(", "))},a.prototype.renderImageItem=function(e){var i=this;e.imgUrl=n.BLANK_GIF,!1===e.attachment.downloadable?this.$log.warn("Attached file in conversation-special is not downloadable",{share:this.share.id,file:e.attachment.id}):this.ConversationsService.getFileDownloadUrl(this.share,e.attachment.id).then(function(t){return i.MediaService.resize(t,320,240)}).then(function(t){e.imgUrl=t}).catch(function(t){i.$log.error("Error getting special image download/thumbail url",{error:t,fileId:e.attachment.id,shareId:i.share.id}),e.imgUrl=n.BLANK_GIF})},a.prototype.openCarousel=function(t){this.previewAttachment=t};var r=a;function a(t,e,i,n,o){this.$q=t,this.$log=e,this.ConversationsService=i,this.SpecialsService=n,this.MediaService=o,this.images=[]}e.ConversationSpecial=r,e.ConversationSpecialModule=i.module("components.conversationSpecial",[]).component("conversationSpecial",{bindings:{message:"<",share:"<"},controller:r,templateUrl:c(469)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/ConversationSpecial.7b2ac2.html"},function(t,e,s){var i=[s,e,s(1),s(471)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$translate"],o.prototype.$onInit=function(){this.updateFlags()},o.prototype.$onChanges=function(t){t.counters&&this.$onInit()},o.prototype.hasParticipants=function(){return void 0!==this.participants},o.prototype.updateFlags=function(){var t=this.counters.opens;!1!==this.hasParticipants()&&(t===this.participants.length?(this.opensIcon="drafts",this.opensTooltip=this.translate("OPENS-TOOLTIP.ALL")):1===t&&t<this.participants.length?(this.opensIcon="mail",this.opensTooltip=this.translate("OPENS-TOOLTIP.NONE")):(this.opensIcon="drafts",this.opensTooltip=this.translate("OPENS-TOOLTIP.SOME")))};var n=o;function o(i){this.bccIcon=s(472),this.translate=function(t,e){return i.instant("message-counters."+t,e)}}e.MessageCounters=n,e.MessageCountersModule=i.module("components.MessageCounters",[]).component("messageCounters",{bindings:{counters:"<",isBcc:"<",participants:"<",quoted:"<"},controller:n,template:s(473)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/img/bcc.09d9a1.svg"},function(t,e){t.exports='<div translate-namespace=message-counters class=message-counters ng-class="{\n\t\t\'warn\' : $ctrl.counters.hardBounces > 0\n\t}" ng-if=$ctrl.hasParticipants()> <div class=counters> <div ng-if="$ctrl.counters.hardBounces > 0" class=hard-bounces> <span>{{ $ctrl.counters.hardBounces }}</span> <md-icon>call_missed_outgoing</md-icon> <md-tooltip md-direction=left md-delay=500> <translate translate-values="{ count: $ctrl.counters.hardBounces }">.HARD-BOUNCES-TOOLTIP</translate> </md-tooltip> </div> <div ng-if="$ctrl.counters.softBounces > 0"> <span>{{ $ctrl.counters.softBounces }}</span> <md-icon>beach_access</md-icon> <md-tooltip md-direction=left md-delay=500> <translate translate-values="{ count: $ctrl.counters.softBounces }">.SOFT-BOUNCES-TOOLTIP</translate> </md-tooltip> </div> <div> <md-icon ng-class="{\n\t\t\t\t\t\'md-primary\': $ctrl.counters.opens >= $ctrl.participants.length\n\t\t\t\t}" ng-bind=$ctrl.opensIcon aria-label="Opening counter"> </md-icon> <md-tooltip md-direction=left md-delay=500> {{ $ctrl.opensTooltip }} </md-tooltip> </div> <div ng-if="$ctrl.quoted === true && $ctrl.isBcc === false" flex flex-xs=100> <md-icon class=forward-icon md-svg-src=ziv:forward-arrow aria-label="Quoted counter"> </md-icon> <md-tooltip md-direction=left md-delay=500> <translate>.QUOTED</translate> </md-tooltip> </div> <div ng-if=$ctrl.isBcc flex flex-xs=100> <img class=bcc-icon ng-src="{{ $ctrl.bccIcon }}"/> <md-tooltip md-direction=left md-delay=500> <translate>.BCC</translate> </md-tooltip> </div> </div> </div> '},function(t,e,i){i=[i,e,i(1),i(14)],e=function(t,e,i,s){function n(o){return function(t){var e=s(new Date),t=s(t.toISOString()),i=e.diff(t,"days"),e=e.isSame(t,"year"),n=e&&i<1,e=!(e&&i<=14),i=o("xs")||n||e?"":"ddd, ";return(""+t.format(i+(n?"":"D MMM YYYY")+(n?"HH:mm":", HH:mm"))).replace(/\.,/g,".")}}Object.defineProperty(e,"__esModule",{value:!0}),e.momentAgo=n,e.MomentAgoFilterModule=i.module("filters.momentAgo",[]).filter("momentAgo",["$mdMedia",n])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,a){var i=[a,e,a(1),a(13),a(55),a(476)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$scope","$log","ConversationsService"],r.prototype.$onInit=function(){var t=this;void 0!==this.message.sentByDelegate&&(this.sentBy=[new n.Participant(this.message.sentByDelegate)]),this.$scope.$watch(function(){return t.message},function(){t.message&&void 0!==t.message&&t.getReadInfo()},!0)},r.prototype.getReadInfo=function(){var i=this;void 0!==this.conversation&&this.ConversationsService.getMessageOpenedBy(this.conversation.id,this.message.id).then(function(t){i.opens=t.openedBy.map(function(t){return new n.Participant(t)}).filter(i.filterParticipants.bind(i)).sort(i.sortParticipants),i.bccRecipients=t.bccRecipients.map(function(t){return new n.Participant(t)}).filter(i.filterParticipants.bind(i)).sort(i.sortParticipants),i.notYetOpened=t.notYetOpenedBy.map(function(t){return new n.Participant(t)}).filter(i.filterParticipants.bind(i)).sort(i.sortParticipants),i.quotedBy=(t.quotedBy||[]).map(function(t){return{count:t.count,participant:new n.Participant(t.participant)}}).sort(function(t,e){return i.sortParticipants(t.participant,e.participant)}),i.outOfOffice=t.softBouncedBy.map(function(t){return new n.Participant(t)}).sort(i.sortParticipants),i.bounces=t.hardBouncedBy.map(function(t){return new n.Participant(t)}).sort(i.sortParticipants)}).catch(function(t){i.$log.warn("Error getting conversation message read info",{error:t})})},r.prototype.filterParticipants=function(t){return 1===this.conversation.participants.length||t.email!==this.profile.email},r.prototype.sortParticipants=function(t,e){return t.fullNameOrEmail().localeCompare(e.fullNameOrEmail())};var s=r;function r(t,e,i){this.$scope=t,this.$log=e,this.ConversationsService=i,this.infoType="MESSAGE",this.bounces=[],this.notYetOpened=[],this.opens=[],this.bccRecipients=[],this.outOfOffice=[],this.sentBy=[],this.quotedBy=[]}e.MessageInfoComponentModule=i.module("zivver.components.MessageInfo",[o.ParticipantsListModule.name]).component("messageInfo",{bindings:{conversation:"<",message:"<",profile:"<"},controller:s,templateUrl:a(477)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/MessageInfo.6730c6.html"},function(t,e,r){var i=[r,e,r(1),r(14),r(479)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$mdDialog","$mdMedia","$rootScope","$scope","$translate"],s.prototype.$onInit=function(){var t=this;n.locale(""+this.$translate.use()),this.translateDescription(),this.$rootScope.$on("$translateChangeSuccess",function(){t.translateDescription()})},s.prototype.translateDescription=function(){var t;void 0!==this.scheduledExpiration?(t=n(this.scheduledExpiration.expiresAt).format("dddd D MMMM YYYY, HH:mm"),this.description=this.translate(this.action.toUpperCase(),{actor:this.actor,expirationDate:t})):this.description=this.translate(this.action.toUpperCase(),{actor:this.actor})},s.prototype.editExpirationSetting=function(){this.$scope.$emit("edit-settings-from-bar")},s.prototype.resetAccess=function(){this.$scope.$emit("reset-access-from-bar")},s.prototype.showEditButton=function(){return"revoked-own"!==this.action&&!0===this.isOwn},s.prototype.showResetButton=function(){return"revoked-own"===this.action&&!0===this.isOwn};var o=s;function s(t,e,i,n,o){this.$mdDialog=t,this.$mdMedia=e,this.$rootScope=i,this.$scope=n,this.$translate=o,this.translate=function(t,e){return o.instant("expiration-bar."+t,e)}}e.ExpirationBar=o,e.ExpirationBarModule=i.module("components.ExpirationBar",[]).component("expirationBar",{bindings:{action:"<",actor:"<",isOwn:"<",scheduledExpiration:"<"},controller:o,template:r(480)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<div flex ng-class=$ctrl.action layout=row layout-align="space-between center" translate-namespace=expiration-bar> <div aria-label="Open expiration settings" layout=row layout-align="space-between center"> <div flex> <md-icon ng-class=$ctrl.action class=left-icon>history</md-icon> <span data-qa=revoke-message-text class=description>{{ $ctrl.description }}</span> </div> <md-button ng-if=$ctrl.showEditButton() ng-click=$ctrl.editExpirationSetting() data-qa=revoke-edit-button> <translate>.EDIT</translate> </md-button> <md-button ng-if=$ctrl.showResetButton() ng-click=$ctrl.resetAccess() data-qa=revoke-reset-button> <translate>.RESET</translate> </md-button> </div> </div> '},function(t,e,n){var i=[n,e,n(482)],e=function(t,e){function i(t,e,i,n,o,s,r,a,c){this.$log=t,this.$mdDialog=e,this.$state=i,this.ConversationsService=n,this.MessengerService=o,this.SignupService=s,this.conversationId=r,this.email=a,this.messageId=c,this.loading=!1,this.subState="SUBMIT"}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$log","$mdDialog","$state","ConversationsService","MessengerService","SignupService","conversationId","email","messageId"],i.prototype.$onInit=function(){this.email=this.email.toLowerCase()},i.prototype.close=function(){return this.$mdDialog.cancel()},i.prototype.sendCopyToInbox=function(){this.$mdDialog.hide("sendCopy")},i.prototype.signup=function(){var e=this;this.loading=!0,this.$state.transitionTo("signup",{email:this.email},{location:"replace"}).then(function(){e.subState="DONE",e.loading=!1}).catch(function(t){e.subState="ERROR",e.loading=!1,e.$log.warn("Error signing up from GuestForwardDialog",{error:t})})},i.factory=function(t){return{controller:i,templateUrl:n(483),locals:t}},e.GuestForwardDialog=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/GuestForwardDialog.6f2dfe.html"},function(t,e,n){var i=[n,e,n(485)],e=function(t,e){function i(t,e,i,n,o){this.$log=t,this.$mdDialog=e,this.$translate=i,this.email=n,this.level=o}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$log","$mdDialog","$translate","email","level"],i.prototype.$onInit=function(){var t=this.$translate.use().toLowerCase();this.link="https://docs.zivver.com/"+t+"/references/general/save-zivver-message.html",this.message="dane"===this.level.toLowerCase()?"send-copy-dialog.DANE":"send-copy-dialog.TLS"},i.prototype.close=function(){this.$mdDialog.cancel()},i.prototype.submit=function(){this.$mdDialog.hide()},i.factory=function(t){return{controller:i,templateUrl:n(486),locals:t}},e.SendCopyDialog=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SendCopyDialog.6dedb9.html"},function(t,e,i){},function(t,e){t.exports='<md-card id="msg-{{:: $ctrl.message.id }}" translate-namespace=conversation-message layout-wrap ng-class="{\n\t\t\'own\' : $ctrl.message.isOwn === true,\n\t\t\'new\': $ctrl.message.isNew === true,\n\t\t\'revoked\' : $ctrl.message.revoked === true,\n\t\t\'selected\' : $ctrl.showSidePane === true\n\t}"> <div layout=row flex> <expiration-bar ng-if=$ctrl.showExpirationBar() action=$ctrl.getMessageAction() actor=$ctrl.message.sender is-own=$ctrl.message.isOwn scheduled-expiration=$ctrl.message.scheduledExpiration> </expiration-bar> </div> <div class=header-container layout=row layout-align="space-between start" ng-class="{\'hasExpirationBar\': $ctrl.showExpirationBar()}"> <md-card-header> <md-card-avatar> <avatar avatar-entity=$ctrl.sender avatar-size=md></avatar> </md-card-avatar> <md-card-header-text> <span class=md-title layout=row layout-align="space-between center"> <div class=sender-info flex> <span class="truncate fullname" ng-if=$ctrl.sender.fullName> {{:: $ctrl.sender.fullName }} </span> <span class="truncate sender"> <span class="truncate sent-by" ng-if=":: $ctrl.message.sentByDelegate" translate translate-values="{ delegate : $ctrl.message.sentByDelegate.fullName}"> .SENT-BY </span> <a class="truncate sent-by" ng-if=$ctrl.showSenderWithLink() ui-sref="drafts.create({ to: [ $ctrl.sender.email ]})"> {{:: $ctrl.sender.email }} </a> <span class="truncate sent-by" ng-if=$ctrl.showSender()> {{:: $ctrl.sender.email }} </span> </span> </div> <div layout=row layout-align="space-between center" class=actions-wrapper> <div class=menu-actions ng-class="{\'hide-actions\' : $ctrl.isRevokedBccQuote()}" ng-if="$ctrl.sender.active === true"> <md-button type=button aria-label=Reply class=md-icon-button ng-click=$ctrl.replyMessage() ng-if=":: $ctrl.message.isOwn === false && $ctrl.canCreateDraft" ng-disabled="$ctrl.canQuote === false || $ctrl.message.revoked"> <md-tooltip md-delay=500> <translate>.ACTIONS.REPLY</translate> </md-tooltip> <md-icon aria-label="Reply to sender">reply</md-icon> </md-button> </div> <div class=menu-actions ng-class="{ \'hide-actions\' : $ctrl.isRevokedBccQuote() }" ng-if="$ctrl.hasActions() || $ctrl.sender.active === true"> <md-menu md-position-mode="target-right bottom"> <md-button aria-label="More options" class=md-icon-button ng-click="$ctrl.openMenu($mdMenu, $event)" data-qa=more-options-window> <md-tooltip md-delay=500> <translate>.ACTIONS.MORE</translate> </md-tooltip> <md-icon aria-label="More options" md-menu-origin>more_vert</md-icon> </md-button> <md-menu-content class=message-info width=4> <md-menu-item ng-if=":: $ctrl.message.isOwn === false && $ctrl.canCreateDraft"> <md-button aria-label=Reply ng-click=$ctrl.replyMessage() ng-disabled="$ctrl.canQuote === false || $ctrl.message.revoked"> <md-icon>reply</md-icon> <translate>.ACTIONS.REPLY</translate> </md-button> </md-menu-item> <md-menu-item ng-if="$ctrl.canQuote === true || $ctrl.message.revoked === false"> <md-button aria-label=Forward ng-click=$ctrl.forwardMessage()> <md-icon>forward</md-icon> <translate>.ACTIONS.FORWARD</translate> </md-button> </md-menu-item> <md-menu-item> <md-button aria-label=file_copy ng-click=$ctrl.sendCopyToInbox()> <md-icon>input</md-icon> <span translate translate-value-email="{{ $ctrl.profile.email }}"> .ACTIONS.SEND-COPY </span> </md-button> </md-menu-item> <md-menu-item class=download-message> <md-button aria-label="Download message" ng-click=$ctrl.downloadMessage($event); ng-disabled=$ctrl.message.revoked> <md-icon>file_download</md-icon> <translate>.ACTIONS.DOWNLOAD</translate> </md-button> </md-menu-item> <md-menu-item class=print-message> <md-button aria-label="Print message" ng-click=$ctrl.printMessage() ng-disabled=$ctrl.message.revoked> <md-icon>print</md-icon> <translate>.ACTIONS.PRINT</translate> </md-button> </md-menu-item> <md-menu-item ng-if="$ctrl.message.isOwn && $ctrl.message.revoked === false"> <md-button aria-label="Revoke access to this message" ng-click=$ctrl.revokeAccess(); ng-disabled=$ctrl.message.revoked data-qa=revoke-access-button> <md-icon>remove_circle</md-icon> <translate>.ACTIONS.REVOKE</translate> </md-button> </md-menu-item> <md-menu-item ng-if="$ctrl.message.isOwn && $ctrl.message.revoked"> <md-button aria-label="Unrevoke access to this message" ng-click=$ctrl.unRevokeAccess();> <md-icon>undo</md-icon> <translate>.ACTIONS.UNREVOKE</translate> </md-button> </md-menu-item> <md-menu-item ng-if=":: $ctrl.showCounters === true"> <md-button aria-label="Open message info sidenav" data-qa=message-info-guest ng-click=$ctrl.openSidePane()> <md-icon>info</md-icon> <translate>.ACTIONS.INFO</translate> </md-button> </md-menu-item> <md-menu-item ng-if="$ctrl.profile.features.hasProofOfDelivery === true"> <md-button aria-label="Proof of delivery" data-qa=message-proof-of-delivery ng-click=$ctrl.downloadProofOfDelivery(!$ctrl.message.isOwn)> <md-icon>done_all</md-icon> <translate>{{ $ctrl.message.isOwn ? \'.ACTIONS.DOWNLOAD-DELIVERY\' : \'.ACTIONS.DOWNLOAD-RECEIPT\' }}</translate> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> </div> </span> </md-card-header-text> </md-card-header> </div> <md-card-content ng-switch=":: $ctrl.message.contentType" ng-class="[ $ctrl.contentType, { \'no-counters\' : $ctrl.showCounters === false } ]"> <div class=revoked-notice ng-if=$ctrl.showRevokedNotice()> <p translate translate-compile ng-if=$ctrl.isRevokedBccQuote()> .REVOKED-OWN-MESSAGE.BCC-ORIGINAL </p> </div> <conversation-special ng-switch-when=application/zivver-special+json ng-if="$ctrl.message.revoked === false" message=$ctrl.message share=$ctrl.share></conversation-special> <div class=bcc-info ng-if=$ctrl.message.isBcc translate translate-compile> .BCC-INFO </div> <conversation-message-body ng-switch-default id=":: $ctrl.conversation.id + \'-\' + $ctrl.message.id" content-type=":: $ctrl.message.contentType" body=":: $ctrl.message.body" inline-images=":: $ctrl.message.files" share=$ctrl.share></conversation-message-body> <conversation-attachments ng-if="$ctrl.message.files.length > 0" ng-class="{ \'no-message\' : $ctrl.message.body === \'\' }" profile=$ctrl.profile message=$ctrl.message share=$ctrl.share></conversation-attachments> <conversation-quote ng-if=":: $ctrl.message.quote && $ctrl.isRevokedBccQuote() === false" quote=":: $ctrl.message.quote" conversation=$ctrl.conversation profile=$ctrl.profile share=$ctrl.share class=conversation-quote></conversation-quote> <div class=counters ng-class="{ \'has-bounces\' : ($ctrl.message.counters.hardBounces > 0 || $ctrl.message.counters.softBounces > 0)}" layout=row layout-align="space-between start"> <message-counters ng-if=":: $ctrl.showCounters" participants=$ctrl.conversation.participants counters=$ctrl.message.counters quoted=$ctrl.message.quoted is-bcc=$ctrl.message.isBcc ng-click=$ctrl.openSidePane()></message-counters> <span></span> <time class=moment-date datetime="{{:: $ctrl.message.createdDate | date : \'yyyy-MM-dd HH:mm:ss\' }}"> {{:: $ctrl.message.createdDate | momentAgo }} </time> </div> </md-card-content> <a ng-href="{{ $ctrl.downloadMessageUrl }}" target=_blank class=downloadMessage download></a> <sidepane ng-if="$ctrl.showCounters === true && $ctrl.showSidePane === true" on-close=$ctrl.closeSidePane()> <pane-title> <translate>.INFO-PANE</translate> </pane-title> <pane-content> <message-info profile=$ctrl.profile conversation=$ctrl.conversation message=$ctrl.message></message-info> </pane-content> </sidepane> </md-card> '},function(t,e,i){},function(t,e){t.exports='<div translate-namespace=conversation-quote> <ng-repeat ng-repeat="message in $ctrl.quote.messages | orderBy:\'id\' track by message.id"> <div class=message-quoted ng-class="{\n\t\t\t\t revoked : message.revoked,\n\t\t\t\t bcc : message.isBcc,\n\t\t\t\t forwardedConversation : $ctrl.isForwardedConversation,\n\t\t\t\t selected : $ctrl.isSelectedMessage(message.id)\n\t\t\t }" layout=row layout-xs=column flex> <div class=labels> <span translate ng-if=message.isBcc data-qa=bcc-tag-for-recipient> .BCC-LABEL </span> <span translate class=original ng-if="message.isBcc && $ctrl.isOwnMessage(message)" ng-click=$ctrl.showOriginal()> .BCC-ORIGINAL </span> </div> <div class="fill-width header quote-information" layout=row layout-align="space-between center"> <span ng-if=$ctrl.isSenderVisible(message) class="sender truncate"> {{:: message.participant.fullName || message.participant.email }} </span> <span flex></span> <div class=attachment-counter ng-if="message.files.length > 0"> <span>{{message.files.length}}</span> <md-icon aria-label="Attachment counter">attach_file</md-icon> </div> <time ng-if="message.isBcc === false" class=moment-date datetime="{{:: message.createdDate | date : \'yyyy-MM-dd HH:mm:ss\' }}"> {{ message.createdDate | momentAgo }} </time> <md-checkbox aria-label="select message" class=md-primary ng-click=$ctrl.toggleSelectMessage(message.id) ng-checked=$ctrl.isSelectedMessage(message.id) ng-if=$ctrl.isForwardedConversation data-qa=selected-message></md-checkbox> </div> <div ng-if=$ctrl.areRecipientsVisible(message) class="fill-width header quote-information-recipients" layout=row ng-class="$ctrl.getAreRecipientsExpandable(message.id) ? \'expandable-recipients\' : \'non-expandable-recipients\'" ng-click=$ctrl.toggleRecipientsExpansion(message.id)> <div ng-class="{ \'truncate\' : $ctrl.getAreRecipientsExpanded(message.id) === false }"> <span class=to translate>.TO</span> <span id=recipients-{{message.id}} class=recipients> {{ $ctrl.getRecipients(message.participant) }} </span> </div> <md-icon ng-if=$ctrl.getAreRecipientsExpandable(message.id) class=expand-icon ng-class="{ \'hide-when-no-truncation\' : $ctrl.getAreRecipientsExpandable(message.id) === false && $ctrl.getAreRecipientsExpanded(message.id) === false }" ng-bind="$ctrl.getAreRecipientsExpanded(message.id) === false ? \'expand_more\' : \'expand_less\'"></md-icon> <md-tooltip ng-if=$ctrl.getAreRecipientsExpandable(message.id) md-delay=500 md-direction=right> <translate ng-if="$ctrl.getAreRecipientsExpanded(message.id) === false">.TRUNCATED-RECIPIENTS.SHOW-MORE</translate> <translate ng-if=$ctrl.getAreRecipientsExpanded(message.id)>.TRUNCATED-RECIPIENTS.SHOW-LESS</translate> </md-tooltip> </div> <div ng-if="message.revoked === true && message.isBcc === false" class="conversation-message-body info"> <div translate translate-value-email={{message.sender}} class="message-body conversation-quote"> .QUOTED.NO-ACCESS </div> </div> <conversation-message-body class=conversation-message-body ng-if="message.revoked === false || $ctrl.isOwnMessage(message) === true" id=":: $ctrl.conversation.id + \'-\' + message.id" content-type=":: message.contentType" body=":: message.body" inline-images=":: message.files" share=$ctrl.share></conversation-message-body> <conversation-attachments ng-if="message.revoked === false && message.files.length > 0" class=conversation-attachments ng-class="{ \'no-message\' : message.body === \'\' }" profile=$ctrl.profile message=message share=":: $ctrl.share"></conversation-attachments> </div> </ng-repeat> </div> '},function(t,e,c){var i=[c,e,c(9),c(1),c(55),c(15),c(492)],e=function(t,e,i,n,o,s){Object.defineProperty(e,"__esModule",{value:!0}),a.$inject=["$log","$scope","$state","$translate","$uiRouterGlobals","DeviceService","MessengerService","OrganizationService","SpecialsService"],a.prototype.$onInit=function(){var i=this;if(void 0!==this.conversation.specialId&&(this.draft=new s.Draft,void 0!==this.conversation.flow))return this.inSpecial();this.$scope.$on(o.Events.Updated,function(t,e){i.conversation.participants=e}),this.$scope.$on("reply-all",function(){i.reply()})},a.prototype.reply=function(){this.$state.go("conversations.reply",i.__assign({},this.$uiRouterGlobals.params))},a.prototype.forwardConversation=function(){var t=this.messages.filter(function(t){return!1===t.revoked&&!1===t.deleted}).map(function(t){return t.id});0===t.length?this.MessengerService.alert("conversation-reply.NO-FORWARD",""):(t={draftType:"forward",quote:{conversationId:this.conversation.id,messageIds:t},share:this.share,subject:"FW: "+this.conversation.subject},this.$state.go("drafts.create",t))},a.prototype.inSpecial=function(){var t=this,e=(this.draft.draftType="plain",this.draft.contentType="application/zivver-special+json",this.conversation.flow.responses);0!==e.length&&(1===e.length?(this.formDefinition=e[0].formDefinition,this.draft.messageDefinitionId=e[0].id):this.$log.warn("More than one responses available. Not yet implemented.")),this.$scope.$on("conversations.replied",function(){t.updateFlow()})},a.prototype.updateFlow=function(){var e=this;void 0!==this.conversation.specialId&&this.SpecialsService.getConversationFlow(this.conversation.id).then(function(t){e.conversation.flow=t})};var r=a;function a(t,e,i,n,o,s,r,a,c){this.$log=t,this.$scope=e,this.$state=i,this.$translate=n,this.$uiRouterGlobals=o,this.DeviceService=s,this.MessengerService=r,this.OrganizationService=a,this.SpecialsService=c}e.ConversationReply=r,e.ConversationReplyModule=n.module("components.ConversationReply",[]).component("conversationReply",{bindings:{conversation:"<",messages:"<",share:"<"},controller:r,template:c(493)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports=' <div translate-namespace=conversation-reply ng-if="$ctrl.conversation.specialId === undefined"> <section flex=100 class=actions layout=row layout-align="left center"> <div layout=row layout-align="space-between center"> <md-button aria-label="conversation reply button" class=md-primary ng-click=$ctrl.reply() data-qa=reply-button> <md-icon ng-if="$ctrl.conversation.participants.length <= 2">reply</md-icon> <md-icon ng-if="$ctrl.conversation.participants.length > 2">reply_all</md-icon> <translate ng-if="$ctrl.conversation.participants.length <= 2">.REPLY</translate> <translate ng-if="$ctrl.conversation.participants.length > 2">.REPLY-ALL</translate> </md-button> <md-button aria-label="forward conversation button" class=md-primary ng-click=$ctrl.forwardConversation() ng-if="$ctrl.conversation.systemLabel.name === \'inbox\' || $ctrl.conversation.systemLabel.name === \'archive\'" data-qa=forward-button> <md-icon>forward</md-icon> <translate>.FORWARD</translate> </md-button> </div> </section> </div> <draft-special ng-if="$ctrl.conversation.specialId !== undefined && $ctrl.conversation.flow.responses.length > 0" type=response draft=$ctrl.draft conversation=":: $ctrl.conversation" download-grant-token=":: $ctrl.token" message-definition=$ctrl.draft.messageDefinitionId form-definition=$ctrl.formDefinition></draft-special> '},function(t,e,s){var i=[s,e,s(1),s(495)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$translate"],o.prototype.closeSurvey=function(){this.onClose()},o.prototype.getFeedbackUrl=function(t){return"https://survey.zivver.com/798254?lang="+this.$translate.use()+"&id=guestopen&shareid="+this.shareId+"&sort="+t};var n=o;function o(t){this.$translate=t}e.SurveyToolModule=i.module("components.SurveyTOol",[]).component("surveyTool",{bindings:{shareId:"<",onClose:"&"},controller:n,templateUrl:s(496)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SurveyTool.9b98bb.html"},function(t,e,i){i=[i,e,i(1),i(32),i(13),i(82),i(190),i(33),i(181),i(191),i(500),i(27)],e=function(t,e,n,o,s,i,r,a,c,l,u,p){function d(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v,g){var S=this;this.labelCollection=t,this.profile=e,this.profileProgress=i,this.$log=n,this.$mdDialog=o,this.$q=s,this.$mdMedia=r,this.$rootScope=a,this.$scope=c,this.$state=l,this.$timeout=u,this.$transitions=p,this.$window=d,this.hotkeys=h,this.AppSwitcherService=f,this.ConversationsService=m,this.MessengerService=v,this.WebSocketService=g,this.items=[],this.listAction="DEFAULT",this.loading=!0,this.refreshing=!0,this.search={textInput:"",debounce:void 0,inProgress:!1,wasPerformed:!1},this.selectedItems=0,this.excludedComposeLabels=["trash"],this.excludedSearchLabels=["trash"],this.registerEvents(),this.enableHotkeys(),this.specialId=this.AppSwitcherService.getContext().specialId,this.listedLabel=this.validateLabel(l.params.label),void 0===l.params.keywords?this.getConversations("desc"):(this.loading=!1,this.initSearch(l.params.keywords,this.listedLabel)),this.setPlaceholder(this.listedLabel),this.$transitions.onSuccess({to:"conversations.label"},function(t){t=t.params().label;"SEARCH"===S.listAction||"DEFAULT"===S.listAction&&S.listedLabel!==t?(S.listedLabel=S.validateLabel(t),S.refresh(!0)):"SELECT"===S.listAction&&S.listedLabel!==t&&(S.listedLabel=S.validateLabel(t),S.clearSelection(),S.refresh(!0)),S.setPlaceholder(S.listedLabel)})}Object.defineProperty(e,"__esModule",{value:!0}),e.ListControllerModule=n.module("app.conversations.ListController",[a.AppSwitcherModule.name,l.ComposeButtonModule.name,i.IfEmptyFilterModule.name,c.ParticipantAvatarsModule.name,u.QuickSelectModule.name,r.TruncateFilterModule.name,p.WarningDialogModule.name]),d.$inject=["labelCollection","profile","profileProgress","$log","$mdDialog","$q","$mdMedia","$rootScope","$scope","$state","$timeout","$transitions","$window","hotkeys","AppSwitcherService","ConversationsService","MessengerService","WebSocketService"],d.prototype.setPlaceholder=function(t){this.placeholderItem="archive"===t?"archive":"trash"===t?"trash":"conversations"},d.prototype.openItem=function(t){"SELECT"===this.listAction?(t.isSelected=!t.isSelected,!0===t.isSelected?this.selectedItems++:this.selectedItems--):this.isItemActive(t)||(t={conversationId:t.id,label:this.listedLabel},"SEARCH"===this.listAction&&(t.keywords=this.search.textInput),this.$state.go("conversations.view",t,{reload:"conversations.view"}))},d.prototype.loadMoreConversations=function(){var t;0<this.items.length&&(t=this.items[this.items.length-1].lastMessageDate),this.getConversations("desc",t)},d.prototype.clearSelection=function(){this.selectedItems=0,this.items.forEach(function(t){return t.isSelected=!1}),this.listAction="DEFAULT"},d.prototype.showLabels=function(t,e){return void 0===e&&(e=!1),t="SEARCH"===this.listAction&&this.search.wasPerformed?[t.systemLabel].concat(t.customLabels):t.customLabels,e?t.slice(3):t.slice(0,3)},d.prototype.getConversations=function(t,e){var i=this,t=(this.refreshing=!0,this.ConversationsService.list(t,e,this.listedLabel,50,this.specialId));t.then(function(t){var e;"SEARCH"!==i.listAction&&(i.lastRefresh=Date.now(),i.totalItems=t.pagination.total,e=t.items.map(function(t){return t.id}),i.items=i.items.filter(function(t){return-1===e.indexOf(t.id)}).concat(t.items).sort(i.sortConversations),i.initRefresh())}),t.catch(function(t){i.$log.warn("error fetching conversations",{error:t})}),t.finally(function(){i.loading=!1,i.$timeout(function(){i.refreshing=!1},500)})},d.prototype.initSearch=function(e,i){var n=this;this.listAction="SEARCH",this.$timeout(function(){var t=n.$window.document.getElementById("search-text-input");t.focus(),void 0!==e&&3<=e.length&&void 0!==i&&(t.value=e,n.searchKeyword(e))},0,!1)},d.prototype.searchTextOnChange=function(){this.search.inProgress=!0,void 0!==this.search.debounce&&this.$timeout.cancel(this.search.debounce),this.search.textInput&&3<=this.search.textInput.length?this.searchKeyword(this.search.textInput):(void 0===this.search.textInput||this.search.textInput.length<=3)&&(this.items=[],this.search.wasPerformed=!1)},d.prototype.searchKeyword=function(e){var i=this;this.search.debounce=this.$timeout(function(){var t;i.$scope.$$destroyed||(i.loading=!0,(t=n.copy(i.$state.params)).keywords=e,i.$state.go(i.$state.current.name,t,{notify:!1}),i.ConversationsService.search(e,i.specialId).then(function(t){return i.search.wasPerformed=!0,i.ConversationsService.getBatch(t.map(function(t){return t.conversationId}))}).then(function(t){i.items=t}).catch(function(){i.MessengerService.toast("CONVERSATIONS.LIST.SEARCH.ERROR")}).finally(function(){i.loading=!1}))},500,!1)},d.prototype.searchClose=function(){this.$timeout.cancel(this.search.debounce),this.search={textInput:"",debounce:void 0,inProgress:!1,wasPerformed:!1},this.listAction="DEFAULT";var t=n.copy(this.$state.params);t.keywords=void 0,this.$state.go(this.$state.current.name,t,{reload:!1}),this.refresh(!0)},d.prototype.isItemActive=function(t){var e=this.$state.current.name;return"conversations.open"===e&&this.$state.params.shareId===t.share||"conversations.view"===e&&this.$state.params.conversationId===t.id||"conversations.reply"===e&&this.$state.params.conversationId===t.id},d.prototype.validateLabel=function(t){return this.labelCollection.getAll().map(function(t){return t.name.toLowerCase()}).indexOf(t.toLowerCase())<0?(this.$log.debug("label '"+t+"' was not defined in this.labels"),"inbox"):t},d.prototype.initRefresh=function(){var t=this;this.WebSocketService.isOpen()||this.$timeout(function(){t.refresh()},3e4,!1)},d.prototype.refresh=function(t){var e;void 0===t&&(t=!1),this.$scope.$$destroyed||!1===t&&this.refreshing||(e=Date.now(),!1===t&&e-this.lastRefresh<3e4||"SEARCH"===this.listAction||"SELECT"===this.listAction||"hidden"===this.$window.document.visibilityState&&0<this.items.length?this.initRefresh():!0===t?(this.loading=!0,this.items=[],this.selectedItems=0,this.getConversations("desc")):(e=void 0,0<this.items.length&&(e=this.items[0].lastMessageDate),this.getConversations("asc",e)))},d.prototype.registerEvents=function(){function t(){return i.$timeout(function(){return i.refresh()},500)}var i=this;this.$scope.$on("conversation-moved",function(t,e){i.items=i.items.filter(function(t){return t.id!==e}),i.totalItems--,i.$state.go("conversations.label",{label:i.listedLabel})}),this.$scope.$on("conversation:updated",function(t,e){i.items=i.items.map(function(t){return t.id===e.id?e:t}).sort(i.sortConversations)}),this.$window.document.addEventListener("visibilitychange",t),this.$scope.$on("$destroy",function(){i.$window.document.removeEventListener("visibilitychange",t)}),this.$rootScope.$on("push.conversations",function(){i.$log.debug("Updating list of conversations, from push notifications"),i.refresh()}),this.$scope.$on(o.WebSocketEvents.CONVERSATION_UPDATED,function(){i.$log.debug("Websocket received a updated conversation, refreshing list"),i.refresh()}),this.$scope.$on(s.LabelEvents.Updated,function(t,e){i.labelCollection=e,i.ConversationsService.setLabels(i.labelCollection),i.items.forEach(function(t){return t.updateLabelCollection(i.labelCollection)})}),this.$scope.$on(s.LabelEvents.Deleted,function(t,e){i.items.forEach(function(t){return t.removeLabelById(e)})})},d.prototype.enableHotkeys=function(){var e=this;this.hotkeys.bindTo(this.$scope).add({combo:"/",callback:function(t){t.preventDefault(),e.initSearch()}}).add({combo:"esc",allowIn:["INPUT"],callback:function(t){t.preventDefault(),e.searchClose()}})},d.prototype.sortConversations=function(t,e){return t.lastMessageDate>e.lastMessageDate?-1:1},d.prototype.moveConversations=function(e){var i,n=this;this.items.filter(function(t){return t.isSelected}).length<1?this.MessengerService.toast("CONVERSATIONS.LIST.MOVE.NONE"):(this.listAction="DEFAULT",this.selectedItems=0,i=[],this.items.filter(function(t){return t.isSelected}).forEach(function(t){i.push(n.ConversationsService.moveConversation(t,e))}),this.$q.all(i).then(function(){n.MessengerService.toast("CONVERSATIONS.LIST.MOVE.SUCCESS."+e),n.totalItems=n.totalItems-i.length,n.items=n.items.filter(function(t){return!1===t.isSelected}),n.$state.go("conversations.label",{label:n.listedLabel})}).catch(function(t){n.$log.warn("Error unarchiving conversations",{error:t}),n.MessengerService.toast("CONVERSATIONS.LIST.MOVE.ERROR")}))},d.prototype.deleteItems=function(){var t,i,n=this,e=this.items.filter(function(t){return t.isSelected});e.length<1?this.MessengerService.toast("CONVERSATIONS.LIST.MOVE.NONE"):(t=p.WarningDialog.factory({title:"conversation-header.DELETE.TITLE",explanation:1<e.length?"conversation-header.DELETE.EXPLANATION-MULTIPLE":"conversation-header.DELETE.EXPLANATION",submitText:"conversation-header.DELETE.CONFIRM",type:p.WarningDialogTypes.error}),i=[],this.$mdDialog.show(t).then(function(){e.reduce(function(t,e){return t.then(function(){return n.ConversationsService.removeConversation(e.share).then(function(t){i.push(t)}).catch(function(t){n.$log.warn("error deleting conversation",{error:t})})})},n.$q.resolve()).then(function(){i.every(function(t){return!0===t})?n.MessengerService.toast("CONVERSATIONS.LIST.DELETE-SUCCESS"):n.MessengerService.toast("CONVERSATIONS.LIST.DELETE-SOME-SUCCESS"),n.clearSelection(),n.refresh(!0),n.$state.go("conversations.label",{label:n.listedLabel})}).catch(function(t){n.$log.warn("error while deleting conversations",{error:t})})}))},e.ListController=d}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<div translate-namespace=compose-button> <md-button class="md-fab md-primary" aria-label="{{:: $ctrl.options[0].label}}" ui-sref="{{ $ctrl.options[0].state}}($ctrl.options[0].stateParams)" ng-if="$ctrl.options.length === 1" data-qa=compose-button> <md-icon>{{:: $ctrl.options[0].icon }}</md-icon> <md-tooltip md-delay=500 md-direction=top>{{:: $ctrl.options[0].label}}</md-tooltip> </md-button> <md-fab-speed-dial md-open=$ctrl.speedDialOpen md-direction=up class=md-scale ng-if="$ctrl.options.length > 1"> <md-fab-trigger> <md-button aria-label=menu class="md-fab md-primary"> <md-icon>apps</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <div ng-repeat="option in $ctrl.options"> <md-button ui-sref="{{ option.state }}(option.stateParams)" aria-label="{{:: option.label }}" class="md-fab md-raised md-mini"> <md-icon>{{:: option.icon }}</md-icon> <md-tooltip md-direction=left>{{:: option.label }}</md-tooltip> </md-button> </div> </md-fab-actions> </md-fab-speed-dial> </div> '},function(t,e,r){var i=[r,e,r(1),r(13),r(501)],e=function(t,e,i,s){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","$scope","$state","LabelService"],o.prototype.getLabels=function(){var e=this;this.LabelService.getLabels().then(function(t){return e.userLabels=t.userLabels.filter(function(t){return 0<t.counter})}).catch(function(t){e.$log.warn("Error getting labels",{error:t})})},o.prototype.goToSysItem=function(t){this.$state.go(t.state,t.stateParams)},o.prototype.sysItemActive=function(t){return"conversations.label"===t.state?this.$state.includes(t.state,t.stateParams):"drafts.index"===t.state?this.$state.includes(t.state)||this.$state.includes("drafts.edit")||this.$state.includes("draft.create"):void 0},o.prototype.labelActive=function(t){return this.$state.params.label===t.name},o.prototype.showLabelConversations=function(t){this.$state.go("conversations.label",{label:t.name})},o.prototype.goTo=function(t){this.$state.go(t)};var n=o;function o(t,e,i,n){var o=this;this.$log=t,this.$scope=e,this.$state=i,this.LabelService=n,this.sysItems=[{state:"conversations.label",stateParams:{label:"inbox"},label:"INBOX",icon:"question_answer"},{state:"drafts.index",label:"DRAFTS",icon:"rate_review"},{state:"conversations.label",stateParams:{label:"archive"},label:"ARCHIVE",icon:"archive"},{state:"conversations.label",stateParams:{label:"trash"},label:"TRASH",icon:"delete"}],this.userLabels=[],this.$scope.$on(s.LabelEvents.Updated,function(t,e){o.userLabels=e.userLabels.filter(function(t){return 0<t.counter})}),this.$scope.$on(s.LabelEvents.Deleted,function(t,e){o.userLabels=o.userLabels.filter(function(t){return t.id!==e})}),this.getLabels()}e.QuickSelect=n,e.QuickSelectModule=i.module("components.QuickSelect",[]).component("quickSelect",{controller:n,templateUrl:r(502)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/QuickSelect.c45cd5.html"},function(t,e,c){var i=[c,e,c(1),c(504),c(8),c(11),c(507)],e=function(t,e,i,n,o,s){Object.defineProperty(e,"__esModule",{value:!0}),a.$inject=["$log","$scope","$state","$uiRouterGlobals","AuthSessionService","MessengerService","RecoveryKeyService","StorageService"],a.prototype.recoverMessages=function(){var i=this,t={recoveryCode:this.form.recoveryCode.$viewValue};this.submittingForm=!0,this.RecoveryKeyService.requestRecovery(t).then(function(t){t.details.recoveries.some(function(t){return t.accountKeyId===i.recovery.accountKeyId&&0<t.recovered})?i.$state.go("conversations.open",{shareId:i.share.id},{reload:!0}):(i.$scope.$broadcast("reset.recovery-form"),i.MessengerService.toast(i.translationNamespace+"."+i.error+".DIFFERENT-RECOVERY",{},!0,8e3))}).catch(function(t){i.$log.info("Could not recover code: ",{error:t}),i.form.recoveryCode.$setDirty();var e=t.status,t=t.data.reason;e===o.HTTP_NOT_FOUND&&"accessibleValue"===t?i.form.recoveryCode.$setValidity("currentCode",!1):i.form.recoveryCode.$setValidity("codeInvalid",!1)}).finally(function(){i.submittingForm=!1})},a.prototype.redirectMfaSetup=function(){var t;this.StorageService.setItem("SESSION","security.redirect",{name:"conversations.view",params:{conversationId:null==(t=this.conversation)?void 0:t.id,label:this.$uiRouterGlobals.params.label}}),this.$state.go("settings.security",{highlight:"2fa"})},a.prototype.isRecoverDisabled=function(){return!0===this.submittingForm||!0===this.form.$invalid||void 0===this.form.recoveryCode||void 0===this.form.recoveryCode.$viewValue||""===this.form.recoveryCode.$viewValue},a.prototype.showRecoverySection=function(){return this.canRecover=this.AuthSessionService.hasScope(s.Scopes.USERECOVERYCODE)&&!1===this.AuthSessionService.isDelegate(),this.isRecoveryError&&void 0!==this.recovery&&this.canRecover};var r=a;function a(t,e,i,n,o,s,r,a){this.$log=t,this.$scope=e,this.$state=i,this.$uiRouterGlobals=n,this.AuthSessionService=o,this.MessengerService=s,this.RecoveryKeyService=r,this.StorageService=a,this.translationNamespace="conversation-error";t=this.$uiRouterGlobals.params,e=t.conversation,i=t.share,n=t.error,o=t.recovery;this.conversation=e,this.share=i,this.error=n,this.recovery=o,this.isRecoveryError=-1<this.error.indexOf("DECRYPT")}e.ConversationError=r,e.ConversationErrorModule=i.module("components.ConversationError",[n.RecoverMessagesModule.name]).component("conversationError",{bindings:{profile:"<"},controller:r,templateUrl:c(508)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,s){var i=[s,e,s(1),s(505)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","$scope","$timeout","$translate","RecoveryKeyService"],o.prototype.$onInit=function(){var t,e=this;void 0!==this.recovery?(this.recoverySent=new Date(this.recovery.sent),this.label=this.recovery.label,this.subject=(null==(t=this.recovery.messageSubject)?void 0:t.substring(this.label.length))||this.$translate.instant("recover-messages.RECOVERY-CODE.SUBJECT.TEXT")):void 0!==this.resetInfo?(this.recoveryCodeMandatory=this.resetInfo.recoveryCodeMandatory,this.recoverySent=new Date(this.resetInfo.recoverySent),this.label=this.resetInfo.recoveryLabel,this.subject=(null==(t=this.resetInfo.recoveryMessageSubject)?void 0:t.substring(this.label.length))||this.$translate.instant("recover-messages.RECOVERY-CODE.SUBJECT.TEXT")):(this.getRecoveryInfo(),this.subject=this.$translate.instant("recover-messages.RECOVERY-CODE.SUBJECT.TEXT")),this.$scope.$on("reset.recovery-form",function(){e.recoveryCode=""})},o.prototype.getRecoveryInfo=function(){var e=this;this.RecoveryKeyService.getInaccessibles().then(function(t){e.recoveryCodeMandatory=t.inaccessibles[0].recovered,e.recoverySent=new Date(t.inaccessibles[0].recoverySent)}).catch(function(t){e.$log.error("failed to get the recovery code info: ",{reason:t})})};var n=o;function o(t,e,i,n,o){var s=this;this.$log=t,this.$scope=e,this.$timeout=i,this.$translate=n,this.RecoveryKeyService=o,this.$timeout(function(){s.$scope.$watch(function(){return s.recoveryCode},function(t){void 0!==t&&(void 0!==s.form&&(s.form.recoveryCode.$setValidity("codeInvalid",!0),s.form.recoveryCode.$setValidity("currentCode",!0)),s.recoveryCode=t.replace(/\s+/g,""),0===t.length||25===t.length?void 0!==s.form&&s.form.recoveryCode.$setValidity("codeInvalidLength",!0):void 0!==s.form&&s.form.recoveryCode.$setValidity("codeInvalidLength",!1))}),s.$scope.$watch(function(){return s.$translate.use()},function(t){s.supportUrl="https://docs.zivver.com/"+t+"/references/general/recovery-code.html"})})}e.RecoverMessagesModule=i.module("components.recoverMessages",[]).component("recoverMessages",{bindings:{email:"<",form:"=",resetInfo:"<",recovery:"<",skipRecovery:"<"},controller:n,templateUrl:s(506)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/RecoverMessages.bcf86f.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/ConversationError.3d72ce.html"},function(t,e,i){},function(t,e,i){},function(t,e){t.exports='<aside class=header layout=row layout-align="space-between center"> <div class=list-actions flex-gt-sm=15 ng-if="$ctrl.items.length > 0"> <md-button class=md-icon-button ng-click="$ctrl.listAction = \'SELECT\'" ng-if="$ctrl.listAction === \'DEFAULT\'" aria-label="Select conversations"> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.SELECT</translate> </md-tooltip> <md-icon md-svg-icon=ziv:select></md-icon> </md-button> <md-button class=md-icon-button ng-click=$ctrl.clearSelection() ng-if="$ctrl.listAction === \'SELECT\'" aria-label="Cancel selection"> <md-icon md-svg-icon=ziv:deselect></md-icon> </md-button> </div> <div ng-switch=$ctrl.listAction flex flex-gt-sm=75 layout-align="start center" class=middle-list-header ng-class="{ \'no-multiselect-margin\' : $ctrl.items.length === 0 }"> <div ng-switch-default layout=row> <h2 flex=nogrow class=md-title> <span ng-if="$ctrl.selectedItems === 0" ng-switch=$ctrl.listedLabel> <translate ng-switch-when=inbox>CONVERSATIONS.LIST.TITLE</translate> <translate ng-switch-when=archive>CONVERSATIONS.LIST.TITLE-ARCHIVE</translate> <translate ng-switch-when=trash>CONVERSATIONS.LIST.TITLE-TRASH</translate> <span ng-switch-default>{{$ctrl.listedLabel}}</span> </span> <span ng-if="$ctrl.selectedItems > 0"> {{$ctrl.selectedItems}} </span> </h2> <div ng-if="$ctrl.listAction === \'DEFAULT\'" hide-gt-sm class="label-menu noselect"> <quick-select></quick-select> </div> </div> <div ng-switch-when=SEARCH flex layout=row layout-fill class=search-container> <md-input-container flex=100 md-no-float class=md-block> <input id=search-text-input class=search-input type=text ng-model=$ctrl.search.textInput ng-change=$ctrl.searchTextOnChange() placeholder="{{ \'CONVERSATIONS.LIST.SEARCH\' | translate }}"> </md-input-container> </div> </div> <div flex-gt-sm=30 ng-switch=$ctrl.listAction> <div ng-switch-when=DEFAULT ng-if="$ctrl.excludedSearchLabels.indexOf($ctrl.listedLabel) === -1" layout=row layout-align="end center"> <md-button class=md-icon-button ng-click=$ctrl.initSearch(false)> <md-icon>search</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.SEARCH</translate> </md-tooltip> </md-button> </div> <div ng-switch-when=SELECT layout=row layout-align="end center"> <md-button class=md-icon-button ng-if="$ctrl.listedLabel === \'inbox\'" ng-click="$ctrl.moveConversations(\'ARCHIVE\')"> <md-icon>archive</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.MOVE.ARCHIVE</translate> </md-tooltip> </md-button> <md-button class=md-icon-button ng-click="$ctrl.moveConversations(\'INBOX\')" ng-if="$ctrl.listedLabel === \'archive\'"> <md-icon>move_to_inbox</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.MOVE.INBOX</translate> </md-tooltip> </md-button> <md-button class=md-icon-button ng-click="$ctrl.moveConversations(\'TRASH\')" ng-if="$ctrl.listedLabel !== \'trash\'"> <md-icon>delete</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.MOVE.TRASH</translate> </md-tooltip> </md-button> <md-button class=md-icon-button ng-click="$ctrl.moveConversations(\'INBOX\')" ng-if="$ctrl.listedLabel === \'trash\'"> <md-icon>move_to_inbox</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.MOVE.INBOX</translate> </md-tooltip> </md-button> <md-button class=md-icon-button ng-click=$ctrl.deleteItems() ng-if="$ctrl.listedLabel === \'trash\'"> <md-icon>delete</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.DELETE</translate> </md-tooltip> </md-button> </div> <div ng-switch-when=SEARCH layout=row layout-align="end center"> <md-button class=md-icon-button ng-click=$ctrl.searchClose();> <md-icon>close</md-icon> </md-button> </div> </div> </aside> <md-progress-linear md-mode=indeterminate ng-if="$ctrl.loading === true"></md-progress-linear> <div class="conversations-list items-list" translate-namespace=CONVERSATIONS.LIST ng-class="{\'md-whiteframe-1dp\' : $ctrl.$mdMedia(\'gt-sm\')}"> <div ng-if="$ctrl.loading === false" class=div-list> <div class=list-item-empty ng-if="$ctrl.items.length === 0 && $ctrl.search.inProgress === false && $ctrl.$mdMedia(\'gt-sm\')"> <translate>.EMPTY</translate> </div> <placeholder ng-if="$ctrl.items.length === 0 && $ctrl.search.inProgress === false && $ctrl.$mdMedia(\'gt-sm\') === false" item=$ctrl.placeholderItem profile-progress=::$ctrl.profileProgress></placeholder> <div class=list-item-empty ng-if="$ctrl.search.textInput.length > 3 && $ctrl.items.length === 0 && $ctrl.search.wasPerformed === true"> <translate>.SEARCH.NOTFOUND</translate> </div> <div class=div-list-item ng-if="$ctrl.items.length > 0" ng-repeat="item in $ctrl.items track by item.id" ng-class="{\n\t\t\t\tselected : item.isSelected,\n\t\t\t\tactive : $ctrl.isItemActive(item)\n\t\t\t}" ng-click=$ctrl.openItem(item); layout=row layout-align="start center" data-qa=conversation-list> <md-icon ng-if="$ctrl.listAction === \'SELECT\'" class=item-select ng-class="{ \'selected\' : item.isSelected === true }"> {{ item.isSelected === true ? \'check_box\' : \'check_box_outline_blank\' }} </md-icon> <participant-avatars participants=":: item.participants" profile=":: $ctrl.profile" ng-if=":: item.participants.length > 0"> </participant-avatars> <div class="div-list-item-text extend" flex=85> <div class="first-line truncate" title="{{:: item.subject }}" data-qa=conversation-list-first-line> <span class=truncate>{{:: item.subject | ifEmpty:"" }}</span> </div> <div class=second-line> <span class=truncate>{{:: item.summarizeParticipants($ctrl.profile, 2); }}</span> </div> <div class=third-line layout=row> <div flex=90> <conversation-label ng-repeat="label in $ctrl.showLabels(item) track by label.id" label=::label mini=::true></conversation-label> <span ng-if="$ctrl.showLabels(item, true).length > 0"> ... +{{ $ctrl.showLabels(item, true).length }} </span> </div> </div> </div> <span flex></span> <div class=messageType> <span class=date title="{{ item.lastMessageDate | date : \'medium\'}}"> {{ item.lastMessageDate | date : \'dd MMM\'}} </span> <div class="row icons" layout-wrap> <md-icon class=new ng-if="item.counters.unread > 0">lens</md-icon> <md-icon class=attach-file ng-if=":: item.counters.files > 0">attach_file</md-icon> </div> </div> </div> <div ng-if="$ctrl.totalItems > $ctrl.items.length && $ctrl.listAction === \'DEFAULT\'" class="div-list-item load-more"> <a ng-if="$ctrl.refreshing === false" ng-click="$ctrl.loadMoreConversations(\'older\');"> <translate>.LOAD-OLDER</translate> </a> </div> </div> </div> <compose-button ng-if="$ctrl.excludedComposeLabels.indexOf($ctrl.listedLabel) === -1"></compose-button> '},function(t,e){t.exports='<div flex=100 layout=row class=zv-subheader> <aside class=header flex ng-if="$app.isGuest === false"></aside> </div> <div class="main-content messages-view conversation-view" translate-namespace=CONVERSATIONS.LIST flex=100> <md-card ng-if=$app.isGuest> <md-card-content> <p class="fill-width center"><translate>.GUEST-ACCESS</translate></p> <div layout=row layout-align=center> <md-button class="md-raised md-warn" ui-sref="signup({email : $app.profile.email })"> <translate>.GUEST-SIGNUP</translate> </md-button> </div> </md-card-content> </md-card> <placeholder ng-if="$app.isGuest === false && $ctrl.$mdMedia(\'gt-sm\')" item=::$ctrl.placeholderItem profile-progress=::$ctrl.profileProgress></placeholder> </div> '},function(t,e){t.exports='<conversation-header conversation=$ctrl.conversation profile=$ctrl.profile share=$ctrl.share> </conversation-header> <div class="main-content messages-view conversation-view" flex=100 layout=row ng-if=$ctrl.loading> <md-progress-linear md-mode=query></md-progress-linear> </div> <div class="main-content messages-view conversation-view" flex=100 layout=row layout-align="center start" ng-if="$ctrl.loading === false"> <md-card ng-if="$ctrl.loading === false && $ctrl.delegate === undefined" class=challenge> <md-card-content> <conversation-challenge conversation=$ctrl.conversation label=$ctrl.label share=$ctrl.share profile=$ctrl.profile></conversation-challenge> </md-card-content> </md-card> <conversation-for-delegate ng-if="$ctrl.loading === false && $ctrl.delegate !== undefined" profile-email=":: $ctrl.profile.email" delegate=":: $ctrl.delegate" share-id=":: $ctrl.share.id"> </conversation-for-delegate> </div> '},function(t,e){t.exports='<conversation-header conversation=$ctrl.conversation messages=$ctrl.messages profile=$ctrl.profile share=$ctrl.share openpane=$ctrl.showInfoPane> </conversation-header> <div class="main-content messages-view conversation-view" translate-namespace=CONVERSATIONS.VIEW> <md-progress-linear md-mode=query ng-if=$ctrl.loading></md-progress-linear> <div layout=column layout-align-xs=space-between class=conversation-container ng-class="{\n\t\t\t\'guest\' : $ctrl.profile.isGuest() && $ctrl.loading === false,\n\t\t\t\'ordinary\' : $ctrl.conversation.specialId === undefined\n\t\t}"> <div class=conversation-messages> <div> <div ng-show="$ctrl.conversation.customLabels.length > 0" class="conversation-label-container clearfix"> <conversation-label ng-repeat="label in $ctrl.conversation.customLabels" label=label conversation=":: $ctrl.conversation"> </conversation-label> </div> <div ng-repeat="item in $ctrl.messagesAndEvents track by item.id" data-qa=conversation-messages> <md-card class=placeholder ng-if="item.contentType === undefined && item.eventType === undefined"> <md-card-header flex> <md-card-avatar> <div class=block></div> </md-card-avatar> <md-card-header-text> <span class="md-title block">&nbsp;</span> </md-card-header-text> </md-card-header> <md-card-content> <p class=block>&nbsp;</p> <p class=block>&nbsp;</p> </md-card-content> </md-card> <conversation-message ng-if="item.contentType !== undefined" message=item conversation=$ctrl.conversation profile=$ctrl.profile share=$ctrl.share></conversation-message> <conversation-event conversation=$ctrl.conversation ng-if="item.eventType !== undefined" event=item profile=$ctrl.profile show-info-pane=$ctrl.showInfoPane></conversation-event> <survey-tool ng-if="$first === true && $ctrl.showSurvey === true" on-close=$ctrl.closeSurvey() share-id=$ctrl.share.id></survey-tool> </div> <conversation-event ng-repeat="item in $ctrl.suspendedEvents track by item.originator" event=::item></conversation-event> </div> <div> <conversation-reply id=conversation-reply ng-if="$ctrl.messagesAndEvents.length > 0" conversation=":: $ctrl.conversation" messages=$ctrl.messages share=$ctrl.share> </conversation-reply> </div> </div> </div> <sidepane ng-if=$ctrl.showInfoPane on-close=$ctrl.sidePaneClosed()> <pane-title translate>.INFO-PANE-TITLE</pane-title> <pane-content> <conversation-info profile=$ctrl.profile conversation=$ctrl.conversation></conversation-info> </pane-content> </sidepane> </div> '},function(t,e){t.exports='<div flex=100 layout=row class="conversation-reply-header zv-subheader"> <aside class=header flex></aside> <aside class="header middle" layout=row layout-align="space-between center"> <back-button></back-button> <div class=title flex> <h2 class="md-title truncate">{{:: $ctrl.conversation.subject }}</h2> <div class=summary> <md-icon class=recipient-icon>person</md-icon> <span class=recipients>{{ $ctrl.conversation.participants.length }}</span> </div> </div> </aside> <aside class=header flex></aside> </div> <div class="main-content conversation-reply" translate-namespace=CONVERSATIONS.REPLY> <md-progress-linear md-mode=query ng-if=$ctrl.loading></md-progress-linear> <md-card ng-if="$ctrl.loading === false"> <draft-validations-bar draft=$ctrl.draft ng-if="$ctrl.showValidationBar === true" ng-click=$ctrl.openValidationsSidePane()></draft-validations-bar> <md-card-content ng-if="$ctrl.showDraft === true"> <section class=recipients> <draft-recipients recipients=$ctrl.recipients validation=$ctrl.draft.validation hide-label=true autocomplete=false></draft-recipients> </section> <section class=subject> <md-input-container flex layout-fill> <label for=subject translate>.SUBJECT</label> <input id=subject name=subject ng-model=$ctrl.conversation.subject maxlength=255 readonly=readonly> </md-input-container> </section> <div layout=row layout-align="space-between end" layout-wrap class=message-body> <md-input-container md-no-float> <draft-body body=$ctrl.draft.body content-type=$ctrl.draft.contentType is-signature-page=false profile=$ctrl.profile> </draft-body> </md-input-container> <section flex-gt-sm=100 class=actions layout=row layout-align="end center"> <div layout=row layout-align="space-between center"> <span ng-if=$ctrl.isExpirationEnabled class=time-left> {{$ctrl.timeLeft}} </span> <md-button class="md-icon-button expiration-button" ng-click=$ctrl.openExpirationDialog() aria-label="schedule options" ng-class="{\'md-primary\': $ctrl.isExpirationEnabled}" ng-if="$ctrl.profile.isGuest() === false"> <md-tooltip md-direction=top> <translate>.SCHEDULE</translate> </md-tooltip> <md-icon>history</md-icon> </md-button> </div> <md-button class="md-icon-button editor-button" ng-click=$ctrl.editorToggle() ng-if=$ctrl.showSwitchButton aria-label="editor toggle" md-no-ink hide-xs hide-sm> <md-tooltip md-direction=top> <translate>{{ \'.EDITOR.\' + ($ctrl.draft.contentType === \'text/plain\' ? \'PLAIN\' : \'HTML\') }}</translate> </md-tooltip> <md-icon ng-class="{\'rich-text\': $ctrl.draft.contentType === \'text/html\'}"> text_format </md-icon> </md-button> <md-button class=md-icon-button ng-click=$ctrl.cancel(); aria-label=cancel> <md-tooltip md-direction=top><translate>MAIN.DELETE</translate></md-tooltip> <md-icon>delete_forever</md-icon> </md-button> <attach-button draft=$ctrl.draft></attach-button> <draft-send-button draft=$ctrl.draft send=$ctrl.send() recipients-check=false class=draft-send> </draft-send-button> </section> <section class=attachments> <draft-attachments draft=$ctrl.draft></draft-attachments> </section> </div> <div id=conversation-reply-messages ng-if="$ctrl.loadingMessages === false"> <div ng-repeat="item in $ctrl.messagesAndEvents track by item.id"> <conversation-reply-message ng-if="item.contentType !== undefined" message=item conversation=$ctrl.conversation profile=$ctrl.profile share=$ctrl.share></conversation-reply-message> </div> </div> </md-card-content> </md-card> <sidepane ng-if="$ctrl.showViolationsSidePane === true" on-close=$ctrl.closeViolationsSidePane()> <pane-title> <translate>.VALIDATIONS-PANE</translate> </pane-title> <pane-content> <draft-validation-results draft=$ctrl.draft></draft-validation-results> </pane-content> </sidepane> </div> '},function(t,e,b){var i=[b,e,b(1),b(76),b(24),b(517),b(15),b(38),b(518),b(568),b(569),b(11),b(570),b(99),b(620)],e=function(t,e,i,p,n,o,s,r,a,c,l,u,d,h){m.$inject=["$q","$transition$","SpecialsService","draft"],v.$inject=["$transition$","SpecialsService"],g.$inject=["$transition$","$log","DraftsService"],S.$inject=["$q","$log","$transition$","draft","profile","ConversationsService","MessengerService"],$.$inject=["$q","$transition$","ContactsService"],y.$inject=["$q","$transition$","$log","ConversationStartersService"],Object.defineProperty(e,"__esModule",{value:!0});var f=new RegExp(r.EMAIL_REGEX,"i");function m(t,e,i,n){e=e.params().messageDefinition;return null!==e?t.resolve(e):i.getMessageDefinition(n.messageDefinitionId)}function v(t,e){return e.getSpecial(t.params().specialId)}function g(e,i,t){var n=e.params().draftId;return t.get(n).catch(function(t){i.warn("Error resolving draft",{draftId:n,error:t}),e.router.stateService.go("drafts.index")})}function S(t,e,i,n,o,s,r){var a;return void 0===n||n.isPlain()||n.isForward()&&void 0===n.quote?t.resolve():(void 0!==(a=i.params().share)?t.resolve(a):s.getShare(n.quote.shareId)).then(function(t){if(!1!==t.isAccessGranted())return t;r.confirm("DRAFTS.DIALOG.ACCESSRIGHTGRANT-NEEDED.TITLE","DRAFTS.DIALOG.ACCESSRIGHTGRANT-NEEDED.BODY").then(function(){i.router.stateService.go("conversations.open",{shareId:t.id})},function(){i.router.stateService.go("conversations.index")})}).catch(function(t){e.warn("Error resolving share for quoted draft",{error:t}),i.router.stateService.go("drafts.index")})}function $(e,t,n){var o=[],i=t.params(),s=i.toRecipient,i=i.recipients,t=t.params().to;if(void 0!==s&&!0===f.test(s)&&t.push(s),void 0!==i&&0<i.length)for(var r=0,a=i;r<a.length;r++){var c=a[r];o.push(e.when(c))}if(void 0!==t&&0<t.length)for(var l=0,u=t;l<u.length;l++)!function(i){var t=n.get(i).then(function(t){var e;return void 0===t?(e=new p.Contact).email=i:e=t,e.toRecipient()});t.catch(function(){return e.resolve(i)}),o.push(t)}(u[l]);return e.all(o)}function y(e,t,i,n){var o=t.params().conversationStarterUuid;return o?n.getInfo(o).catch(function(t){return i.warn("Error resolving conversation starter",{conversationStarterUuid:o,error:t}),e.resolve()}):e.resolve()}e.DraftsModule=i.module("app.drafts",[n.AvatarModule.name,o.CreateControllerModule.name,a.EditControllerModule.name,c.IndexControllerModule.name,l.ListControllerModule.name,d.SpecialControllerModule.name,h.SpecialsFormModule.name]),e.DraftsModule.config(["$stateProvider",function(t){t.state({abstract:!0,parent:"_app_layout",name:"drafts",url:"/drafts",data:{title:"Drafts",bodyClass:"app drafts",scopesRequired:[u.Scopes.SENDMESSAGES]},onEnter:["$state","$transition$","profileProgress","MessengerService","$translate",function(t,e,i,n,o){!1===i.canSendFromWebapp&&(i=o.instant("DRAFTS.ALERT-SENDING-PROHIBITED"),n.alert(i),e.abort())}],resolve:{profileProgress:["ProfileService",function(t){return t.progress()}]},views:{"list@_app_layout":{templateUrl:b(621),controller:l.ListController,controllerAs:"$ctrl"},"main@_app_layout":{template:'<div class="drafts" layout="row" layout-wrap ui-view></div>'}}}),t.state({name:"drafts.index",url:"/index",controller:c.IndexController,controllerAs:"$ctrl",templateUrl:b(194)}),t.state({name:"drafts.create",url:"/create?toRecipient&subject",templateUrl:b(194),params:{recipients:[],to:[],quote:void 0,share:void 0,draftType:"plain",selectedMessages:void 0,conversationStarter:void 0,toRecipient:void 0,subject:void 0},controller:o.CreateController,resolve:{profileProgress:["ProfileService",function(t){return t.progress()}],recipients:$}}),t.state({name:"drafts.edit",url:"/edit/{draftId:uuid}?conversationStarterUuid&email",templateUrl:b(622),controller:a.EditController,controllerAs:"$ctrl",data:{scopesRequired:[u.Scopes.SENDMESSAGES]},params:{draft:null,draftId:null,share:void 0,conversationStarterUuid:void 0,email:void 0},resolve:{draft:g,share:S,conversationStarter:y}}),t.state({name:"drafts.special",url:"/special/{specialId:uuid}",controller:d.SpecialController,controllerAs:"$ctrl",templateUrl:b(195),resolve:{draft:["$state","DraftsService","special",function(e,t,i){var n=new s.Draft,i=i.flowInitiations[0],o=i.messageDefinition,i=i.fixedRecipients;return n.contentType="application/zivver-special+json",n.messageDefinitionId=o.id,n.recipients=i.map(function(t){return new s.Recipient({email:t})}),n.subject="",t.save(n).then(function(t){return e.go("drafts.specialedit",{draftId:t.id,draft:t,messageDefinition:o})})}],special:v}}),t.state({name:"drafts.specialedit",url:"/special/edit/{draftId:uuid}",templateUrl:b(195),controller:d.SpecialController,controllerAs:"$ctrl",params:{draft:null,draftId:null,messageDefinition:null},resolve:{draft:g,messageDefinition:m}})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(175),i(15)],e=function(t,e,i,n,m){function o(t,e,i,n,o,s,r,a,c,l,u,p){var d=this;if(this.$log=t,this.DeviceService=e,this.SignatureService=i,this.StorageService=n,this.profile=o,!1===(this.profileProgress=s).hasSecondAuthenticationFactor&&!1===l.isDelegate())this.StorageService.setItem("SESSION","security.redirect",{name:"drafts.index"}),a.go("settings.security",{highlight:"2fa"});else{var t=new m.Draft,e=c.params,h=e.share,f=e.quote,i=e.subject;if(t.draftType=e.draftType,t.subject=i,t.recipients=p,t.isPlain())this.setSignature(t).then(function(t){u.save(t).then(function(t){r.$broadcast("list:added",t),a.go("drafts.edit",{draftId:t.id,draft:t},{location:"replace"})}).catch(function(t){d.$log.error("Error creating new draft",{error:t})})});else{if(void 0===h)throw Error("Cannot quote without a share");if(void 0===f)throw Error("Cannot quote without a quote");u.setAccessRightGrant(h.accessRightGrant),this.setSignature(t).then(function(t){u.save(t,f).then(function(t){return r.$broadcast("list:added",t),a.go("drafts.edit",{draftId:t.id,draft:t,share:h},{location:"replace"})})})}}}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","DeviceService","SignatureService","StorageService","profile","profileProgress","$rootScope","$state","$uiRouterGlobals","AuthSessionService","DraftsService","recipients"],o.prototype.setSignature=function(e){var i=this,n=e,o=this.DeviceService.isMSBrowser();return this.SignatureService.getSignature(this.profile.uuid,"First").then(function(t){var e;return t&&0<t.content.length&&!1===o?n.body+="<div><br><br> -- <br> "+t.content+"</div>":t&&0<t.content.length&&o&&((e=document.createElement("div")).innerHTML=t.content,n.body+="\n\n--\n"+e.innerText),n}).catch(function(t){return i.$log.error("Error getting signature",{error:t}),e})},e.CreateController=o,e.CreateControllerModule=i.module("app.drafts.CreateController",[n.WizardMfaModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(9),i(1),i(14),i(519),i(11),i(13),i(187),i(189),i(528),i(15),i(192),i(531),i(183),i(551),i(554),i(83),i(8),i(50),i(565),i(27),i(174),i(173),i(32)],e=function(t,e,b,i,n,o,w,E,s,r,a,c,l,u,p,d,h,f,m,v,g,C,S,$,T){Object.defineProperty(e,"__esModule",{value:!0});var y="conversation-message";function A(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v,g,S,$){var y=this;this.$log=t,this.$mdDialog=e,this.$mdMedia=i,this.$rootScope=n,this.$scope=o,this.$state=s,this.$timeout=r,this.$transitions=a,this.DeviceService=c,this.DraftsService=l,this.DraftsValidationService=u,this.MessengerService=p,this.OrganizationService=d,this.WizardService=h,this.ContactsService=f,this.$q=m,this.draft=v,this.profile=g,this.share=S,this.conversationStarter=$,this.areAllQuotesSelected=!1,this.conversationEvent=new E.ConversationEvent,this.isExpirationEnabled=!1,this.isForwardedConversation=!1,this.changesForValidation=0,this.changesForSaving=0,this.isMSBrowser=!1,this.saveAttempts=0,this.validationAttempts=0,this.triggerConfirmationOnDestroy=!1,this.showBcc=this.hasRecipients("bcc")||this.draft.readOnlyToRecipient,void 0!==this.draft.quote&&(1<=this.draft.quote.messages.length&&this.selectAllQuotes(),this.isForwardedConversation=this.draft.isForward()&&1<this.draft.quote.messages.filter(function(t){return!1===t.revoked}).length,this.$timeout(function(){y.$scope.$watch(function(){return y.selectedMessages.length},function(){y.areAllQuotesSelected=y.selectedMessages.length===y.draft.quote.messages.filter(function(t){return!1===t.revoked}).length})})),this.conversationStarter&&(!1===this.conversationStarter.isPersonal&&0<this.draft.recipients.length&&(this.conversationStarter.recipientEmail=this.draft.recipients[0].email),void 0!==this.conversationStarter.recipientEmail&&(t=this.ContactsService.get(this.conversationStarter.recipientEmail).then(function(t){return t.toRecipient()}),this.$q.resolve(t).then(function(t){y.draft.recipients=[t]})),this.triggerConfirmationOnDestroy=!0,this.$scope.$on("list:remove",function(t,e){e===y.draft.id&&(y.triggerConfirmationOnDestroy=!1)})),void 0!==S&&this.DraftsService.setAccessRightGrant(S.accessRightGrant),o.$on("$destroy",function(){y.DraftsService.setAccessRightGrant()}),!1===this.isDraftEmpty()&&(this.changesForValidation++,this.validate()),this.useQuoteInfo(),this.handleQuoteNotifications(),this.$scope.$watch(function(){return y.draft.isModified},function(t){t&&(y.validationAttempts=0,y.changesForSaving++,y.changesForValidation++,y.draft.isModified=!1,y.draft.validation.validationCompleted=!1,y.$timeout.cancel(y.draftModifiedTimeout),y.draftModifiedTimeout=y.$timeout(function(){y.validate(),y.save()},500))}),this.$scope.$on(T.DraftEvents.ValidationsUpdated,function(t,e){y.draft.validation=e.validation}),this.$scope.$on(w.AuthEvents.logoutOtherTab,function(){y.$timeout.cancel(y.saveTimeout),y.$timeout.cancel(y.validationTimeout)}),this.$scope.$watch(function(){return y.draft.recipients.length},function(t,e){0===e&&0<t&&y.$timeout(function(){y.WizardService.showWizardOnce(y.WizardService.WIZARDS.VERIFICATION)},1e3)}),this.$transitions.onStart({},function(e){var t;if(y.conversationStarter){if(y.triggerConfirmationOnDestroy)return t=C.WarningDialog.factory({title:"DRAFTS.CANCEL-DIALOG.TITLE",explanation:"DRAFTS.CANCEL-DIALOG.CONFIRMATION",submitText:"DRAFTS.CANCEL-DIALOG.SUBMIT",cancelText:"DRAFTS.CANCEL-DIALOG.CANCEL",type:C.WarningDialogTypes.warning}),y.$mdDialog.show(t).then(function(){var t;if(y.draft.isUploading=!1,y.triggerConfirmationOnDestroy=!1,null!==y.draft.id&&(y.$rootScope.$broadcast("list:remove",y.draft.id),y.DraftsValidationService.clearDismissedViolations(y.draft.id),y.DraftsService.remove(y.draft)),e.targetState().params().draftId)return(t=b.__assign({},e.targetState().params())).conversationStarterUuid=void 0,t.conversationStarter=void 0,e.router.stateService.target(e.to(),t)})}else y.$timeout.cancel(y.saveTimeout),y.$timeout.cancel(y.draftModifiedTimeout),y.$timeout.cancel(y.validationTimeout),!0===y.isDraftEmpty()&&(y.$rootScope.$broadcast("list:remove",v.id),y.DraftsService.remove(y.draft),y.DraftsValidationService.clearDismissedViolations(y.draft.id))})}A.$inject=["$log","$mdDialog","$mdMedia","$rootScope","$scope","$state","$timeout","$transitions","DeviceService","DraftsService","DraftsValidationService","MessengerService","OrganizationService","WizardService","ContactsService","$q","draft","profile","share","conversationStarter"],A.prototype.$onInit=function(){var i=this;this.setFocus(),this.$scope.$on("show-bcc",function(t,e){i.showBcc=e,i.setFocus()}),this.isMSBrowser=this.DeviceService.isMSBrowser(),this.isMSBrowser&&(this.draft.contentType="text/plain"),void 0===this.draft.scheduledExpiration?this.OrganizationService.getMessageExpirationPolicy().then(function(t){i.isExpirationEnabled=t.automaticScheduledExpiration,t.automaticScheduledExpiration&&(i.draft.scheduledExpiration={action:t.defaults.action,expiresIn:t.defaults.duration},i.timeLeft=i.setTimeLeft())}):(this.isExpirationEnabled=void 0!==this.draft.scheduledExpiration.expiresIn,this.timeLeft=this.setTimeLeft()),this.draft.body&&(this.draft.validation.validationCompleted=!0)},A.prototype.save=function(){var e=this;0===this.changesForSaving||this.draft.isSaving||(10<=this.saveAttempts&&(this.$log.error("Cannot save draft, tried "+this.saveAttempts+" time already"),this.MessengerService.toast("DRAFTS.EDIT.ERROR.SAVE")),this.saveAttempts++,this.draft.isSaving=!0,this.changesForSaving=0,this.DraftsService.save(this.draft).then(function(t){e.saveAttempts=0,e.draft.createdDate=t.createdDate,e.draft.modifiedDate=t.modifiedDate}).catch(function(t){t.status===m.HTTP_BAD_REQUEST?e.draft.validation.validationCompleted=!0:e.$log.warn("Could not save message",{error:t})}).finally(function(){e.draft.isSaving=!1}))},A.prototype.cancel=function(){var t=this,e=C.WarningDialog.factory({title:"DRAFTS.CANCEL-DIALOG.TITLE",explanation:"DRAFTS.CANCEL-DIALOG.CONFIRMATION",submitText:"DRAFTS.CANCEL-DIALOG.SUBMIT",cancelText:"DRAFTS.CANCEL-DIALOG.CANCEL",type:C.WarningDialogTypes.warning});this.$mdDialog.show(e).then(function(){t.draft.isUploading=!1,null!==t.draft.id?(t.$rootScope.$broadcast("list:remove",t.draft.id),t.DraftsValidationService.clearDismissedViolations(t.draft.id),t.DraftsService.remove(t.draft).then(function(){t.$state.go("drafts.index")})):t.$state.go("drafts.index")})},A.prototype.validate=function(){var e=this;this.$timeout.cancel(this.validationTimeout),0===this.changesForValidation||this.draft.isValidating||(this.draft.isValidating=!0,this.changesForValidation=0,this.validationAttempts++,this.DraftsService.validate(this.draft).then(function(t){(e.draft.validation=t).validationCompleted?e.validationAttempts=0:e.validationAttempts<10?e.validationTimeout=e.$timeout(function(){e.changesForValidation++,e.validate()},1e3*e.validationAttempts,!1):(e.MessengerService.alert("DRAFTS.EDIT.ERROR.VALIDATION.TIMEOUT"),e.$log.warn("Giving up draft validation after too many attempts",{fileIds:e.draft.files.map(function(t){return t.id}),draftId:e.draft.id}),e.validationAttempts=0),t.hasViolations()&&e.WizardService.showWizardOnce(e.WizardService.WIZARDS.BUSINESSRULES)},function(t){e.$log.warn("Error validating draft",{error:t})}).finally(function(){e.draft.isValidating=!1}))},A.prototype.isDraftValid=function(){return!1===this.draft.isModified&&0<this.draft.recipients.length&&this.draft.validation.validationCompleted&&this.draft.validation.validDraft&&0===this.draft.validation.violationsUnresolved.length},A.prototype.isDraftEmpty=function(){return 0===this.draft.recipients.length&&0===this.draft.files.length&&void 0===this.draft.subject&&!1===this.draft.hasBodyContent()},A.prototype.send=function(){var t,n=this;this.$timeout.cancel(this.validationTimeout),!1!==this.preSend()&&(void 0!==this.draft.scheduledExpiration&&void 0!==this.draft.scheduledExpiration.expiresAt&&void 0!==this.draft.scheduledExpiration.expiresIn&&delete this.draft.scheduledExpiration.expiresIn,t=i.copy(this.draft),!this.draft.isReply()&&!this.draft.isForward()||void 0!==this.draft.quote&&0!==this.selectedMessages.length?(void 0!==t.quote&&(t.quote.messages=this.draft.quote.messages.filter(function(t){return-1<n.selectedMessages.indexOf(t.id)})),this.draft.isSending=!0,this.DraftsService.send(t).then(function(t){n.MessengerService.toast("DRAFTS.EDIT.MESSAGE.SENT"),n.DraftsValidationService.clearDismissedViolations(n.draft.id),void 0!==n.mdPanelRef&&n.mdPanelRef.destroy(),n.conversationStarter&&(n.triggerConfirmationOnDestroy=!1),n.$state.go("conversations.view",{conversationId:t.conversation},{location:"replace"})}).catch(function(t){n.draft.isSending=!1;var e=t.status,i=t.data;return 409===e&&0<(null==i?void 0:i.violations.length)&&void 0!==i.violations.map(function(t){return new c.Violation(t)}).find(function(t){return"freemiumConversationsTooMany"===t.businessRuleId})?n.MessengerService.alert("DRAFTS.ALERT-FREEMIUM-LIMIT-REACHED"):(n.$log.error("Error finalizing draft",{error:t}),n.validate(),n.MessengerService.alert("DRAFTS.EDIT.MESSAGE.CANNOT-BE-SENT"))})):this.MessengerService.alert("DRAFTS.EDIT.FORWARD.NO-MESSAGE.ERROR"))},A.prototype.uploadFiles=function(t){!1!==i.isArray(t)&&0!==t.length&&this.$rootScope.$broadcast("files-dropped",t)},A.prototype.preSend=function(){return!(this.draft.isValidating||(this.draft.isUploading?(this.$log.info("Trying to finalize draft while still uploading"),1):0<this.draft.validation.violationsUnresolved.length?(this.openValidationsSidePane(),this.$log.info("Trying to finalize draft with unresolved violations"),1):!1===this.isDraftValid()&&(this.openValidationsSidePane(),this.$log.info("Trying to finalize draft that is invalid"),1)))},A.prototype.useQuoteInfo=function(){null==this.draft.quote||void 0!==this.draft.subject&&0!==this.draft.subject.length||(void 0!==this.draft.draftType&&(this.draft.isReply()?this.draft.subject="RE":this.draft.isForward()&&(this.draft.subject="FW")),void 0!==this.draft.quote.conversationInfo&&void 0!==this.draft.quote.conversationInfo.subject&&(this.draft.subject+=": "+this.draft.quote.conversationInfo.subject))},A.prototype.handleQuoteNotifications=function(){this.draft.isForward()&&(void 0===this.draft.quote?this.conversationEvent.eventType="quotes-conversation-revoked":this.draft.quote.messages.some(function(t){return t.revoked})&&(this.conversationEvent.eventType="quotes-revoked"))},A.prototype.editorToggle=function(){var t;this.draft.contentType="text/html"===this.draft.contentType?"text/plain":"text/html","text/plain"===this.draft.contentType?((t=document.createElement("div")).innerHTML=this.draft.body,this.draft.body=t.innerText):this.draft.body=this.draft.body.slice(0,this.draft.body.indexOf("\n\n--\n"))},A.prototype.hasRecipients=function(e){return 0<this.draft.recipients.filter(function(t){return t.recipientType===e}).length},A.prototype.setFocus=function(){this.conversationStarter&&!1===this.conversationStarter.isPersonal&&void 0===this.conversationStarter.recipientEmail?this.focusOn="to-recipients":this.conversationStarter&&(this.conversationStarter.isSubjectEditable||!1===this.conversationStarter.isPersonal)?this.focusOn="subject":this.conversationStarter&&(this.conversationStarter.isPersonal||this.conversationStarter.recipientEmail)?this.focusOn="body":!1===this.hasRecipients("bcc")&&!0===this.showBcc?this.focusOn="bcc-recipients":!1===this.hasRecipients("to")?this.focusOn="to-recipients":void 0===this.draft.subject||""===this.draft.subject?this.focusOn="subject":this.focusOn="body"},A.prototype.openVerificationSidePane=function(){this.sidePane="VERIFICATIONS"},A.prototype.openValidationsSidePane=function(){this.sidePane="VALIDATIONRESULTS"},A.prototype.onSidePaneClosed=function(){this.sidePane=void 0},A.prototype.openExpirationPanel=function(){var i=this,t={isDraft:!0,isEnabled:this.isExpirationEnabled,scheduledExpiration:this.draft.scheduledExpiration},t=f.ExpirationDialog.factory(t);this.$mdDialog.show(t).then(function(t){var e;t.isEnabled?(e=C.WarningDialog.factory({title:y+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.TITLE",explanation:y+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.SCHEDULED",submitText:"MAIN.OK",type:"delete"===t.scheduledExpiration.action?C.WarningDialogTypes.error:C.WarningDialogTypes.info}),i.$mdDialog.show(e).then(function(){i.setExpirationData(t)})):i.setExpirationData(t)})},A.prototype.setExpirationData=function(t){this.isExpirationEnabled=t.isEnabled,this.draft.scheduledExpiration=b.__assign({},t.scheduledExpiration),this.draft.isModified=!0,t.isEnabled?this.timeLeft=this.setTimeLeft():delete this.draft.scheduledExpiration},A.prototype.setTimeLeft=function(){return n().add(n.duration(this.draft.scheduledExpiration.expiresIn)).fromNow(!0)},A.prototype.selectAllQuotes=function(){this.selectedMessages=this.draft.quote.messages.filter(function(t){return!1===t.revoked}).map(function(t){return t.id})},A.prototype.deselectAllQuotes=function(){this.selectedMessages=[]},e.EditController=A,e.EditControllerModule=i.module("app.drafts.EditController",[o.AttachButtonModule.name,a.CalloutCardModule.name,s.ConversationEventModule.name,r.ConversationQuoteModule.name,l.DraftAttachmentsModule.name,u.DraftBodyModule.name,p.DraftRecipientsModule.name,d.DraftSendButtonModule.name,h.DraftValidationsBarModule.name,v.SidepaneModule.name,g.VerificationSettingsModule.name,C.WarningDialogModule.name,$.WizardVerificationModule.name,S.WizardBusinessRulesModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(192)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$rootScope","$scope","$window","$element"],s.prototype.attachFiles=function(t){t.preventDefault(),t.stopPropagation(),this.systemAttach()},s.prototype.systemAttach=function(){var t=this.$element[0].querySelectorAll("div[ngf-select]")[0];i.element(t).triggerHandler("click")},s.prototype.uploadFiles=function(t){!1!==i.isArray(t)&&0!==t.length&&this.$rootScope.$broadcast("files-dropped",t)};var o=s;function s(t,e,i,n){this.$rootScope=t,this.$scope=e,this.$window=i,this.$element=n}e.AttachButton=o,e.AttachButtonModule=i.module("components.AttachButton",[n.DraftAttachmentsModule.name]).component("attachButton",{bindings:{draft:"<"},controller:o,template:r(527)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,l){var i=[l,e,l(1),l(15),l(521),l(188),l(190),l(523)],e=function(t,e,i,n,o,s,r){Object.defineProperty(e,"__esModule",{value:!0}),c.$inject=["$scope","$element","$mdDialog","$translate"],c.prototype.$onInit=function(){var t=this;this.setIcon(),this.setTooltip(),this.setViolationsClass(),this.$scope.$watchGroup([function(){return t.validation.violationsUnresolved},function(){return t.validation.violationsIgnored},function(){return t.validation.validationCompleted}],function(){t.setIcon(),t.setTooltip(),t.setViolationsClass()}),this.$scope.$watchCollection(function(){return t.file.upload||{}},function(){t.setIcon(),t.setTooltip(),t.setViolationsClass()})},c.prototype.setIcon=function(){this.hasUploadError()||this.hasViolationLevel("error")||this.hasViolationLevel("warning")?this.icon="error":void 0!==this.file.upload?0<this.file.upload.progress&&this.file.upload.progress<100?this.icon="file_upload":this.icon="hourglass_empty":this.icon="insert_drive_file"},c.prototype.setTooltip=function(){var e=this;this.hasUploadError()?this.file.upload.error===n.ClientViolationTypes.UploadFailed?this.tooltip=this.$translate.instant("DRAFTS.EDIT.ATTACHMENT.UPLOAD-ERROR"):this.tooltip=this.validation.violationsUnresolved.filter(function(t){return-1<t.files.indexOf(e.file.id)}).shift().description:void 0!==this.file.upload?this.tooltip=this.file.name+" ("+s.formatBytes(this.file.upload.loaded,!1)+" / "+s.formatBytes(this.file.size,!1)+")":this.tooltip=this.file.name+" ("+s.formatBytes(this.file.size,!1)+")"},c.prototype.showDialog=function(){var t=new o.AttachmentDialog;t.locals.file=this.file,t.locals.violations=this.validation.getViolationsForAttachment(this.file.id),this.$mdDialog.show(t)},c.prototype.setViolationsClass=function(){var e=this;Object.keys(n.ViolationClassNames).map(function(t){return e.mdChip.removeClass(n.ViolationClassNames[t])}),this.hasViolationLevel("error")||this.hasUploadError()?(this.mdChip.addClass(n.ViolationClassNames.error),this.iconStatus=n.ViolationClassNames.error):this.hasViolationLevel("warning")?(this.mdChip.addClass(n.ViolationClassNames.warning),this.iconStatus=n.ViolationClassNames.warning):this.hasViolationLevel("suggestion")?(this.mdChip.addClass(n.ViolationClassNames.suggestion),this.iconStatus=n.ViolationClassNames.suggestion):!1===this.validation.validationCompleted?(this.mdChip.addClass(n.ViolationClassNames.validating),this.iconStatus=n.ViolationClassNames.validating):this.validation.validationCompleted&&0===this.validation.getViolationsForAttachment(this.file.id).length?(this.mdChip.addClass(n.ViolationClassNames.success),this.iconStatus=n.ViolationClassNames.success):(this.mdChip.addClass(n.ViolationClassNames.unknown),this.iconStatus=n.ViolationClassNames.unknown)},c.prototype.hasViolationLevel=function(e){return 0<this.validation.getViolationsForAttachment(this.file.id).map(function(t){return t.violationLevel}).filter(function(t){return t===e}).length},c.prototype.hasUploadError=function(){return void 0!==this.file.upload&&void 0!==this.file.upload.error};var a=c;function c(t,e,i,n){this.$scope=t,this.$element=e,this.$mdDialog=i,this.$translate=n,this.iconStatus="unknown",this.mdChip=this.$element.parent().parent().parent()}e.DraftAttachmentChipModule=i.module("components.DraftAttachmentChip",[o.AttachmentDialogModule.name,s.FormatBytesFilterModule.name,r.TruncateFilterModule.name]).component("draftAttachmentChip",{bindings:{file:"<",validation:"<"},controller:a,templateUrl:l(524)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,r){var i=[r,e,r(1),r(182)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),e.AttachmentDialog=function(){this.templateUrl=r(522),this.locals={file:null,violations:null},this.controller=o},s.$inject=["$mdDialog","file","violations"],s.prototype.close=function(){this.$mdDialog.cancel()};var o=s;function s(t,e,i){this.$mdDialog=t,this.file=e,this.violations=i}e.AttachmentDialogModule=i.module("app.drafts.edit.AttachmentDialog",[n.DraftViolationItemModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/AttachmentDialog.693362.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/DraftAttachmentChip.2beda8.html"},function(t,e,i){},function(t,e){t.exports='<div layout> <md-chips class=md-contact-chips flex readonly=true md-removable=true md-on-remove=$ctrl.removeFile($chip) ng-model=$ctrl.files ng-show="$ctrl.files.length > 0"> <md-chip-template> <draft-attachment-chip file=$chip validation=$ctrl.draft.validation></draft-attachment-chip> </md-chip-template> </md-chips> </div> '},function(t,e){t.exports="<md-button class=\"md-icon-button attachments\" ng-click=$ctrl.attachFiles($event)> <md-tooltip md-direction=top> <translate>{{ 'DRAFTS.EDIT.ATTACHMENT.ADD' }}</translate> </md-tooltip> <md-icon> attach_file </md-icon> </md-button> <div ngf-select ngf-multiple=true ngf-change=$ctrl.uploadFiles($files) class=hidden></div> "},function(t,e,r){var i=[r,e,r(1),r(529)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),(o=n=e.CalloutCardTypes||(e.CalloutCardTypes={})).info="info",o.warning="warning",o.error="error",Object.defineProperty(s.prototype,"expandableExplanation",{get:function(){return this.isExplanationExpanded?this.explanation:this.shortenText(this.explanation,this.characterLimit)},enumerable:!0,configurable:!0}),s.prototype.$onInit=function(){this.type=this.type||n.info},s.prototype.toggleExplanationExpanded=function(){this.isExplanationExpanded=!this.isExplanationExpanded},s.prototype.shortenText=function(t,e){return t&&0<e?t.length<=e?t:t.slice(0,e)+"...":""};var n,o=s;function s(){this.icon=void 0,this.characterLimit=void 0,this.isExplanationExpanded=!1}e.CalloutCard=o,e.CalloutCardModule=i.module("components.CalloutCard",[]).component("calloutCard",{controller:o,bindings:{explanation:"<",icon:"<?",type:"<",characterLimit:"<?"},templateUrl:r(530)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/CalloutCard.5df7dd.html"},function(t,e,h){var i=[h,e,h(1),h(532),h(533),h(535),h(537),h(540),h(543),h(8),h(42),h(545)],e=function(t,e,i,a,n,o,c,s,r,l,u){Object.defineProperty(e,"__esModule",{value:!0}),d.$inject=["$element","$log","$mdDialog","$mdMedia","$mdPanel","$q","$scope","$window","DeviceService","MediaService","MessengerService","SanitizeService","SignatureService"],d.prototype.$onInit=function(){var n=this;this.browserName=this.DeviceService.getBrowser().name,this.browserVersion=parseInt(this.DeviceService.getBrowser().version.slice(0,2)),this.isMSBrowser=this.DeviceService.isMSBrowser(),this.isDesktop=this.$mdMedia("gt-sm"),!1===this.isMSBrowser?this.$scope.$applyAsync(function(){n.initPellEditor().then(function(){var t;n.isSignatureSet()&&(t=n.body.substring(0,n.body.indexOf("<div><br><br> --")).replace("<div><br></div>"," ")),n.focusableDiv=n.editor.childNodes[1],n.attachListeners(),!0===n.isRichText&&void 0!==n.body&&(!1===n.isSignatureSet()||n.isSignatureSet()&&0<t.length||void 0!==n.autoFocus||n.isSignaturePage)&&n.setHtmlContent().then(function(t){n.body=t,n.setEditorInnerHTML(t),n.isFirstFocus=!1})})}):(this.convertToPlainText(),this.removeSignature()),this.$scope.$on("signature.add",function(t,e){return n.setSignature(e)}),this.$scope.$on("conversation-reply-messages.add",function(t){return n.addConversationMessages()}),this.$scope.$on("conversation-reply-messages.remove",function(t){return n.removeConversationMessages()}),this.$scope.$on("image-preloaded",function(t,e,i){return n.updateImagePreview(e,i)})},d.prototype.$onDestroy=function(){this.editor=void 0,this.$scope.$broadcast("link.tooltip:close")},d.prototype.$onChanges=function(t){void 0!==t.contentType&&(this.isRichText="text/html"===t.contentType.currentValue,!1===this.isRichText&&void 0!==this.editor?(this.removeSignature(),this.body=this.focusableDiv.innerText,this.setEditorInnerHTML(this.focusableDiv.innerText)):!0===this.isRichText&&void 0!==this.editor&&this.setSignature(!0))},d.prototype.updateImagePreview=function(t,e){t=this.$element[0].querySelectorAll("#preview-"+t.id)[0];void 0!==t&&t.setAttribute("style","background-image: url('"+e+"')")},d.prototype.addConversationMessages=function(){var t,e,i;this.isMSBrowser||!1===this.isRichText||(t=this.$window.document.getElementById("conversation-reply-messages"),e=this.isSignatureSet()?"<div><br><br><br></div>":"<div><br></div><div><br><br></div>",i='\n\t\t\t<div id="conversation-reply-messages-textarea" contenteditable="false">\n\t\t\t\t'+t.innerHTML+"\n\t\t\t</div>",-1===this.body.indexOf(e)&&(i=e.concat(i)),this.body+=i,void 0!==this.editor&&this.setEditorInnerHTML(this.body),void 0!==this.focusableDiv&&this.focusableDiv.focus(),t.innerHTML="")},d.prototype.removeConversationMessages=function(){var t=this.body.indexOf('<div id="conversation-reply-messages-textarea"');0<t&&(this.body=this.body.substring(0,t),this.body=this.body.replace("<div><br><br><br></div>",""),void 0!==this.editor&&this.setEditorInnerHTML(this.body),void 0!==this.focusableDiv)&&this.focusableDiv.focus()},d.prototype.convertToPlainText=function(){var t=document.createElement("div");this.body=this.body.replace(/<br\s*\/?>/gm,"\n"),t.innerHTML=this.body,this.body=t.innerText},d.prototype.attachListeners=function(){var n=this;this.focusableDiv.addEventListener("keydown",function(t){return n.keyboardListener(t)}),this.focusableDiv.addEventListener("mousedown",function(t){return n.checkIfAnchor(t)}),this.focusableDiv.addEventListener("paste",function(t){var e=n.getDataFormat(t),i=(t.clipboardData||window.clipboardData).getData(e);if(n.isRichText&&!0===/<[a-z][\s\S]*>/i.test(i))if(t.preventDefault(),t.stopPropagation(),!0===n.isSignaturePage||!1===n.isSignaturePage&&!1===/<img.*?s[^>]+>/i.test(i)){if(!1===/data:image\/[^;]+;base64/i.test(i))return n.$q(function(t){"IE"===n.browserName?n.pasteHtmlAtCaret(i):a.default.exec("insertHTML",i),t()}).then(function(){n.isSignaturePage?n.setHtmlContent().then(function(t){n.body=t,n.setEditorInnerHTML(n.body)}):n.setHtmlContent()});n.MessengerService.toast("draft-body.ERRORS.BASE64-IMG")}else n.MessengerService.toast("draft-body.ERRORS.IMG-NOT-YET-SUPPORTED")}),this.focusableDiv.addEventListener("focus",function(){void 0===n.autoFocus&&n.isFirstFocus?(n.setHtmlContent().then(function(t){n.body=t,n.setEditorInnerHTML(t)}),n.$scope.$applyAsync(function(){n.setSelectionToStart()}),n.isFirstFocus=!1):n.isFirstFocus&&(n.$scope.$applyAsync(function(){n.setSelectionToStart()}),n.isFirstFocus=!1)}),this.$scope.$on("signature.remove",function(){return n.removeSignature()}),this.$scope.$watch(function(){return n.autoFocus},function(){!0===n.autoFocus&&!0===n.isDesktop&&n.setSelection()})},d.prototype.keyboardListener=function(t){if(!1===this.isRichText){if(t.ctrlKey||t.metaKey)switch(t.keyCode){case 66:case 98:case 73:case 105:case 85:case 117:t.preventDefault()}}else this.checkIfAnchor(t)},d.prototype.getDataFormat=function(t){return(t.clipboardData||window.clipboardData).types?this.isMSBrowser?"IE"===this.browserName?!0===window.clipboardData.types.contains("text/html")?"text/html":"Text":this.browserVersion<=16||!0!==t.clipboardData.types.contains("text/html")?"Text":"text/html":"Firefox"===this.browserName&&this.browserVersion<=51?!0===t.clipboardData.types.contains("text/html")?"text/html":"Text":-1<t.clipboardData.types.indexOf("text/html")?"text/html":"Text":"Text"},d.prototype.checkIfAnchor=function(t){var e;"mousedown"===t.type?(e=t.target,this.$scope.$broadcast("link.tooltip:close")):e=this.getSelectionContainer(),void 0!==e&&("a"===e.tagName.toLocaleLowerCase()&&!1===this.isLinkTooltipOpen?(this.isLinkTooltipOpen=!0,this.openLinkTooltip(e)):"a"!==e.tagName.toLocaleLowerCase()&&!0===this.isLinkTooltipOpen&&this.$scope.$broadcast("link.tooltip:close"))},d.prototype.initPellEditor=function(){var n=this;return new Promise(function(t){"IE"===n.browserName?(n.editor=a.default.init({element:document.getElementById("pell"),defaultParagraphSeparator:"div",styleWithCSS:!0,actions:n.setEditorActions(),classes:{actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected"}}),n.pellObserver=new MutationObserver(function(){var t=document.querySelector(".pell-content").innerHTML;"<br>"===t&&(t=""),n.$scope.$applyAsync(function(){return n.body=t})}),n.pellObserver.observe(document.querySelector(".pell-content"),{characterData:!0,attributes:!1,childList:!0,subtree:!0})):n.editor=a.default.init({element:document.getElementById("pell"),onChange:function(t){return n.$scope.$applyAsync(function(){return n.body=t})},defaultParagraphSeparator:"div",styleWithCSS:!0,actions:n.setEditorActions(),classes:{actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected"}});for(var e=0,i=[].slice.call(document.querySelectorAll(".pell-button"));e<i.length;e++)i[e].setAttribute("tabIndex","-1");t()})},d.prototype.setEditorActions=function(){var n=this,t=[{icon:'<div class="button-container"></div><md-icon class="material-icons">format_bold</md-icon>',name:"bold",result:function(){return a.default.exec("bold")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_italic</md-icon>',name:"italic",result:function(){return a.default.exec("italic")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_underlined</md-icon>',name:"underline",result:function(){return a.default.exec("underline")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_strikethrough</md-icon>',name:"strikethrough",result:function(){return a.default.exec("strikethrough")}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-size-button">format_size</md-icon>',name:"fontsize",title:"Font Size",result:function(){if(n.getSelection(),void 0!==n.selection)return n.openFormatSizePanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-color-button">format_color_text</md-icon>',name:"color",title:"Text Color",result:function(){if(n.getSelection(),void 0!==n.selection)return n.openFormatColorPanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-alignment-button">format_align_center</md-icon>',name:"align",title:"Align Content",result:function(){if(n.getSelection(),n.TrailingDivMsBrowsers(),void 0!==n.selection)return n.openFormatAlignmentPanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">insert_link</md-icon>',name:"link",title:"Link",result:function(){var t=n.getSelectionContainer(),e=void 0!==t?t.href:void 0,i=window.getSelection().toString();e&&(i=t.innerHTML),n.getSelection(),void 0!==n.selection&&n.openFormatLinkDialog(t,i,e).catch(function(){return n.setSelection()})}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_list_numbered</md-icon>',name:"olist",result:function(){n.TrailingDivMsBrowsers(),a.default.exec("insertOrderedList"),n.removeTrailingDiv()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_list_bulleted</md-icon>',name:"ulist",result:function(){n.TrailingDivMsBrowsers(),a.default.exec("insertUnorderedList"),n.removeTrailingDiv()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">remove</md-icon>',name:"line",result:function(){return n.pasteHtmlAtCaret('<hr contenteditable="false">')}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_clear</md-icon>',name:"clearformatting",title:"Clear Formatting",result:function(){return a.default.exec("removeFormat")}}];return this.isMSBrowser?t.filter(function(t){return"line"!==t.name}):t},d.prototype.rgbToHex=function(t,e,i){return"#"+[t,e,i].map(function(t){t=Number(t).toString(16);return 1===t.length?"0"+t:t}).join("")},d.prototype.pasteHtmlAtCaret=function(t){this.getSelection(),void 0!==this.selection&&(this.selection.deleteContents(),this.selection.insertNode(this.selection.createContextualFragment(t)),this.setSelection())},d.prototype.TrailingDivMsBrowsers=function(){this.isMSBrowser&&"text/html"===this.contentType&&(this.trailingDiv=document.createElement("div"),this.focusableDiv.appendChild(this.trailingDiv))},d.prototype.removeTrailingDiv=function(){this.trailingDiv&&(this.focusableDiv.removeChild(this.trailingDiv),this.trailingDiv=null)},d.prototype.setHtmlContent=function(){if(void 0===this.editor)return this.convertToPlainText(),this.$q.resolve(this.body);for(var i=[],t=Array.from(this.editor.querySelectorAll("img")),e=this.body,n="",o=this.body.indexOf('<div id="conversation-reply-messages-textarea"'),s=(0<o&&(e=this.body.substring(0,o),n=this.body.substring(o,this.body.length)),this.SanitizeService.sanitizeHtml(e,t)),r=this,a=0,c=[].slice.call(s.querySelectorAll("img"));a<c.length;a++)!function(e){var t;e.classList.contains("external")&&(t=r.MediaService.proxy(e.getAttribute("title")).then(function(t){e.setAttribute("src",t),e.classList.remove("external")}),i.push(t))}(c[a]);return this.$q.all(i).then(function(){return s.innerHTML+n})},d.prototype.setEditorInnerHTML=function(t){var e=this;void 0!==this.editor&&this.$scope.$applyAsync(function(){e.editor.content.innerHTML=t})},d.prototype.openFormatLinkDialog=function(e,t,i){var n=this,t=s.FormatLinkDialog.factory(t,i);return this.$mdDialog.show(t).then(function(t){return i&&e.parentElement.removeChild(e),n.setSelection(),"IE"!==n.browserName?a.default.exec("insertHTML",t.linkElement):n.pasteHtmlAtCaret(t.linkElement)})},d.prototype.openFormatSizePanel=function(){var e=this,t=parseInt(document.queryCommandValue("FontSize")),i=this.$mdPanel.newPanelPosition().relativeTo(".format-size-button").addPanelPosition(this.$mdPanel.xPosition.CENTER,this.$mdPanel.yPosition.ABOVE).withOffsetY("10px"),t={attachTo:document.body,controller:n.FormatSizePanel,controllerAs:"$ctrl",templateUrl:h(546),position:i,locals:{size:t},escapeToClose:!0,clickOutsideToClose:!0,onCloseSuccess:function(t){t=t.config.scope.$ctrl.size;return e.setSelection(),a.default.exec("fontSize",t)}};this.$mdPanel.open(t).then(function(t){window.addEventListener("resize",function(){t.updatePosition(i)})}).catch(function(t){return e.$log.error("Error opening the format size panel",{error:t})})},d.prototype.openFormatColorPanel=function(){var i=this,t=new RegExp("((\\d{1,3}), (\\d{1,3}), (\\d{1,3}))"),e=document.queryCommandValue("foreColor"),n=document.queryCommandValue("backColor"),o=u.COLOR_INK_BLACK,s=u.COLOR_ASH_GREY,r=(null!==t.exec(e)&&(o=this.rgbToHex(t.exec(e)[2],t.exec(e)[3],t.exec(e)[4])),null!==t.exec(n)&&(s=this.rgbToHex(t.exec(n)[2],t.exec(n)[3],t.exec(n)[4])),this.$mdPanel.newPanelPosition().relativeTo(".format-color-button").addPanelPosition(this.$mdPanel.xPosition.CENTER,this.$mdPanel.yPosition.ABOVE).withOffsetY("10px")),e={attachTo:document.body,controller:c.FormatColorsPanel,controllerAs:"$ctrl",templateUrl:h(547),position:r,locals:{foreColor:o,backColor:s},escapeToClose:!0,clickOutsideToClose:!0,onCloseSuccess:function(t){var e=t.config.scope.$ctrl.foreColor,t=t.config.scope.$ctrl.backColor;return i.setSelection(),s!==t?a.default.exec("backColor",t):o!==e?a.default.exec("foreColor",e):void 0}};this.$mdPanel.open(e).then(function(t){window.addEventListener("resize",function(){t.updatePosition(r)})}).catch(function(t){return i.$log.error("Error opening the format color panel",{error:t})})},d.prototype.openFormatAlignmentPanel=function(){var e=this,i=this.$mdPanel.newPanelPosition().relativeTo(".format-alignment-button").addPanelPosition(this.$mdPanel.xPosition.CENTER,this.$mdPanel.yPosition.ABOVE).withOffsetY("10px"),t={attachTo:document.body,controller:o.FormatAlignmentPanel,controllerAs:"$ctrl",templateUrl:h(548),position:i,locals:{},escapeToClose:!0,clickOutsideToClose:!0,onCloseSuccess:function(t){t=t.config.scope.$ctrl.alignment;t&&(e.TrailingDivMsBrowsers(),a.default.exec("justify"+t),e.removeTrailingDiv()),e.setSelection()}};this.$mdPanel.open(t).then(function(t){window.addEventListener("resize",function(){t.updatePosition(i)})}).catch(function(t){return e.$log.error("Error opening the format alignment panel",{error:t})})},d.prototype.openLinkTooltip=function(n){var e,t,o=this;"a"===n.tagName.toLowerCase()&&(e=this.$mdPanel.newPanelPosition().relativeTo(n).addPanelPosition(this.$mdPanel.xPosition.CENTER,this.$mdPanel.yPosition.BELOW).withOffsetY("4px"),t={attachTo:document.body,controller:r.LinkTooltip,controllerAs:"$ctrl",templateUrl:h(549),position:e,locals:{action:void 0,url:n.href},escapeToClose:!1,clickOutsideToClose:!1,focusOnOpen:!1,zIndex:100,propagateContainerEvents:!0,onCloseSuccess:function(t,e){if("fromEvent"!==e){e=t.config.scope.$ctrl.action;switch(o.getSelection(),o.isLinkTooltipOpen=!1,e){case"edit":return o.openFormatLinkDialog(n,n.innerHTML,n.href).catch(function(){return o.setSelection()});case"remove":var i=n.innerHTML;return n.parentNode.removeChild(n),o.setSelection(),a.default.exec("insertText",i);default:return}}}},this.$mdPanel.open(t).then(function(t){window.addEventListener("resize",function(){t.updatePosition(e)}),o.$scope.$on("link.tooltip:close",function(){t.close("fromEvent"),o.isLinkTooltipOpen=!1})}).catch(function(t){return o.$log.error("Error opening the link tooltip panel",{error:t})}))},d.prototype.getSelectionContainer=function(){if(window.getSelection){var t=window.getSelection();if(t.getRangeAt&&t.rangeCount)return 1===(t=t.getRangeAt(0).commonAncestorContainer).nodeType?t:t.parentNode}},d.prototype.getSelection=function(){var t;window.getSelection&&(t=window.getSelection(),"IE"===this.browserName||!1!==this.editor.contains(t.focusNode))?t.getRangeAt&&t.rangeCount&&(this.selection=t.getRangeAt(0)):this.selection=void 0},d.prototype.setSelection=function(){var t;this.selection?window.getSelection&&((t=window.getSelection()).removeAllRanges(),t.addRange(this.selection)):this.focusableDiv.focus()},d.prototype.setSelectionToStart=function(){var t=document.createRange(),e=window.getSelection();this.focusableDiv.firstChild&&(t.setStart(this.focusableDiv.firstChild,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t),this.focusableDiv.focus())},d.prototype.isSignatureSet=function(){return 0<=this.body.indexOf("<div><br><br> --")||0<=this.body.indexOf("\n\n--\n")},d.prototype.removeSignature=function(){var t;this.isSignatureSet()&&-1<(t=-1===(t=this.body.indexOf("<div><br><br> --"))?this.body.indexOf("\n\n--\n"):t)&&(this.body=this.body.substring(0,t),this.setEditorInnerHTML(this.body))},d.prototype.setSignature=function(i){var n=this;this.profile.isGuest()||this.SignatureService.getSignature(this.profile.uuid,!0===i?"First":"All").then(function(t){var e;t&&0<t.content.length&&!1===n.isMSBrowser?(n.isRichText?n.body+="<div><br></div><div><br><br> -- <br> "+t.content+"</div>":((e=document.createElement("div")).innerHTML=t.content,n.body+="\n\n--\n"+e.innerText),!0===i&&void 0!==n.editor&&n.setEditorInnerHTML(n.body),n.isRichText&&n.setHtmlContent().then(function(t){n.body=t,n.setEditorInnerHTML(t)})):t&&0<t.content.length&&n.isMSBrowser&&((e=document.createElement("div")).innerHTML=t.content,n.body+="\n\n--\n"+e.innerText)}).catch(function(t){t.status===l.HTTP_NOT_FOUND?n.$log.error("No signature found",{error:t}):n.$log.error("Unable to get profile signature",{error:t})})};var p=d;function d(t,e,i,n,o,s,r,a,c,l,u,p,d){this.$element=t,this.$log=e,this.$mdDialog=i,this.$mdMedia=n,this.$mdPanel=o,this.$q=s,this.$scope=r,this.$window=a,this.DeviceService=c,this.MediaService=l,this.MessengerService=u,this.SanitizeService=p,this.SignatureService=d,this.body="",this.isDesktop=!0,this.isFirstFocus=!0,this.isMSBrowser=!1,this.isLinkTooltipOpen=!1}e.DraftBodyModule=i.module("components.DraftBody",[]).component("draftBody",{bindings:{autoFocus:"<",body:"=",contentType:"<",isSignaturePage:"<",profile:"<"},controller:p,template:h(550)})}.apply(e,i);void 0!==e&&(t.exports=e)},,function(t,e,i){i=[i,e,i(1),i(534)],e=function(t,e,i){function n(t,e,i){this.$scope=t,this.mdPanelRef=e,this.size=i}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$scope","mdPanelRef","size"],n.prototype.$onInit=function(){},n.prototype.close=function(){this.mdPanelRef.close()},n.prototype.setSize=function(t){this.size=t,this.close()},e.FormatSizePanel=n,e.FormatSizePanelModule=i.module("drafts.FormatSizePanel",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){i=[i,e,i(1),i(536)],e=function(t,e,i){function n(t,e){this.$scope=t,this.mdPanelRef=e,this.alignment="left"}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$scope","mdPanelRef"],n.prototype.$onInit=function(){},n.prototype.close=function(){this.mdPanelRef.close()},n.prototype.setAlignment=function(t){this.alignment=t,this.close()},e.FormatAlignmentPanel=n,e.FormatAlignmentPanelModule=i.module("drafts.FormatAlignmentPanel",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){i=[i,e,i(1),i(538),i(539)],e=function(t,e,i,o){function n(t,e,i,n){this.$scope=t,this.mdPanelRef=e,this.backColor=i,this.foreColor=n,this.primaryColors=o.editorPrimaryColors,this.secondaryColors=o.editorSecondaryColors}Object.defineProperty(e,"__esModule",{value:!0}),n.$inject=["$scope","mdPanelRef","backColor","foreColor"],n.prototype.$onInit=function(){},n.prototype.close=function(){this.mdPanelRef.close()},n.prototype.selectForeColor=function(t){this.foreColor=t,this.close()},n.prototype.selectBackColor=function(t){this.backColor=t,this.close()},e.FormatColorsPanel=n,e.FormatColorsPanelModule=i.module("drafts.FormatColorsPanel",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.editorPrimaryColors=[["#000000","#424242","#616161","#757575","#9e9e9e","#bdbdbd","#eeeeee","#ffffff"],["#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#0000ff","#9900ff","#ff00ff"]],e.editorSecondaryColors=[["#ffebee","#fff3e0","#fffde7","#f9fbe7","#e0f7fa","#e3f2fd","#ede7f6","#f3e5f5"],["#ffcdd2","#ffe0b2","#fff9c4","#f0f4c3","#b2ebf2","#bbdefb","#d1c4e9","#e1bee7"],["#e57373","#ffb74d","#fff176","#dce775","#26c6da","#64b5f6","#7e57c2","#ba68c8"],["#e53935","#fb8c00","#fdd835","#c0ca33","#00acc1","#1e88e5","#5e35b1","#8e24aa"],["#c62828","#ef6c00","#f9a825","#9e9d24","#00838f","#283593","#4527a0","#6a1b9a"],["#b71c1c","#e65100","#f57f17","#827717","#006064","#1a237e","#311b92","#4a148c"]]}.apply(e,[i,e]);void 0!==i&&(t.exports=i)},function(t,e,i){},function(t,e,n){var i=[n,e,n(541)],e=function(t,e){function i(t,e,i,n){this.$scope=t,this.$mdDialog=e,this.link=i,this.linkLabel=n}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$scope","$mdDialog","link","linkLabel"],i.prototype.$onInit=function(){this.currentLinkLabel=this.linkLabel,this.currentLink=this.link},i.prototype.close=function(){this.$mdDialog.cancel()},i.prototype.setLink=function(){var t=new RegExp("^http[s]?|mailto:"),e=(this.link=this.currentLink,this.linkLabel=this.currentLinkLabel,document.createElement("a"));e.setAttribute("href",t.test(this.link)?this.link:"https://"+this.link),e.innerHTML=this.linkLabel,this.$mdDialog.hide({linkElement:e.outerHTML})},i.factory=function(t,e){return{controller:i,template:n(542),locals:{link:e,linkLabel:t}}},e.FormatLinkDialog=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<md-dialog class=format-link-container layout-align="space-between center" translate-namespace=format-link-panel> <md-toolbar> <div class=md-toolbar-tools> <span translate>.TITLE</span> <md-button type=button class=md-icon-button ng-click=$ctrl.close();> <md-icon aria-label="Close dialog">close</md-icon> </md-button> </div> </md-toolbar> <md-dialog-content layout-padding> <div flex=100 layout=row layout-align="space-between center"> <md-input-container flex=100> <label for=linkLabel translate>.LABEL</label> <input id=linkLabel name=linkLabel md-no-asterisk ng-model=$ctrl.currentLinkLabel> </md-input-container> </div> <div flex=100 layout=row layout-align="space-between center"> <md-input-container flex=100> <label for=linkValue translate>.LINK</label> <input id=linkValue name=linkValue md-no-asterisk ng-model=$ctrl.currentLink> </md-input-container> </div> </md-dialog-content> <md-dialog-actions layout=row layout-align="space-between center" class=actions> <md-button ng-click=$ctrl.close()> <translate>MAIN.CANCEL</translate> </md-button> <md-button ng-click=$ctrl.setLink() class="md-primary md-raised" ng-disabled="$ctrl.link.length === 0"> <translate>MAIN.OK</translate> </md-button> </md-dialog-actions> </md-dialog> '},function(t,e,i){i=[i,e,i(544)],e=function(t,e){function i(t,e,i,n){this.$scope=t,this.mdPanelRef=e,this.action=i,this.url=n}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$scope","mdPanelRef","action","url"],i.prototype.$onInit=function(){},i.prototype.editLink=function(){this.action="edit",this.close()},i.prototype.removeLink=function(){this.action="remove",this.close()},i.prototype.close=function(){this.mdPanelRef.close()},e.LinkTooltip=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/FormatSizePanel.0129f3.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/FormatColorsPanel.58e1b9.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/FormatAlignmentPanel.832015.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/LinkTooltip.6bcca9.html"},function(t,e){t.exports='<div id=pell ng-class="{\'rich-text\': $ctrl.isRichText, \'is-desktop\': $ctrl.isDesktop}" ng-if="$ctrl.isMSBrowser === false" ng-show="$ctrl.isRichText && $ctrl.isMSBrowser === false" data-qa=draft-email-body></div> <div class=deprecation-warning ng-if=$ctrl.isMSBrowser> <span translate>.DEPRECATED</span> </div> <textarea class=editor-textarea ng-model=$ctrl.body aria-label="message body" ng-if="$ctrl.isRichText === false || $ctrl.isMSBrowser === true" placeholder="{{ \'draft-body.PLACEHOLDER\' | translate }}"></textarea> '},function(t,e,s){var i=[s,e,s(1),s(552)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.$onInit=function(){var t;this.recipientsCheck=null==(t=this.recipientsCheck)||t},o.prototype.canSend=function(){return this.checkDraftRecipients()&&(this.draft.hasBodyContent()||0<this.draft.files.length||this.checkDraftQuotes())&&this.checkDraftState()},o.prototype.checkDraftQuotes=function(){return void 0!==this.draft.quote&&void 0!==this.draft.quote.messages&&this.draft.quote.messages.some(function(t){return!1===t.revoked})},o.prototype.checkDraftRecipients=function(){return!this.recipientsCheck||0<this.draft.recipients.length},o.prototype.checkDraftState=function(){return!1===this.draft.isModified&&!1===this.draft.isSaving&&!1===this.draft.isValidating&&!1===this.draft.isUploading&&!1===this.draftHasFailedUploaded()&&!1===this.draft.isSending&&this.draft.validation.validationCompleted&&this.draft.validation.validDraft},o.prototype.draftHasFailedUploaded=function(){return 0<this.draft.files.filter(function(t){return void 0!==t.upload&&void 0!==t.upload.error}).length};var n=o;function o(){this.violations=0}e.DraftSendButtonModule=i.module("components.DraftSendButton",[]).component("draftSendButton",{controller:n,bindings:{draft:"=",recipientsCheck:"<",send:"&"},template:s(553)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports=' <md-button hide-gt-sm aria-label="{{ $ctrl.label }}" class="md-fab md-mini md-primary" ng-disabled="$ctrl.canSend() === false" ng-click=$ctrl.send()> <md-icon>send</md-icon> </md-button> <md-button hide-xs hide-sm aria-label="{{ $ctrl.label }}" class="md-raised md-primary wide" ng-disabled="$ctrl.canSend() === false" ng-click=$ctrl.send() data-qa=draft-send-button> <translate>MAIN.SEND</translate> </md-button> '},function(t,e,r){var i=[r,e,r(1),r(555),r(563)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$scope","DraftsValidationService"],s.prototype.$onInit=function(){var t=this;this.unresolvedViolations=this.draft.validation.violationsUnresolved,this.setIconStatus(),this.$scope.$watch(function(){return t.draft.isValidating},function(){t.setIconStatus()}),this.$scope.$watch(function(){return t.draft.validation},function(){t.unresolvedViolations=t.draft.validation.violationsUnresolved,t.setIconStatus()},!0)},s.prototype.dismissViolation=function(t){t.preventDefault(),t.stopPropagation(),this.draft.validation=this.DraftsValidationService.dismissViolation(this.unresolvedViolations[0],this.draft)},s.prototype.setIconStatus=function(){var t=this.DraftsValidationService.getIconStatus(this.draft.validation,this.draft.isValidating),e=t.iconStatus,i=t.icon,t=t.info;this.iconStatus=e,this.icon=i,this.info=t};var o=s;function s(t,e){this.$scope=t,this.DraftsValidationService=e,this.icon="lock",this.iconStatus="unknown"}e.DraftValidationsBarModule=i.module("components.DraftValidationsBar",[n.DraftValidationResultsModule.name]).component("draftValidationsBar",{controller:o,bindings:{draft:"<"},template:r(564),transclude:!0})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,a){var i=[a,e,a(1),a(556),a(558),a(561)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$rootScope","$scope","$log","$mdDialog","$mdSidenav","DraftsValidationService"],r.prototype.$onInit=function(){var t=this;this.updateViolations(),this.$scope.$watchCollection(function(){return[t.draft.validation.violationsUnresolved,t.draft.validation.violationsIgnored]},function(){t.updateViolations()})},r.prototype.dismissViolation=function(t){void 0===t.id?this.$log.info("dismissing violation without id",{violation:t}):t.showStopper?this.$log.warn("trying to dismiss a violation that is a showstopper",{violation:t}):(this.draft.validation=this.DraftsValidationService.dismissViolation(t,this.draft),this.draft.isModified=!0)},r.prototype.dismissAll=function(){this.draft.validation=this.DraftsValidationService.dismissAllViolations(this.draft)},r.prototype.infoViolation=function(t){var e=this,i=new n.ViolationInformationDialog;i.locals.violation=t,i.locals.violation.files=i.locals.violation.files.map(function(t){return e.draft.getFilenameById(t)}),this.$mdDialog.show(i)},r.prototype.showResolveDialog=function(i){var n=this,t=new o.ViolationResolveDialog;t.locals.violation=i,t.locals.draft=this.draft,this.$mdDialog.show(t).then(function(){switch(!0){case 0<i.recipients.length&&"duplicaterecipients"===i.businessRuleId:n.draft.recipients=n.draft.recipients.filter(function(t){return-1===i.recipients.indexOf(t.email)||"bcc"===t.recipientType});break;case 0<i.recipients.length:n.draft.recipients=n.draft.recipients.filter(function(t){return-1===i.recipients.indexOf(t.email)});break;case 0<i.files.length:var t=n.draft.files.filter(function(t){return-1<i.files.indexOf(t.id)});n.$rootScope.$broadcast("attachments-removed",t);break;case/src="data:image\/([a-zA-Z]*);base64,([^"]*)"/i.test(n.draft.body):var e=document.getElementsByClassName("pell-content").item(0);e.querySelectorAll("img").forEach(function(t){/src="data:image\/([a-zA-Z]*);base64,([^"]*)"/i.test(t.outerHTML)&&(t.parentElement.removeChild(t),n.draft.body=e.innerHTML)});break;default:n.$log.warn("Got a violation with no file and no recipients. No clue how to resolve",{violation:i})}})},r.prototype.hasViolations=function(){return 0<this.unresolvedViolations.length||0<this.dismissedViolations.length},r.prototype.toggleUnresolvedViolations=function(){this.isUnresolvedCollapsed=!this.isUnresolvedCollapsed},r.prototype.toggleDismissedViolations=function(){this.isDismissedCollapsed=!this.isDismissedCollapsed},r.prototype.showResolveButton=function(t){return"files"===t.violationType||"toRecipients"===t.violationType||"bccRecipients"===t.violationType||"filesToRecipients"===t.violationType},r.prototype.setViolationIconAndStatus=function(t){var e=t.violationLevel;return"suggestion"===e&&!1===t.showStopper?(this.iconStatus="okay","lock"):"error"===e?this.iconStatus="error":!0===t.showStopper||"warning"===e?(this.iconStatus="warning","error"):(this.iconStatus="okay","lock")},r.prototype.openVerificationInfo=function(){void 0!==this.openVerifications?this.openVerifications():this.$log.warn("no openVerifications function bound")},r.prototype.updateViolations=function(){void 0===this.draft?(this.unresolvedViolations=[],this.dismissedViolations=[],this.hasDismissableViolations=!1,this.$log.warn("[DraftValidationsResult] draft is undefined")):(this.dismissedViolations=this.draft.validation.violationsIgnored,this.unresolvedViolations=this.draft.validation.violationsUnresolved,this.hasDismissableViolations=0<this.unresolvedViolations.filter(function(t){return!1===t.showStopper}).length)};var s=r;function r(t,e,i,n,o,s){this.$rootScope=t,this.$scope=e,this.$log=i,this.$mdDialog=n,this.$mdSidenav=o,this.DraftsValidationService=s,this.hasDismissableViolations=!1,this.iconStatus="unknown",this.isUnresolvedCollapsed=!1,this.isDismissedCollapsed=!1}e.DraftValidationResultsModule=i.module("components.DraftValidationResults",[]).component("draftValidationResults",{bindings:{draft:"<",openVerifications:"&"},controller:s,templateUrl:a(562)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,o){e=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ViolationInformationDialog=function(){this.templateUrl=o(557),this.locals={violation:null},this.controller=i},n.$inject=["$mdDialog","violation"],n.prototype.cancel=function(){this.$mdDialog.cancel()};var i=n;function n(t,e){this.$mdDialog=t,this.violation=e}}.apply(e,[o,e]);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/violationInformationDialog.a5713b.html"},function(t,e,o){var i=[o,e,o(559)],e=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ViolationResolveDialog=function(){this.templateUrl=o(560),this.locals={violation:null,draft:null},this.controller=i},n.$inject=["$rootScope","$log","$mdDialog","draft","violation"],n.prototype.cancel=function(){this.$mdDialog.cancel()},n.prototype.resolve=function(){this.$mdDialog.hide()};var i=n;function n(t,e,i,n,o){var s=this;this.$rootScope=t,this.$log=e,this.$mdDialog=i,this.draft=n,this.violation=o,this.filenames=[],this.filenames=this.violation.files.map(function(t){return s.draft.getFilenameById(t)}),0!==o.recipients.length?this.target="RECIPIENTS":this.target="FILES"}}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/violationResolveDialog.f9271f.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/DraftValidationResults.1aeb71.html"},function(t,e,i){},function(t,e){t.exports='<div ng-class=$ctrl.iconStatus layout=row layout-align="space-between center" translate-namespace=draft-validations-bar> <md-card-header-text> <div aria-label="Open security and protections settings"> <md-icon ng-class=$ctrl.iconStatus class=left-icon>{{$ctrl.icon}}</md-icon> <span ng-if="$ctrl.unresolvedViolations.length !== 1" translate translate-value-violations={{$ctrl.unresolvedViolations.length}} data-qa=header-message> {{ $ctrl.info }} </span> <div class="violation-description truncate" ng-if="$ctrl.unresolvedViolations.length === 1"> {{ $ctrl.unresolvedViolations[0].description }} </div> </div> </md-card-header-text> <span flex></span> <md-button ng-class=$ctrl.iconStatus md-no-ink ng-if="$ctrl.unresolvedViolations.length === 1 && $ctrl.unresolvedViolations[0].showStopper === false" ng-click=$ctrl.dismissViolation($event); data-qa=check-message-dismiss> <translate>.DISMISS</translate> </md-button> <md-icon ng-class=$ctrl.iconStatus>info_outline</md-icon> </div> '},function(t,e,l){var i=[l,e,l(1),l(15),l(81),l(24),l(566)],e=function(t,e,s,r,a,i){Object.defineProperty(e,"__esModule",{value:!0});var c=[{type:"zivver",svg:"ziv:zivver-shield",label:".VERIFICATION.OPTIONS.ZIVVER",available:!1},{type:"sms",icon:"smartphone",label:".VERIFICATION.OPTIONS.SMS-CODE",available:!1},{type:"password",icon:"keyboard",label:".VERIFICATION.OPTIONS.ACCESS-CODE",available:!1},{type:"email",icon:"email",label:".VERIFICATION.OPTIONS.EMAIL",available:!1},{type:"generatedCode",icon:"lock_open",label:".VERIFICATION.OPTIONS.NONE",available:!1}],n=(o.$inject=["$scope","$log","$q","$timeout","$mdDialog","MessengerService","ContactsService"],o.prototype.$onInit=function(){var t=this;this.verificationMethod=this.verifications.filter(function(t){return t.available}).map(function(t){return t.type}).shift(),this.$scope.$watch(function(){return t.recipients},function(){t.updateAvailableVerificationTypes(),t.sortRecipientsByViolation()}),this.$scope.$watch(function(){return t.verificationMethod},function(){t.failed=!1})},o.prototype.$onChanges=function(t){t.validation&&(this.setViolationDescription(),this.sortRecipientsByViolation())},o.prototype.applyVerificationMethod=function(){var s=this;this.failed=!1,this.form.$invalid?this.$log.debug("form is invalid"):0===this.selectedRecipients.length?this.MessengerService.toast("verification-settings.NONE-SELECTED"):(this.recipients.filter(function(t){return-1<s.selectedRecipients.indexOf(t.email)}).forEach(function(t){var e=t.verifications.filter(function(t){return"generatedCode"===s.verificationMethod?"NoVerification"===t.id:"email"===s.verificationMethod?"Email"===t.id:t.verificationType.toString()===s.verificationMethod.toString()})[0],i=void 0!==e;if(i){var n=r.AccessRightSetup.fromVerification(e),o=t.accessRightSetup;switch(s.verificationMethod){case"sms":n.requiresUserInput&&(void 0!==o.phonenumber?n.phonenumber=o.phonenumber:void 0!==t.phonenumber?n.phonenumber=t.phonenumber:i=!1);break;case"password":n.requiresUserInput&&(void 0!==o.password?n.password=o.password:i=!1);break;case"zivver":!1===s.recipientHasZivver(t)&&(i=!1)}n.isValid=i,t.accessRightSetup=n}!1===i&&(s.failed=!0)}),!1===this.failed&&this.MessengerService.toast("verification-settings.SUCCESS"))},o.prototype.hasAccessRightViolation=function(t){return 0<this.validation.getViolationsForRecipient(t).filter(function(t){return"accessRights"===t.violationType}).length},o.prototype.showDialog=function(t,e){var i=this,n=new a.RecipientDialog,o=this.recipients.filter(function(t){return t.email===e})[0];n.resolve.recipient=function(){return void 0!==o.verifications?i.$q.resolve(s.copy(o)):i.ContactsService.get(o.email).then(function(t){return t.toRecipient(o.recipientType)})},n.locals.violations=this.validation.getViolationsForRecipient(o),this.$mdDialog.show(n).then(function(t){o=s.extend(o,t)})},o.prototype.setViolationDescription=function(){var t=this.validation.violationsUnresolved.filter(function(t){return"accessRights"===t.violationType});this.validation.hasViolations()&&0<t.length?this.violationDescription=t[0].description:this.violationDescription=void 0},o.prototype.recipientHasZivver=function(t){return void 0!==t.verifications&&0<t.verifications.filter(function(t){return"zivver"===t.verificationType}).length},o.prototype.updateAvailableVerificationTypes=function(){var e=this,i=!1,n=!1,o=!1,s=!1,r=!1;[].concat.apply([],this.recipients.filter(function(t){return-1<e.selectedRecipients.indexOf(t.email)}).map(function(t){return t.verifications})).filter(function(t){return void 0!==t}).forEach(function(t){"none"===t.verificationType?"Email"===t.id?s=!0:r=!0:"password"===t.verificationType?o=!0:"sms"===t.verificationType?n=!0:"zivver"===t.verificationType&&(i=!0)}),this.verifications=c.filter(function(t){switch(t.type){case"zivver":return i;case"sms":return n;case"password":return o;case"email":return s;case"generatedCode":return r}})},o.prototype.sortRecipientsByViolation=function(){var i=this;this.recipients.sort(function(t,e){return Number(i.hasAccessRightViolation(e))-Number(i.hasAccessRightViolation(t))}),this.lastOfErrors=this.recipients.filter(function(t){return i.hasAccessRightViolation(t)}).length-1},o);function o(t,e,i,n,o,s,r){this.$scope=t,this.$log=e,this.$q=i,this.$timeout=n,this.$mdDialog=o,this.MessengerService=s,this.ContactsService=r,this.failed=!1,this.verificationMethod="generatedCode",this.verifications=c,this.selectedRecipients=[]}e.VerificationSettingsModule=s.module("components.VerificationSettings",[i.AvatarModule.name,a.RecipientDialogModule.name]).component("verificationSettings",{bindings:{recipients:"=",validation:"<"},controller:n,templateUrl:l(567)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/VerificationSettings.9717a7.html"},function(t,e,i){i=[i,e,i(1),i(177)],e=function(t,e,i,n){function o(t){this.profileProgress=t}Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["profileProgress"],e.IndexController=o,e.IndexControllerModule=i.module("app.drafts.IndexController",[n.PlaceholderModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(82),i(191),i(27)],e=function(t,e,i,n,o,s){function r(t,e,i,n,o,s,r,a,c,l,u,p,d){var h=this;this.profileProgress=t,this.$rootScope=e,this.$scope=i,this.$state=n,this.$log=o,this.$q=s,this.$mdMedia=r,this.DraftsService=a,this.AppSwitcherService=c,this.MessengerService=l,this.$mdDialog=u,this.DraftsValidationService=p,this.profile=d,this.items=[],this.loading=!0,this.listAction="DEFAULT",this.selectedItems=0,this.paginator={total:0,limit:500,offset:0},this.getDrafts(),this.context=this.AppSwitcherService.getContext(),this.$scope.$on("list:added",function(t,e){h.addDraft(e)}),this.$scope.$on("list:remove",function(t,e){h.items=h.items.filter(function(t){return t.id!==e})})}Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["profileProgress","$rootScope","$scope","$state","$log","$q","$mdMedia","DraftsService","AppSwitcherService","MessengerService","$mdDialog","DraftsValidationService","profile"],r.prototype.getDrafts=function(){var e=this;this.loading=!0,this.DraftsService.list(this.paginator.offset,this.paginator.limit).then(function(t){e.paginator.total=t.pagination.total,t.items=t.items.sort(function(t,e){return t.modifiedDate<e.modifiedDate?-1:1}),void 0!==e.context.specialId?t.items.filter(function(t){return void 0!==t.messageDefinitionId}).forEach(function(t){return e.addDraft(t)}):t.items.filter(function(t){return void 0===t.messageDefinitionId}).forEach(function(t){return e.addDraft(t)})}).catch(function(t){e.$log.error("Error getting drafts list",{error:t})}).finally(function(){e.loading=!1})},r.prototype.addDraft=function(e){var i=!1;this.items.filter(function(t){return t.id===e.id}).map(function(t){i=!0}),!1===i&&this.items.unshift(e)},r.prototype.openItem=function(t){var e;"SELECT"===this.listAction?(t.isSelected=!t.isSelected,!0===t.isSelected?this.selectedItems++:this.selectedItems--):(e={draftId:t.id,draft:t,conversationStarter:void 0},"DEFAULT"===this.listAction&&this.$state.go(this.getItemStateName(t),e))},r.prototype.isItemActive=function(t){var e=this.$state.current.name,i=this.$state.params.draftId;return e===this.getItemStateName(t)&&i===t.id},r.prototype.getItemStateName=function(t){return"drafts."+(void 0!==t.messageDefinitionId?"specialedit":"edit")},r.prototype.clearSelection=function(){this.selectedItems=0,this.items.forEach(function(t){return t.isSelected=!1}),this.listAction="DEFAULT"},r.prototype.deleteItems=function(){var i=this,t=this.items.filter(function(t){return t.isSelected}),e=s.WarningDialog.factory({title:"DRAFTS.CANCEL-DIALOG.TITLE",explanation:"DRAFTS.CANCEL-DIALOG.MULTI-DELETION",submitText:"DRAFTS.CANCEL-DIALOG.SUBMIT",cancelText:"DRAFTS.CANCEL-DIALOG.CANCEL",type:s.WarningDialogTypes.warning}),n=[];this.$mdDialog.show(e).then(function(){t.reduce(function(t,e){return t.then(function(){e.isUploading=!1,null!==e.id?(i.$rootScope.$broadcast("list:remove",e.id),i.DraftsValidationService.clearDismissedViolations(e.id),i.DraftsService.remove(e).then(function(t){n.push(t)})):i.$state.go("drafts.index")})},i.$q.resolve()).then(function(){n.every(function(t){return!0===t})?i.MessengerService.toast("DRAFTS.DELETE.SUCCESS"):i.MessengerService.toast("DRAFTS.DELETE.SOME-SUCCESS"),i.clearSelection(),i.$state.go("drafts.index")}).catch(function(t){i.$log.warn("error while deleting drafts",{error:t})})})},e.ListController=r,e.ListControllerModule=i.module("app.drafts.ListController",[o.ComposeButtonModule.name,n.IfEmptyFilterModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(1),i(571),i(33),i(27)],e=function(t,e,i,n,o,s){function r(t,e,i,n,o,s,r,a,c,l){if(this.$rootScope=t,this.$log=e,this.$state=i,this.$translate=n,this.$mdDialog=o,this.DraftsService=s,this.AppSwitcherService=r,this.SpecialsService=a,this.draft=c,this.messageDefinition=l,!(this.loading=!0)==(void 0!==this.AppSwitcherService.getContext().specialId))i.go("drafts.index");else{if(this.formDefinition=l.formDefinition,null!==c.body&&""!==c.body)try{var u=JSON.parse(c.body);this.formDefinition=this.SpecialsService.getResumedFormDefinition(this.formDefinition,u),this.SpecialsService.preOpenSections(this.formDefinition,u)}catch(t){this.$log.error("Could not parse special resumed form data",{error:t})}this.loading=!1}}Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$rootScope","$log","$state","$translate","$mdDialog","DraftsService","AppSwitcherService","SpecialsService","draft","messageDefinition"],r.prototype.deleteSpecialDraft=function(t){var e=this,i=s.WarningDialog.factory({title:"DRAFTS.CANCEL-DIALOG.TITLE",explanation:"DRAFTS.CANCEL-DIALOG.CONFIRMATION",explanationParams:{type:this.messageDefinition.name.toLowerCase()},type:s.WarningDialogTypes.warning,submitText:"MAIN.DELETE"});this.$mdDialog.show(i).then(function(){e.draft.isUploading=!1,null!==e.draft.id?(e.$rootScope.$broadcast("list:remove",e.draft.id),e.DraftsService.remove(e.draft).then(function(){e.$state.go("drafts.index")})):e.$state.go("drafts.index")})},e.SpecialController=r,e.SpecialControllerModule=i.module("app.drafts.SpecialController",[o.AppSwitcherModule.name,n.DraftSpecialModule.name])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,c){var i=[c,e,c(1),c(15),c(99),c(193),c(618)],e=function(t,e,i,n,o,s){Object.defineProperty(e,"__esModule",{value:!0}),a.$inject=["$rootScope","$log","$timeout","$q","$state","$translate","DraftsService","FilesOutService","ReplyService","MessengerService"],a.prototype.$onInit=function(){this.submitTranslated=this.$translate.instant("draft-special.SUBMIT")},a.prototype.submitDraft=function(t){return this.currentState="submitting","initiation"===this.type?this.initiate(t):"response"===this.type?this.reply():this.$q.reject("incorrect type on draft-special set! can not determine whether if initiation or response: "+this.type)},a.prototype.initiate=function(t){var n=this;return new this.$q(function(e,i){if(!1===n.canSend())return n.currentState="sendingfailed",i("cannot initiate");void 0!==t&&(n.draft.subject=t),n.DraftsService.send(n.draft).then(function(t){return n.currentState="sent",n.MessengerService.toast("draft-special.SENT"),n.$state.go("conversations.view",{conversationId:t.conversation},{location:"replace"}),e()}).catch(function(t){return n.currentState="sendingfailed",n.$log.error("initiate called => .catch called, error: ",t),i(t)})})},a.prototype.reply=function(){var n=this;return new this.$q(function(e,i){if(!1===n.canSend())return n.currentState="sendingfailed",i("cannot reply");n.ReplyService.send(n.conversation.id,n.draft,n.accessRightGrantToken).then(function(t){return n.currentState="sent",n.draft.isSending=!1,n.$rootScope.$broadcast("conversations.replied",t),n.reset(),n.MessengerService.toast("draft-special.SENT"),e()}).catch(function(t){return n.currentState="sendingfailed",n.draft.isSending=!1,n.$log.error("Could not reply in special conversation",{error:t}),i("replying failed")})})},a.prototype.reset=function(){this.draft=new n.Draft},a.prototype.canSend=function(){switch(!0){case this.draft.isSending:case this.draft.isUploading:return!1;default:return!0}},a.prototype.updateDraft=function(t,e){null===this.draft.body&&(this.draft.body=""),void 0!==e&&(this.draft.subject=e),void 0!==t&&(this.draft.body=t)},a.prototype.saveDraft=function(t,e){var n=this;return this.updateDraft(t,e),"response"===this.type?this.$q.resolve(!0):this.$q(function(e,i){n.draft.isSaving&&(n.$log.warn("draft is currently being saved, not saving..."),n.$timeout.cancel(n.saveTimeout),n.saveTimeout=n.$timeout(function(){delete n.saveTimeout,n.saveDraft()},1e3),e(!1)),n.draft.isModified=!1,n.draft.isSaving=!0,n.DraftsService.save(n.draft).then(function(t){e(!0)}).catch(function(t){i(t)}).finally(function(){return n.draft.isSaving=!1})})},a.prototype.removeDraft=function(){void 0!==this.draft.id&&this.DraftsService.remove(this.draft)},a.prototype.cancelDraft=function(){this.draft.isUploading=!1,this.removeDraft(),this.$state.go("conversations.index")};var r=a;function a(t,e,i,n,o,s,r,a,c,l){this.$rootScope=t,this.$log=e,this.$timeout=i,this.$q=n,this.$state=o,this.$translate=s,this.DraftsService=r,this.FilesOutService=a,this.ReplyService=c,this.MessengerService=l,this.currentState="pending"}e.DraftSpecial=r,e.DraftSpecialModule=i.module("components.draftSpecial",[o.SpecialsFormModule.name,s.SpecialsSectionModule.name]).component("draftSpecial",{bindings:{type:"@",conversation:"<",draft:"=",accessRightGrantToken:"<",subject:"@",formDefinition:"<"},controller:r,templateUrl:c(619)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,s){var i=[s,e,s(1)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.$onInit=function(){void 0!==this.component.answer&&(this.model=this.component.answer.value)};var n=o;function o(){}e.SpecialsHiddenModule=i.module("components.SpecialsHidden",[]).component("specialsHidden",{bindings:{component:"="},controller:n,templateUrl:s(573),require:{specialsSection:"^specialsSection"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsHidden.780fd8.html"},function(t,e,r){var i=[r,e,r(1),r(25)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model.toString()})};var o=s;function s(){void 0!==this.component.answer&&(this.model=this.component.answer.value)}e.SpecialsInputCheckboxModule=i.module("components.SpecialsInputCheckbox",[]).component("specialsInputCheckbox",{bindings:{component:"="},controller:o,templateUrl:r(575)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputCheckbox.c343b9.html"},function(t,e,r){var i=[r,e,r(1),r(577)],e=function(t,e,i){s.$inject=["$log"],Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log"],o.prototype.$onInit=function(){var i,t,n=this;void 0!==this.component.answerArray?(i=this.component.answerArray.map(function(t){return t.value}),this.model={},this.component.choices.forEach(function(t,e){n.model[e]=-1<i.indexOf(t.value)})):(this.model={},0<(t=this.component.choices.filter(function(t){return void 0!==t.default})).length&&(t.forEach(function(t,e){!0===t.default&&(n.model[e]=!0)}),this.updateModel())),this.component.choices.filter(function(t){return void 0!==t.enables}).forEach(function(t){n.specialsSection.setComponentVisibility(t.enables,!1)})},o.prototype.updateModel=function(){for(var t in this.component.answerArray=[],this.model){var e=this.component.choices[t],t=this.model[t];!0===t&&this.component.answerArray.push(e),void 0!==e.enables&&(this.specialsSection.setComponentVisibility(e.enables,t),this.specialsSection.setComponentRequired(e.enables,!0))}},o.prototype.onChange=function(){this.updateModel(),this.specialsSection.validateSection()};var n=o;function o(t){this.$log=t}function s(t){return{require:"ngModel",link:function(t,e,i,n){var s=i.checkboxesMinItems,r=i.checkboxesMaxItems,o=i.checkboxesRequired;n.$validators.checkboxesValidatorRequired=function(t){if(void 0!==o){var e,i=!1;for(e in t)if(!0===t[e]){i=!0;break}return i}},n.$validators.checkboxesValidatorMinMax=function(t){var e=0,i=!0,n=!0;if(""!==s||""!==r)for(var o in t)!0===t[o]&&e++;return""!==s&&(i=parseInt(s)<=e),""!==r&&(n=e<=parseInt(r)),i&&n}}}}e.SpecialsInputCheckboxesModule=i.module("components.SpecialsInputCheckboxes",[]).directive("checkboxesValidator",s).component("specialsInputCheckboxes",{bindings:{component:"="},controller:n,templateUrl:r(578),require:{specialsSection:"^specialsSection"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputCheckboxes.be8f85.html"},function(t,e,s){var i=[s,e,s(1),s(580)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$window","$sce"],o.prototype.$onInit=function(){var e,i=this;void 0!==this.component.answerArray?(e=this.component.answerArray.map(function(t){return t.value}),this.model=this.component.choices.map(function(t){return-1<e.indexOf(t.value)})):this.model=this.component.choices.map(function(t){return!1}),this.trustSVG(),this.component.choices.forEach(function(t){"body-contour"!==t.value&&"body-shadows"!==t.value&&"floor-shadow"!==t.value&&!0!==i.render||(t.unselectable=!0)}),!1===this.render?this.onChange():this.markForRendering()},o.prototype.trustSVG=function(){var e=this;this.component.choices.forEach(function(t){t.trustedSvg=e.$sce.trustAsHtml('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 600">'+t.svg+"</svg>")})},o.prototype.onChange=function(){for(var t in this.component.answerArray=[],!0===this.component.required&&(this.satisfiesRequired=!1),this.model){var e;this.model.hasOwnProperty(t)&&!0===this.model[t]&&(e=this.component.choices[t],this.$window.document.getElementById("renderable-svg-"+t),this.component.answerArray.push(e),this.satisfiesRequired=!0)}this.specialsSection.validateSection()},o.prototype.markForRendering=function(){var e,t=this.component.getAnswer();void 0!==t&&(e=t,void 0!==this.component.answerArray)&&this.component.choices.filter(function(t){return-1<e.indexOf(t.value)}).forEach(function(t){t.selected=!0})},o.prototype.onKeypress=function(t,e){32===e&&(this.model[t]=void 0===this.model[t]||!this.model[t])};var n=o;function o(t,e){this.$window=t,this.$sce=e,this.satisfiesRequired=!0}e.SpecialsInputCheckboxesSvgModule=i.module("components.SpecialsInputCheckboxesSvg",[]).directive("svgValidator",function(){return{require:["ngModel","^?form"],link:function(t,e,i,n){function o(t){var e,i=!1;for(e in t)if(!0===t[e]){i=!0;break}return i}var s=n.shift(),r=n.shift(),a=i.svgLinkedComponents.split(","),c=i.svgRequired;s.$validators.svgValidatorRequired=function(t){var e=!1;return void 0!==c&&!1===(e=o(t))&&0<a.length?a.some(function(t){t=r[t];return void 0!==t&&o(t.$modelValue)}):e}}}}).component("specialsInputCheckboxesSvg",{bindings:{component:"=",render:"<"},controller:n,templateUrl:s(581),require:{specialsSection:"?^specialsSection"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputCheckboxesSvg.f881ac.html"},function(t,e,a){var i=[a,e,a(1),a(14),a(25),a(583)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["$log","$scope","DeviceService"],r.prototype.$onInit=function(){this.inputType="Apple"===this.DeviceService.getDevice().vendor?"date":"text","date"===this.inputType&&(this.inputFormatRegExp=""),void 0!==this.component.answer&&this.update(this.component.answer.value),this.minDate=n().subtract(120,"years"),this.maxDate=n()},r.prototype.momentify=function(t){var e;return"string"==typeof t?(e=t.replace(/\D/gi,"/"),n(e,this.inputFormat)):n(t)},r.prototype.$postLink=function(){var e=this;this.specialsSection.formCtrl[this.component.key].$validators.dateFormat=function(t){return null!=t&&(t=e.momentify(t),null!==n(t).format(e.serverFormat).match(e.serverFormatRegExp))},this.specialsSection.formCtrl[this.component.key].$validators.dateRange=function(t){return null!=t&&(t=e.momentify(t),void 0===e.minDate||t.isAfter(e.minDate))&&(void 0===e.maxDate||t.isBefore(e.maxDate))},this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&e.updateValue(t.value)})},r.prototype.onChange=function(){var t;if("string"==typeof this.date)t=this.momentify(this.date).format(this.serverFormat);else{if(!(this.date instanceof Date))return;t=n(this.date).format(this.serverFormat)}this.component.answer=new o.FormChoice({value:t}),this.specialsSection.validateSection()},r.prototype.update=function(t){var e=n(t).format(this.serverFormat);"date"===this.inputType?this.date=new Date(t):this.date=n(t).format(this.inputFormat),this.component.answer=new o.FormChoice({value:e})},r.prototype.updateValue=function(t){void 0===t?this.date="":8===t.length&&this.update(t)};var s=r;function r(t,e,i){this.$log=t,this.$scope=e,this.DeviceService=i,this.serverFormat="YYYY-MM-DD",this.serverFormatRegExp="([0-9]{4}).(0[1-9]|1[012]).(0[1-9]|1[0-9]|2[0-9]|3[01])",this.inputFormat="DD-MM-YYYY",this.inputFormatRegExp="([0-9]{1,2}).([0-9]{1,2}).([0-9]{4})"}e.SpecialsInputDateModule=i.module("components.SpecialsInputDate",[]).component("specialsInputDate",{bindings:{component:"="},controller:s,templateUrl:a(584),require:{specialsSection:"^specialsSection"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputDate.cdc895.html"},function(t,e,r){var i=[r,e,r(1),r(25),r(586)],e=function(t,e,i,o){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$window","$timeout","$scope","$log","FilesOutService"],s.prototype.$onInit=function(){var e=this;void 0!==this.component.answer&&(this.model=this.component.answer.value),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.watchFile()},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this;this.$timeout(function(){t.getInputElement().focus()})},s.prototype.onChange=function(){this.specialsSection.validateSection()},s.prototype.watchFile=function(){var t,e=this,i=this.getInputElement();i.addEventListener("change",function(){e.$timeout.cancel(t),t=e.$timeout(function(){var t;0!==i.files.length&&(t=i.files[0],e.filename=t.name,e.specialsSection.closeAllSectionsBelow(),e.onChange(),e.handleFile(t))},10)})},s.prototype.handleFile=function(t){var n=this;this.$timeout(function(){var i;!0===n.specialsSection.sectionValid?(i=n.filename.slice(0,-4).split("_"),n.uploadFile(t)):i=new Array(4),n.component.patternReferences.forEach(function(e,t){n.specialsSection.specialsForm.sections[2].components.filter(function(t){return t.key===e})[0].answer=new o.FormChoice({value:i[t]})})},150)},s.prototype.uploadFile=function(e){var i=this;this.specialsSection.specialsForm.removeAllFiles(),this.specialsSection.specialsForm.awaitUpload(),this.FilesOutService.createFileSlot(this.component.patternReplacementFileName,e.size,e.type,!0).then(function(t){return i.file=t,i.FilesOutService.uploadToFileSlot(t,e)}).then(function(){i.specialsSection.specialsForm.addFile(i.file),i.model=i.file.fileslotId,i.component.answer=new o.FormChoice({value:i.model})}).catch(function(t){i.$log.error("Error uploading file in special filename pattern component",{reason:t})}).finally(function(){i.specialsSection.specialsForm.awaitedUploadDone()})},s.prototype.getInputElement=function(){return this.$window.document.getElementById(this.component.key).querySelector('[component="component"] input')};var n=s;function s(t,e,i,n,o){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n,this.FilesOutService=o}e.SpecialsInputFilenamePatternModule=i.module("components.SpecialsInputFilenamePattern",[]).component("specialsInputFilenamePattern",{bindings:{component:"="},controller:n,templateUrl:r(587),require:{specialsSection:"^specialsSection"}}).directive("filenamePatternValidator",function(){return{require:"ngModel",link:function(t,i,e,n){n.$validators.filenamePatternValidator=function(t,e){return!(n.$isEmpty(e)||!n.$isEmpty(t)&&null===e.toString().match(i[0].pattern))}}}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputFilenamePattern.e34332.html"},function(t,e,a){var i=[a,e,a(1),a(25),a(589),a(592)],e=function(t,e,i,n,o){Object.defineProperty(e,"__esModule",{value:!0}),r.$inject=["FilesOutService","$timeout","$window","$translate","$scope","$log","$element"],r.prototype.$onInit=function(){var e=this;this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.updateModel(this.specialsForm.files),this.$scope.$watch(function(){return e.selectedFile},function(){void 0!==e.selectedFile&&e.uploadImage(e.selectedFile)})},r.prototype.updateModel=function(t){var i=this;t.forEach(function(t){var e=i.component.key;t.name.substring(0,t.name.indexOf("."))===e&&i.$timeout(function(){i.imageName=t.name}).then(function(){return i.uploadImageDone(t)}).catch(function(t){return i.uploadImageCatch(t)}).finally(function(){return i.uploadImageFinally()})})},r.prototype.$onDestroy=function(){this.focusInputWatch()},r.prototype.setFocus=function(){this.$timeout(this.$element[0].focus,0,!1)},r.prototype.uploadImageFailed=function(){this.specialsForm.removeFile(this.file),this.file=void 0,this.component.answer=void 0},r.prototype.uploadImage=function(e){var t,i=this;this.$log.info("SPECIALS::CONSULT >> uploadImage called with selectedFile: ",e),this.thumbnailStatus=this.$translate.instant("specials-input-image.UPLOADING"),this.imageName=e.name,null==(this.image=e)?this.uploadImageFailed():(this.isUploading=!0,this.isUploaded=!1,this.specialsSection.specialsForm.awaitUpload(),t=this.component.key+"."+e.name.split(".").pop(),this.FilesOutService.createFileSlot(t,e.size,e.type,!0).then(function(t){return i.file=t,i.FilesOutService.uploadToFileSlot(t,e)}).then(function(t){return i.uploadImageDone(t)}).catch(function(t){return i.uploadImageCatch(t)}).finally(function(){return i.uploadImageFinally()})),this.specialsSection.validateSection()},r.prototype.uploadImageDone=function(t){this.component.answer=new n.FormChoice({value:t.id}),this.isUploaded=!0,this.thumbnailStatus=this.$translate.instant("specials-input-image.UPLOADED"),this.specialsForm.addFile(t)},r.prototype.uploadImageCatch=function(t){this.uploadImageFailed(),this.thumbnailStatus=this.$translate.instant("specials-input-image.UPLOADFAILED"),this.$log.warn("SPECIALS::CONSULT >> image upload FAILED: ",{reason:t})},r.prototype.uploadImageFinally=function(){var t=this;this.isUploading=!1,this.$timeout(function(){t.isUploaded=!1},2e3,!1),this.specialsSection.specialsForm.awaitedUploadDone()};var s=r;function r(t,e,i,n,o,s,r){this.FilesOutService=t,this.$timeout=e,this.$window=i,this.$translate=n,this.$scope=o,this.$log=s,this.$element=r,this.isUploaded=!1,this.uploadProgress=0,this.isUploading=!1,this.thumbnailStatus=""}e.SpecialsInputImageModule=i.module("ziv.components.SpecialsInputImage",[o.SpecialsAttachButtonModule.name]).component("specialsInputImage",{bindings:{component:"="},controller:s,templateUrl:a(593),require:{specialsSection:"^specialsSection",specialsForm:"^specialsForm"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,s){var i=[s,e,s(1),s(590)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$log","$scope","$element"],o.prototype.triggerFileSelect=function(t){var e=this,i=this.getInputElement();i.onchange=function(){e.selectedFile=i.files[0],e.$scope.$applyAsync()},i.click()},o.prototype.getInputElement=function(){return this.$element.find("input")[0]};var n=o;function o(t,e,i){this.$log=t,this.$scope=e,this.$element=i}e.SpecialsAttachButton=n,e.SpecialsAttachButtonModule=i.module("components.SpecialsAttachButton",[]).component("specialsAttachButton",{bindings:{selectedFile:"="},controller:n,template:s(591)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<label> <md-button class="md-fab md-primary" aria-label="upload image" ng-click=$ctrl.triggerFileSelect($event)> <md-icon>add</md-icon> </md-button> <input type=file name=inputFile class=inputFile accept=image/* /> </label> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputImage.9531e8.html"},function(t,e,s){var i=[s,e,s(1),s(595)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$timeout","$window","$log","$scope"],o.prototype.$onInit=function(){var t,e=this;0===this.component.choices.length&&this.$log.warn("No choices defined for component",{component:this.component}),void 0!==this.component.answer?this.model=this.component.answer.value:(this.model="",1===(t=this.component.choices.filter(function(t){return void 0!==t.default})).length&&(!0===t[0].default&&(this.model=t[0].value),this.onChange())),this.component.choices.filter(function(t){return void 0!==t.enables}).forEach(function(t){e.componentsToEnable.push(t),e.specialsSection.setComponentVisibility(t.enables,!1)}),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&(e.model=t.value)})},o.prototype.$onDestroy=function(){this.focusInputWatch()},o.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] md-radio-group');this.$timeout(function(){t.focus()})},o.prototype.onChange=function(){var t,e=this;this.component.answer=this.component.choices.filter(function(t){return t.value===e.model}).shift(),void 0!==this.model&&(t=this.component.answer,this.componentsToEnable.forEach(function(t){e.specialsSection.setComponentVisibility(t.enables,!1),e.specialsSection.setComponentRequired(t.enables,!1)}),void 0!==t.enables)&&(this.specialsSection.setComponentVisibility(t.enables,!0),this.specialsSection.setComponentRequired(t.enables,!0)),this.specialsSection.validateSection()};var n=o;function o(t,e,i,n){this.$timeout=t,this.$window=e,this.$log=i,this.$scope=n,this.componentsToEnable=[]}e.SpecialsInputRadioButtonModule=i.module("components.SpecialsInputRadioButton",[]).component("specialsInputRadioButton",{bindings:{component:"="},controller:n,templateUrl:s(596),require:{specialsSection:"^specialsSection"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputRadioButton.a77bbf.html"},function(t,e,s){var i=[s,e,s(1)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.$onInit=function(){this.updateQuestionChoices()},o.prototype.updateQuestionChoices=function(e){e&&(this.choices=this.component.choices.filter(function(t){return t.value!==e.value}))},o.prototype.onChange=function(){var e=this;this.component.answer=this.component.choices.filter(function(t){return t.value===e.model}).shift()};var n=o;function o(){this.choices=[]}e.SpecialsInputSelectModule=i.module("ziv.components.SpecialsInputSelect",[]).component("specialsInputSelect",{bindings:{component:"="},controller:n,templateUrl:s(598)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputSelect.c7dcf2.html"},function(t,e,c){var i=[c,e,c(1),c(25)],e=function(t,e,i,n){a.$inject=["$log"],Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$window","$timeout","$scope","$log"],s.prototype.$onInit=function(){var e=this;void 0!==this.component.answer&&(this.model=this.component.answer.value),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&(e.model=t.value)})},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] input');this.$timeout(function(){t.focus()})},s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model}),this.specialsSection.validateSection()};var o=s;function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n}var r=9;function a(t){return{require:"ngModel",link:function(t,e,i,n){n.$parsers.push(function(t){return parseInt(t)}),n.$formatters.push(function(t){return parseInt(t)}),n.$validators.ssnValidator=function(t,e){if(n.$isEmpty(e))return!1;if(n.$isEmpty(t))return!0;if(e.toString().length!==r)return!1;try{return e.toString().split("").map(function(t,e){e=r-e==1?-1:r-e;return parseInt(t)*e}).reduce(function(t,e){return t+e})%11==0}catch(t){return!1}}}}}e.SpecialsInputSsnModule=i.module("components.SpecialsInputSsn",[]).component("specialsInputSsn",{bindings:{component:"="},controller:o,templateUrl:c(600),require:{specialsSection:"^specialsSection"}}).directive("ssnValidator",a)}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputSsn.0fe20f.html"},function(t,e,r){var i=[r,e,r(1),r(25)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$window","$timeout","$scope","$log"],s.prototype.$onInit=function(){var e=this;this.component.autocomplete=this.component.autocomplete.map(function(t){return t[Object.keys(t)[0]]}),void 0!==this.component.answer?this.model=this.component.answer.value:void 0!==this.component.defaultValue&&(this.model=this.component.defaultValue.toString(),this.onChange()),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&(e.model=t.value)})},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] input');this.$timeout(function(){t.focus()},0,!1)},s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model}),this.specialsSection.validateSection()},s.prototype.createNew=function(){this.model=this.search,this.onChange()},s.prototype.onBlur=function(){this.model=this.search,this.onChange()},s.prototype.searchAutocomplete=function(){var e=this;return""===this.search||void 0===this.search?this.component.autocomplete:this.component.autocomplete.filter(function(t){return 0===t.indexOf(e.search)})};var o=s;function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n,this.search=""}e.SpecialsInputTextAutocompleteModule=i.module("ziv.components.SpecialsInputTextAutocomplete",[]).component("specialsInputTextAutocomplete",{bindings:{component:"="},controller:o,templateUrl:r(602),require:{specialsSection:"^specialsSection"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputTextAutocomplete.fc67bc.html"},function(t,e,r){var i=[r,e,r(1),r(25)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$window","$timeout","$scope","$log"],s.prototype.$onInit=function(){var e=this;void 0!==this.component.answer&&(this.model=this.component.answer.value),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&(e.model=t.value)})},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] input');this.$timeout(function(){t.focus()},0,!1)},s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model}),this.specialsSection.validateSection()};var o=s;function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n}e.SpecialsInputTextModule=i.module("ziv.components.SpecialsInputText",[]).component("specialsInputText",{bindings:{component:"="},controller:o,templateUrl:r(604),require:{specialsSection:"^specialsSection"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputText.7e532f.html"},function(t,e,r){var i=[r,e,r(1),r(25)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$window","$timeout","$scope","$log"],s.prototype.$onInit=function(){var e=this;void 0!==this.component.answer&&(this.model=this.component.answer.value),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()})},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] textarea');this.$timeout(function(){t.focus()})},s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model}),this.specialsSection.validateSection()};var o=s;function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n}e.SpecialsInputTextareaModule=i.module("components.SpecialsInputTextarea",[]).component("specialsInputTextarea",{bindings:{component:"="},controller:o,templateUrl:r(606),require:{specialsSection:"^specialsSection"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsInputTextarea.7c8e24.html"},function(t,e,r){var i=[r,e,r(1),r(37)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$log","$element"],s.prototype.$onInit=function(){var t=this.component.imgUrl.split("/")[3],t=n.importSpecialTheme(t).staticImageUrls;this.imgUrl=null!=(t=t[this.component.imgUrl])?t:this.component.imgUrl},s.prototype.$postLink=function(){var t=this;this.$element.find("img").on("error",function(){t.$log.warn("Error loading special static image",{component:t.component})})};var o=s;function s(t,e){this.$log=t,this.$element=e}e.SpecialsStaticImageModule=i.module("components.SpecialsStaticImage",[]).component("specialsStaticImage",{bindings:{component:"="},controller:o,templateUrl:r(608)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsStaticImage.14b010.html"},function(t,e,s){var i=[s,e,s(1)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$sce"],o.prototype.$onInit=function(){this.textHtml=this.$sce.trustAsHtml(this.component.textTranslated)};var n=o;function o(t){this.$sce=t}e.SpecialsStaticText=n,e.SpecialsStaticTextModule=i.module("components.SpecialsStaticText",[]).component("specialsStaticText",{bindings:{component:"="},controller:n,templateUrl:s(610)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsStaticText.492dfa.html"},function(t,e,n){var i=[n,e,n(1),n(612)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.SpecialsStaticTextHeaderModule=i.module("components.SpecialsStaticTextHeader",[]).component("specialsStaticTextHeader",{bindings:{component:"=",enabled:"<",formReference:"<"},controller:function(){},templateUrl:n(613)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsStaticTextHeader.379efa.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsSection.749aaa.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SpecialsForm.91749a.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/DraftSpecial.a46939.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/list.284098.html"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/edit.8c8bbc.html"},function(t,e,r){var i=[r,e,r(1),r(33),r(624)],e=function(t,e,i,n){Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$mdSidenav","$window","$state","$uiRouterGlobals","AppSwitcherService"],s.prototype.goBack=function(){this.$mdSidenav("sidepane").isOpen()?this.$mdSidenav("sidepane").close():this.$state.includes("conversations.reply")?this.$state.go("conversations.view",{conversationId:this.$uiRouterGlobals.params.conversationId}):this.$state.includes("conversations")?this.$state.go("conversations.label",{label:this.$uiRouterGlobals.params.label}):this.$state.includes("drafts")?!0===this.inSpecial?this.$state.go("conversations.label",{label:"inbox"}):this.$state.go("drafts.index"):this.$state.includes("contacts")?"contacts.view"===this.$state.current.name?this.$state.go("contacts."+this.$state.params.listType):this.$state.go("contacts.personal"):this.$state.includes("settings")?this.$state.go("settings"):this.$window.history.go(-1)};var o=s;function s(t,e,i,n,o){this.$mdSidenav=t,this.$window=e,this.$state=i,this.$uiRouterGlobals=n,this.AppSwitcherService=o,this.inSpecial=void 0!==this.AppSwitcherService.getContext().specialId}e.BackButton=o,e.BackButtonModule=i.module("components.BackButton",[n.AppSwitcherModule.name]).component("backButton",{controller:o,template:r(625)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports="<md-button class=md-icon-button ng-click=$ctrl.goBack() translate-namespace=back-button> <md-tooltip md-delay=500> <translate>.TOOLTIP</translate> </md-tooltip> <md-icon class=back-arrow>keyboard_arrow_left</md-icon> </md-button> "},function(t,e,l){var i=[l,e,l(9),l(1),l(8),l(54),l(24),l(627)],e=function(t,e,i,n,o,s,r){Object.defineProperty(e,"__esModule",{value:!0}),c.$inject=["$scope","$window","$log","$timeout","$translate","$state","$mdDialog","AccessRightGrantService","AuthSessionService","DelegateAccountService","LoginService","MessengerService","ProfileService","StorageService"],c.prototype.$onInit=function(){var i=this;this.isDelegate=this.AuthSessionService.isDelegate(),this.listPrincipalAccounts(),this.$scope.$on("profile-updated",function(t,e){i.profile=e.profile,i.entrustedAccounts=i.entrustedAccounts.slice(1),i.entrustedAccounts.unshift(i.profile)}),this.$scope.$on("$destroy",function(){i.ProfileService.clearCachedProfile()})},c.prototype.listPrincipalAccounts=function(){var e=this;return this.DelegateAccountService.getDelegations().then(function(t){e.entrustedAccounts=i.__spreadArrays([e.profile],t.filter(function(t){return t.email!==e.profile.email}))}).catch(function(t){e.$log.error("Could not get list of principal accounts",{error:t})})},c.prototype.openState=function(t,e){this.$state.go(t,e=void 0===e?{}:e)},c.prototype.selectAccount=function(e){var t,i=this;void 0===e&&(e=null),this.profile.uuid!==e&&(t=this.entrustedAccounts.filter(function(t){return t.uuid===e})[0],this.LoginService.switchAccount(t.email).then(function(){i.AccessRightGrantService.clear(),i.StorageService.removeItem("LOCAL","application.context"),i.StorageService.removeItem("SESSION","application.theme"),i.reload()}).catch(function(t){i.entrustedAccounts=i.entrustedAccounts.filter(function(t){return t.uuid!==e}),t.status===o.HTTP_UNAUTHORIZED&&void 0!==t.data&&void 0!==t.data.reason?i.MessengerService.toast("profile-menu."+t.data.reason,{},!0):t.status===o.HTTP_PRECONDITION_FAILED?i.MessengerService.confirm("AUTH.LOGIN-412.EXPLANATION","AUTH.LOGIN-412.TITLE",{},i.$translate.instant("AUTH.LOGIN-412.ACTION"),i.$translate.instant("MAIN.CANCEL")).then(function(){return i.$state.go("settings.security")}):i.$log.error("Unexpected error switching accounts",{error:t})}))},c.prototype.reload=function(){s.locationReload("conversations.index",{},this.$window,this.$state,this.StorageService)};var a=c;function c(t,e,i,n,o,s,r,a,c,l,u,p,d,h){this.$scope=t,this.$window=e,this.$log=i,this.$timeout=n,this.$translate=o,this.$state=s,this.$mdDialog=r,this.AccessRightGrantService=a,this.AuthSessionService=c,this.DelegateAccountService=l,this.LoginService=u,this.MessengerService=p,this.ProfileService=d,this.StorageService=h,this.entrustedAccounts=[],this.isDelegate=!1}e.ProfileMenuModule=n.module("components.ProfileMenu",[r.AvatarModule.name]).component("profileMenu",{bindings:{profile:"<"},controller:a,template:l(628)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<div class=profile translate-namespace=profile-menu> <md-menu md-offset="10 60" md-position-mode="target-right target" md-no-ink> <div ng-click=$mdMenu.open($event)> <avatar avatar-entity=$ctrl.profile avatar-size=lg></avatar> </div> <md-menu-content width=6 class=profile-menu> <div class=account-list> <md-menu-item class="menu-header account-option" ng-repeat="account in $ctrl.entrustedAccounts track by account.uuid" ng-click=$ctrl.selectAccount(account.uuid)> <avatar avatar-entity=account avatar-size=lg></avatar> <div layout=row layout-align="start center" layout-wrap flex> <span class="md-subhead full-name" flex=100>{{ account.fullName }}</span> <span class="md-subhead email" flex=100>{{ account.email }}</span> </div> <md-icon ng-if="$ctrl.profile.email === account.email && $ctrl.entrustedAccounts.length > 1" aria-label="Selected account"> check </md-icon> </md-menu-item> </div> <md-menu-divider></md-menu-divider> <div class=actions-list> <md-menu-item> <md-button class="md-primary edit-profile" aria-label="Edit profile" ng-click="$ctrl.openState(\'settings.profile\')" ng-disabled=$ctrl.isDelegate> <md-icon md-menu-align-target>account_circle</md-icon> <span translate>.EDIT-PROFILE</span> </md-button> </md-menu-item> <md-menu-item> <md-button class="md-primary log-out" aria-label=Logout ng-click="$ctrl.openState(\'logout\')"> <md-icon md-menu-align-target>exit_to_app</md-icon> <span translate>.LOGOUT</span> </md-button> </md-menu-item> </div> </md-menu-content> </md-menu> </div> '},function(t,e,f){var i=[f,e,f(1),f(32),f(11),f(13),f(33),f(80),f(179),f(630)],e=function(t,i,e,n,h,o,s,r,a){Object.defineProperty(i,"__esModule",{value:!0}),i.STORAGE_PREFIX="sidenav.",l.$inject=["$scope","$rootScope","$log","$timeout","$window","$state","$mdDialog","$mdMedia","AuthSessionService","DeviceService","LabelService","StorageService","AppSwitcherService"],l.prototype.$onInit=function(){var t=this,e=(this.state=this.getStorageItem("state")||"CLOSED",this.updateBodyClass(),this.registerEvents(),this.$rootScope.$on("$locationChangeStart",function(){"OPEN"===t.state&&t.toggleState()}),this.labelsCollapsed=!1!==this.getStorageItem("labelsCollapsed"),void 0!==this.AppSwitcherService.getContext().specialId),i=this.AuthSessionService.isDelegate();this.AuthSessionService.hasScope(h.Scopes.RECEIVEMESSAGES)&&this.messageItems.push({state:"conversations.label",stateParams:{label:"inbox"},additionalActiveStates:[["conversations.view",{label:"inbox"}],["conversations.open",{label:"inbox"}]],label:"INBOX",icon:"question_answer"}),this.AuthSessionService.hasScope(h.Scopes.SENDMESSAGES)&&this.messageItems.push({state:"drafts.index",additionalActiveStates:[["drafts",{}]],label:"DRAFTS",icon:"rate_review"}),this.AuthSessionService.hasScope(h.Scopes.RECEIVEMESSAGES)&&this.messageItems.push({state:"conversations.label",stateParams:{label:"archive"},additionalActiveStates:[["conversations.view",{label:"archive"}],["conversations.open",{label:"archive"}]],label:"ARCHIVE",icon:"archive"}),this.AuthSessionService.hasScope(h.Scopes.SENDMESSAGES)&&(this.messageItems.push({state:"conversations.label",stateParams:{label:"trash"},additionalActiveStates:[["conversations.view",{label:"trash"}],["conversations.open",{label:"trash"}]],label:"TRASH",icon:"delete"}),this.addLabelsOption()),1==e?this.restItems.push({state:"specials-about",stateParams:{theme:this.AppSwitcherService.getContext().theme},label:"SPECIALINFO",icon:"help"}):(this.AuthSessionService.hasScope(h.Scopes.SENDMESSAGES)&&(this.profile.isBusiness()&&this.contactItems.push({state:"contacts.all",stateParams:{listType:"all"},additionalActiveStates:[["contacts.view",{listType:"all"}]],label:"CONTACTS-ALL",icon:"supervisor_account"}),this.contactItems.push({state:"contacts.personal",stateParams:{listType:"personal"},additionalActiveStates:[["contacts.view",{listType:"personal"}]],label:"CONTACTS-PERSONAL",icon:"account_circle"}),this.profile.isBusiness())&&this.contactItems.push({state:"contacts.organization",stateParams:{listType:"organization"},additionalActiveStates:[["contacts.view",{listType:"organization"}]],label:"CONTACTS-SHARED",icon:"folder_shared"}),!1===this.AuthSessionService.hasScopes([h.Scopes.ORGANIZATIONADMIN,h.Scopes.USERADMIN,h.Scopes.SUDOADMIN])&&!1===i&&(this.restItems.push({state:"settings.support",label:"SUPPORT",icon:"help"}),this.exceptionStates.push("settings.support")),this.AuthSessionService.hasScopes([h.Scopes.ORGANIZATIONADMIN,h.Scopes.SUDOADMIN])&&!1===i&&this.restItems.push({state:"organization.overview",label:"ORG-SETTINGS",additionalActiveStates:[["organization",{}]],icon:"org-settings"}),!1===i&&this.restItems.push({state:this.$mdMedia("gt-sm")?"settings.profile":"settings",label:"SETTINGS",additionalActiveStates:[["settings",{}]],icon:"personal-settings"}))},l.prototype.showOverlay=function(){return"OPEN"===this.state&&(!1===this.$mdMedia("gt-sm")||!1===this.DeviceService.isDesktop())},l.prototype.showPin=function(){return"OPEN"===this.state&&this.DeviceService.isDesktop()},l.prototype.getStorageItem=function(t){return this.StorageService.getItem("SESSION",""+i.STORAGE_PREFIX+t)},l.prototype.setStorageItem=function(t,e){this.StorageService.setItem("SESSION",""+i.STORAGE_PREFIX+t,e)},l.prototype.go=function(t,e){var i=this;void 0===e&&(e={}),"OPEN"===this.state?(this.toggleState(),this.$timeout(function(){i.$state.transitionTo(t,e,{reload:i.$state.$current.parent})},200)):this.$state.transitionTo(t,e,{reload:this.$state.$current.parent})},l.prototype.toggleLabels=function(){"CLOSED"===this.state?this.toggleState():(this.labelsCollapsed=!this.labelsCollapsed,this.setStorageItem("labelsCollapsed",this.labelsCollapsed))},l.prototype.isStateActive=function(t){if(this.$state.includes(t.state,t.stateParams))return!0;if(void 0!==t.additionalActiveStates)for(var e=0,i=t.additionalActiveStates;e<i.length;e++){var n=i[e],o=n[0];if(this.$state.includes(o,n[1])&&this.exceptionStates.indexOf(this.$state.current.name)<0)return!0}return!1},l.prototype.isLabelActive=function(t){t={label:t.name};return this.$state.includes("conversations.label",t)||this.$state.includes("conversations.view",t)||this.$state.includes("conversations.open",t)},l.prototype.setState=function(t){var e=this;t!==this.state&&this.$timeout(function(){e.setRotate(t),e.state=t,e.updateBodyClass(),"OPEN"!==e.state&&e.setStorageItem("state",e.state)},16,!0)},l.prototype.setRotate=function(t){this.rotate="OPEN"===this.state&&"PINNED"===t||"PINNED"===this.state&&"OPEN"===t},l.prototype.updateBodyClass=function(){var t=this.$window.document.body;"PINNED"===this.state?t.classList.add("sidenav-pinned"):t.classList.remove("sidenav-pinned")},l.prototype.addLabelsOption=function(){var e=this,t=this.LabelService.getLabels();t.then(function(t){e.labels=t.userLabels.filter(function(t){return 0<t.counter})}),t.catch(function(t){e.$log.error("Error getting labels",{error:t})})},l.prototype.addNewLabel=function(t){var e=a.LabelsDialog.factory("EDIT");e.targetEvent=t,e.openFrom=t.currentTarget,e.closeTo=t.currentTarget,this.$mdDialog.show(e)},l.prototype.toggleState=function(){"CLOSED"===this.state||"PINNED"===this.state?this.setState("OPEN"):this.setState("CLOSED")},l.prototype.onMouseLeave=function(){var t=this;"OPEN"===this.state&&this.$mdMedia("gt-sm")&&(this.mouseCloseTimeout=this.$timeout(function(){t.setState("CLOSED"),t.mouseCloseTimeout=void 0},1500,!1))},l.prototype.onMouseEnter=function(){void 0!==this.mouseCloseTimeout&&this.$timeout.cancel(this.mouseCloseTimeout)},l.prototype.registerEvents=function(){var i=this;this.$scope.$on(o.LabelEvents.Updated,function(t,e){i.labels=e.userLabels.filter(function(t){return 0<t.counter})}),this.$scope.$on(o.LabelEvents.Deleted,function(t,e){i.labels=i.labels.filter(function(t){return t.id!==e})}),this.$scope.$on("sidenav:toggle",function(){i.toggleState()}),this.$scope.$on(n.DeviceService.Events.WindowResized,function(){"PINNED"===i.state&&!1===i.$mdMedia("gt-sm")&&i.setState("CLOSED")})};var c=l;function l(t,e,i,n,o,s,r,a,c,l,u,p,d){this.$scope=t,this.$rootScope=e,this.$log=i,this.$timeout=n,this.$window=o,this.$state=s,this.$mdDialog=r,this.$mdMedia=a,this.AuthSessionService=c,this.DeviceService=l,this.LabelService=u,this.StorageService=p,this.AppSwitcherService=d,this.messageItems=[],this.contactItems=[],this.restItems=[],this.labelsCollapsed=!0,this.rotate=!1,this.orgSettingsIcon=f(631),this.personalSettingsIcon=f(632),this.exceptionStates=[],this.hasSpecials=this.AuthSessionService.hasScope(h.Scopes.SPECIALSUSER)}i.Sidenav=c,i.SidenavModule=e.module("components.sidenav",[s.AppSwitcherModule.name,r.VersionModule.name,a.LabelsDialogModule.name]).component("sidenav",{bindings:{profile:"<"},controller:c,template:f(633)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/img/org-settings.03b51c.svg"},function(t,e,i){t.exports=i.p+"assets/v2/img/personal-settings.f00104.svg"},function(t,e){t.exports='<div id=overlay ng-if=$ctrl.showOverlay() ng-click="$ctrl.setState(\'CLOSED\');"> </div> <div class=wrapper translate-namespace=SIDENAV ng-class="\'state-\' + $ctrl.state.toLowerCase()" ng-mouseleave=$ctrl.onMouseLeave() ng-mouseenter=$ctrl.onMouseEnter()> <header> <app-switcher ng-if=$ctrl.hasSpecials></app-switcher> <md-button class="md-icon-button close-button" ng-click="$ctrl.setState(\'CLOSED\');" ng-if="$ctrl.hasSpecials === false"> <md-icon>close</md-icon> </md-button> <div class=icons> <md-button class="md-icon-button set-state-open" aria-label="open sidenav" ng-if="$ctrl.state === \'CLOSED\'" ng-click="$ctrl.setState(\'OPEN\');"> <md-icon>menu</md-icon> </md-button> <md-button class="md-icon-button set-state-pinned" aria-label="pinned sidenav" ng-if=$ctrl.showPin() ng-click="$ctrl.setState(\'PINNED\');" hide show-gt-sm> <md-icon md-svg-src=ziv:pin ng-class="{ \'rotatable\' : $ctrl.rotate === true }"></md-icon> </md-button> <md-button class="md-icon-button set-state-unpin" aria-label="unpin sidenav" ng-if="$ctrl.state === \'PINNED\'" ng-click="$ctrl.setState(\'CLOSED\');" hide show-gt-sm> <md-icon md-svg-src=ziv:pin class="rotatable rotated"></md-icon> </md-button> </div> </header> <div class=sections-wrapper> <section class=conversations> <h2 translate ng-if="::$ctrl.messageItems.length > 0">.CONVERSATIONS-TITLE</h2> <ul> <li ng-repeat="$item in ::$ctrl.messageItems track by $index" ng-click="$ctrl.go($item.state, $item.stateParams);" ng-class="{\'active\' : $ctrl.isStateActive($item)}"> <md-icon>{{:: $item.icon }}</md-icon> <span translate>{{:: \'.ITEMS.\' + $item.label }}</span> </li> <li ng-click=$ctrl.toggleLabels(); ng-if="$ctrl.messageItems.length > 0"> <md-icon>local_offer</md-icon> <span translate>.ITEMS.LABELS</span> <md-icon class="toggle hide-when-mini" ng-bind="$ctrl.labelsCollapsed ? \'expand_more\' : \'expand_less\'"></md-icon> </li> <ul ng-if="$ctrl.labelsCollapsed === false"> <li ng-repeat="$item in $ctrl.labels track by $item.id" ng-click="$ctrl.go(\'conversations.label\', { label : $item.name });" class="child hide-when-mini" ng-class="{ \'active\' : $ctrl.isLabelActive($item) }"> <md-icon ng-style="{ \'color\': $item.labelColor }">lens</md-icon> <span class=name>{{ $item.name }}</span> <span class=counter>{{ $item.counter }}</span> </li> </ul> <ul ng-if="$ctrl.labelsCollapsed === false"> <li ng-click=$ctrl.addNewLabel($event); ng-if="$ctrl.messageItems.length > 0" class="child hide-when-mini"> <md-icon>add</md-icon> <span class=name translate>.LABELS-ADD</span> </li> </ul> </ul> </section> <section class=contacts> <h2 translate ng-if="::$ctrl.contactItems.length > 0">.CONTACTS-TITLE</h2> <ul> <li ng-repeat="$item in ::$ctrl.contactItems track by $index" ng-click="$ctrl.go($item.state, $item.stateParams);" ng-class="{\'active\' : $ctrl.isStateActive($item)}"> <md-icon>{{:: $item.icon }}</md-icon> <span translate>{{:: \'.ITEMS.\' + $item.label }}</span> </li> </ul> </section> <section class="rest settings"> <ul> <li ng-repeat="$item in ::$ctrl.restItems track by $index" ng-click="$ctrl.go($item.state, $item.stateParams);" ng-class="[\n\t\t\t\t\t\t{\'hidden\' : $item.label === \'ORG-SETTINGS\'},\n\t\t\t\t\t\t{\'active\' : $ctrl.isStateActive($item)}\n\t\t\t\t\t]" data-qa=organization-setting-button> <img ng-if="$item.icon === \'org-settings\'" ng-src="{{ $ctrl.orgSettingsIcon }}"/> <img ng-if="$item.icon === \'personal-settings\'" ng-src="{{ $ctrl.personalSettingsIcon }}"/> <md-icon ng-if="$item.icon !== \'org-settings\' && $item.icon !== \'personal-settings\'"> {{:: $item.icon }} </md-icon> <span translate>{{:: \'.ITEMS.\' + $item.label }}</span> </li> </ul> </section> <version with-api="$ctrl.state !== \'CLOSED\'"></version> </div> </div> '},function(t,e,s){var i=[s,e,s(1),s(635)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.prototype.$onInit=function(){this.docsUrl="https://docs.zivver.com/","Android"===this.operatingSystem.name?this.storeUrl="https://play.google.com/store/apps/details?id=com.zivver.app":this.storeUrl="https://itunes.apple.com/app/zivver/id1179528663"},o.prototype.openSupportDropdown=function(){this.isOpen=!0},o.prototype.hideSupportMenu=function(){this.isOpen=!1};var n=o;function o(){this.isOpen=!1}e.SupportMenuModule=i.module("components.SupportMenu",[]).component("supportMenu",{bindings:{isMobile:"<",isGuest:"<",operatingSystem:"<",lang:"<"},controller:n,templateUrl:s(636)})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/v2/tpl/SupportMenu.18be39.html"},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),o.$inject=["$document","$scope","$element"],o.prototype.$onInit=function(){var t=this;this.$scope.$watch("isOpen",function(){t.$scope.isOpen?t.$document.on("click",t.clickHandler):t.$document.off("click",t.clickHandler)})},o.prototype.isOutSide=function(t,e){return!t[0].contains(e.target)};var n=o;function o(t,e,i){var n=this;this.$document=t,this.$scope=e,this.$element=i,this.clickHandler=function(t){n.isOutSide(n.$element,t)&&n.$scope.$apply(function(){n.$scope.clickOutside()})}}e.ClickOutsideDirectiveModule=i.module("common.ClickOutsideDirective",[]).directive("clickOutside",function(){return{restrict:"A",scope:{isOpen:"<",clickOutside:"&"},controller:n,controllerAs:"$ctrl"}})}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,o){var i=[o,e,o(11),o(52)],e=function(t,e,i,s){function n(e,i,t,n,o){var s=o.params().email;return t.get(s).catch(function(t){return e.warn("error resolving contact",{error:t,email:s}),n.toast("CONTACTS.ERRORS.UNKNOWN"),i.go("contacts.index")})}n.$inject=["$log","$state","ContactsService","MessengerService","$transition$"],Object.defineProperty(e,"__esModule",{value:!0}),e.ContactsRoutes=[{parent:"_app_layout",abstract:!0,name:"contacts",url:"/contacts",lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){o.e(8).then(function(){var t=[o(764)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.ContactsModule)})},data:{title:"Contacts",scopesRequired:[i.Scopes.SENDMESSAGES]},views:{"list@_app_layout":{component:"contactList"},"main@_app_layout":{template:'<div class="contacts" layout="row" layout-wrap ui-view></div>'}}},{name:"contacts.personal",url:"/personal",component:"contactsIndex",params:{listType:"personal"}},{name:"contacts.organization",url:"/organization",component:"contactsIndex",onEnter:["$state","profile",function(t,e){!1===e.isBusiness()&&t.go("contacts.personal")}],params:{listType:"organization"}},{name:"contacts.all",url:"/all",component:"contactsIndex",onEnter:["$state","profile",function(t,e){!1===e.isBusiness()&&t.go("contacts.personal")}],params:{listType:"all"}},{name:"contacts.view",url:"/{listType:all|personal|organization}/view?email",component:"contactView",onEnter:["$state","profile","$transition$",function(t,e,i){var i=i.params(),n=i.listType,o=i.contact,i=i.email;!1===e.isBusiness()&&"personal"!==n&&t.go("contacts.view",{email:s.encodeEmailForURI(i),contact:o,listType:"personal"})}],params:{listType:"personal"},resolve:{contact:n}}]}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,a){var i=[a,e,a(9),a(11)],e=function(t,e,i,n){o.$inject=["OrganizationService"],s.$inject=["SubscriptionService"],r.$inject=["organization"],Object.defineProperty(e,"__esModule",{value:!0});n=[{abstract:!0,parent:"_app_layout",name:"organization",url:"/organization",data:{title:"Organization Settings",scopesRequired:[n.Scopes.USERADMIN]},lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){a.e(6).then(function(){var t=[a(765)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.OrganizationModule)})},views:{"main@_app_layout":{template:'<div class="settings" ui-view></div>'}},resolve:{organization:o,subscriptionInfo:s}},{name:"organization.dns-settings",url:"/dns-settings",component:"organizationDnsSettings",resolve:{isInboundDirectDeliveryEnabled:["organization",function(t){return t.isInboundDirectDeliveryEnabled}]},onEnter:["$state","subscriptionInfo",function(t,e){if(!1===e.features.has("EmailDnsSettings"))return t.go("_errors.not_found")}]},{name:"organization.domains",url:"/domains",component:"organizationOwnedDomains",onEnter:["$state","subscriptionInfo",function(t,e){if(!1===e.features.has("DomainClaims"))return t.go("_errors.not_found")}]},{name:"organization.notifications",url:"/notifications",component:"organizationNotifications",data:{title:"Organization notifications"},resolve:{organization:o,defaultOrganizationalUnitUuid:r},onEnter:["$state","subscriptionInfo",function(t,e){if(!1===e.features.has("CustomizeNotificationMessage"))return t.go("_errors.not_found")}]},{name:"organization.specials",url:"/specials",component:"organizationSpecials",data:{title:"Organization specials"},onEnter:["$state","subscriptionInfo",function(t,e){if(!1===e.features.has("Specials"))return t.go("_errors.not_found")}]},{name:"organization.unit",url:"/unit/{unitId:uuid}",component:"organizationUnit",data:{title:"Organizational unit"},resolve:{organization:o,defaultOrganizationalUnitUuid:r},onEnter:["$state","$transition$","subscriptionInfo","defaultOrganizationalUnitUuid",function(t,e,i,n){return!1===i.features.has("OrganizationalUnits")?t.go("_errors.not_found"):e.params().unitId===n?t.go("organization.profile"):void 0}]},{name:"organization.units",url:"/units",component:"organizationUnits",data:{title:"Organizational units"},resolve:{organization:o,defaultOrganizationalUnitUuid:r,organizationalUnits:["organization",function(t){return t.organizationalUnits}]},onEnter:["$state","subscriptionInfo",function(t,e){if(!1===e.features.has("OrganizationalUnits"))return t.go("_errors.not_found")}]}];function o(t){return t.get()}function s(t){return t.getSubscription()}function r(t){return t.organizationalUnits.filter(function(t){return!0===t.isDefault})[0].id}e.OrganizationRoutes=i.__spreadArrays(n,[{name:"organization.accounts",url:"/accounts",data:{isMigrated:!0,migratedUrl:"/admin/accounts"}},{name:"organization.api-keys",url:"/api-keys",data:{isMigrated:!0,migratedUrl:"/admin/api-keys"}},{name:"organization.audit-log",url:"/audit-log",data:{isMigrated:!0,migratedUrl:"/admin/audit-log"}},{name:"organization.business-rules",url:"/business-rules",data:{isMigrated:!0,migratedUrl:"/admin/business-rules"}},{name:"organization.data-export",url:"/data-export",data:{isMigrated:!0,migratedUrl:"/admin/organization-account#export-user-data"}},{name:"organization.downloads",url:"/downloads",data:{isMigrated:!0,migratedUrl:"/admin/downloads"}},{name:"organization.external-conversations",url:"/external-conversations",data:{isMigrated:!0,migratedUrl:"/admin/conversation-starters"}},{name:"organization.external-services",url:"/external-services",data:{isMigrated:!0,migratedUrl:"/admin/google-workspace-settings"}},{name:"organization.insights",url:"/insights",data:{isMigrated:!0,migratedUrl:"/admin/insights"}},{name:"organization.mail-submission",url:"/mail-submission",data:{isMigrated:!0,migratedUrl:"/admin/smtp-credentials"}},{name:"organization.messages-expiration-date",url:"/messages-expiration-date",data:{isMigrated:!0,migratedUrl:"/admin/message-revocation"}},{name:"organization.network-restrictions",url:"/network-restrictions",data:{isMigrated:!0,migratedUrl:"/admin/trusted-networks"}},{name:"organization.nta-compliance",url:"/nta-compliance",data:{isMigrated:!0,migratedUrl:"/admin/nta-compliance"}},{name:"organization.overview",url:"/overview",data:{isMigrated:!0,migratedUrl:"/admin/overview"}},{name:"organization.plugin-settings",url:"/plugin-settings",data:{isMigrated:!0,migratedUrl:"/admin/plugin-settings"}},{name:"organization.profile",url:"/profile",data:{isMigrated:!0,migratedUrl:"/admin/organization-account"}},{name:"organization.recipients-verifications",url:"/recipients-verifications",data:{isMigrated:!0,migratedUrl:"/admin/recipient-verification"}},{name:"organization.sso",url:"/sso",data:{isMigrated:!0,migratedUrl:"/admin/sso"}},{name:"organization.subscription",url:"/subscription?update",data:{isMigrated:!0,migratedUrl:"/admin/subscription"}},{name:"organization.support",url:"/support",data:{isMigrated:!0,migratedUrl:"/admin/support"}},{name:"organization.support-contact",url:"/support-contact",data:{isMigrated:!0,migratedUrl:"/admin/bring-your-own-support"}},{name:"organization.verification-methods",url:"/verification-methods",data:{isMigrated:!0,migratedUrl:"/admin/verification-methods"}}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,s){var i=[s,e,s(11)],e=function(t,e,i){function n(t){return t.get()}function o(t,e){t.get().then(function(t){return e.getSignature(t.uuid)})}n.$inject=["ProfileService"],o.$inject=["ProfileService","SignatureService"],Object.defineProperty(e,"__esModule",{value:!0}),e.SettingsRoutes=[{parent:"_app_layout",name:"settings",url:"/settings",data:{title:"Settings",scopesRequired:[i.Scopes.USERREGISTRATION]},lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){s.e(7).then(function(){var t=[s(766)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.SettingsModule)})},onEnter:["$state","AuthSessionService",function(t,e){e.isDelegate()&&t.go("conversations.label")}],params:{mode:"default"},views:{"list@_app_layout":{component:"settingsList"},"main@_app_layout":{template:'<div class="settings" ui-view></div>'}},resolve:{profile:n}},{name:"settings.audit-log",url:"/auditlog",component:"settingsAuditLog",data:{title:"Account Audit Log"}},{name:"settings.business-rules",url:"/business-rules",component:"settingsAccountBusinessRules",data:{title:"Account business rules"},onEnter:["$state","profile",function(t,e){if(!1===e.isBusiness())return t.go("_errors.not_found")}]},{name:"settings.delegation",url:"/delegation",component:"settingsDelegation",data:{title:"Delegation settings"},onEnter:["$state","profile",function(t,e){if(!1===e.isPersonal())return t.go("_errors.not_found")}]},{name:"settings.data-export",url:"/data-export",component:"settingsDataExport",data:{title:"Data export settings"}},{name:"settings.notifications",url:"/notifications",component:"settingsNotifications",data:{title:"Notification settings"},resolve:{profile:n}},{name:"settings.profile",url:"/profile",component:"settingsProfile",data:{title:"Profile settings"},resolve:{profile:n}},{name:"settings.recovery",url:"/recovery",component:"settingsRecovery",data:{scopesRequired:[i.Scopes.USERECOVERYCODE],title:"Message recovery"}},{name:"settings.security",url:"/security?highlight",component:"settingsSecurity",data:{title:"Security settings"},params:{highlight:void 0},resolve:{cardHighlight:["$q","$transition$",function(t,e){return t.resolve(e.params().highlight)}],profile:n}},{name:"settings.signature",url:"/signature",component:"settingsSignature",data:{title:"Signature"},resolve:{profile:n,signature:o}},{name:"settings.specials",url:"/specials",component:"settingsSpecials",data:{title:"Specials settings"}},{name:"settings.support",url:"/support",component:"support"}]}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,n){var i=[n,e,n(11)],e=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.SpecialsRoutes=[{abstract:!0,parent:"_app_layout",name:"specials",url:"/specials/{theme:string}",lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){n.e(10).then(function(){var t=[n(767)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.SpecialsModule)})}},{parent:"specials",name:"specials-about",url:"/about",data:{scopesRequired:[i.Scopes.USERREGISTRATION,i.Scopes.SPECIALSUSER],title:"Specials information"},resolve:{special:["$transition$","SpecialsService",function(e,t){return t.listSpecials().then(function(t){return t.filter(function(t){return t.theme===e.params().theme}).shift()})}]},views:{"@":{component:"specialsInfo"}}}]}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e){t.exports='<div id=zivver-main class=zivver-main translate-cloak ngf-drop ngf-drag-over-class=dragover ngf-change=$app.filesDropped($files); data-qa=zivver-main ngf-multiple=true ngf-model-options="{\n\t\tupdateOn: \'drop\',\n\t\tallowInvalid: false,\n\t\tdebounce: 0\n\t}"> <sidenav ng-if="::($app.isGuest === false && $app.isFreemium === false)" profile=::$app.profile></sidenav> <div class="app-container no-guest" ng-class="{ \'freemium\': $app.isFreemium === true }" ng-if="::$app.isGuest === false"> <header class=app layout=row layout-align="space-between center"> <div class=burger hide show-xs show-sm ng-if="::$app.isFreemium === false"> <md-button class="md-icon-button burger-menu" ng-click=$app.toggleSidenav()> <md-icon>menu</md-icon> </md-button> </div> <span flex-xs flex-sm></span> <h1> <a ng-attr-ui-sref="{{ $app.isFreemium ? \'redirect-to-new-webapp\' : \'conversations.label({ label: \\\'inbox\\\' })\' }}"> Zivver </a> </h1> <span flex></span> <md-button ng-if="::$app.isFreemium === true" class="new-inbox md-primary" ui-sref=redirect-to-new-webapp> <span translate>SETTINGS.INBOX-BUTTON.LABEL</span> <md-icon>mail_outline</md-icon> </md-button> <profile-menu profile=::$app.profile data-qa=profile-menu></profile-menu> </header> <div class=body layout=row layout-align="start start"> <div ui-view=list class=column-list></div> <div class=column-content flex> <div class=main ui-view=main></div> </div> <right-pane profile=::$app.profile></right-pane> </div> </div> <div class="app-container guest" ng-if=::$app.isGuest> <header class=app layout=row layout-align="space-between center"> <h1><a>Zivver</a></h1> <span flex></span> <language-select hide show-gt-xs></language-select> <div class=profile layout=row layout-align="end center" data-qa=guest-button-close> <md-button class="" ui-sref="logout({message : \'HASQUIT\'})"> <span translate>MAIN.CLOSE</span> <md-icon>close</md-icon> </md-button> </div> </header> <div class="body guest" layout=row layout-align="start start"> <div class=column-content flex> <div class=main ui-view=main></div> </div> <right-pane profile=::$app.profile></right-pane> </div> </div> </div> <support-menu is-guest=$app.isGuest is-mobile="$app.isMobile || $app.isTablet" lang=$app.lang operating-system=$app.operatingSystem></support-menu> <div id=noprinting> <span class=no-print-message translate>PRINT.NOPRINT</span> </div> '},function(t,e){t.exports='<div id=zivver-main class="zivver-main verify" translate-cloak> <div class="" ng-if="::$app.isGuest === false"> <header class="app no-shadow" layout=row layout-align="space-between center"> <span flex-xs flex-sm></span> <h1><a ui-sref="conversations.label({ label : \'inbox\' })">Zivver</a></h1> <span flex></span> <profile-menu profile=::$app.profile data-qa=profile-menu></profile-menu> </header> <div class="body verify" layout=row layout-align="start start"> <div class=column-content flex> <div class=main ui-view=main></div> </div> </div> </div> </div> <div id=noprinting> <span class=no-print-message translate>PRINT.NOPRINT</span> </div> '},function(t,e,i){t.exports='<div id=zivver-main class=zivver-main translate-namespace=APP.REFRESH> <div class="app-container refresh"> <div class=zivver-loader ng-if="$ctrl.connectionError === false && $ctrl.authenticationError === false"> <img src='+i(84)+' alt="Zivver is loading"> </div> <md-card class=no-connection ng-if=$ctrl.connectionError translate-namespace=.CONNECTION-ERROR> <md-card-title> <md-card-title-text> <span class=md-headline translate>.TITLE</span> </md-card-title-text> </md-card-title> <md-card-content> <p translate> .MESSAGE </p> </md-card-content> <md-card-actions layout=row layout-align="end center" class=actions> <md-button ng-click=$ctrl.tryAgain() class="md-primary md-raised"> <translate>.TRY-AGAIN</translate> </md-button> </md-card-actions> </md-card> <md-card class=no-connection ng-if=$ctrl.authenticationError translate-namespace=.AUTH-401> <md-card-title> <md-card-title-text> <span class=md-headline translate>.TITLE</span> </md-card-title-text> </md-card-title> <md-card-content> <p translate> .MESSAGE </p> </md-card-content> <md-card-actions layout=row layout-align="end center" class=actions> <md-button ng-click=$ctrl.loginAgain() class="md-primary md-raised"> <translate>.LOGIN-AGAIN</translate> </md-button> </md-card-actions> </md-card> </div> </div> '},function(t,e,i){t.exports=i.p+"assets/v2/tpl/pod.6997f1.html"},function(t,e,f){var i=[f,e,f(9),f(1),f(648),f(650),f(651),f(103),f(80),f(104),f(652)],e=function(t,e,i,n,o,s,r,a,c,l){p.$inject=["$stateProvider"],d.$inject=["$q","AuthSessionService","LoginService"],h.$inject=["$q","ProfileService","accessToken"],Object.defineProperty(e,"__esModule",{value:!0});var u=31536e3;function p(t){var e={authorizationRequired:!1,permissionsRequired:[],bodyClass:"landing auth"};t.state({name:"landing-open",url:"/l/{openOrShare:open|share}/{uuid:uuid}/{token:token}?{messageId}&{fileId:uuid}",template:f(653),controller:o.OpenController,controllerAs:"$ctrl",data:i.__assign(i.__assign({},e),{doNotTrack:!0}),resolve:{accessToken:d,profile:h}}),t.state({name:"landing-theme",url:"/l/special/{theme}?{next}",controller:r.SpecialController,data:e}),t.state({name:"landing-mobapp-sso-start",url:"/l/mobapp-sso-start?url&scheme",controller:["$uiRouterGlobals","$window","LoginService","AuthSessionService",function(t,e,i,n){var t=t.params,o=t.url,t=t.scheme;n.forgetMe(),n.setSessionDurationOverride(u),i.setLoginDestination("landing-mobapp-sso-success",{scheme:t}),e.location.href=o}],data:e}),t.state({name:"landing-mobapp-sso-success",url:"/l/mobapp-sso-success",params:{refreshToken:void 0,scheme:void 0},controller:["$uiRouterGlobals","$window","AuthSessionService",function(t,e,i){t=t.params.scheme,i=i.getRefreshToken();e.location.href=t+"://?token="+i}],data:e}),t.state({name:"landing-download-attachment",url:"/l/download-attachment/{shareId:uuid}/{messageId}/{fileId:uuid}?recipient",templateUrl:f(655),controller:s.DownloadAttachmentController,controllerAs:"$ctrl",data:{authorizationRequired:!0,permissionsRequired:[],bodyClass:"landing auth"},resolve:{accessToken:d,profile:h}})}function d(t,e,i){return e.isGuest()?t.resolve(void 0):e.isAuthenticated()?t.resolve(e.getAccessToken()):e.hasRefreshToken()?i.refresh().then(function(t){return t.accessToken}):t.resolve(void 0)}function h(t,e,i){return void 0!==i?e.get():t.resolve(!1)}e.LandingModule=n.module("zivver.landing",[o.OpenControllerModule.name,s.DownloadAttachmentControllerModule.name,c.VersionModule.name,a.FooterDonsModule.name,l.LanguageSelectModule.name]),e.LandingModule.config(p)}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,c){var i=[c,e,c(1),c(14),c(8),c(184),c(54),c(51)],e=function(t,e,i,n,b,o,s,r){Object.defineProperty(e,"__esModule",{value:!0});var w=c(649),i=(e.OpenControllerModule=i.module("landing.OpenController",[o.ConversationChallengeModule.name]),a.$inject=["profile","$log","$q","$state","$translate","$window","$cookies","AuthSessionService","ConversationsService","DelegateAccountService","KeysService","LoginService","ProfileService","ShareTokenService","StorageService","ThemeService","$uiRouterGlobals","DeviceService","$rootScope"],a.prototype.resolveConflict=function(){"stay-logged-in"===this.userConflictResolution?this.$state.go("conversations.label",{location:"replace"}):(this.AuthSessionService.forgetMe(),this.$window.location.reload())},a.prototype.changeToDelegate=function(){var t=this;this.LoginService.switchAccount(this.intendedRecipient).then(function(){s.locationReload("conversations.open",{shareId:t.shareId},t.$window,t.$state,t.StorageService)})},a.prototype.switchToBeta=function(){var t=n().add(30,"days").toDate();this.$cookies.put("beta","1",{expires:t}),this.$window.location.reload()},a.prototype.dismissBetaNotice=function(){this.showBetaNotice=!1},a.prototype.getShareAndBranding=function(i){var n=this,t=(void 0===i&&(i=!1),r.setUserId(this.AuthSessionService.getMainAccountId()),this.ConversationsService.getShare(this.shareId).then(function(e){return r.setConversationContext(e.conversationId),n.ConversationsService.getBrandingForShare(e).then(function(t){return void 0!==t&&void 0!==t.name&&"zivver"!==t.name&&(n.ThemeService.loadTheme(t,!0),n.logo=t.logoUrl),e}).catch(function(){return e})}));this.$q.all([t,this.ProfileService.get()]).then(function(t){var e=t[0],t=t[1];n.share=e,n.isEmailChallenge=n.share.isEmailAccessRight(),n.profile=t,n.showBetaNotice=i&&t.isGuest(),!1===e.isAccessGranted()?n.getConversation(e).then(function(t){n.isShareUrl&&n.$window.location.reload(),n.conversation=t,n.screen="challenge",n.trackPageview()}).catch(function(t){return n.$log.error("Error: ",{err:t})}):void 0!==n.messageId&&void 0!==n.fileId?n.goToDownloadAttachment():n.goToConversation()}).catch(function(t){n.$log.error("Error resolving data for guest conversation-challenge",{error:t}),n.trackPageview("2751"),n.AuthSessionService.forgetMe(),n.$window.location.reload()})},a.prototype.goToDownloadAttachment=function(){return this.$state.transitionTo("landing-download-attachment",{shareId:this.shareId,messageId:this.messageId,fileId:this.fileId},{location:"replace"})},a.prototype.goToConversation=function(){return this.$state.transitionTo("conversations.open",{shareId:this.shareId},{location:"replace"})},a.prototype.checkShareToken=function(t){var i=this;r.setUserId(this.AuthSessionService.getMainAccountId()),this.KeysService.verifyAdoptShareToken(t).then(function(e){!1===e.isAdoptable&&void 0!==e.canBeAdoptedBy?(i.intendedRecipient=e.canBeAdoptedBy,i.DelegateAccountService.getDelegations().then(function(t){return t.map(function(t){return t.email})}).then(function(t){-1<t.indexOf(e.canBeAdoptedBy)?i.screen="for-delegate":i.screen="user-conflict",i.trackPageview()})):i.goToConversation()},function(t){i.screen="error",i.error="Unexpected error occurred (code: 2767)",i.$log.error("Could not verify share token adoption (code: 2767)",{error:t}),i.trackPageview("2767")})},a.prototype.getShareIdFromToken=function(t){t=t.split(".")[1],t=JSON.parse(atob(t));return this.$log.warn("Getting share id from legacy JWT"),t.shareUuid},a.prototype.getConversation=function(t){var e=this;return this.ConversationsService.get(t.conversationId).then(function(t){return t}).catch(function(t){return e.screen="error",e.error=e.$translate.instant("LANDING.OPEN.ERROR.CHALLENGE-RESOLVE")+" (code: 2750)",e.$log.error("Error resolving data for guest conversation-challenge",{error:t}),e.trackPageview("2750"),e.$q.reject(t)})},a.prototype.trackPageview=function(t){t?r.trackPageView("guests."+this.screen+"-"+t):r.trackPageView("guests."+this.screen)},a);function a(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,m,v,g,S){var $=this,e=(this.profile=t,this.$log=e,this.$q=i,this.$state=n,this.$translate=o,this.$window=s,this.$cookies=r,this.AuthSessionService=a,this.ConversationsService=c,this.DelegateAccountService=l,this.KeysService=u,this.LoginService=p,this.ProfileService=d,this.ShareTokenService=h,this.StorageService=f,this.ThemeService=m,this.DeviceService=g,this.$rootScope=S,this.intendedRecipient="stay-logged-in",this.logo=w,this.screen="loading",this.showBetaNotice=!1,this.isMobile=!1,this.isTablet=!1,this.isShareUrl=!1,this.isMobile=this.DeviceService.isMobile(),this.isTablet=this.DeviceService.isTablet(),this.operatingSystem=this.DeviceService.getOS(),this.$rootScope.$on("$translateChangeSuccess",function(){$.lang=$.$translate.use().toLowerCase()}),v.params),i=e.uuid,n=e.token,o=e.openOrShare,s=e.messageId,r=e.fileId,y=(this.expired=!1,this.shareId="share"===o?i:this.getShareIdFromToken(n),this.messageId=s,this.fileId=r,this.isShareUrl="share"===o,"share"===o&&"serviceWorker"in navigator);this.ShareTokenService.storeToken(this.shareId,n),this.AuthSessionService.isAuthenticated()?t.isGuest()?this.getShareAndBranding(y):this.checkShareToken(n):this.LoginService.authCodeLogin(n,!1).then(function(){return $.getShareAndBranding(y)},function(t){$.showBetaNotice=!1,t.status===b.HTTP_CONFLICT?$.$state.go("login",{nextState:"conversations.open",nextParams:{shareId:$.shareId}},{location:"replace"}):($.$translate("LANDING.OPEN.ERROR.AUTHENTICATION").then(function(t){$.screen="error",$.error=t+" (code: 2749)"}),$.$log.error("Could not log in guest (code: 2749)",{error:t}),$.trackPageview("2749"))})}e.OpenController=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){t.exports=i.p+"assets/v2/img/ZIVVER-logo.de4453.svg"},function(t,e,i){i=[i,e,i(9),i(1),i(14),i(8)],e=function(t,e,a,i,n,o){function s(t,e,i,n,o,s,r,a,c){this.$log=t,this.$q=e,this.$uiRouterGlobals=i,this.$translate=n,this.$window=o,this.ConversationsService=s,this.DelegateAccountService=r,this.LoginService=a,this.profile=c,this.loading=!0;t=this.$uiRouterGlobals.params,e=t.shareId;this.checkDelegations(e,t.messageId,t.fileId,t.recipient)}Object.defineProperty(e,"__esModule",{value:!0}),s.$inject=["$log","$q","$uiRouterGlobals","$translate","$window","ConversationsService","DelegateAccountService","LoginService","profile"],s.prototype.checkDelegations=function(i,n,o,s){var r=this;void 0!==s&&s!==this.profile.email?this.DelegateAccountService.getDelegations().then(function(t){var t=t.reduce(function(t,e){return a.__spreadArrays(t,e.aliases,[e.email])},[]),e=t.filter(function(t){return t===s})[0];void 0!==e?r.LoginService.switchAccount(e).then(function(){return r.setDownloadLink(i,n,o)}):(r.error="NOT_FOUND",r.$log.error("The recipient is not in the list of delegates",{recipient:s,delegates:t}))}).catch(function(t){r.error="NOT_FOUND",r.$log.error("Error getting delegations in OpenController",{error:t})}):this.setDownloadLink(i,n,o)},s.prototype.setDownloadLink=function(t,e,i){var n=this;this.getDownloadUrl(t,e,i).then(function(t){n.loading=!1,n.downloadLink=t}).catch(function(t){n.$log.error("Something went wrong while getting the attachment",{error:t}),t.status===o.HTTP_FORBIDDEN?n.error="FORBIDDEN":n.error=t.status===o.HTTP_NOT_FOUND?"NOT_FOUND":t.status===o.HTTP_UNAUTHORIZED?"LOGGEDOUT":"UNKNOWN"})},s.prototype.getDownloadUrl=function(t,e,i){var n=this;return this.ConversationsService.getShare(t).then(function(t){return n.share=t,n.ConversationsService.getMessage(t.conversationId,e,t.accessRightGrant.token)}).then(function(t){var e=a.__spreadArrays(t.files,[].concat.apply([],((null==(e=null==t?void 0:t.quote)?void 0:e.messages)||[]).map(function(t){return t.files})));return n.attachment=e.filter(function(t){return t.id===i})[0],n.expiration=void 0!==t.scheduledExpiration?t.scheduledExpiration.expiresAt:void 0,!0===n.attachment.downloadable?n.ConversationsService.getFileDownloadUrl(n.share,i):n.$q.reject("The attachment is not downloadable")})},s.prototype.getExpirationDescription=function(){var t=n(this.expiration).fromNow();return this.$translate.instant("download-large-file.EXPIRATION",{expirationDuration:t})},s.prototype.downloadAttachment=function(){this.$window.open(this.downloadLink,"_self")},e.DownloadAttachmentController=s,e.DownloadAttachmentControllerModule=i.module("landing.DownloadAttachmentController",[])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){i=[i,e,i(37)],e=function(t,e,o){function i(t,e,i){var i=i.params,n=i.theme,i=i.next;void 0!==n&&o.loadTheme(n),"/login"!==i&&t.warn("SpecialController got an unexpected url to go next: ",{next:i}),e.go("login")}Object.defineProperty(e,"__esModule",{value:!0}),i.$inject=["$log","$state","$uiRouterGlobals"],e.SpecialController=i}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){},function(t,e,i){t.exports='<div id=overlay ng-if=$ctrl.showBetaNotice ng-click=$ctrl.dismissBetaNotice();> </div> <div class="beta md-whiteframe-4dp" translate-namespace=LANDING.OPEN.BETA ng-if=$ctrl.showBetaNotice> <div class=beta-close> <md-icon ng-click=$ctrl.dismissBetaNotice();>close</md-icon> </div> <div class=beta-image> <img ng-src='+i(654)+' alt=logo class=logo /> </div> <div class=beta-text> <div class=title translate>.TITLE</div> <div class=desc translate>.DESCRIPTION</div> <md-button class="md-raised md-primary" ng-click=$ctrl.switchToBeta();><translate>.YES</translate></md-button> </div> </div> > <div class="auth landing open" translate-cloak translate-namespace=LANDING.OPEN> <main> <div class=loader ng-if="$ctrl.screen === \'loading\'"> <md-progress-linear md-mode=query></md-progress-linear> </div> <div ng-if="$ctrl.screen === \'challenge\'"> <img ng-src="{{ $ctrl.logo }}" alt=logo class=logo /> <conversation-challenge conversation=$ctrl.conversation share=$ctrl.share sender=$ctrl.sender profile=$ctrl.profile expired=$ctrl.expired message-id=$ctrl.messageId file-id=$ctrl.fileId></conversation-challenge> </div> <div ng-if="$ctrl.screen === \'user-conflict\'" translate-namespace=.USER-CONFLICT> <img ng-src="{{ $ctrl.logo }}" alt=logo class=logo /> <p class=intro translate translate-values="{\n\t\t\t\t\tuser : $ctrl.profile.email,\n\t\t\t\t\trecipient : $ctrl.intendedRecipient\n\t\t\t\t}"> .INTRO </p> <div> <md-radio-group ng-model=$ctrl.userConflictResolution> <md-radio-button value=stay-logged-in class=md-primary> <translate translate-values="{ user : $ctrl.profile.email }">.STAY-LOGGED-IN</translate> </md-radio-button> <md-radio-button value=logout-current-user class=md-primary> <translate translate-values="{\n\t\t\t\t\t\t\t\tuser : $ctrl.profile.email,\n\t\t\t\t\t\t\t\trecipient : $ctrl.intendedRecipient\n\t\t\t\t\t\t\t}">.LOGOUT-CURRENT-USER</translate> </md-radio-button> </md-radio-group> <div class=actions> <md-button class="md-raised md-primary" ng-click=$ctrl.resolveConflict();> <translate>.SUBMIT</translate> </md-button> </div> </div> </div> <div ng-if="$ctrl.screen === \'for-delegate\'" translate-namespace=.FOR-DELEGATE> <img ng-src="{{ $ctrl.logo }}" alt=logo class=logo /> <p class=intro translate translate-values="{\n\t\t\t\t\tuser : $ctrl.profile.email,\n\t\t\t\t\trecipient : $ctrl.intendedRecipient\n\t\t\t\t}"> .INTRO </p> <div> <div class=actions> <md-button class="md-raised md-primary" ng-click=$ctrl.changeToDelegate();> <translate>.SUBMIT</translate> </md-button> </div> </div> </div> <div class=error ng-if="$ctrl.screen === \'error\'" ng-bind-html=$ctrl.error></div> </main> </div> <footer> <version with-api=false></version> <div class=secured-by ng-if="$ctrl.hasDefaultLogo() === false" layout=row> <span class=text translate>LANDING.OPEN.SECURED-BY</span> <span class=logo>ZIVER</span> </div> </footer> <language-select class=open-guest></language-select> <support-menu is-guest=$ctrl.profile.isGuest() is-mobile="$ctrl.isMobile || $ctrl.isTablet" lang=$ctrl.lang operating-system=$ctrl.operatingSystem></support-menu> '},function(t,e,i){t.exports=i.p+"assets/v2/img/beta-logo.1e0364.svg"},function(t,e,i){t.exports=i.p+"assets/v2/tpl/DownloadAttachment.c7f597.html"},function(t,e,i){i=[i,e,i(1)],e=function(t,e,i){function n(t){var e="Zivver",i=t[0];return{setTitle:function(t){null===t?i.title=e:"  "===t.substr(-2)?i.title=t:i.title=t+" - "+e},getTitle:function(){return i.title.replace(e,"")}}}n.$inject=["$document"],Object.defineProperty(e,"__esModule",{value:!0}),e.DocumentTitleServiceModule=i.module("services.DocumentTitleService",[]).factory("DocumentTitleService",n).run(["$transitions",function(t){t.onSuccess({},function(t){var e=t.to(),t=t.injector().get("DocumentTitleService");i.isDefined(e.data)&&i.isDefined(e.data.title)?t.setTitle(e.data.title):t.setTitle(null)})}])}.apply(e,i);void 0!==e&&(t.exports=e)},function(t,e,i){e=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorRoutes=[{name:"_errors",abstract:!0,template:i(658),lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){i.e(9).then(function(){var t=[i(768)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.ErrorsModule)})},data:{authorizationRequired:!1,permissionsRequired:[],bodyClass:"error auth"}},{name:"_errors.not_found",component:"errorsNotFound"},{name:"_errors.permissions",component:"errorsPermissions",resolve:{prevState:["$q","$transition$",function(t,e){return t.resolve(e.params().prevState)}],scopes:["$q","$transition$",function(t,e){return t.resolve(e.params().scopes)}]}},{name:"_errors.state_change",component:"errorsStateChange"}]}.apply(e,[i,e]);void 0!==e&&(t.exports=e)},function(t,e){t.exports='<div class="auth errors" translate-cloak ui-view></div> '},,,,,,,,,,,function(t,e,i){t.exports=i.p+"assets/v2/img/zivver.5e0470.svg"},function(t,e,i){i=[i,e,i(671),i(692),i(716),i(725),i(732),i(753)],e=function(t,e){Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,i);void 0!==e&&(t.exports=e)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){}],[[239,0,1,5]]]);